console.info("UnityPluginVersion: e82c8ebcc2de09344efee07d6cc81f7b38f50aaf");
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./src/coverview/CoverviewLayouts.ts":
/*!*******************************************!*\
  !*** ./src/coverview/CoverviewLayouts.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.webviewLayout = exports.nativeviewLayout = void 0;
var TagBaseClass_1 = __importDefault(__webpack_require__(/*! ./TagBaseClass */ "./src/coverview/TagBaseClass.ts"));
var layoutUtils = function () {
    var inherit = "inherit";
    var ltr = "ltr";
    var rtl = "rtl";
    var row = "row";
    var rowReverse = "row-reverse";
    var column = "column";
    var columnReverse = "column-reverse";
    var flexStart = "flex-start";
    var center = "center";
    var stretch = "stretch";
    var flexEnd = "flex-end";
    var spaceBetween = "space-between";
    var spaceAround = "space-around";
    var relative = "relative";
    var absolute = "absolute";
    var directionMap = {
        "row": "left",
        "row-reverse": "right",
        "column": "top",
        "column-reverse": "bottom",
    };
    var oppositeMap = {
        "row": "right",
        "row-reverse": "left",
        "column": "bottom",
        "column-reverse": "top",
    };
    var mainSizeMap = {
        "row": "width",
        "row-reverse": "width",
        "column": "height",
        "column-reverse": "height",
    };
    function isUndefined(value) {
        return typeof value === "undefined";
    }
    function isRow(flexDirection) {
        return flexDirection === row || flexDirection === rowReverse;
    }
    function getMarginStart(node, flexDirection) {
        if (node.style.marginStart !== undefined && isRow(flexDirection)) {
            return node.style.marginStart;
        }
        var margin = null;
        switch (flexDirection) {
            case row:
                margin = node.style.marginLeft;
                break;
            case rowReverse:
                margin = node.style.marginRight;
                break;
            case column:
                margin = node.style.marginTop;
                break;
            case columnReverse:
                margin = node.style.marginBottom;
        }
        return margin !== undefined ? margin : node.style.margin || 0;
    }
    function getMarginEnd(node, flexDirection) {
        if (node.style.marginEnd !== undefined && isRow(flexDirection)) {
            return node.style.marginEnd;
        }
        var margin = null;
        switch (flexDirection) {
            case row:
                margin = node.style.marginRight;
                break;
            case rowReverse:
                margin = node.style.marginLeft;
                break;
            case column:
                margin = node.style.marginBottom;
                break;
            case columnReverse:
                margin = node.style.marginTop;
        }
        return margin !== undefined ? margin : node.style.margin || 0;
    }
    function getBorderStartWidth(node, flexDirection) {
        if (node.style.borderStartWidth !== undefined &&
            node.style.borderStartWidth >= 0 &&
            isRow(flexDirection)) {
            return node.style.borderStartWidth;
        }
        var border = null;
        switch (flexDirection) {
            case row:
                border = node.style.borderLeftWidth;
                break;
            case rowReverse:
                border = node.style.borderRightWidth;
                break;
            case column:
                border = node.style.borderTopWidth;
                break;
            case columnReverse:
                border = node.style.borderBottomWidth;
        }
        return border !== undefined && border !== null && border >= 0
            ? border
            : node.style.borderWidth !== undefined && node.style.borderWidth >= 0
                ? node.style.borderWidth
                : 0;
    }
    function getBorderEndWidth(node, flexDirection) {
        if (node.style.borderEndWidth !== undefined &&
            node.style.borderEndWidth >= 0 &&
            isRow(flexDirection)) {
            return node.style.borderEndWidth;
        }
        var border = null;
        switch (flexDirection) {
            case row:
                border = node.style.borderRightWidth;
                break;
            case rowReverse:
                border = node.style.borderLeftWidth;
                break;
            case column:
                border = node.style.borderBottomWidth;
                break;
            case columnReverse:
                border = node.style.borderTopWidth;
        }
        return border !== undefined && border !== null && border >= 0
            ? border
            : node.style.borderWidth !== undefined && node.style.borderWidth >= 0
                ? node.style.borderWidth
                : 0;
    }
    function getPaddingStart(node, flexDirection) {
        if (node.style.paddingStart !== undefined &&
            node.style.paddingStart >= 0 &&
            isRow(flexDirection)) {
            return node.style.paddingStart;
        }
        var padding = null;
        switch (flexDirection) {
            case row:
                padding = node.style.paddingLeft;
                break;
            case rowReverse:
                padding = node.style.paddingRight;
                break;
            case column:
                padding = node.style.paddingTop;
                break;
            case columnReverse:
                padding = node.style.paddingBottom;
        }
        return padding !== undefined && padding !== null && padding >= 0
            ? padding
            : node.style.padding !== undefined && node.style.padding >= 0
                ? node.style.padding
                : 0;
    }
    function getPaddingEnd(node, flexDirection) {
        if (node.style.paddingEnd !== undefined &&
            node.style.paddingEnd >= 0 &&
            isRow(flexDirection)) {
            return node.style.paddingEnd;
        }
        var padding = null;
        switch (flexDirection) {
            case row:
                padding = node.style.paddingRight;
                break;
            case rowReverse:
                padding = node.style.paddingLeft;
                break;
            case column:
                padding = node.style.paddingBottom;
                break;
            case columnReverse:
                padding = node.style.paddingTop;
        }
        return padding !== undefined && padding !== null && padding >= 0
            ? padding
            : node.style.padding !== undefined && node.style.padding >= 0
                ? node.style.padding
                : 0;
    }
    function getBorder(node, flexDirection) {
        return getBorderStartWidth(node, flexDirection) + getPaddingStart(node, flexDirection);
    }
    function getMargin(node, flexDirection) {
        return getMarginStart(node, flexDirection) + getMarginEnd(node, flexDirection);
    }
    function getPadding(node, flexDirection) {
        return getPaddingStart(node, flexDirection) + getPaddingEnd(node, flexDirection);
    }
    function getAlignSelf(node, parent) {
        return (node.style.alignSelf ||
            parent.style.alignItems ||
            "stretch");
    }
    function reverseDirection(direction, parentDirection) {
        if (parentDirection === rtl) {
            if (direction === row)
                return rowReverse;
            if (direction === rowReverse)
                return row;
        }
        return direction;
    }
    function getMainAxis(direction, parentDirection) {
        return (direction === column || direction === columnReverse) ? reverseDirection(row, parentDirection) : column;
    }
    function getPositionType(node) {
        return node.style.position || relative;
    }
    function isFlex(node) {
        return getPositionType(node) === relative && node.style.flex && node.style.flex > 0;
    }
    function getMainSize(node, direction) {
        return node.layout[mainSizeMap[direction]] + getMargin(node, direction);
    }
    function hasMainSize(node, direction) {
        return (node.style[mainSizeMap[direction]] !== undefined &&
            node.style[mainSizeMap[direction]] >= 0);
    }
    function hasDefinedSize(node, direction) {
        return node.style[mainSizeMap[direction]] !== undefined;
    }
    function getDefinedSize(node, direction) {
        return node.style[mainSizeMap[direction]] || 0;
    }
    function getMinSize(node, direction, parentSize) {
        var minSizeMap = {
            "row": "minWidth",
            "row-reverse": "minWidth",
            "column": "minHeight",
            "column-reverse": "minHeight",
        };
        var maxSizeMap = {
            "row": "maxWidth",
            "row-reverse": "maxWidth",
            "column": "maxHeight",
            "column-reverse": "maxHeight",
        };
        var size = parentSize;
        if (node.style[maxSizeMap[direction]] !== undefined &&
            node.style[maxSizeMap[direction]] >= 0 &&
            size > node.style[maxSizeMap[direction]]) {
            size = node.style[maxSizeMap[direction]];
        }
        if (node.style[minSizeMap[direction]] !== undefined &&
            node.style[minSizeMap[direction]] >= 0 &&
            size < node.style[minSizeMap[direction]]) {
            size = node.style[minSizeMap[direction]];
        }
        return size;
    }
    function getMaxSize(node, direction, parentSize) {
        var maxSizeMap = {
            "row": "maxWidth",
            "row-reverse": "maxWidth",
            "column": "maxHeight",
            "column-reverse": "maxHeight",
        };
        var size = parentSize;
        if (node.style[maxSizeMap[direction]] !== undefined &&
            node.style[maxSizeMap[direction]] >= 0 &&
            size > node.style[maxSizeMap[direction]]) {
            size = node.style[maxSizeMap[direction]];
        }
        return size;
    }
    function getPaddingAndBorder(node, direction) {
        return getPadding(node, direction) + getBorder(node, direction);
    }
    function getMarginAndPadding(node, direction) {
        return getMargin(node, direction) + getPadding(node, direction);
    }
    function getAlignBaseline(node, parent) {
        return (parent.layout[directionMap[parent.style.flexDirection || '']] -
            node.layout[directionMap[node.style.flexDirection || '']] -
            node.layout[oppositeMap[node.style.flexDirection || '']]);
    }
    function getAlignStart(node, parent, direction) {
        return (parent.layout[directionMap[direction]] +
            getMarginStart(node, direction) +
            getPaddingStart(parent, direction));
    }
    function getAlignEnd(node, parent, direction) {
        return (parent.layout[oppositeMap[direction]] -
            node.layout[mainSizeMap[direction]] -
            getMarginEnd(node, direction) -
            getPaddingEnd(parent, direction));
    }
    function getAlignCenter(node, parent, direction) {
        return (parent.layout[directionMap[direction]] +
            (parent.layout[mainSizeMap[direction]] -
                node.layout[mainSizeMap[direction]]) /
                2 +
            getMarginStart(node, direction) +
            getPaddingStart(parent, direction));
    }
    function getAlignStretch(node, parent, direction) {
        return (parent.layout[directionMap[direction]] +
            getMarginStart(node, direction) +
            getPaddingStart(parent, direction));
    }
    function getAlign(node, parent, direction) {
        var alignSelf = getAlignSelf(node, parent);
        switch (alignSelf) {
            case flexStart:
                return getAlignStart(node, parent, direction);
            case flexEnd:
                return getAlignEnd(node, parent, direction);
            case center:
                return getAlignCenter(node, parent, direction);
            case stretch:
                return getAlignStretch(node, parent, direction);
            default:
                return getAlignBaseline(node, parent);
        }
    }
    function layoutNode(node, parentWidth, parentDirection) {
        var direction = node.style.direction || inherit;
        var flexDirection = reverseDirection(node.style.flexDirection || column, direction);
        var mainAxis = getMainAxis(flexDirection, flexDirection);
        var crossAxis = reverseDirection(mainAxis, direction);
        var mainSize = hasMainSize(node, mainAxis)
            ? node.style[mainSizeMap[mainAxis]]
            : parentWidth - getMarginAndPadding(node, mainAxis);
        var crossSize = hasMainSize(node, crossAxis)
            ? node.style[mainSizeMap[crossAxis]]
            : parentWidth - getMarginAndPadding(node, crossAxis);
        if (node.style.measure) {
            var measuredSize = node.style.measure(mainSize);
            node.layout.width = measuredSize.width + getPaddingAndBorder(node, row);
            node.layout.height = measuredSize.height + getPaddingAndBorder(node, column);
        }
        else {
            node.layout.width = getMaxSize(node, row, parentWidth);
            node.layout.height = getMaxSize(node, column, parentWidth);
        }
        node.layout.direction = flexDirection;
        node.layout[directionMap[mainAxis]] = getAlign(node, node, mainAxis);
        node.layout[oppositeMap[mainAxis]] = node.layout[directionMap[mainAxis]] + node.layout[mainSizeMap[mainAxis]];
        node.layout[directionMap[crossAxis]] = getAlign(node, node, crossAxis);
        node.layout[oppositeMap[crossAxis]] = node.layout[directionMap[crossAxis]] + node.layout[mainSizeMap[crossAxis]];
        for (var _i = 0, _a = node.children; _i < _a.length; _i++) {
            var child = _a[_i];
            layoutNode(child, node.layout.width || 0, flexDirection);
        }
    }
    function computeLayout(node, parentWidth, parentDirection) {
        layoutNode(node, parentWidth, parentDirection);
    }
    return {
        layoutNodeImpl: layoutNode,
        computeLayout: computeLayout,
        fillNodes: function fillNodes(node) {
            node.layout = node.layout || {
                width: undefined,
                height: undefined,
                top: 0,
                left: 0,
                right: 0,
                bottom: 0,
            };
            node.style = node.style || {};
            node.children = node.children || [];
            node.children.forEach(fillNodes);
            return node;
        },
    };
}();
function updateLayoutBox(node, parent) {
    var shouldUpdate = false;
    parent.layoutBox = parent.layoutBox || {};
    ["left", "top", "width", "height"].forEach(function (prop) {
        shouldUpdate = shouldUpdate || parent.layoutBox[prop] !== node.layout[prop];
        parent.layoutBox[prop] = node.layout[prop];
    });
    parent.shouldUpdate = parent.shouldUpdate || shouldUpdate;
    node.children.forEach(function (child) {
        var childNode = parent.children[child.id];
        if (childNode) {
            updateLayoutBox(child, childNode);
        }
    });
}
function updateNode(node) {
    var promises = [];
    if (node.isInserted) {
        if (node.shouldUpdate) {
            promises.push(node.update());
        }
    }
    else {
        promises.push(node.insert());
    }
    node.children.forEach(function (child) {
        promises.push(updateNode(child));
    });
    return Promise.all(promises);
}
function syncUpdateNode(node) {
    if (node.isInserted) {
        if (node.shouldUpdate) {
            node.update();
        }
    }
    else {
        node.insert();
    }
    node.children.forEach(syncUpdateNode);
}
var LayoutNode = /** @class */ (function (_super) {
    __extends(LayoutNode, _super);
    function LayoutNode(_a) {
        var _b = _a === void 0 ? {} : _a, style = _b.style, name = _b.name, _c = _b.auto, auto = _c === void 0 ? true : _c;
        var _this = _super.call(this, {
            style: style,
            id: 0,
            name: name,
        }) || this;
        _this.auto = auto;
        _this.onebyone = true;
        _this.on("layout", function () {
            if (_this.auto) {
                setTimeout(function () { return _this.layout(); }, 0);
            }
        });
        return _this;
    }
    LayoutNode.prototype.layout = function (oneByOne) {
        var _this = this;
        var parentWidth = this.style.width || 0;
        var parentDirection = this.style.direction || "ltr";
        var node = this.toNode();
        layoutUtils.fillNodes(node);
        layoutUtils.computeLayout(node, parentWidth, parentDirection);
        updateLayoutBox(node, node);
        if (oneByOne === undefined) {
            oneByOne = this.onebyone;
        }
        return oneByOne ? updateNode(node).then(function () { return _this.emit("update-done"); }) : (syncUpdateNode(node), Promise.resolve().then(function () { return _this.emit("update-done"); }));
    };
    LayoutNode.prototype.toNode = function () {
        var _this = this;
        return {
            children: this.getChildrenNodes(),
            style: this.style,
            layout: this.layoutBox || {},
            id: this.id,
            isInserted: this.isInserted,
            shouldUpdate: this.shouldUpdate,
            update: function () { return _this.update(); },
            insert: function () { return _this.insert(); },
        };
    };
    LayoutNode.prototype.getChildrenNodes = function () {
        var _this = this;
        return Object.keys(this.children).map(function (childId) { return _this.children[childId].toNode(); });
    };
    LayoutNode.prototype.insert = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    LayoutNode.prototype.update = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    return LayoutNode;
}(TagBaseClass_1.default));
var webviewLayout = new LayoutNode({
    name: "webview-layout",
});
exports.webviewLayout = webviewLayout;
webviewLayout.dest = 0;
var nativeviewLayout = new LayoutNode({
    name: "nativeview-layout",
    auto: false,
});
exports.nativeviewLayout = nativeviewLayout;
nativeviewLayout.onebyone = false;
nativeviewLayout.dest = 1;


/***/ }),

/***/ "./src/coverview/EventEmitter.ts":
/*!***************************************!*\
  !*** ./src/coverview/EventEmitter.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports) {


var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var isArray = Array.isArray ? Array.isArray : function (e) {
    return Object.prototype.toString.call(e) === "[object Array]";
};
var DEFAULT_MAX_LISTENERS = 20;
function warnMemoryLeak(count, eventName) {
    console.warn("[Event] ".concat(count, " listeners of event ").concat(eventName, " have been added, possibly causing memory leak."));
}
var EventEmitter = /** @class */ (function () {
    function EventEmitter(options) {
        this._events = {};
        this._maxListeners = DEFAULT_MAX_LISTENERS;
        this._newListener = false;
        this._removeListener = false;
        this._conf = options;
        if (options) {
            this.delimiter = options.delimiter || ".";
            this._maxListeners = options.maxListeners || DEFAULT_MAX_LISTENERS;
            this._newListener = !!options.newListener;
            this._removeListener = !!options.removeListener;
        }
    }
    Object.defineProperty(EventEmitter.prototype, "delimiter", {
        get: function () {
            var _a;
            return ((_a = this._conf) === null || _a === void 0 ? void 0 : _a.delimiter) || ".";
        },
        set: function (value) {
            this._conf = this._conf || {};
            this._conf.delimiter = value;
        },
        enumerable: false,
        configurable: true
    });
    EventEmitter.prototype.setMaxListeners = function (maxListeners) {
        this._maxListeners = maxListeners;
        this._conf = this._conf || {};
        this._conf.maxListeners = maxListeners;
    };
    EventEmitter.prototype.on = function (event, listener, prepend) {
        if (prepend === void 0) { prepend = false; }
        return this._on(event, listener, prepend);
    };
    EventEmitter.prototype.prependListener = function (event, listener) {
        return this._on(event, listener, true);
    };
    EventEmitter.prototype.once = function (event, listener) {
        return this._once(event, listener, false);
    };
    EventEmitter.prototype.prependOnceListener = function (event, listener) {
        return this._once(event, listener, true);
    };
    EventEmitter.prototype._once = function (event, listener, prepend) {
        return this._many(event, 1, listener, prepend);
    };
    EventEmitter.prototype.many = function (event, count, listener) {
        return this._many(event, count, listener, false);
    };
    EventEmitter.prototype.prependMany = function (event, count, listener) {
        return this._many(event, count, listener, true);
    };
    EventEmitter.prototype._many = function (event, count, listener, prepend) {
        var _this = this;
        if (typeof listener !== "function") {
            throw new Error("many only accepts instances of Function");
        }
        var wrappedListener = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            if (--count === 0) {
                _this.off(event, wrappedListener);
            }
            return listener.apply(_this, args);
        };
        wrappedListener._origin = listener;
        return this._on(event, wrappedListener, prepend);
    };
    EventEmitter.prototype._on = function (event, listener, prepend) {
        if (typeof listener !== "function") {
            throw new Error("on only accepts instances of Function");
        }
        this._events || (this._events = {});
        this._newListener && this.emit("newListener", event, listener);
        if (!this._events[event]) {
            this._events[event] = listener;
        }
        else {
            if (typeof this._events[event] === "function") {
                this._events[event] = [this._events[event]];
            }
            prepend ? this._events[event].unshift(listener) : this._events[event].push(listener);
            if (!this._events[event].warned && this._maxListeners > 0 && this._events[event].length > this._maxListeners) {
                this._events[event].warned = true;
                warnMemoryLeak(this._events[event].length, event);
            }
        }
        return this;
    };
    EventEmitter.prototype.emit = function (event) {
        var _this = this;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        this._events || (this._events = {});
        if (this._all && this._all.length) {
            this._all.forEach(function (listener) {
                listener.apply(_this, __spreadArray([event], args, true));
            });
        }
        if (typeof this._events[event] === "function") {
            this._events[event].apply(this, args);
            return true;
        }
        else if (Array.isArray(this._events[event])) {
            this._events[event].forEach(function (listener) {
                listener.apply(_this, args);
            });
            return true;
        }
        if (!this._all && event === "error") {
            throw args[0] instanceof Error ? args[0] : new Error("Uncaught, unspecified 'error' event.");
        }
        return !!this._all;
    };
    EventEmitter.prototype.off = function (event, listener) {
        if (typeof listener !== "function") {
            throw new Error("removeListener only takes instances of Function");
        }
        if (!this._events[event]) {
            return this;
        }
        var listeners = this._events[event];
        if (Array.isArray(listeners)) {
            var index = listeners.findIndex(function (l) { return l === listener || l._origin === listener; });
            if (index !== -1) {
                listeners.splice(index, 1);
                if (listeners.length === 0) {
                    delete this._events[event];
                }
            }
        }
        else if (listeners === listener || listeners._origin === listener) {
            delete this._events[event];
        }
        this._removeListener && this.emit("removeListener", event, listener);
        return this;
    };
    EventEmitter.prototype.removeAllListeners = function (event) {
        if (event) {
            delete this._events[event];
        }
        else {
            this._events = {};
        }
        return this;
    };
    EventEmitter.prototype.listeners = function (event) {
        var listeners = this._events[event];
        return Array.isArray(listeners) ? listeners : listeners ? [listeners] : [];
    };
    EventEmitter.prototype.eventNames = function () {
        return Object.keys(this._events);
    };
    EventEmitter.prototype.listenerCount = function (event) {
        var listeners = this._events[event];
        return Array.isArray(listeners) ? listeners.length : listeners ? 1 : 0;
    };
    EventEmitter.prototype.listenersAny = function () {
        return this._all || [];
    };
    return EventEmitter;
}());
exports["default"] = EventEmitter;


/***/ }),

/***/ "./src/coverview/Formatter.ts":
/*!************************************!*\
  !*** ./src/coverview/Formatter.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.noop = noop;
exports.camelCase = camelCase;
exports.capitalizeFirstLetter = capitalizeFirstLetter;
exports.convertColor = convertColor;
function noop() { }
function camelCase(str) {
    return str.split("-")
        .map(function (segment, index) { return index === 0 ? segment : capitalizeFirstLetter(segment); })
        .join("");
}
function capitalizeFirstLetter(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
}
function convertColor(color) {
    var match = null;
    if (!/^#/.test(color) || (color.length !== 7 && color.length !== 9)) {
        match = /^(rgb|rgba)\((.+)\)/.exec(color);
        if (match) {
            return "#" + match[2].split(",")
                .map(function (value, index) {
                value = value.trim();
                var valueNumber = index === 3 ? Math.floor(255 * parseFloat(value)) : parseInt(value, 10);
                var hex = valueNumber.toString(16);
                if (hex.length === 1)
                    hex = "0" + hex;
                return hex;
            })
                .join("");
        }
        return "#00000000";
    }
    return color;
}


/***/ }),

/***/ "./src/coverview/Image.ts":
/*!********************************!*\
  !*** ./src/coverview/Image.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var ViewParser_1 = __webpack_require__(/*! ./ViewParser */ "./src/coverview/ViewParser.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ../lib/SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
function modifyUrl(e) {
    if (!(SystemEnvironmentVariables_1.default.ks.getSystemInfoSync() === "devtools") || typeof e !== "string")
        return e;
    if (/^https?:\/\//.test(e)) {
        var t = e.split("?");
        var r = t[1] || "";
        var n = r.length > 0 ? "&" : "";
        return "".concat(t[0], "?").concat(r).concat(n, "devtools_ignore=true");
    }
    return e;
}
var ImageComponent = /** @class */ (function (_super) {
    __extends(ImageComponent, _super);
    function ImageComponent(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.id, id = _c === void 0 ? 0 : _c, _d = _b.style, style = _d === void 0 ? {} : _d, _e = _b.src, src = _e === void 0 ? '' : _e, _f = _b.name, name = _f === void 0 ? '' : _f, _g = _b.autoInsert, autoInsert = _g === void 0 ? false : _g, eventType = _b.eventType, bubbleEvent = _b.bubbleEvent, clickState = _b.clickState, _h = _b.independent, independent = _h === void 0 ? false : _h, _j = _b.dest, dest = _j === void 0 ? 0 : _j;
        var _this = _super.call(this, {
            id: id,
            style: style,
            props: {
                src: src
            },
            type: "image",
            name: name,
            autoInsert: autoInsert,
            eventType: eventType,
            bubbleEvent: bubbleEvent,
            clickState: clickState,
            independent: independent,
            dest: dest
        }) || this;
        _this.src = src;
        return _this;
    }
    ImageComponent.prototype.toNativeData = function () {
        return Object.assign(_super.prototype.toNativeData.call(this), {
            iconPath: modifyUrl(this.src)
        });
    };
    return ImageComponent;
}(ViewParser_1.CoverView));
exports["default"] = ImageComponent;


/***/ }),

/***/ "./src/coverview/ImagePreviewer.ts":
/*!*****************************************!*\
  !*** ./src/coverview/ImagePreviewer.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ComponentManager = void 0;
exports.parseNode = parseNode;
exports.getComponent = getComponent;
exports.initComponent = initComponent;
exports.deleteComponent = deleteComponent;
exports.setComponent = setComponent;
var Text_1 = __importDefault(__webpack_require__(/*! ./Text */ "./src/coverview/Text.ts"));
var Image_1 = __importDefault(__webpack_require__(/*! ./Image */ "./src/coverview/Image.ts"));
var TagBaseClass_1 = __importDefault(__webpack_require__(/*! ./TagBaseClass */ "./src/coverview/TagBaseClass.ts"));
var ViewParser_1 = __webpack_require__(/*! ./ViewParser */ "./src/coverview/ViewParser.ts");
var Formatter_1 = __webpack_require__(/*! ./Formatter */ "./src/coverview/Formatter.ts");
var ImagePreviewer = /** @class */ (function (_super) {
    __extends(ImagePreviewer, _super);
    function ImagePreviewer(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.style, style = _c === void 0 ? {} : _c, name = _b.name, _d = _b.x, x = _d === void 0 ? 0 : _d, _e = _b.y, y = _e === void 0 ? 0 : _e, _f = _b.width, width = _f === void 0 ? 300 : _f, _g = _b.height, height = _g === void 0 ? 200 : _g, _h = _b.url, url = _h === void 0 ? '' : _h, _j = _b.urls, urls = _j === void 0 ? [] : _j, _k = _b.scale, scale = _k === void 0 ? 1 : _k, _l = _b.autoInsert, autoInsert = _l === void 0 ? true : _l, _m = _b.hide, hide = _m === void 0 ? false : _m, _o = _b.zIndex, zIndex = _o === void 0 ? 0 : _o;
        var _this = _super.call(this, { style: style, name: name }) || this;
        _this.x = x;
        _this.y = y;
        _this.width = width;
        _this.height = height;
        _this.url = url;
        _this.urls = Array.isArray(urls) ? urls : [];
        _this.scale = scale;
        _this.autoInsert = autoInsert;
        _this.hide = hide;
        _this.zIndex = zIndex;
        _this.emitter = null;
        _this._insertPromise = new Promise(function (resolve, reject) { });
        return _this;
    }
    ImagePreviewer.prototype.insert = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    ImagePreviewer.prototype.update = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    ImagePreviewer.prototype.destroy = function () {
        return Promise.resolve();
    };
    ImagePreviewer.prototype.toNativeData = function () {
        return {
            position: this.layoutBox || {
                left: this.x,
                top: this.y,
                width: this.width,
                height: this.height
            },
            urls: this.urls.length > 0 ? this.urls : [this.url],
            scale: this.scale,
            hide: this.hide,
            viewId: this.id,
            zIndex: this.zIndex,
            parentId: this.parentId
        };
    };
    ImagePreviewer.prototype.onImageLoadFail = function (e) {
        console.warn('onImageLoadFail');
    };
    ImagePreviewer.prototype.offImageLoadFail = function (e) {
        console.warn('offImageLoadFail');
    };
    return ImagePreviewer;
}(TagBaseClass_1.default));
var componentMap = {
    'view': ViewParser_1.CoverView,
    'text': Text_1.default,
    'image': Image_1.default,
    'image-previewer': ImagePreviewer
};
var componentCache = new WeakMap();
function getComponent(instance) {
    return componentCache.get(instance) || {};
}
function setComponent(instance, value) {
    if (value === void 0) { value = {}; }
    componentCache.set(instance, value);
}
function deleteComponent(instance) {
    componentCache.delete(instance);
}
function parseNode(instance, node) {
    var component = getComponent(instance);
    var componentConstructor = componentMap[node.name];
    var componentId = '';
    if (node.attributes.id) {
        componentId = (0, Formatter_1.camelCase)(node.attributes.id);
    }
    else {
        console.error("".concat(node.name, " \u7F3A\u5C11id"));
    }
    var componentAttributes = Object.keys(node.attributes).reduce(function (attrs, attrName) {
        var attrValue = node.attributes[attrName];
        var camelCaseAttrName = (0, Formatter_1.camelCase)(attrName);
        if (attrName === 'id') {
            attrs.style = Object.assign(attrs.style || {}, component.style[componentId]);
        }
        else if (attrName === 'class') {
            attrs.style = attrValue.split(/\s+/).reduce(function (styleObj, className) {
                return Object.assign(styleObj, component.style[className]);
            }, attrs.style || {});
        }
        else {
            attrs[camelCaseAttrName] = attrValue !== '' && attrValue !== 'false';
        }
        return attrs;
    }, {});
    componentAttributes.name = componentId;
    var newComponent = new componentConstructor(componentAttributes);
    component[componentId] = newComponent;
    node.children.forEach(function (child) {
        if (child.name === 'video' || child.name === 'image-previewer')
            return;
        var childComponent = parseNode(instance, child);
        newComponent.add(childComponent);
    });
    return newComponent;
}
var ComponentManager = /** @class */ (function () {
    function ComponentManager() {
        setComponent(this, {});
    }
    return ComponentManager;
}());
exports.ComponentManager = ComponentManager;
function initComponent(instance, xom, style, state) {
    var imagePreviewer = getComponent(instance);
    if (!imagePreviewer) {
        setComponent(instance, {});
        initComponent(instance, xom, style, state);
    }
    else {
        imagePreviewer.xom = xom;
        imagePreviewer.style = style;
        imagePreviewer.state = state;
        parseNode(instance, xom);
    }
}


/***/ }),

/***/ "./src/coverview/TagBaseClass.ts":
/*!***************************************!*\
  !*** ./src/coverview/TagBaseClass.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventEmitter_1 = __importDefault(__webpack_require__(/*! ./EventEmitter */ "./src/coverview/EventEmitter.ts"));
var UUIDGenerator_1 = __importDefault(__webpack_require__(/*! ./UUIDGenerator */ "./src/coverview/UUIDGenerator.ts"));
var defaultStyle = {
    hidden: false,
    scale: 1,
    scaleWidth: 1,
    scaleHeight: 1,
    backgroundColorOpacity: 1,
    zIndex: 1,
    fixed: false,
    rotate: 0
};
var propertyKey = [
    'margin',
    'marginTop',
    'marginBottom',
    'marginLeft',
    'marginRight',
    'padding',
    'paddingTop',
    'paddingBottom',
    'paddingLeft',
    'paddingRight',
    'width',
    'height'
];
var stylePropertyKey = [
    'left',
    'top',
    'right',
    'bottom',
    'width',
    'height',
    'margin',
    'marginLeft',
    'marginRight',
    'marginTop',
    'marginBottom',
    'padding',
    'paddingLeft',
    'paddingRight',
    'paddingTop',
    'paddingBottom',
    'fontSize',
    'lineHeight',
    'borderRadius'
];
var TagBaseClass = /** @class */ (function () {
    function TagBaseClass(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.parentId, parentId = _c === void 0 ? 0 : _c, _d = _b.id, id = _d === void 0 ? UUIDGenerator_1.default.increase() : _d, _e = _b.style, style = _e === void 0 ? {} : _e, _f = _b.props, props = _f === void 0 ? {} : _f, _g = _b.name, name = _g === void 0 ? '' : _g;
        var _this = this;
        this.children = {};
        this.parent = null;
        this.dest = 0;
        this.bubbleEvent = false;
        this.parentId = parentId;
        this.id = id;
        this.name = name;
        this.isInserted = false;
        this.shouldUpdate = false;
        this.autoLayout = true;
        this.readyResult = new Promise(function (resolve) {
            _this.on('ready', resolve);
        });
        this.style = __assign(__assign({}, defaultStyle), style);
        this.computedStyle = __assign({}, this.style);
        this.lastComputedStyle = __assign({}, this.style);
        this.layoutBox = null;
        Object.keys(this.style).forEach(function (key) {
            Object.defineProperty(_this.style, key, {
                configurable: true,
                enumerable: true,
                get: function () { return _this.computedStyle[key]; },
                set: function (value) {
                    if (value !== _this.computedStyle[key] && value !== undefined) {
                        _this.computedStyle[key] = value;
                        _this.lastComputedStyle[key] = value;
                        if (stylePropertyKey.includes(key) && _this.style.scale !== undefined) {
                            var scaledValue = value * _this.style.scale;
                            _this.computedStyle[key] = scaledValue;
                            _this.lastComputedStyle[key] = scaledValue;
                        }
                        if (key === 'scale') {
                            stylePropertyKey.forEach(function (prop) {
                                if (_this.style[prop] !== undefined) {
                                    var scaledValue = _this.style[prop] * value;
                                    _this.computedStyle[prop] = scaledValue;
                                    _this.lastComputedStyle[prop] = scaledValue;
                                }
                            });
                        }
                        if (key === 'hidden') {
                            if (value) {
                                // noop(this.id, this.name, '隐藏, 保存宽高', this.computedStyle.width, this.computedStyle.height);
                                propertyKey.forEach(function (prop) {
                                    _this.computedStyle[prop] = 0;
                                });
                            }
                            else {
                                // noop(this.id, this.name, '显示, 设置回来', this.lastComputedStyle.width, this.lastComputedStyle.height);
                                propertyKey.forEach(function (prop) {
                                    _this.computedStyle[prop] = _this.lastComputedStyle[prop];
                                });
                            }
                        }
                        _this.shouldUpdate = true;
                        _this.requestLayout();
                    }
                }
            });
        });
        Object.keys(props).forEach(function (key) {
            Object.defineProperty(_this, key, {
                configurable: true,
                enumerable: true,
                get: function () { return props[key]; },
                set: function (value) {
                    if (value !== props[key]) {
                        props[key] = value;
                        _this.shouldUpdate = true;
                        _this.requestLayout();
                    }
                }
            });
        });
        ['touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(function (event) {
            _this.on(event, function (data) {
                if (_this.bubbleEvent && _this.parent) {
                    var _a = _this.layoutBox || { left: 0, top: 0 }, left_1 = _a.left, top_1 = _a.top;
                    if (event === 'touchstart' || event === 'touchend') {
                        var adjustedData = __assign(__assign({}, data), { x: data.x + left_1, y: data.y + top_1 });
                        _this.parent.emit(event, adjustedData);
                    }
                    else {
                        var adjustedData = data.map(function (point) { return ({
                            x: point.x + left_1,
                            y: point.y + top_1
                        }); });
                        _this.parent.emit(event, adjustedData);
                    }
                }
            });
        });
    }
    TagBaseClass.prototype.getChildren = function () {
        var _this = this;
        return Object.keys(this.children).map(function (childId) {
            var child = _this.children[childId];
            return {
                id: child.id,
                name: child.name,
                style: child.computedStyle,
                children: child.getChildren()
            };
        });
    };
    TagBaseClass.prototype.getAbsolutePosition = function (element) {
        var _a, _b;
        if (!element) {
            return this.getAbsolutePosition(this);
        }
        if (!element.parent) {
            return { left: 0, top: 0 };
        }
        var _c = this.getAbsolutePosition(element.parent), left = _c.left, top = _c.top;
        return {
            left: left + (((_a = element.layoutBox) === null || _a === void 0 ? void 0 : _a.left) || 0),
            top: top + (((_b = element.layoutBox) === null || _b === void 0 ? void 0 : _b.top) || 0)
        };
    };
    TagBaseClass.prototype.add = function (child) {
        child.parent = this;
        child.parentId = this.id;
        child.dest = this.dest;
        this.children[child.id] = child;
        this.requestLayout();
    };
    TagBaseClass.prototype.remove = function (child) {
        var _this = this;
        if (child) {
            if (this.children[child.id]) {
                child.remove();
                delete this.children[child.id];
            }
        }
        else {
            Object.keys(this.children).forEach(function (childId) {
                _this.children[childId].remove();
                delete _this.children[childId];
            });
            this.destroy();
            if (this.parent) {
                delete this.parent.children[this.id];
            }
        }
        this.requestLayout();
    };
    TagBaseClass.prototype.emit = function (event, data) {
        var eventName = eventCheck(event, this.id);
        eventEmitter.emit(eventName, data);
    };
    TagBaseClass.prototype.on = function (event, callback) {
        var eventName = eventCheck(event, this.id);
        eventEmitter.on(eventName, callback);
    };
    TagBaseClass.prototype.once = function (event, callback) {
        var eventName = eventCheck(event, this.id);
        eventEmitter.once(eventName, callback);
    };
    TagBaseClass.prototype.off = function (event, callback) {
        var eventName = eventCheck(event, this.id);
        eventEmitter.off(eventName, callback);
    };
    TagBaseClass.prototype.nextLayout = function (callback) {
        var _this = this;
        if (!callback || typeof callback !== 'function') {
            return new Promise(function (resolve) { return _this.nextLayout(resolve); });
        }
        setTimeout(callback, 250);
        return Promise.resolve();
    };
    TagBaseClass.prototype.nextUpdate = function (callback) {
        var _this = this;
        if (!callback || typeof callback !== 'function') {
            return new Promise(function (resolve) { return _this.nextUpdate(resolve); });
        }
        this.once('update-done', callback);
        return Promise.resolve();
    };
    TagBaseClass.prototype.ready = function () {
        var _this = this;
        var childPromises = Object.keys(this.children).map(function (childId) { return _this.children[childId].ready(); });
        return Promise.all(childPromises.concat(this.readyResult));
    };
    TagBaseClass.prototype.requestLayout = function () {
        if (this.autoLayout) {
            this.emit('layout');
        }
    };
    TagBaseClass.prototype.forceUpdate = function () {
        var _this = this;
        var updatePromise = this.isInserted ? this.update() : this.insert();
        var childPromises = Object.keys(this.children).map(function (childId) { return _this.children[childId].forceUpdate(); });
        return updatePromise.then(function () { return Promise.all(childPromises); });
    };
    TagBaseClass.prototype.insert = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    TagBaseClass.prototype.update = function () {
        this.emit("ready");
        return Promise.resolve();
    };
    TagBaseClass.prototype.destroy = function () {
        var _this = this;
        ['click', 'ready', 'touchstart', 'touchmove', 'touchend', 'touchcancel'].forEach(function (event) {
            var eventName = eventCheck(event, _this.id);
            eventEmitter.removeAllListeners(eventName);
        });
    };
    return TagBaseClass;
}());
var eventEmitter = new EventEmitter_1.default({ maxListeners: 200000 });
function eventCheck(event, id) {
    var validEvents = ['click', 'touchstart', 'touchmove', 'touchend', 'touchcancel', 'ready', 'prop-change'];
    var layoutEvents = ['layout'];
    if (validEvents.includes(event)) {
        return "element-".concat(id, "-").concat(event);
    }
    if (layoutEvents.includes(event)) {
        return event;
    }
    return '';
}
exports["default"] = TagBaseClass;


/***/ }),

/***/ "./src/coverview/Text.ts":
/*!*******************************!*\
  !*** ./src/coverview/Text.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var ViewParser_1 = __webpack_require__(/*! ./ViewParser */ "./src/coverview/ViewParser.ts");
var TextComponent = /** @class */ (function (_super) {
    __extends(TextComponent, _super);
    function TextComponent(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.id, id = _c === void 0 ? 0 : _c, _d = _b.style, style = _d === void 0 ? {} : _d, _e = _b.value, value = _e === void 0 ? '' : _e, _f = _b.name, name = _f === void 0 ? '' : _f, _g = _b.autoInsert, autoInsert = _g === void 0 ? false : _g, eventType = _b.eventType, bubbleEvent = _b.bubbleEvent, clickState = _b.clickState, _h = _b.independent, independent = _h === void 0 ? false : _h, _j = _b.dest, dest = _j === void 0 ? 0 : _j;
        var _this = _super.call(this, {
            id: id,
            style: style,
            props: {
                value: value
            },
            type: 'text',
            name: name,
            autoInsert: autoInsert,
            eventType: eventType,
            bubbleEvent: bubbleEvent,
            clickState: clickState,
            independent: independent,
            dest: dest
        }) || this;
        _this.value = value;
        return _this;
    }
    TextComponent.prototype.toNativeData = function () {
        var _this = this;
        var labelStyle = ['color', 'fontSize', 'textAlign', 'fontWeight', 'lineHeight', 'lineBreak']
            .reduce(function (style, key) {
            if (_this.computedStyle[key] !== undefined) {
                style[key] = _this.computedStyle[key];
            }
            return style;
        }, {});
        return __assign(__assign({}, _super.prototype.toNativeData.call(this)), { label: __assign(__assign({}, labelStyle), { content: this.value }) });
    };
    return TextComponent;
}(ViewParser_1.CoverView));
exports["default"] = TextComponent;


/***/ }),

/***/ "./src/coverview/UUIDGenerator.ts":
/*!****************************************!*\
  !*** ./src/coverview/UUIDGenerator.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var UUIDGenerator = /** @class */ (function () {
    function UUIDGenerator() {
        this.uuid = 32768;
    }
    UUIDGenerator.prototype.increase = function () {
        return this.uuid++;
    };
    return UUIDGenerator;
}());
var uuidGenerator = new UUIDGenerator();
exports["default"] = uuidGenerator;


/***/ }),

/***/ "./src/coverview/ViewParser.ts":
/*!*************************************!*\
  !*** ./src/coverview/ViewParser.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CoverView = void 0;
var TagBaseClass_1 = __importDefault(__webpack_require__(/*! ./TagBaseClass */ "./src/coverview/TagBaseClass.ts"));
var Formatter_1 = __webpack_require__(/*! ./Formatter */ "./src/coverview/Formatter.ts");
var CoverView = /** @class */ (function (_super) {
    __extends(CoverView, _super);
    function CoverView(_a) {
        var _b = _a === void 0 ? {} : _a, _c = _b.id, id = _c === void 0 ? 0 : _c, _d = _b.parentId, parentId = _d === void 0 ? 0 : _d, _e = _b.style, style = _e === void 0 ? {} : _e, _f = _b.props, props = _f === void 0 ? {} : _f, _g = _b.type, type = _g === void 0 ? 'text' : _g, _h = _b.name, name = _h === void 0 ? '' : _h, _j = _b.autoInsert, autoInsert = _j === void 0 ? false : _j, _k = _b.eventType, eventType = _k === void 0 ? 'touch' : _k, _l = _b.clickState, clickState = _l === void 0 ? false : _l, _m = _b.bubbleEvent, bubbleEvent = _m === void 0 ? false : _m, _o = _b.independent, independent = _o === void 0 ? false : _o, _p = _b.dest, dest = _p === void 0 ? 0 : _p;
        var _this = _super.call(this, {
            id: id,
            style: style,
            props: __assign(__assign({}, props), { fullscreen: false }),
            name: name,
            parentId: parentId
        }) || this;
        _this.type = type === 'text' ? 'TextView' : 'ImageView';
        _this.eventType = eventType;
        _this.autoInsert = autoInsert;
        _this.bubbleEvent = bubbleEvent;
        _this.clickState = clickState;
        _this.independent = independent;
        _this.dest = dest;
        if (_this.eventType === 'touch' && _this.clickState) {
            _this.ready()
                .then(function () {
                _this.mask = new CoverView({
                    style: {
                        backgroundColor: 'rgba(0, 0, 0, 0.1)',
                        hidden: true,
                        position: 'absolute',
                        left: 0,
                        top: 0
                    },
                    eventType: 'click',
                    independent: _this.independent
                });
                _this.mask.name = 'mask';
                _this.add(_this.mask);
            })
                .catch(function () { });
        }
        var touchStartTime = Date.now();
        var touchStartPos = { x: 0, y: 0 };
        _this.on('touchstart', function (event) {
            if (_this.clickState && _this.mask) {
                _this.mask.style.hidden = false;
            }
            touchStartTime = Date.now();
            touchStartPos = event;
        });
        var handleTouchEnd = function (event) {
            if (_this.clickState && _this.mask) {
                _this.mask.style.hidden = true;
            }
            var absolutePosition = { left: 0, top: 0 };
            try {
                absolutePosition = _this.getAbsolutePosition();
            }
            catch (error) { }
            var touchEndPos = { x: 0, y: 0 };
            if (Array.isArray(event)) {
                touchEndPos = event.pop();
            }
            else if (event.x !== undefined && event.y !== undefined) {
                touchEndPos = event;
            }
            var clickData = {
                absoluteX: absolutePosition.left + touchStartPos.x,
                absoluteY: absolutePosition.top + touchStartPos.y,
                relativeX: touchStartPos.x,
                relativeY: touchStartPos.y,
                absoluteEndX: absolutePosition.left + touchEndPos.x,
                absoluteEndY: absolutePosition.top + touchEndPos.y,
                relativeEndX: touchEndPos.x,
                relativeEndY: touchEndPos.y,
                pressInterval: Date.now() - touchStartTime
            };
            _this.emit('click', clickData);
        };
        _this.on('touchend', handleTouchEnd);
        _this.on('touchcancel', handleTouchEnd);
        if (_this.autoInsert) {
            _this.insert();
        }
        return _this;
    }
    CoverView.prototype.toNativeData = function () {
        var _this = this;
        var styleKeys = [
            'borderRadius',
            'borderWidth',
            'borderColor',
            'opacity',
            'overflow',
            'fixed',
            'rotate'
        ];
        if (this.type === 'ImageView') {
            styleKeys.push('objectFit');
        }
        var styleData = styleKeys.reduce(function (style, key) {
            style[key] = _this.computedStyle[key];
            if (key === 'borderColor') {
                style[key] = (0, Formatter_1.convertColor)(_this.computedStyle[key]);
            }
            return style;
        }, {});
        styleData.bgColor = (0, Formatter_1.convertColor)(this.computedStyle.backgroundColor);
        styleData.scaleX = this.computedStyle.scaleWidth;
        styleData.scaleY = this.computedStyle.scaleHeight;
        var positionData = {
            left: this.computedStyle.left,
            top: this.computedStyle.top,
            width: this.computedStyle.width,
            height: this.computedStyle.height
        };
        if (this.layoutBox) {
            positionData = {
                left: this.layoutBox.left,
                top: this.layoutBox.top,
                width: this.layoutBox.width,
                height: this.layoutBox.height
            };
        }
        if (this.computedStyle.hidden) {
            positionData.width = 0;
            positionData.height = 0;
        }
        if (this.mask) {
            this.mask.style.width = positionData.width;
            this.mask.style.height = positionData.height;
        }
        styleData.padding = [0, 0, 0, 0];
        if (styleData.borderRadius === undefined) {
            styleData.borderRadius = 0;
        }
        return {
            parentId: this.parentId,
            dest: this.dest,
            viewId: this.id,
            position: positionData,
            hide: this.computedStyle.hidden,
            style: styleData,
            notCoverRect: true,
            fullscreen: this.fullscreen,
            zIndex: this.style.zIndex,
            fixed: styleData.fixed,
            independent: this.independent
        };
    };
    CoverView.prototype.insert = function () {
        var _this = this;
        var nativeData = this.toNativeData();
        nativeData.clickable = this.eventType === 'click';
        nativeData.gesture = this.eventType === 'touch';
        nativeData.transEvt = false;
        nativeData.sendTo = 'appservice';
        nativeData.data = JSON.stringify({ id: this.id });
        this.isInserted = true;
        return new Promise(function (resolve, reject) {
            Object.assign(nativeData, {
                success: function (result) {
                    // noop(this.name, this.id, 'ready');
                    _this.emit('ready');
                    resolve(result);
                },
                fail: reject
            });
        });
    };
    CoverView.prototype.update = function () {
        this.shouldUpdate = false;
        var nativeData = this.toNativeData();
        return new Promise(function (resolve, reject) {
            Object.assign(nativeData, {
                success: resolve,
                fail: reject
            });
        });
    };
    CoverView.prototype.destroy = function () {
        _super.prototype.destroy.call(this);
        var destroyData = {
            dest: this.dest,
            viewId: this.id,
            independent: this.independent
        };
        return new Promise(function (resolve, reject) {
            Object.assign(destroyData, {
                success: resolve,
                fail: reject
            });
        });
    };
    CoverView.prototype.animate = function (_a) {
        var _this = this;
        var _b = _a === void 0 ? {} : _a, left = _b.left, top = _b.top, opacity = _b.opacity, scaleWidth = _b.scaleWidth, scaleHeight = _b.scaleHeight, _c = _b.rotate, rotate = _c === void 0 ? 0 : _c, _d = _b.duration, duration = _d === void 0 ? 500 : _d, easing = _b.easing, _e = _b.emitError, emitError = _e === void 0 ? false : _e;
        var animateData = {
            dest: this.dest,
            viewId: this.id,
            easing: easing || 'ease-in',
            duration: duration,
            finalStyle: {
                left: left,
                top: top,
                opacity: opacity,
                rotate: rotate,
                scaleX: scaleWidth,
                scaleY: scaleHeight
            },
            independent: this.independent
        };
        return new Promise(function (resolve, reject) {
            Object.assign(animateData, {
                success: resolve,
                fail: reject
            });
        })
            .then(function (result) {
            if (left !== undefined) {
                _this.style.left = left;
            }
            if (top !== undefined) {
                _this.style.top = top;
            }
            if (scaleWidth !== undefined) {
                _this.style.scaleWidth = scaleWidth;
            }
            if (scaleHeight !== undefined) {
                _this.style.scaleHeight = scaleHeight;
            }
            if (opacity !== undefined) {
                _this.style.opacity = opacity;
            }
            if (rotate !== undefined) {
                _this.style.rotate = rotate;
            }
            return result;
        })
            .catch(function (error) {
            if (emitError) {
                throw error;
            }
        });
    };
    return CoverView;
}(TagBaseClass_1.default));
exports.CoverView = CoverView;


/***/ }),

/***/ "./src/coverview/XMLParser.ts":
/*!************************************!*\
  !*** ./src/coverview/XMLParser.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
function XmlParser(template) {
    template = template.trim().replace(/<!--[\s\S]*?-->/g, "");
    return {
        declaration: parseDeclaration(),
        root: parseRoot()
    };
    function parseDeclaration() {
        if (match(/^<\?xml\s*/)) {
            var attributes = {};
            while (!isEnd() && !startsWith("?>")) {
                var attr = parseAttribute();
                if (!attr)
                    return { attributes: attributes };
                attributes[attr.name] = attr.value;
            }
            match(/\?>\s*/);
            return { attributes: attributes };
        }
        return { attributes: {} };
    }
    function parseRoot() {
        var rootTag = match(/^<([\w-:.]+)\s*/);
        if (rootTag) {
            var root = {
                name: rootTag[1],
                attributes: {},
                children: []
            };
            while (!(isEnd() || startsWith(">") || startsWith("/>"))) {
                var attr = parseAttribute();
                if (!attr)
                    return root;
                root.attributes[attr.name] = attr.value;
            }
            if (match(/^\s*\/>\s*/))
                return root;
            match(/\?>\s*/);
            root.content = parseContent();
            var child = void 0;
            while ((child = parseRoot())) {
                root.children.push(child);
            }
            match(/^<\/[\w-:.]+>\s*/);
            return root;
        }
        return { name: "", attributes: {}, children: [] };
    }
    function parseAttribute() {
        var attrMatch = match(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);
        if (attrMatch) {
            var value = attrMatch[2].replace(/^['"]|['"]$/g, "");
            return { name: attrMatch[1], value: value };
        }
        return undefined;
    }
    function match(regex) {
        var result = template.match(regex);
        if (result) {
            template = template.slice(result[0].length);
            return result;
        }
        return undefined;
    }
    function isEnd() {
        return template.length === 0;
    }
    function startsWith(str) {
        return template.indexOf(str) === 0;
    }
    function parseContent() {
        var contentMatch = match(/^([^<]*)/);
        return contentMatch ? contentMatch[1] : "";
    }
}
exports["default"] = XmlParser;


/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Constants_1 = __webpack_require__(/*! ./lib/Constants */ "./src/lib/Constants.ts");
var FileSystem_1 = __importDefault(__webpack_require__(/*! ./lib/FileSystem */ "./src/lib/FileSystem.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./lib/FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./lib/UnityManager */ "./src/lib/UnityManager.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./lib/SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var LogReport_1 = __importDefault(__webpack_require__(/*! ./lib/LogReport */ "./src/lib/LogReport.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./lib/ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./lib/GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
GameGlobalVars_1.default.Initialize();
LogReport_1.default.init({
    debug: false,
    pluginAppId: "kwai_game_test_appid",
    pluginVersion: Constants_1.PluginVersion,
    xlogName: "unityPlugin",
});
setTimeout(function () {
    try {
        GameGlobalVars_1.default.logManager.log("[PLUGIN LOG] systemInfo=", SystemEnvironmentVariables_1.default.systemInfo);
        var pluginEnvironment = SystemEnvironmentVariables_1.default.pluginEnv;
        GameGlobalVars_1.default.logManager.log("[PLUGIN LOG] check permission: coverview=".concat(!!pluginEnvironment.coverflow, ", gameTransfer=").concat(!!pluginEnvironment.gameTransfer, ", reportKeyValue=").concat(!!pluginEnvironment.reportKeyValue));
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.log("[PLUGIN LOG] systemInfo=", SystemEnvironmentVariables_1.default.systemInfo);
            console.log("[PLUGIN LOG] check permission: coverview=".concat(!!pluginEnvironment.coverflow, ", gameTransfer=").concat(!!pluginEnvironment.gameTransfer, ", reportKeyValue=").concat(!!pluginEnvironment.reportKeyValue));
        }
    }
    catch (error) {
    }
}, 0);
ReportInitializer_1.default.initialize();
FileSystemManager_1.default.fileSystem = FileSystem_1.default.getInstance();
UnityManager_1.default.showTimes = -1;
exports["default"] = UnityManager_1.default;


/***/ }),

/***/ "./src/lib/AnimationConstant.ts":
/*!**************************************!*\
  !*** ./src/lib/AnimationConstant.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.AnimationStruct = exports.SizeStruct = exports.PositionStruct = void 0;
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var PositionStruct = {
    top: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.None, Types_1.ParamInputType.Percent],
        desc: "屏幕顶边距离。",
    },
    bottom: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.None, Types_1.ParamInputType.Percent],
        desc: "屏幕底边距离，若同时设定Top Bottom 则该属性失效。",
    },
    left: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.None, Types_1.ParamInputType.Percent],
        desc: "屏幕左边距离。",
    },
    right: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.None, Types_1.ParamInputType.Percent],
        desc: "屏幕右边距离，若同时设定 Left Right 则该属性失效。",
    },
    visible: {
        type: Types_1.ParamInputType.Boolean,
        desc: "是否可见。",
        default: true,
    },
};
exports.PositionStruct = PositionStruct;
var SizeStruct = {
    width: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.Percent],
        desc: "宽度。",
    },
    height: {
        type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.Percent],
        desc: "高度。",
    },
    scaleHeight: {
        type: Types_1.ParamInputType.Number,
        desc: "缩放值，标准为1。",
    },
    scaleWidth: {
        type: Types_1.ParamInputType.Number,
        desc: "缩放值，标准为1。",
    },
    opacity: {
        type: Types_1.ParamInputType.Number,
        desc: "透明度，1 为不透明，0 为完全透明。",
    },
};
exports.SizeStruct = SizeStruct;
var AnimationStruct = {
    duration: {
        type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
        desc: "动画持续时间，ms。",
    },
    easing: {
        type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
        desc: "曲率函数名。",
    },
};
exports.AnimationStruct = AnimationStruct;


/***/ }),

/***/ "./src/lib/AssetsLoader.ts":
/*!*********************************!*\
  !*** ./src/lib/AssetsLoader.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var GameWasmLoader_1 = __importDefault(__webpack_require__(/*! ./GameWasmLoader */ "./src/lib/GameWasmLoader.ts"));
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var AssetsLoader = /** @class */ (function (_super) {
    __extends(AssetsLoader, _super);
    function AssetsLoader() {
        var _this = _super.call(this) || this;
        _this.assetsLoadType = Types_1.AssetsLoadType.DownloadAll;
        return _this;
    }
    AssetsLoader.prototype.init = function (unityManagerInstance) {
        this.unityManager = unityManagerInstance;
        this.initConfig();
    };
    AssetsLoader.prototype.getAssetsLoadText = function () {
        return Types_1.AssetsLoadTypeText[this.assetsLoadType];
    };
    Object.defineProperty(AssetsLoader.prototype, "needDownload", {
        get: function () {
            return this.assetsLoadType !== Types_1.AssetsLoadType.AllCached;
        },
        enumerable: false,
        configurable: true
    });
    AssetsLoader.prototype.initAssetsLoadType = function () {
        try {
            var assetStatus = this.getAssetsMd5();
            var wasmCachedStatus = assetStatus.wasmCached;
            var dataPackageCached = assetStatus.dataPackageCached;
            if (wasmCachedStatus && dataPackageCached) {
                this.assetsLoadType = Types_1.AssetsLoadType.AllCached;
            }
            else if (wasmCachedStatus || dataPackageCached) {
                if (wasmCachedStatus && !dataPackageCached) {
                    this.assetsLoadType = Types_1.AssetsLoadType.DownloadDataPackage;
                }
                else if (!wasmCachedStatus && dataPackageCached) {
                    this.assetsLoadType = Types_1.AssetsLoadType.DownloadWasmCode;
                }
            }
            else {
                this.assetsLoadType = Types_1.AssetsLoadType.DownloadAll;
            }
        }
        catch (error) {
            console.error('Error initializing assets load type:', error);
        }
    };
    AssetsLoader.prototype.initConfig = function () {
        try {
            this.initAssetsLoadType();
        }
        catch (error) {
            console.error('Error initializing config:', error);
        }
    };
    AssetsLoader.prototype.getAssetsMd5 = function () {
        var gameWasmLoader = GameWasmLoader_1.default.getInstance();
        return {
            wasmCached: FileSystemManager_1.default.checkFileExist((0, LogUtils_1.resolveCachePath)(gameWasmLoader.filename)),
            dataPackageCached: FileSystemManager_1.default.checkFileExist((0, LogUtils_1.resolveCachePath)(DataPackageLoader_1.default.cachePath)),
        };
    };
    return AssetsLoader;
}(Instance_1.default));
var assetsLoader = AssetsLoader.getInstance();
exports["default"] = assetsLoader;


/***/ }),

/***/ "./src/lib/AuthToken.ts":
/*!******************************!*\
  !*** ./src/lib/AuthToken.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PatchManager_1 = __webpack_require__(/*! ./PatchManager */ "./src/lib/PatchManager.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var AuthToken = /** @class */ (function (_super) {
    __extends(AuthToken, _super);
    function AuthToken() {
        var _this = _super.call(this) || this;
        _this.token = '';
        _this.skipAuth = false;
        _this.useWasmSplit = false;
        return _this;
    }
    AuthToken.prototype.init = function (initParams) {
        this.useWasmSplit = initParams.codeType === Types_1.CodeType.codeSplit;
        this.bindInterface(initParams);
        this.autoRefreshToken();
    };
    AuthToken.prototype.autoRefreshToken = function () {
        var _this = this;
        if (!SystemEnvironmentVariables_1.default.isWK || !this.useWasmSplit) {
            this.refreshTokenPromise = Promise.resolve('');
            this.skipAuth = true;
            return;
        }
        setTimeout(function () {
            _this.autoRefreshToken();
        }, 2400000);
        this.refreshTokenPromise = this.getAuthToken();
    };
    AuthToken.prototype.getAuthToken = function () {
        return __awaiter(this, void 0, void 0, function () {
            var loadingProgressResponse, loadingProgressError, loadingToken, error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        return [4 /*yield*/, (0, Utils_1.handlePromise)((0, Utils_1.executePromiseWithRetry)(this.handleRefreshToken, 1, 1, this.token))];
                    case 1:
                        loadingProgressResponse = _a.sent();
                        loadingProgressError = loadingProgressResponse[0], loadingToken = loadingProgressResponse[1];
                        if (loadingProgressError) {
                            PluginLogger_1.default.pluginError("获取authtoken失败, err=", loadingProgressError);
                            this.skipAuth = true;
                            PluginLogger_1.default.eventLog("跳过鉴权");
                            return [2 /*return*/, ''];
                        }
                        else {
                            this.skipAuth = false;
                            this.token = loadingToken;
                            PluginLogger_1.default.pluginLog("获取token成功, token=", this.token);
                            return [2 /*return*/, this.token];
                        }
                        return [3 /*break*/, 3];
                    case 2:
                        error_1 = _a.sent();
                        PluginLogger_1.default.pluginError("获取authtoken失败, err=", error_1);
                        this.skipAuth = true;
                        PluginLogger_1.default.eventLog("跳过鉴权");
                        return [2 /*return*/, ''];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    AuthToken.prototype.handleRefreshToken = function () {
        return __awaiter(this, arguments, void 0, function (_emptyString) {
            var authPayload;
            if (_emptyString === void 0) { _emptyString = ""; }
            return __generator(this, function (_a) {
                TimeLogManager_1.TimeLogManager.timeStart("refreshToken");
                authPayload = {
                    auth_payload: {
                        md5: GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5,
                        sub_version: GameGlobalVars_1.default.unityNamespace.WASM_SPLIT_SUB_VERSION,
                        last_token: "",
                    },
                };
                if (_emptyString) {
                    authPayload.auth_payload.last_token = _emptyString;
                }
                // TODO Hao Feng 10/23/2024 delete call gametransfer
                return [2 /*return*/, Promise.reject({
                        errmsg: "Gametransfer 'refreshToken' error",
                    })];
            });
        });
    };
    AuthToken.prototype.bindInterface = function (context) {
        var patchManager = PatchManager_1.PatchManager.getInstance();
        context.wasmsplit = context.wasmsplit || {};
        context.wasmsplit.innerInvokeWasmFunc = this.innerInvokeWasmFunc.bind(this);
        context.wasmsplit.instantiatePatch = patchManager.instantiatePatch;
        context.wasmsplit.checkNeedReportMissPatchFunc = patchManager.checkNeedReportMissPatchFunc;
        context.instantiatePatch = patchManager.instantiatePatch;
    };
    AuthToken.prototype.innerInvokeWasmFunc = function (functionArgs) {
        var name = functionArgs.name, invokeWasmFunc = functionArgs.invokeWasmFunc, fail = functionArgs.fail;
        var params = {
            md5: JSON.stringify({
                md5: GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5,
                auth_token: encodeURIComponent(this.token),
            }),
            subVersion: GameGlobalVars_1.default.unityNamespace.WASM_SPLIT_SUB_VERSION,
            funcName: name,
            fail: fail,
        };
        if (this.skipAuth) {
            params.md5 = GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5;
        }
        invokeWasmFunc(params);
    };
    return AuthToken;
}(Instance_1.default));
var authToken = AuthToken.getInstance();
exports["default"] = authToken;


/***/ }),

/***/ "./src/lib/BaseDataLoader.ts":
/*!***********************************!*\
  !*** ./src/lib/BaseDataLoader.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var TaskManager_1 = __importDefault(__webpack_require__(/*! ./TaskManager */ "./src/lib/TaskManager.ts"));
var BaseDataLoader = /** @class */ (function () {
    function BaseDataLoader(unityManager, monitor) {
        this.unityManager = unityManager;
        this.monitor = monitor;
        this.loadCount = 0;
        this.loadedCount = 0;
        this.cacheableCount = 0;
        this.hitCacheCount = 0;
        this.loadFromCacheCount = 0;
        this.loadedSize = 0;
        this.startTime = 0;
        this.useH2 = false;
        this.enabledH2Count = 0;
        this.checkedH2 = false;
        this.useContentEncoding = false;
        this.enabledContentEncodingCount = 0;
        this.needEnableContentEncodingCount = 0;
        this.checkedContentEncoding = false;
    }
    BaseDataLoader.prototype.baseReset = function () {
        this.loadCount = 0;
        this.loadedCount = 0;
        this.cacheableCount = 0;
        this.hitCacheCount = 0;
        this.loadFromCacheCount = 0;
        this.loadedSize = 0;
        this.startTime = 0;
        this.needEnableContentEncodingCount = 0;
    };
    BaseDataLoader.prototype.baseLoad = function () {
        this.startTime || (this.startTime = Date.now());
        this.loadCount += 1;
    };
    BaseDataLoader.prototype.completeLoad = function (taskId, taskResponse, error, taskIndex) {
        this.loadedCount += 1;
        var task = TaskManager_1.default.getTask(taskId, taskIndex);
        if (!task) {
            return false;
        }
        var status = (taskResponse === null || taskResponse === void 0 ? void 0 : taskResponse.status) || (taskResponse === null || taskResponse === void 0 ? void 0 : taskResponse.statusCode);
        if (error || !(0, Utils_1.isSuccessfulHttpStatus)(status)) {
            task.requestFail(error);
        }
        else {
            task.requestSuccess(taskResponse, true);
        }
        TaskManager_1.default.removeTask(task);
        return true;
    };
    BaseDataLoader.prototype.baseCheck = function (task) {
        this.checkHttp2(task);
        this.checkContentEncoding(task);
        this.checkCache(task);
    };
    BaseDataLoader.prototype.checkHttp2 = function (task) {
        var protocol = task.info.protocol;
        if (protocol === "h2" || (protocol === null || protocol === void 0 ? void 0 : protocol.includes("http/2"))) {
            this.enabledH2Count += 1;
        }
    };
    BaseDataLoader.prototype.checkContentEncoding = function (task) {
        var enableContentEncoding = !!task.info.enableContentEncoding;
        if (!enableContentEncoding && !!task.info.cacheable && !task.info.isReadFromCache) {
            this.needEnableContentEncodingCount += 1;
        }
        if (enableContentEncoding) {
            this.enabledContentEncodingCount += 1;
        }
    };
    BaseDataLoader.prototype.checkCache = function (task) {
        if (task.info.hitCache) {
            this.hitCacheCount += 1;
        }
        if (task.info.isReadFromCache) {
            this.loadFromCacheCount += 1;
        }
    };
    return BaseDataLoader;
}());
exports["default"] = BaseDataLoader;


/***/ }),

/***/ "./src/lib/Buffer.ts":
/*!***************************!*\
  !*** ./src/lib/Buffer.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.processBuffer = processBuffer;
var Constants_1 = __webpack_require__(/*! ./Constants */ "./src/lib/Constants.ts");
function processBuffer(buffer) {
    var bufferLength = buffer.byteLength;
    if (Array.from(buffer.slice(-8)).every(function (element, index) {
        return 11 + index === element;
    })) {
        var currentIterationIndex = 1;
        var iterationCount = buffer.slice(-12, -8).reduce(function (accumulator, currentValue, currentIndex) {
            return accumulator + currentValue * Constants_1.BufferWeights[currentIndex];
        }, 0);
        while (currentIterationIndex <= iterationCount) {
            var index = bufferLength - 12 - currentIterationIndex * 6;
            var oldValue = buffer[index];
            var adjustedValue = buffer[index + 1] + 200;
            var val2 = buffer[index + 2];
            var val3 = buffer[index + 3];
            var val4 = buffer[index + 4];
            var val5 = buffer[index + 5];
            var targetIndex = val2 * Constants_1.BufferWeights[0] + val3 * Constants_1.BufferWeights[1] + val4 * Constants_1.BufferWeights[2] + val5;
            buffer[targetIndex] = oldValue;
            buffer[targetIndex + 1] = adjustedValue;
            currentIterationIndex += 1;
        }
        var maxIndex = (buffer[bufferLength - 12 - (currentIterationIndex - 1) * 6 - 1] << 8) + buffer[bufferLength - 12 - (currentIterationIndex - 1) * 6 - 2];
        var currentIndex = 1;
        while (currentIndex <= maxIndex) {
            if (buffer[bufferLength - 12 - (currentIterationIndex - 1) * 6 - 2 - currentIndex] !== 0) {
                return [buffer.buffer, false];
            }
            currentIndex++;
        }
        return [
            buffer.slice(0, bufferLength - 12 - (currentIterationIndex - 1) * 6 - maxIndex - 2).buffer,
            true,
        ];
    }
    if (Array.from(buffer.slice(-8)).every(function (element, index) {
        return 21 + index === element;
    })) {
        var maxIndex = (buffer[bufferLength - 9] << 8) + buffer[bufferLength - 10];
        var currentIndex = 1;
        while (currentIndex <= maxIndex) {
            if (buffer[bufferLength - 10 - currentIndex] !== 0) {
                return [buffer.buffer, false];
            }
            currentIndex++;
        }
        return [
            buffer.slice(0, bufferLength - 8 - maxIndex - 2).buffer,
            true,
        ];
    }
    return [buffer.buffer, false];
}


/***/ }),

/***/ "./src/lib/CacheableXMLHttpRequest.ts":
/*!********************************************!*\
  !*** ./src/lib/CacheableXMLHttpRequest.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var ParsedRequest_1 = __importDefault(__webpack_require__(/*! ./ParsedRequest */ "./src/lib/ParsedRequest.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Task_1 = __importDefault(__webpack_require__(/*! ./Task */ "./src/lib/Task.ts"));
var PreloadTaskManager_1 = __importDefault(__webpack_require__(/*! ./PreloadTaskManager */ "./src/lib/PreloadTaskManager.ts"));
var Events_1 = __webpack_require__(/*! ./Events */ "./src/lib/Events.ts");
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./UnityManager */ "./src/lib/UnityManager.ts"));
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var EventStatus;
(function (EventStatus) {
    EventStatus[EventStatus["Fail"] = 0] = "Fail";
    EventStatus[EventStatus["Ok"] = 1] = "Ok";
})(EventStatus || (EventStatus = {}));
var CacheableXMLHttpRequest = /** @class */ (function () {
    function CacheableXMLHttpRequest() {
        var _this = this;
        this.status = -1;
        this.cacheable = false;
        this.isReadFromCache = false;
        this.isFetchApi = false;
        this.signal = { aborted: false };
        this.paramsCache = {};
        this.cachePath = "";
        this.hasUnityAnalysisLoged = false;
        this.openAndSend = function (url, request) {
            _this.isFetchApi = true;
            _this.open(request.method, url, true);
            _this.responseType = "arraybuffer";
            Object.keys(request.headers).forEach(function (header) {
                _this.setRequestHeader(header, request.headers[header]);
            });
            _this.timeout = request.timeout;
            _this.onprogress = request.onProgress;
            return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            this.onFetchResolve = function () {
                                resolve(new ParsedRequest_1.default(_this));
                            };
                            this.onFetchReject = function (error) {
                                var parsedRequest = new ParsedRequest_1.default(_this);
                                parsedRequest.message = (error === null || error === void 0 ? void 0 : error.errMsg) || (error === null || error === void 0 ? void 0 : error.message) || "";
                                reject(parsedRequest);
                            };
                            return [4 /*yield*/, this.send(request.body)];
                        case 1:
                            _a.sent();
                            return [2 /*return*/];
                    }
                });
            }); });
        };
        this.send = function (content) { return __awaiter(_this, void 0, void 0, function () {
            var requestedUrl, cachePath, body, httpResponseCode, filename, preloadTaskManager, task, taskResult, _a, error, fileContent, error_1, task, error_2;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        _b.trys.push([0, 12, , 13]);
                        requestedUrl = this.paramsCache.url;
                        if ((0, Utils_1.isUnityCloud)(requestedUrl)) {
                            if (GameGlobalVars_1.default.isDevelopment) {
                                PluginLogger_1.default.debugLog("[开发阶段提示]请求无效URL=", requestedUrl, ", 浏览器搜索 `Disable Editor analytics` 或忽略此日志");
                            }
                            this.triggerEvent("error");
                            return [2 /*return*/];
                        }
                        cachePath = FileSystemManager_1.default.getCachePath(requestedUrl);
                        body = null;
                        httpResponseCode = 200;
                        filename = (0, Utils_1.resolveFilename)(requestedUrl);
                        preloadTaskManager = PreloadTaskManager_1.default.getInstance();
                        if (!(0, Utils_1.isCacheableURL)(requestedUrl)) return [3 /*break*/, 11];
                        TimeLogManager_1.TimeLogManager.timeStart("xhr_send:".concat(requestedUrl));
                        if (!(SystemEnvironmentVariables_1.default.enableOffline() && !cachePath)) return [3 /*break*/, 1];
                        cachePath = SystemEnvironmentVariables_1.default.resolveOfflinePath(requestedUrl);
                        return [3 /*break*/, 6];
                    case 1:
                        task = preloadTaskManager.getTaskByUrl(requestedUrl);
                        if (!task) return [3 /*break*/, 5];
                        if (!preloadTaskManager.isPreloadedUrl(requestedUrl)) return [3 /*break*/, 2];
                        PluginLogger_1.default.pluginLog("xhr: ".concat(filename, "\u4F7F\u7528\u9884\u8F7D\u5185\u5BB9"));
                        body = task.response;
                        cachePath = "";
                        preloadTaskManager.releaseTask(new Task_1.default(requestedUrl));
                        return [3 /*break*/, 4];
                    case 2:
                        PluginLogger_1.default.pluginLog("xhr: ".concat(filename, "\u7B49\u5F85\u9884\u8F7D\u5B8C\u6210"));
                        return [4 /*yield*/, task.once(Types_1.TaskStatus.COMPLETE)];
                    case 3:
                        taskResult = _b.sent();
                        httpResponseCode = taskResult.statusCode;
                        body = taskResult.response;
                        _b.label = 4;
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        preloadTaskManager.addTask(new Task_1.default(requestedUrl));
                        _b.label = 6;
                    case 6:
                        if (!cachePath) return [3 /*break*/, 10];
                        _b.label = 7;
                    case 7:
                        _b.trys.push([7, 9, , 10]);
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(SystemEnvironmentVariables_1.default.enableOffline() ?
                                FileSystemManager_1.default.readFileTrunk(cachePath) :
                                FileSystemManager_1.default.readFile(cachePath))];
                    case 8:
                        _a = _b.sent(), error = _a[0], fileContent = _a[1];
                        if (error) {
                            PluginLogger_1.default.pluginError("xhr: ".concat(filename, "\u8BFB\u7F13\u5B58\u5931\u8D25, err="), error.errMsg);
                            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.LOAD_ASSET_BUNDLE,
                                ErrorMsg: error.errMsg,
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                ExternInfo: JSON.stringify({
                                    stage: "CacheXMLHttpRequest: read cacheFile error",
                                    filename: filename,
                                    gameStage: GameLogic_1.GameStage.GetStage(),
                                }),
                            }));
                            FileSystemManager_1.default.removeFile(cachePath);
                        }
                        else if (fileContent === null || fileContent === void 0 ? void 0 : fileContent.byteLength) {
                            body = fileContent;
                            httpResponseCode = 200;
                        }
                        else {
                            PluginLogger_1.default.pluginError("xhr: ".concat(filename, "\u6E05\u7406\u7A7A\u6587\u4EF6\u7F13\u5B58"));
                            FileSystemManager_1.default.removeFile(cachePath);
                        }
                        return [3 /*break*/, 10];
                    case 9:
                        error_1 = _b.sent();
                        PluginLogger_1.default.pluginError("xhr: ".concat(filename, "\u8BFB\u7F13\u5B58\u5931\u8D25, err="), error_1);
                        FileSystemManager_1.default.removeFile(cachePath);
                        return [3 /*break*/, 10];
                    case 10:
                        this.cachePath = cachePath;
                        if (body) {
                            this.isReadFromCache = true;
                            this.createResponse({
                                data: body,
                                statusCode: httpResponseCode,
                            });
                            this.triggerEvent((0, Utils_1.isSuccessfulHttpStatus)(httpResponseCode) ? "load" : "error");
                            task = preloadTaskManager.getTaskByUrl(requestedUrl);
                            if (task) {
                                task.statusCode = httpResponseCode;
                                task.response = body;
                                preloadTaskManager.removeTask(task);
                            }
                            return [2 /*return*/];
                        }
                        _b.label = 11;
                    case 11: return [2 /*return*/, this.originXhr.send(content)];
                    case 12:
                        error_2 = _b.sent();
                        PluginLogger_1.default.pluginError("xhr: \u8BF7\u6C42\u5904\u7406\u5931\u8D25, err=", error_2);
                        this.triggerEvent("error");
                        return [3 /*break*/, 13];
                    case 13: return [2 /*return*/];
                }
            });
        }); };
        this.open = function (method, url, async) {
            var _a;
            var additionalArgs = [];
            for (var _i = 3; _i < arguments.length; _i++) {
                additionalArgs[_i - 3] = arguments[_i];
            }
            var resolvedUrl = (0, Utils_1.resolveURL)(url);
            var preloadTaskManager = PreloadTaskManager_1.default.getInstance();
            _this.paramsCache = {
                method: method,
                url: resolvedUrl,
                async: async,
            };
            if (!(0, Utils_1.isValidURL)(resolvedUrl)) {
                PluginLogger_1.default.pluginError("URL\u4E0D\u5408\u6CD5: ".concat(resolvedUrl));
                return _this.triggerEvent("error");
            }
            if ((0, Utils_1.isCacheableURL)(resolvedUrl) || SystemEnvironmentVariables_1.default.enableOffline()) {
                _this.cacheable = true;
            }
            else {
                preloadTaskManager.addTask(new Task_1.default(resolvedUrl));
            }
            PluginMonitor_1.default.getInstance().requestMonitor.startLoad(resolvedUrl, _this.reqId);
            (_a = _this.originXhr).open.apply(_a, __spreadArray([method, resolvedUrl, async], additionalArgs, false));
            _this.onload = function () {
            };
            _this.onerror = function () {
            };
            _this.ontimeout = function () {
            };
            _this.onabort = function () {
            };
        };
        this.bindEvent = function () {
            var responseProperties = [
                "readyState",
                "response",
                "responseText",
                "responseURL",
                "responseXML",
                "status",
                "statusText",
            ];
            [
                "readyState",
                "response",
                "responseText",
                "responseType",
                "responseURL",
                "responseXML",
                "status",
                "statusText",
                "timeout",
                "upload",
                "withCredentials",
                "onloadstart",
                "onprogress",
                "onabort",
                "onerror",
                "onload",
                "ontimeout",
                "onloadend",
                "onreadystatechange",
            ].forEach(function (eventName) {
                Object.defineProperty(_this, eventName, {
                    get: function () {
                        return ((responseProperties.includes(eventName) && _this["_".concat(eventName)]) || _this.originXhr[eventName]);
                    },
                    set: function (func) {
                        if (eventName === "onload") {
                            _this.originXhr[eventName] = function (data) {
                                if (_this.isFetchApi) {
                                    _this.triggerEvent("FetchResolve");
                                }
                                else {
                                    func(data);
                                }
                                _this.handleTaskComplete();
                                var url = _this.paramsCache.url;
                                PluginMonitor_1.default.getInstance().requestMonitor.completeLoad(url, _this, undefined, _this.reqId);
                                if (_this.cacheable) {
                                    var fileInfo = FileSystemManager_1.default.getFileInfo(url);
                                    var filename = (0, Utils_1.resolveFilename)(url);
                                    if ((0, Utils_1.isSuccessfulHttpStatus)(_this.status)) {
                                        if (!_this.response.byteLength) {
                                            _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                                xhrObj: _this,
                                                status: EventStatus.Fail,
                                                errMsg: Types_1.ErrorMessages.EmptyContent,
                                            }));
                                            return PluginLogger_1.default.pluginError("xhr_onload: ".concat(filename, "\u662F\u7A7A\u6587\u4EF6,\u4E0D\u4F7F\u7528\u7F13\u5B58"));
                                        }
                                        if (fileInfo) {
                                            _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                                xhrObj: _this,
                                                status: EventStatus.Ok,
                                            }));
                                            PluginLogger_1.default.pluginLog("xhr_onload: ".concat(filename, ",\u8017\u65F6=").concat(TimeLogManager_1.TimeLogManager.timeEnd("xhr_send:".concat(url)), "ms,size=").concat(_this.response.byteLength, ",\u6709\u7F13\u5B58"));
                                        }
                                        else {
                                            PluginLogger_1.default.pluginLog("xhr_onload: ".concat(filename, ",\u8017\u65F6=").concat(TimeLogManager_1.TimeLogManager.timeEnd("xhr_send:".concat(url)), "ms,size=").concat(_this.response.byteLength, ",\u65E0\u7F13\u5B58"));
                                            var cachePath_1 = (0, LogUtils_1.resolveCachePath)(url);
                                            _this.cachePath = cachePath_1;
                                            if (cachePath_1) {
                                                FileSystemManager_1.default
                                                    .writeFile(cachePath_1, _this.response)
                                                    .then(function () {
                                                    _this.triggerEvent("save", cachePath_1);
                                                    _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                                        xhrObj: _this,
                                                        status: EventStatus.Ok,
                                                    }));
                                                })
                                                    .catch(function (PreloadHandler) {
                                                    _this.triggerEvent("savefail", PreloadHandler);
                                                    _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                                        xhrObj: _this,
                                                        status: EventStatus.Fail,
                                                        errMsg: PreloadHandler.errMsg ||
                                                            PreloadHandler.message,
                                                    }));
                                                });
                                            }
                                            else {
                                                var error = new Error(Types_1.ErrorMessages.InvalidCachePath);
                                                _this.triggerEvent("savefail", error);
                                                _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                                    xhrObj: _this,
                                                    status: EventStatus.Fail,
                                                    errMsg: error.message,
                                                }));
                                            }
                                        }
                                    }
                                    else {
                                        _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                            xhrObj: _this,
                                            status: EventStatus.Fail,
                                            errMsg: _this.statusText,
                                        }));
                                        _this.reportHttpError({
                                            filename: filename,
                                            url: url,
                                            error: _this.status,
                                            type: "onload",
                                        });
                                    }
                                }
                                else {
                                    _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                        xhrObj: _this,
                                        status: EventStatus.Ok,
                                    }));
                                    if (!(0, Utils_1.isSuccessfulHttpStatus)(_this.status)) {
                                        _this.reportHttpError({
                                            filename: (0, Utils_1.resolveFilenameFromPath)(url),
                                            url: url,
                                            error: _this.status,
                                            type: "onload",
                                        });
                                    }
                                }
                            };
                        }
                        else if (eventName === "onerror" || eventName === "ontimeout" || eventName === "onabort") {
                            _this.originXhr[eventName] = function (error) {
                                var url = _this.paramsCache.url;
                                PluginMonitor_1.default.getInstance().requestMonitor.completeLoad(url, _this, error, _this.reqId);
                                if (_this.isFetchApi) {
                                    _this.triggerEvent("FetchReject", error);
                                }
                                else {
                                    func(error);
                                }
                                _this.handleTaskComplete();
                                _this.triggerEvent("complete", new Events_1.HttpRequestCompleteEvent({
                                    xhrObj: _this,
                                    status: EventStatus.Fail,
                                    errMsg: "".concat(eventName, "_").concat(_this.statusText),
                                }));
                                _this.reportHttpError({
                                    filename: _this.cacheable ? (0, Utils_1.resolveFilename)(url) : (0, Utils_1.resolveFilenameFromPath)(url),
                                    url: url,
                                    error: error,
                                    type: eventName,
                                });
                            };
                        }
                        else if (responseProperties.includes(eventName)) {
                            _this["_".concat(eventName)] = func;
                        }
                        else {
                            _this.originXhr[eventName] = func;
                        }
                    },
                });
            });
            [
                "abort",
                "getAllResponseHeaders",
                "getResponseHeader",
                "overrideMimeType",
                "addEventListener",
                "setRequestHeader",
            ].forEach(function (eventName) {
                Object.defineProperty(_this, eventName, {
                    value: function () {
                        var _a;
                        var args = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            args[_i] = arguments[_i];
                        }
                        if (eventName === "abort") {
                            _this.signal.aborted = true;
                        }
                        return (_a = _this.originXhr)[eventName].apply(_a, args);
                    },
                });
            });
        };
        this.createResponse = function (response) {
            var httpResponseData = response.data;
            _this.status = response.statusCode || 200;
            if (httpResponseData) {
                _this.response = httpResponseData;
            }
        };
        this.triggerEvent = function (eventName) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            var callbackFunction = _this["on".concat(eventName)];
            if (callbackFunction) {
                callbackFunction.apply(_this, args);
            }
        };
        this.handleTaskComplete = function () {
            var preloadTaskManager = PreloadTaskManager_1.default.getInstance();
            var task = preloadTaskManager.getTaskByUrl(_this.paramsCache.url);
            if (task) {
                task.statusCode = _this.originXhr.status;
                task.response = _this.originXhr.response;
                preloadTaskManager.removeTask(task);
            }
        };
        this.reportHttpError = function (errorDetails) {
            var isHttpErrorReportable = false;
            var filename = errorDetails.filename;
            var url = errorDetails.url;
            var errorDetail = errorDetails.error;
            var errorType = errorDetails.type;
            if ((0, Utils_1.isUnityCloud)(url)) {
                if (!_this.hasUnityAnalysisLoged) {
                    _this.hasUnityAnalysisLoged = true;
                    PluginLogger_1.default.debugWarn("[\u5F00\u53D1\u7248\u63D0\u793A]\u8BF7\u6C42\u65E0\u7528URL=".concat(url));
                }
            }
            else {
                var isErrorHandled = false;
                var handleErrorFunction = PluginLogger_1.default.pluginError;
                var isErrorDetailNum = typeof errorDetail === "number";
                var errMsg = errorDetail;
                if (!isErrorDetailNum && typeof errorDetail !== "string") {
                    errMsg = (errorDetail === null || errorDetail === void 0 ? void 0 : errorDetail.errMsg) || (errorDetail === null || errorDetail === void 0 ? void 0 : errorDetail.message) || "empty errMsg";
                }
                if (GameGlobalVars_1.default.unityNamespace.isReportableHttpError) {
                    isHttpErrorReportable = GameGlobalVars_1.default.unityNamespace.isReportableHttpError.call(GameGlobalVars_1.default.unityNamespace, {
                        url: url,
                        filename: filename,
                        error: errorDetail,
                    });
                    if (!isHttpErrorReportable) {
                        isErrorHandled = true;
                        handleErrorFunction = PluginLogger_1.default.debugError;
                    }
                }
                handleErrorFunction("xhr_".concat(errorType, ": ").concat(filename, "\u4E0B\u8F7D\u5931\u8D25: statusCode=").concat(!!isErrorDetailNum && _this.status, ", statusText=").concat(_this.statusText, ", networkType=").concat(GameLogic_1.gameNetworkType.getNetworkType(), ", isVisible=").concat(GameLogic_1.GameVisible.GetVisible(), ", cost=").concat(_this.cacheable ? TimeLogManager_1.TimeLogManager.timeEnd("xhr_send:".concat(url)) : "-", "ms, errMsg=").concat(errMsg, ", error=").concat(errorDetail));
                if (UnityManager_1.default.getInstance().needPluginReport() && !isErrorHandled) {
                    ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                        ReportType: Types_1.GameLaunchStatus.LOAD_ASSET_BUNDLE,
                        ErrorMsg: "".concat(errMsg),
                        ErrorType: Number(_this.status),
                        RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                        ExternInfo: JSON.stringify({
                            event: "CacheXMLHttpRequest_".concat(errorType, ": ").concat(isErrorDetailNum ? "statusCode" : "network", " error"),
                            isReadFromCache: _this.isReadFromCache,
                            cacheable: _this.cacheable,
                            type: errorType,
                            url: url,
                            gameStage: GameLogic_1.GameStage.GetStage(),
                        }),
                    }));
                }
            }
        };
        this.originXhr = new GameGlobalVars_1.default.unityNamespace.XMLHttpRequest();
        this.paramsCache = {};
        this.bindEvent();
        this.reqId = this.generateReqId();
    }
    CacheableXMLHttpRequest.prototype.generateReqId = function () {
        var characterSet = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
        var randomString = "";
        for (var i = 0; i < 10; i++) {
            randomString += characterSet[Math.floor(Math.random() * characterSet.length)];
        }
        return randomString;
    };
    return CacheableXMLHttpRequest;
}());
exports["default"] = CacheableXMLHttpRequest;


/***/ }),

/***/ "./src/lib/CaseType.ts":
/*!*****************************!*\
  !*** ./src/lib/CaseType.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.LoggerCaseType = exports.ProgressCaseType = exports.ReportCaseType = exports.ViewerElementBaseCaseType = exports.ViewerBaseCaseType = exports.DirctorCaseType = exports.OperaPlayerCaseType = exports.FrameBaseCaseType = void 0;
var FrameBaseCaseType;
(function (FrameBaseCaseType) {
    FrameBaseCaseType[FrameBaseCaseType["ParamChange"] = 0] = "ParamChange";
    FrameBaseCaseType[FrameBaseCaseType["EventLaunch"] = 1] = "EventLaunch";
    FrameBaseCaseType[FrameBaseCaseType["End"] = 2] = "End";
})(FrameBaseCaseType || (exports.FrameBaseCaseType = FrameBaseCaseType = {}));
var OperaPlayerCaseType;
(function (OperaPlayerCaseType) {
    OperaPlayerCaseType[OperaPlayerCaseType["ElementParamChange"] = 0] = "ElementParamChange";
    OperaPlayerCaseType[OperaPlayerCaseType["PlayFrame"] = 1] = "PlayFrame";
    OperaPlayerCaseType[OperaPlayerCaseType["PlayStoryLine"] = 2] = "PlayStoryLine";
    OperaPlayerCaseType[OperaPlayerCaseType["EventLaunch"] = 3] = "EventLaunch";
    OperaPlayerCaseType[OperaPlayerCaseType["Exception"] = 4] = "Exception";
    OperaPlayerCaseType[OperaPlayerCaseType["End"] = 5] = "End";
    OperaPlayerCaseType[OperaPlayerCaseType["ReportStoryStart"] = 6] = "ReportStoryStart";
    OperaPlayerCaseType[OperaPlayerCaseType["ReportStoryEnd"] = 7] = "ReportStoryEnd";
})(OperaPlayerCaseType || (exports.OperaPlayerCaseType = OperaPlayerCaseType = {}));
var DirctorCaseType;
(function (DirctorCaseType) {
    DirctorCaseType[DirctorCaseType["FrameElementParamChange"] = 0] = "FrameElementParamChange";
    DirctorCaseType[DirctorCaseType["FrameElementParamChangeUpdate"] = 1] = "FrameElementParamChangeUpdate";
    DirctorCaseType[DirctorCaseType["FrameCreate"] = 2] = "FrameCreate";
    DirctorCaseType[DirctorCaseType["PlayFrame"] = 3] = "PlayFrame";
    DirctorCaseType[DirctorCaseType["PlayStoryLine"] = 4] = "PlayStoryLine";
    DirctorCaseType[DirctorCaseType["OperaDataMounted"] = 5] = "OperaDataMounted";
    DirctorCaseType[DirctorCaseType["ViewerReady"] = 6] = "ViewerReady";
    DirctorCaseType[DirctorCaseType["Exception"] = 7] = "Exception";
    DirctorCaseType[DirctorCaseType["End"] = 8] = "End";
    DirctorCaseType[DirctorCaseType["UpdateParams"] = 9] = "UpdateParams";
    DirctorCaseType[DirctorCaseType["Report"] = 10] = "Report";
    DirctorCaseType[DirctorCaseType["ReportStoryStart"] = 11] = "ReportStoryStart";
    DirctorCaseType[DirctorCaseType["ReportStoryEnd"] = 12] = "ReportStoryEnd";
    DirctorCaseType[DirctorCaseType["CheckPoint"] = 13] = "CheckPoint";
    DirctorCaseType[DirctorCaseType["ReportCheckPointCount"] = 14] = "ReportCheckPointCount";
    DirctorCaseType[DirctorCaseType["LoggerPush"] = 15] = "LoggerPush";
    DirctorCaseType[DirctorCaseType["ReportLogger"] = 16] = "ReportLogger";
    DirctorCaseType[DirctorCaseType["LoggerEmitEvent"] = 17] = "LoggerEmitEvent";
    DirctorCaseType[DirctorCaseType["WeakNetwork"] = 18] = "WeakNetwork";
})(DirctorCaseType || (exports.DirctorCaseType = DirctorCaseType = {}));
var ViewerBaseCaseType;
(function (ViewerBaseCaseType) {
    ViewerBaseCaseType[ViewerBaseCaseType["FrameCreate"] = 0] = "FrameCreate";
    ViewerBaseCaseType[ViewerBaseCaseType["PlayFrame"] = 1] = "PlayFrame";
    ViewerBaseCaseType[ViewerBaseCaseType["OperaDataMounted"] = 2] = "OperaDataMounted";
    ViewerBaseCaseType[ViewerBaseCaseType["FrameElementParamChange"] = 3] = "FrameElementParamChange";
    ViewerBaseCaseType[ViewerBaseCaseType["FrameElementParamChangeUpdate"] = 4] = "FrameElementParamChangeUpdate";
    ViewerBaseCaseType[ViewerBaseCaseType["Exception"] = 5] = "Exception";
    ViewerBaseCaseType[ViewerBaseCaseType["End"] = 6] = "End";
    ViewerBaseCaseType[ViewerBaseCaseType["UpdateParams"] = 7] = "UpdateParams";
    ViewerBaseCaseType[ViewerBaseCaseType["Report"] = 8] = "Report";
    ViewerBaseCaseType[ViewerBaseCaseType["CheckPoint"] = 9] = "CheckPoint";
    ViewerBaseCaseType[ViewerBaseCaseType["ReportCheckPointCount"] = 10] = "ReportCheckPointCount";
    ViewerBaseCaseType[ViewerBaseCaseType["LoggerPush"] = 11] = "LoggerPush";
    ViewerBaseCaseType[ViewerBaseCaseType["LoggerEmitEvent"] = 12] = "LoggerEmitEvent";
    ViewerBaseCaseType[ViewerBaseCaseType["WeakNetWork"] = 13] = "WeakNetWork";
})(ViewerBaseCaseType || (exports.ViewerBaseCaseType = ViewerBaseCaseType = {}));
var ViewerElementBaseCaseType;
(function (ViewerElementBaseCaseType) {
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["Created"] = 0] = "Created";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["Actived"] = 1] = "Actived";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["DomReady"] = 2] = "DomReady";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["ParamChange"] = 3] = "ParamChange";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["DestoryView"] = 4] = "DestoryView";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["ParamsUpdate"] = 5] = "ParamsUpdate";
    ViewerElementBaseCaseType[ViewerElementBaseCaseType["LoggerEmitEvent"] = 6] = "LoggerEmitEvent";
})(ViewerElementBaseCaseType || (exports.ViewerElementBaseCaseType = ViewerElementBaseCaseType = {}));
var ReportCaseType;
(function (ReportCaseType) {
    ReportCaseType[ReportCaseType["custom"] = 0] = "custom";
    ReportCaseType[ReportCaseType["sys"] = 1] = "sys";
    ReportCaseType[ReportCaseType["err"] = 2] = "err";
    ReportCaseType[ReportCaseType["logger"] = 3] = "logger";
    ReportCaseType[ReportCaseType["end"] = 4] = "end";
})(ReportCaseType || (exports.ReportCaseType = ReportCaseType = {}));
var ProgressCaseType;
(function (ProgressCaseType) {
    ProgressCaseType[ProgressCaseType["RefreshProgress"] = 0] = "RefreshProgress";
})(ProgressCaseType || (exports.ProgressCaseType = ProgressCaseType = {}));
var LoggerCaseType;
(function (LoggerCaseType) {
    LoggerCaseType[LoggerCaseType["Reset"] = 0] = "Reset";
    LoggerCaseType[LoggerCaseType["End"] = 1] = "End";
    LoggerCaseType[LoggerCaseType["LoggerPush"] = 2] = "LoggerPush";
})(LoggerCaseType || (exports.LoggerCaseType = LoggerCaseType = {}));


/***/ }),

/***/ "./src/lib/Common.ts":
/*!***************************!*\
  !*** ./src/lib/Common.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.setKs = setKs;
exports.getKs = getKs;
exports.compareVersion = compareVersion;
// module 5327
var common = {
    ks: null,
};
function setKs(ks) {
    common.ks = ks;
}
function getKs() {
    return common.ks || {};
}
function compareVersion(jsonVersion, createOperaInstance) {
    if (typeof jsonVersion !== "string" && typeof createOperaInstance !== "string") {
        return 0;
    }
    if (typeof jsonVersion !== "string") {
        return 1;
    }
    if (typeof createOperaInstance !== "string") {
        return -1;
    }
    var jsonVersionSegments = jsonVersion.split(".");
    var operaVersionSegments = createOperaInstance.split(".");
    var maxLength = Math.max(jsonVersionSegments.length, operaVersionSegments.length);
    while (jsonVersionSegments.length < maxLength) {
        jsonVersionSegments.push("0");
    }
    while (operaVersionSegments.length < maxLength) {
        operaVersionSegments.push("0");
    }
    for (var i = 0; i < maxLength; i++) {
        var parsedJsonVersion = parseInt(jsonVersionSegments[i], 10);
        var parsedOperaVersion = parseInt(operaVersionSegments[i], 10);
        if (parsedJsonVersion > parsedOperaVersion) {
            return 1;
        }
        if (parsedJsonVersion < parsedOperaVersion) {
            return -1;
        }
    }
    return 0;
}


/***/ }),

/***/ "./src/lib/CommonMonitor.ts":
/*!**********************************!*\
  !*** ./src/lib/CommonMonitor.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var CommonMonitor = /** @class */ (function () {
    function CommonMonitor(unityManager, monitor) {
        this.unityManager = unityManager;
        this.monitor = monitor;
        this.result = {};
        this.assetPerformance = {};
        this.wasmPerformance = {};
        this.callmainPerformance = {};
        this.optimizationSuggestions = {
            haventUseCodeSplit: DefaultLanguageMap_1.default.commonMonitor_haventUseCodeSplit,
            largeAssetPackage: DefaultLanguageMap_1.default.commonMonitor_largeAssetPackage,
            noContentEncoding: DefaultLanguageMap_1.default.commonMonitor_noContentEncoding,
            longCallmainCost: DefaultLanguageMap_1.default.commonMonitor_longCallmainCost,
        };
    }
    CommonMonitor.prototype.recordAsset = function (assetPerformance) {
        this.assetPerformance = Object.assign(Object.assign({}, this.assetPerformance), assetPerformance);
    };
    CommonMonitor.prototype.recordWasm = function (wasmPerformance) {
        this.wasmPerformance = Object.assign(Object.assign(Object.assign({}, this.wasmPerformance), wasmPerformance), {
            useCodeSplit: this.unityManager.codeType === Types_1.CodeType.codeSplit,
            useHostCodeSplit: this.unityManager.useHostCodeSplit,
        });
    };
    CommonMonitor.prototype.recordCallmain = function (callmainPerformance) {
        this.callmainPerformance = Object.assign(Object.assign({}, this.callmainPerformance), callmainPerformance);
    };
    CommonMonitor.prototype.reset = function () {
        this.assetPerformance = {};
        this.wasmPerformance = {};
        this.callmainPerformance = {};
    };
    CommonMonitor.prototype.showResult = function () {
        this.result = this.getResultInfo();
        return this.checkResult();
    };
    CommonMonitor.prototype.checkResult = function () {
        PluginLogger_1.default.monitorLog("----启动数据监控 start----");
        PluginLogger_1.default.monitorLog("启动基本信息: ", this.result);
        var optimizationSuggestions = [];
        var gameResult = this.result;
        var primaryDataCachePath = DataPackageLoader_1.default.getPrimaryDataCachePath();
        if (!gameResult.useHostCodeSplit) {
            optimizationSuggestions.push(this.optimizationSuggestions.haventUseCodeSplit);
        }
        if (+gameResult.assetContentLength > 15728640) {
            optimizationSuggestions.push(this.optimizationSuggestions.largeAssetPackage);
        }
        if (!DataPackageLoader_1.default.loadDataPackageFromSubpackage &&
            !gameResult.useContentEncoding &&
            !primaryDataCachePath) {
            optimizationSuggestions.push(this.optimizationSuggestions.noContentEncoding);
        }
        if (SystemEnvironmentVariables_1.default.isIOS && +gameResult.callmainCost > 1500) {
            optimizationSuggestions.push(this.optimizationSuggestions.longCallmainCost);
        }
        if (SystemEnvironmentVariables_1.default.isAndroid &&
            +gameResult.callmainCost > 3000) {
            optimizationSuggestions.push(this.optimizationSuggestions.longCallmainCost);
        }
        if (optimizationSuggestions.length) {
            PluginLogger_1.default.monitorWarn("".concat(DefaultLanguageMap_1.default.showResult_LaunchOptAdvice, ":"));
            PluginLogger_1.default.monitorWarn(optimizationSuggestions.join("\n"));
        }
        PluginLogger_1.default.monitorLog("----启动数据监控 end----");
        return optimizationSuggestions;
    };
    CommonMonitor.prototype.getResultInfo = function () {
        return {
            assetLoadCost: this.assetPerformance.duration || 0,
            assetContentLength: this.assetPerformance.contentLength || 0,
            useContentEncoding: !!this.assetPerformance.useContentEncoding,
            wasmLoadCost: this.wasmPerformance.duration || 0,
            wasmContentLength: this.wasmPerformance.contentLength || 0,
            useCodeSplit: this.wasmPerformance.useCodeSplit,
            useHostCodeSplit: !!this.wasmPerformance.useHostCodeSplit,
            callmainCost: this.callmainPerformance.duration,
            launchTime: this.callmainPerformance.launchTime,
        };
    };
    return CommonMonitor;
}());
exports["default"] = CommonMonitor;


/***/ }),

/***/ "./src/lib/Constants.ts":
/*!******************************!*\
  !*** ./src/lib/Constants.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.BufferWeights = exports.GameFileCacheDirname = exports.GameFileCacheRegex = exports.BackslashRegex = exports.PathRegex3 = exports.PathRegex2 = exports.PathRegex1 = exports.GameWasmCodeSuffix = exports.GameDataSuffix = exports.PathSplit = exports.PluginVersion = void 0;
var PluginVersion = "1.2.45";
exports.PluginVersion = PluginVersion;
var PathSplit = "/";
exports.PathSplit = PathSplit;
var GameDataSuffix = "data.unityweb";
exports.GameDataSuffix = GameDataSuffix;
var GameWasmCodeSuffix = "wasm.code.unityweb";
exports.GameWasmCodeSuffix = GameWasmCodeSuffix;
var PathRegex1 = /[^:]\/{2,}/gi;
exports.PathRegex1 = PathRegex1;
var PathRegex2 = /\.[./]+/gi;
exports.PathRegex2 = PathRegex2;
var PathRegex3 = /[<>]+/gi;
exports.PathRegex3 = PathRegex3;
var BackslashRegex = /\\+/gi;
exports.BackslashRegex = BackslashRegex;
var GameFileCacheRegex = new RegExp("/?__GAME_FILE_CACHE");
exports.GameFileCacheRegex = GameFileCacheRegex;
var GameFileCacheDirname = "__GAME_FILE_CACHE";
exports.GameFileCacheDirname = GameFileCacheDirname;
var BufferWeights = [
    Math.pow(216, 3),
    Math.pow(216, 2),
    216,
    1,
];
exports.BufferWeights = BufferWeights;


/***/ }),

/***/ "./src/lib/DataPackageLoader.ts":
/*!**************************************!*\
  !*** ./src/lib/DataPackageLoader.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Events_1 = __webpack_require__(/*! ./Events */ "./src/lib/Events.ts");
var GameWasmLoader_1 = __importDefault(__webpack_require__(/*! ./GameWasmLoader */ "./src/lib/GameWasmLoader.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var DataPackageLoader = /** @class */ (function (_super) {
    __extends(DataPackageLoader, _super);
    function DataPackageLoader() {
        var _this = _super.call(this) || this;
        _this.loadDataPackageFromSubpackage = false;
        _this.compressDataPackage = false;
        _this.retryCount = 1;
        _this.retryDuration = 1500;
        _this.pendingDuration = 60000;
        _this.dataPackageLoaded = false;
        _this.preloadDataProcessed = false;
        _this.releaseAblePaths = [];
        _this.defaultSize = 0;
        _this.downloadPath = "";
        _this.optimalSize = 0;
        _this.cachePath = "";
        _this.downloadFilename = "";
        _this.md5 = "";
        _this.cacheFilename = "";
        return _this;
    }
    DataPackageLoader.prototype.processRawData = function () {
        var unityManager = this.unityManager;
        var gameWasmLoader = GameWasmLoader_1.default.getInstance();
        if (!this.preloadDataProcessed && this.dataPackageLoaded && gameWasmLoader.unityModuleInited) {
            var rawData = unityManager.gameInstance.Module.rawData;
            var dataArray = new Uint8Array(rawData);
            var dataView = new DataView(rawData);
            var dataProcessingIndex = 0;
            var errorMessage = "";
            if (!rawData || !this.checkPackageSize(rawData.byteLength)) {
                errorMessage = "mismatch data size";
            }
            var matchedDataPrefix = "";
            var webDataPatterns = ["UnityWebData1.0\0", "TuanjieWebData1.0\0"];
            for (var index = 0; index < webDataPatterns.length; index++) {
                var dataPattern = webDataPatterns[index];
                var currentMatchedDataPrefix = String.fromCharCode.apply(null, Array.from(dataArray.subarray(dataProcessingIndex, dataProcessingIndex + dataPattern.length)));
                if (currentMatchedDataPrefix === dataPattern) {
                    matchedDataPrefix = currentMatchedDataPrefix;
                    break;
                }
            }
            PluginLogger_1.default.pluginLog("prefix", matchedDataPrefix);
            if (!matchedDataPrefix && !errorMessage) {
                errorMessage = "unknown data format";
            }
            if (errorMessage.length) {
                this.handleDataError({
                    errMsg: errorMessage,
                    byteLength: rawData === null || rawData === void 0 ? void 0 : rawData.byteLength,
                    defaultSize: this.defaultSize,
                    prefix: matchedDataPrefix,
                });
                throw errorMessage;
            }
            dataProcessingIndex += matchedDataPrefix.length;
            var totalDataSize = dataView.getUint32(dataProcessingIndex, true);
            dataProcessingIndex += 4;
            TimeLogManager_1.TimeLogManager.timeStart("解析资源");
            while (dataProcessingIndex < totalDataSize) {
                var dataOffset = dataView.getUint32(dataProcessingIndex, true);
                dataProcessingIndex += 4;
                var dataSize = dataView.getUint32(dataProcessingIndex, true);
                dataProcessingIndex += 4;
                var dataChunkSize = dataView.getUint32(dataProcessingIndex, true);
                dataProcessingIndex += 4;
                var decodedString = String.fromCharCode.apply(null, Array.from(dataArray.subarray(dataProcessingIndex, dataProcessingIndex + dataChunkSize)));
                dataProcessingIndex += dataChunkSize;
                for (var currentIndex = 0, nextSlashIndex = decodedString.indexOf("/", currentIndex) + 1; nextSlashIndex > 0; currentIndex = nextSlashIndex, nextSlashIndex = decodedString.indexOf("/", currentIndex) + 1) {
                    GameGlobalVars_1.default.unityNamespace.FS.createPath(decodedString.substring(0, currentIndex), decodedString.substring(currentIndex, nextSlashIndex - 1), true, true);
                }
                if (decodedString === null || decodedString === void 0 ? void 0 : decodedString.includes("metadata.dat")) {
                    this.releaseAblePaths.push(decodedString);
                }
                GameGlobalVars_1.default.unityNamespace.FS.createDataFile(decodedString, null, dataArray.slice(dataOffset, dataOffset + dataSize), true, true, true);
            }
            this.preloadDataProcessed = true;
            GameGlobalVars_1.default.unityNamespace.Module.rawData = null;
            TimeLogManager_1.TimeLogManager.printTime("解析资源");
            TimeLogManager_1.TimeLogManager.timeEnd("解析资源");
            var eventTrigger = Events_1.EventTrigger.getInstance();
            eventTrigger.triggerEvent(Types_1.GameEvents.AssetProcessed, new Events_1.GameEventDetail(unityManager));
            unityManager.gameInstance.Module.removeRunDependency("wasm-preloadAssets");
        }
    };
    DataPackageLoader.prototype.releaseDataPackage = function () {
        this.releaseAblePaths.forEach(function (filePath) {
            var _a, _b;
            var unlinkFunction;
            try {
                if ((unlinkFunction = (_b = (_a = GameGlobalVars_1.default.unityNamespace) === null || _a === void 0 ? void 0 : _a.FS) === null || _b === void 0 ? void 0 : _b.unlink) != null) {
                    var unityFileSystem = GameGlobalVars_1.default.unityNamespace.FS;
                    unlinkFunction.call(unityFileSystem, filePath);
                }
            }
            catch (error) {
                PluginLogger_1.default.pluginError("\u5220\u9664\u9996\u8D44\u6E90\u5305meta\u6BB5\u9519\u8BEF: ".concat(error.message));
            }
        });
    };
    DataPackageLoader.prototype.loadAssetsByDownloadFile = function (retries) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        try {
                            var canRetry_1 = retries === 0;
                            var unityManager_1 = _this.unityManager;
                            var downloadUrl_1 = (0, Utils_1.resolvePath)(GameGlobalVars_1.default.unityNamespace.DATA_CDN, _this.downloadPath);
                            PluginLogger_1.default.eventLog("\u8D44\u6E90\u5305\u4E0B\u8F7Durl\uFF1A".concat(downloadUrl_1));
                            TimeLogManager_1.TimeLogManager.timeStart("下载资源包耗时");
                            unityManager_1.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                                status: Types_1.LaunchStageStatus.PENDING,
                            });
                            SystemEnvironmentVariables_1.default.tjInstance
                                .downloadFile({
                                url: downloadUrl_1,
                                timeout: 60000,
                                success: function (downloadedInfo) { return __awaiter(_this, void 0, void 0, function () {
                                    var statusCode, tempFilePath, userProfile, decompressResult, results, error, saveResult, error_1;
                                    return __generator(this, function (_a) {
                                        switch (_a.label) {
                                            case 0:
                                                _a.trys.push([0, 5, , 6]);
                                                statusCode = downloadedInfo.statusCode;
                                                tempFilePath = downloadedInfo.tempFilePath;
                                                userProfile = downloadedInfo.profile;
                                                if (!(0, Utils_1.isSuccessfulHttpStatus)(statusCode)) {
                                                    this.handleDownloadError(statusCode, canRetry_1);
                                                    reject(statusCode);
                                                    return [2 /*return*/];
                                                }
                                                TimeLogManager_1.TimeLogManager.printTime("下载资源包耗时");
                                                unityManager_1.triggerLaunchProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时", false));
                                                PluginLogger_1.default.eventLog("data download size=".concat((userProfile === null || userProfile === void 0 ? void 0 : userProfile.receivedBytedCount) || 0));
                                                ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                                    ReportType: Types_1.GameLaunchStatus.LOAD_ASSETS,
                                                    CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时"),
                                                    RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                                    ExternInfo: JSON.stringify({
                                                        fileSize: (userProfile === null || userProfile === void 0 ? void 0 : userProfile.receivedBytedCount) || 0,
                                                        defaultSize: this.defaultSize,
                                                        optimalSize: this.optimalSize,
                                                        compressDataPackage: this.compressDataPackage,
                                                    }),
                                                }));
                                                if (!this.compressDataPackage) return [3 /*break*/, 2];
                                                decompressResult = this.decompressPackage(tempFilePath);
                                                return [4 /*yield*/, (0, Utils_1.handlePromise)(decompressResult)];
                                            case 1:
                                                results = _a.sent();
                                                error = results[0];
                                                if (error) {
                                                    reject(error);
                                                }
                                                else {
                                                    resolve();
                                                }
                                                return [3 /*break*/, 4];
                                            case 2:
                                                TimeLogManager_1.TimeLogManager.timeStart("saveDataPackage");
                                                return [4 /*yield*/, FileSystemManager_1.default.saveFile(this.cachePath, tempFilePath)];
                                            case 3:
                                                saveResult = _a.sent();
                                                PluginLogger_1.default.eventLog("\u8D44\u6E90\u5305\u62F7\u8D1D\u8017\u65F6".concat(TimeLogManager_1.TimeLogManager.timeEnd("saveDataPackage"), "ms"));
                                                resolve(saveResult);
                                                _a.label = 4;
                                            case 4: return [3 /*break*/, 6];
                                            case 5:
                                                error_1 = _a.sent();
                                                this.handleDownloadError(error_1, canRetry_1);
                                                reject(error_1);
                                                return [3 /*break*/, 6];
                                            case 6: return [2 /*return*/];
                                        }
                                    });
                                }); },
                                fail: function (error) {
                                    _this.handleDownloadError(error, canRetry_1);
                                    reject(error);
                                },
                            })
                                .onHeadersReceived(function (header) {
                                var contentEncoding = (0, Utils_1.getHeaderValue)(header.header, "Content-Encoding") || "";
                                var encodeSupported = !contentEncoding.includes("gzip") && !contentEncoding.includes("br");
                                PluginMonitor_1.default.getInstance().commonMonitor.recordAsset({
                                    useContentEncoding: !encodeSupported || _this.compressDataPackage,
                                });
                                if (encodeSupported && !_this.compressDataPackage) {
                                    console.error("\u4F60\u7684CDN\u672A\u5F00\u542F\u5BF9txt\u6587\u4EF6\u7684gzip/br\uFF0C\u4F1A\u589E\u52A0\u6587\u4EF6\uFF1A".concat(downloadUrl_1, " \u7684\u52A0\u8F7D\u8017\u65F6\uFF01"));
                                }
                            });
                        }
                        catch (error) {
                            reject(error);
                        }
                    })];
            });
        });
    };
    DataPackageLoader.prototype.loadAssetsByXhr = function (retries) {
        return __awaiter(this, void 0, void 0, function () {
            var canRetry, unityManager, _downloadUrl;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        canRetry = retries === 0;
                        unityManager = this.unityManager;
                        _downloadUrl = (0, Utils_1.resolvePath)(GameGlobalVars_1.default.unityNamespace.DATA_CDN, this.downloadPath);
                        PluginLogger_1.default.eventLog("\u8D44\u6E90\u5305\u4E0B\u8F7Durl\uFF1A".concat(_downloadUrl));
                        TimeLogManager_1.TimeLogManager.timeStart("下载资源包耗时");
                        return [4 /*yield*/, new Promise(function (resolve, reject) {
                                unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                                    status: Types_1.LaunchStageStatus.PENDING,
                                });
                                var httpRequest = new GameGlobalVars_1.default.unityNamespace.XMLHttpRequest();
                                httpRequest.open("GET", _downloadUrl);
                                httpRequest.responseType = "arraybuffer";
                                httpRequest.timeout = 60000;
                                httpRequest.onload = function () {
                                    var _a, _b;
                                    var httpRequestStatus = httpRequest.status;
                                    if ((0, Utils_1.isSuccessfulHttpStatus)(httpRequestStatus)) {
                                        TimeLogManager_1.TimeLogManager.printTime("下载资源包耗时");
                                        unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时", false));
                                        PluginMonitor_1.default.getInstance().commonMonitor.recordAsset({
                                            duration: TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时", false),
                                            contentLength: httpRequest.response.byteLength,
                                        });
                                        PluginLogger_1.default.eventLog("data download size=".concat((_a = httpRequest.response) === null || _a === void 0 ? void 0 : _a.byteLength));
                                        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                            ReportType: Types_1.GameLaunchStatus.LOAD_ASSETS,
                                            CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时"),
                                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                            ExternInfo: JSON.stringify({
                                                fileSize: ((_b = httpRequest.response) === null || _b === void 0 ? void 0 : _b.byteLength) || 0,
                                                defaultSize: _this.defaultSize,
                                                optimalSize: _this.optimalSize,
                                                compressDataPackage: _this.compressDataPackage,
                                            }),
                                        }));
                                        unityManager.gameInstance.Module.rawData = httpRequest.response;
                                        _this.printBufferContent(httpRequest.response);
                                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.READ_ASSETS, {
                                            status: Types_1.LaunchStageStatus.FULFILLED,
                                        });
                                        unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.READ_ASSETS, 0);
                                        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                            ReportType: Types_1.GameLaunchStatus.READ_ASSETS,
                                            CostTimeMs: 0,
                                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                        }));
                                        FileSystemManager_1.default.writeFile(_this.cachePath, httpRequest.response);
                                        var contentEncoding = (0, Utils_1.getResponseHeaderValue)(httpRequest, "Content-Encoding") || "";
                                        var encodeSupported = !contentEncoding.includes("gzip") && !contentEncoding.includes("br");
                                        PluginMonitor_1.default.getInstance().commonMonitor.recordAsset({
                                            useContentEncoding: !encodeSupported || _this.compressDataPackage,
                                        });
                                        if (encodeSupported && !_this.compressDataPackage) {
                                            console.error("\u4F60\u7684CDN\u672A\u5F00\u542F\u5BF9txt\u6587\u4EF6\u7684gzip/br\uFF0C\u4F1A\u589E\u52A0\u6587\u4EF6\uFF1A".concat(_downloadUrl, " \u7684\u52A0\u8F7D\u8017\u65F6\uFF01"));
                                        }
                                        resolve();
                                    }
                                    else {
                                        _this.handleDownloadError(httpRequestStatus, canRetry);
                                        reject(httpRequest);
                                    }
                                };
                                var handleException = function (error) {
                                    _this.handleDownloadError(error, canRetry);
                                    reject(error);
                                };
                                httpRequest.onerror = function (error) { return handleException(error); };
                                httpRequest.ontimeout = function () { return handleException(new Error("timeout")); };
                                httpRequest.onabort = function () { return handleException(new Error("abort")); };
                                httpRequest.send();
                            })];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    DataPackageLoader.prototype.invokeLoadDataPackage = function (retries) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            try {
                var canRetry_2 = retries === 0;
                var unityManager_2 = _this.unityManager;
                var isDownloadSuccessful_1 = false;
                unityManager_2.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                    status: Types_1.LaunchStageStatus.PENDING,
                });
                TimeLogManager_1.TimeLogManager.timeStart("下载资源包");
                var loadDataPackagePromise = SystemEnvironmentVariables_1.default.tjInstance.loadSubpackage({
                    name: "data-package",
                    success: function () { return __awaiter(_this, void 0, void 0, function () {
                        var costTimeMs, runTimeMs, fileSize, decompressResult, results, error, error_2;
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0:
                                    _a.trys.push([0, 6, , 7]);
                                    TimeLogManager_1.TimeLogManager.printTime("下载资源包");
                                    unityManager_2.triggerLaunchProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, TimeLogManager_1.TimeLogManager.timeEnd("下载资源包", false));
                                    PluginMonitor_1.default.getInstance().commonMonitor.recordAsset({
                                        duration: TimeLogManager_1.TimeLogManager.timeEnd("下载资源包", false),
                                        useContentEncoding: true,
                                    });
                                    costTimeMs = TimeLogManager_1.TimeLogManager.timeEnd("下载资源包");
                                    runTimeMs = TimeLogManager_1.TimeLogManager.getRuntime();
                                    return [4 /*yield*/, FileSystemManager_1.default.getFileSize("data-package/".concat(this.downloadFilename))];
                                case 1:
                                    fileSize = _a.sent();
                                    PluginLogger_1.default.eventLog("data download size=".concat(fileSize));
                                    ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                        ReportType: Types_1.GameLaunchStatus.LOAD_ASSETS,
                                        CostTimeMs: costTimeMs,
                                        RunTimeMs: runTimeMs,
                                        ExternInfo: JSON.stringify({
                                            fileSize: fileSize,
                                            defaultSize: this.defaultSize,
                                            optimalSize: this.optimalSize,
                                            compressDataPackage: this.compressDataPackage,
                                            statCost: TimeLogManager_1.TimeLogManager.getRuntime() - runTimeMs,
                                        }),
                                    }));
                                    if (!this.compressDataPackage) return [3 /*break*/, 3];
                                    decompressResult = this.decompressPackage("data-package/".concat(this.downloadFilename));
                                    return [4 /*yield*/, (0, Utils_1.handlePromise)(decompressResult)];
                                case 2:
                                    results = _a.sent();
                                    error = results[0];
                                    if (error) {
                                        reject(error);
                                    }
                                    else {
                                        resolve();
                                    }
                                    return [3 /*break*/, 5];
                                case 3: return [4 /*yield*/, FileSystemManager_1.default.writeFile(this.cachePath, new ArrayBuffer(1))];
                                case 4:
                                    _a.sent();
                                    resolve("data-package/".concat(this.downloadFilename));
                                    _a.label = 5;
                                case 5: return [3 /*break*/, 7];
                                case 6:
                                    error_2 = _a.sent();
                                    reject(error_2);
                                    return [3 /*break*/, 7];
                                case 7:
                                    isDownloadSuccessful_1 = true;
                                    unityManager_2.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                                        progress: 100,
                                        status: Types_1.LaunchStageStatus.FULFILLED,
                                    });
                                    return [2 /*return*/];
                            }
                        });
                    }); },
                    fail: function (error) {
                        _this.handleDownloadError(error, canRetry_2);
                        reject(error);
                    },
                });
                setTimeout(function () {
                    if (!isDownloadSuccessful_1) {
                        PluginLogger_1.default.pluginError(Types_1.ResourceDownloadError.DataPackage);
                        reject(new Error(Types_1.ResourceDownloadError.DataPackage));
                    }
                }, _this.pendingDuration);
                loadDataPackagePromise.onProgressUpdate(function (progressInfo) {
                    var totalBytesWrittenInMB = (progressInfo.totalBytesWritten / 1048576).toFixed(2);
                    var expectedBytesToWriteInMB = (progressInfo.totalBytesExpectedToWrite / 1048576).toFixed(2);
                    if (!GameGlobalVars_1.default.isRelease) {
                        PluginLogger_1.default.eventLog("资源包下载进度", progressInfo.progress, totalBytesWrittenInMB, "MB;", expectedBytesToWriteInMB, "MB");
                    }
                    unityManager_2.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                        progress: progressInfo.progress * 100,
                    });
                });
            }
            catch (error) {
                reject(error);
            }
        });
    };
    DataPackageLoader.prototype.init = function (unityManager, config) {
        this.unityManager = unityManager;
        this.initConfig(config);
    };
    DataPackageLoader.prototype.loadDataPackage = function () {
        return __awaiter(this, void 0, void 0, function () {
            var unityManager, downloadFilename, eventTrigger, primaryDataCachePath, fileInfo, cachePath, fileInput, dataPackagePath, results, error, error_3;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        unityManager = this.unityManager;
                        downloadFilename = this.downloadFilename;
                        eventTrigger = Events_1.EventTrigger.getInstance();
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 18, , 19]);
                        eventTrigger.triggerEvent(Types_1.GameEvents.AssetLoading, new Events_1.GameEventDetail(unityManager));
                        if (this.loadDataPackageFromSubpackage) {
                            PluginLogger_1.default.eventLog("通过小游戏分包加载资源", downloadFilename, ", 是否压缩=", this.compressDataPackage);
                        }
                        else {
                            PluginLogger_1.default.eventLog("通过CDN加载资源", downloadFilename);
                        }
                        primaryDataCachePath = this.getPrimaryDataCachePath();
                        fileInfo = FileSystemManager_1.default.getFileInfo(primaryDataCachePath);
                        cachePath = void 0;
                        if (!(primaryDataCachePath && (fileInfo === null || fileInfo === void 0 ? void 0 : fileInfo.size))) return [3 /*break*/, 4];
                        if (this.loadDataPackageFromSubpackage && !this.compressDataPackage) {
                            cachePath = "data-package/".concat(downloadFilename);
                        }
                        else {
                            cachePath = primaryDataCachePath;
                        }
                        PluginLogger_1.default.eventLog("从缓存加载首包资源");
                        PluginLogger_1.default.pluginLog("加载路径: ", cachePath);
                        if (!(this.loadDataPackageFromSubpackage && !this.compressDataPackage)) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.invokeLoadDataPackage(0)];
                    case 2:
                        _a.sent();
                        _a.label = 3;
                    case 3:
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                            progress: 100,
                            status: Types_1.LaunchStageStatus.FULFILLED,
                        });
                        return [3 /*break*/, 15];
                    case 4:
                        if (!(SystemEnvironmentVariables_1.default.enableOffline() && typeof SystemEnvironmentVariables_1.default.resolveOfflinePath === "function")) return [3 /*break*/, 8];
                        fileInput = (0, Utils_1.resolvePath)(GameGlobalVars_1.default.unityNamespace.DATA_CDN, this.downloadPath);
                        dataPackagePath = SystemEnvironmentVariables_1.default.resolveOfflinePath(fileInput);
                        if (!this.compressDataPackage) return [3 /*break*/, 6];
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(this.decompressPackage(dataPackagePath))];
                    case 5:
                        results = _a.sent();
                        error = results[0];
                        if (error) {
                            PluginLogger_1.default.pluginError("Offline mode: 解压资源包失败", error);
                        }
                        else {
                            PluginLogger_1.default.eventLog("Offline mode: 解压资源包成功", cachePath);
                        }
                        return [3 /*break*/, 7];
                    case 6:
                        this.cachePath = dataPackagePath;
                        PluginLogger_1.default.eventLog("Offline mode: Use local data package=" + this.cachePath);
                        _a.label = 7;
                    case 7:
                        cachePath = this.cachePath;
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                            progress: 100,
                            status: Types_1.LaunchStageStatus.FULFILLED,
                        });
                        return [3 /*break*/, 15];
                    case 8:
                        PluginLogger_1.default.eventLog("首包资源无缓存，开始下载");
                        if (!this.loadDataPackageFromSubpackage) return [3 /*break*/, 10];
                        return [4 /*yield*/, (0, Utils_1.executePromiseWithRetry)(function (retryCount) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                                return [2 /*return*/, this.invokeLoadDataPackage(retryCount)];
                            }); }); }, this.retryCount, this.retryDuration)];
                    case 9:
                        cachePath = _a.sent();
                        return [3 /*break*/, 14];
                    case 10:
                        if (!(!SystemEnvironmentVariables_1.default.isWK || this.compressDataPackage)) return [3 /*break*/, 12];
                        return [4 /*yield*/, (0, Utils_1.executePromiseWithRetry)(function (retryCount) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                                return [2 /*return*/, this.loadAssetsByDownloadFile(retryCount)];
                            }); }); }, this.retryCount, this.retryDuration)];
                    case 11:
                        cachePath = _a.sent();
                        return [3 /*break*/, 14];
                    case 12: return [4 /*yield*/, (0, Utils_1.executePromiseWithRetry)(function (retryCount) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {
                            return [2 /*return*/, this.loadAssetsByXhr(retryCount)];
                        }); }); }, this.retryCount, this.retryDuration)];
                    case 13:
                        cachePath = _a.sent();
                        _a.label = 14;
                    case 14:
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_ASSETS, {
                            progress: 100,
                            status: Types_1.LaunchStageStatus.FULFILLED,
                        });
                        _a.label = 15;
                    case 15:
                        unityManager.loadingCount -= 1;
                        PluginLogger_1.default.eventLog("loadDataPackage cachePath=" + cachePath);
                        if (!cachePath) return [3 /*break*/, 17];
                        return [4 /*yield*/, this.readDataPackage(cachePath)];
                    case 16:
                        _a.sent();
                        _a.label = 17;
                    case 17:
                        this.dataPackageLoaded = true;
                        PluginMonitor_1.default.getInstance().commonMonitor.recordAsset({
                            contentLength: unityManager.gameInstance.Module.rawData.byteLength,
                        });
                        eventTrigger.triggerEvent(Types_1.GameEvents.AssetLoaded, new Events_1.GameEventDetail(unityManager));
                        this.processRawData();
                        return [2 /*return*/, Promise.resolve()];
                    case 18:
                        error_3 = _a.sent();
                        PluginLogger_1.default.pluginError("加载资源异常 ", error_3.errMsg || error_3.message, error_3);
                        return [2 /*return*/, Promise.reject(error_3)];
                    case 19: return [2 /*return*/];
                }
            });
        });
    };
    DataPackageLoader.prototype.getPrimaryDataCachePath = function () {
        return FileSystemManager_1.default.getCachePath(this.cachePath);
    };
    DataPackageLoader.prototype.readDataPackage = function (filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var unityManager, _a, _b, error_4, errorMsg;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        unityManager = this.unityManager;
                        if (!filePath) {
                            return [2 /*return*/, Promise.reject("need asset path")];
                        }
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.READ_ASSETS, {
                            status: Types_1.LaunchStageStatus.PENDING,
                        });
                        TimeLogManager_1.TimeLogManager.timeStart("读取资源文件");
                        _c.label = 1;
                    case 1:
                        _c.trys.push([1, 6, , 7]);
                        if (!(SystemEnvironmentVariables_1.default.enableOffline() && !this.compressDataPackage)) return [3 /*break*/, 3];
                        _a = unityManager.gameInstance.Module;
                        return [4 /*yield*/, FileSystemManager_1.default.readFileTrunk(filePath, this.loadDataPackageFromSubpackage)];
                    case 2:
                        _a.rawData = _c.sent();
                        return [3 /*break*/, 5];
                    case 3:
                        _b = unityManager.gameInstance.Module;
                        return [4 /*yield*/, FileSystemManager_1.default.readFile(filePath, undefined, this.loadDataPackageFromSubpackage)];
                    case 4:
                        _b.rawData = _c.sent();
                        _c.label = 5;
                    case 5:
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.READ_ASSETS, {
                            status: Types_1.LaunchStageStatus.FULFILLED,
                        });
                        TimeLogManager_1.TimeLogManager.printTime("读取资源文件");
                        this.printBufferContent(unityManager.gameInstance.Module.rawData);
                        unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.READ_ASSETS, TimeLogManager_1.TimeLogManager.timeEnd("读取资源文件", false));
                        PluginLogger_1.default.eventLog("data content size=".concat(unityManager.gameInstance.Module.rawData.byteLength));
                        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.GameLaunchStatus.READ_ASSETS,
                            CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("读取资源文件"),
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                            ExternInfo: JSON.stringify({
                                fileSize: unityManager.gameInstance.Module.rawData.byteLength,
                                defaultSize: this.defaultSize,
                                optimalSize: this.optimalSize,
                                compressDataPackage: this.compressDataPackage,
                            }),
                        }));
                        return [2 /*return*/, Promise.resolve()];
                    case 6:
                        error_4 = _c.sent();
                        errorMsg = error_4;
                        if (typeof error_4 !== "number" && typeof error_4 !== "string") {
                            errorMsg = error_4.errMsg || error_4.message;
                        }
                        this.handleDataError({ errMsg: errorMsg });
                        return [2 /*return*/, Promise.resolve()];
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    DataPackageLoader.prototype.decompressPackage = function (filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var unityManager, readResults, results, error, content, errorMsg;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        unityManager = this.unityManager;
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.UNZIP_ASSETS, {
                            status: Types_1.LaunchStageStatus.PENDING,
                        });
                        TimeLogManager_1.TimeLogManager.timeStart("解压资源包耗时");
                        readResults = FileSystemManager_1.default.readCompressedFile(filePath);
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(readResults)];
                    case 1:
                        results = _a.sent();
                        error = results[0];
                        content = results[1];
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.UNZIP_ASSETS, {
                            status: Types_1.LaunchStageStatus.FULFILLED,
                        });
                        TimeLogManager_1.TimeLogManager.printTime("解压资源包耗时");
                        if (error || !(content === null || content === void 0 ? void 0 : content.byteLength)) {
                            errorMsg = (error === null || error === void 0 ? void 0 : error.errMsg) || "empty content";
                            ReportInitializer_1.default.remoteReporter.send({
                                ReportType: Types_1.GameLaunchStatus.UNZIP_ASSETS,
                                ErrorMsg: errorMsg,
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                            });
                            PluginLogger_1.default.pluginError("\u89E3\u538B\u8D44\u6E90\u5931\u8D25, \u52A0\u8F7D\u65B9\u5F0F: ".concat(this.loadDataPackageFromSubpackage ? "分包" : "CDN", ", errMsg: "), errorMsg);
                            return [2 /*return*/, Promise.reject(error || errorMsg)];
                        }
                        PluginLogger_1.default.eventLog("data decompressed size=".concat(content.byteLength));
                        unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.UNZIP_ASSETS, TimeLogManager_1.TimeLogManager.timeEnd("下载资源包耗时", false));
                        return [4 /*yield*/, ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.UNZIP_ASSETS,
                                CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("解压资源包耗时"),
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                ExternInfo: JSON.stringify({
                                    fileSize: content.byteLength,
                                    defaultSize: this.defaultSize,
                                    optimalSize: this.optimalSize,
                                    compressDataPackage: this.compressDataPackage,
                                }),
                            }))];
                    case 2:
                        _a.sent();
                        unityManager.gameInstance.Module.rawData = content;
                        this.printBufferContent(content);
                        return [4 /*yield*/, FileSystemManager_1.default.writeFile(this.cachePath, content)];
                    case 3:
                        _a.sent();
                        return [2 /*return*/, Promise.resolve(content)];
                }
            });
        });
    };
    DataPackageLoader.prototype.handleDownloadError = function (errorInfo, shouldPromptErrorDialog) {
        var isErrorNumber = typeof errorInfo == "number";
        var isErrorString = typeof errorInfo == "string";
        var errorMsg = errorInfo;
        if (!isErrorNumber && !isErrorString) {
            errorMsg = errorInfo.errMsg || errorInfo.message;
        }
        PluginLogger_1.default.pluginError("loadType=", this.loadDataPackageFromSubpackage ? "subpackage" : "cdn", "下载资源包失败: ", "statusCode=", isErrorNumber && errorMsg, ", networkType=", GameLogic_1.gameNetworkType.getNetworkType(), ", isVisible=", GameLogic_1.GameVisible.GetVisible(), ", errMsg=", errorMsg, ", error=", errorInfo);
        (0, TimeLogManager_1.reportEndPerformance)("下载资源包失败", Date.now(), errorMsg);
        if (!isErrorNumber && !isErrorString) {
            console.error(errorInfo);
        }
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.GameLaunchStatus.LOAD_ASSETS,
            ErrorMsg: "".concat(errorMsg),
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
        if (shouldPromptErrorDialog) {
            var shouldRestartGame_1 = !SystemEnvironmentVariables_1.default.isPC && errorMsg === Types_1.ResourceDownloadError.DataPackage && !!SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram;
            PluginLogger_1.default.pluginError("资源包下载最终失败", ", networkType=", GameLogic_1.gameNetworkType.getNetworkType(), ", isVisible=", GameLogic_1.GameVisible.GetVisible());
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: DefaultLanguageMap_1.default.handleAssetsDownloadError_title,
                content: "".concat(errorMsg).concat(SystemEnvironmentVariables_1.default.isPC && errorMsg === Types_1.ResourceDownloadError.Wasm ? DefaultLanguageMap_1.default.restartGameContent : ""),
                confirmText: shouldRestartGame_1 ? DefaultLanguageMap_1.default.restartGame : DefaultLanguageMap_1.default.confirm,
                showCancel: false,
                success: function () {
                    if (shouldRestartGame_1) {
                        SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram({});
                    }
                },
            });
        }
    };
    DataPackageLoader.prototype.checkPackageSize = function (fileSize) {
        // Nemo: 2024-10-09, to be compatible with the old version 1.1.x, we should always return true
        var isDefaultFileSize = !Number.isNaN(this.defaultSize) && fileSize === this.defaultSize;
        var isOptimalFileSize = !Number.isNaN(this.optimalSize) && fileSize === this.optimalSize;
        PluginLogger_1.default.eventLog("[datapackage] fileSize=".concat(fileSize, ", defaultSize=").concat(this.defaultSize, ", optimalSize=").concat(this.optimalSize));
        return isDefaultFileSize || isOptimalFileSize || 1;
    };
    DataPackageLoader.prototype.initConfig = function (dataPackageConfig) {
        if (dataPackageConfig === void 0) { dataPackageConfig = {}; }
        var loadDataPackageFromSubpackage = dataPackageConfig.loadDataPackageFromSubpackage, compressDataPackage = dataPackageConfig.compressDataPackage;
        this.loadDataPackageFromSubpackage = !!loadDataPackageFromSubpackage;
        this.compressDataPackage = !!compressDataPackage;
        var _a = GameGlobalVars_1.default.unityNamespace, dataFileMD5 = _a.DATA_FILE_MD5, gameName = _a.GAME_NAME, dataFileSize = _a.DATA_FILE_SIZE, optionalDataFileSize = _a.OPT_DATA_FILE_SIZE, _b = _a.dataFileSubPrefix, dataFileSubPrefix = _b === void 0 ? "" : _b;
        this.md5 = dataFileMD5;
        this.cacheFilename = "".concat(this.md5, ".").concat(gameName, ".data.unityweb.bin");
        this.downloadFilename = this.compressDataPackage
            ? "".concat(this.cacheFilename, ".br")
            : "".concat(this.cacheFilename, ".txt");
        this.unityManager.gameInstance.Module.preLoaDataPath = this.downloadFilename;
        this.cachePath = (0, Utils_1.resolvePath)(dataFileSubPrefix, this.cacheFilename);
        this.downloadPath = (0, Utils_1.resolvePath)(dataFileSubPrefix, this.downloadFilename);
        this.defaultSize = Number(dataFileSize);
        this.optimalSize = Number(optionalDataFileSize);
    };
    DataPackageLoader.prototype.handleDataError = function (errorDetail) {
        var errorMessage = errorDetail.errMsg;
        var errorDetailsByteLength = errorDetail.byteLength;
        var defaultSize = errorDetail.defaultSize;
        var optimalSize = errorDetail.optimalSize;
        var errorDetailsPrefix = errorDetail.prefix;
        if (!this.loadDataPackageFromSubpackage || this.compressDataPackage) {
            FileSystemManager_1.default.removeFile(this.cachePath);
        }
        GameGlobalVars_1.default.logManager.warn(errorMessage);
        GameGlobalVars_1.default.realtimeLogManager.error(errorMessage);
        var onCrash = (GameGlobalVars_1.default.unityNamespace || {}).onCrash;
        if (onCrash) {
            onCrash.call(GameGlobalVars_1.default.unityNamespace);
        }
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.GameLaunchStatus.READ_ASSETS,
            ErrorMsg: errorMessage,
            ExternInfo: JSON.stringify({
                byteLength: errorDetailsByteLength,
                defaultSize: defaultSize,
                optimalSize: optimalSize,
                prefix: errorDetailsPrefix,
                compressDataPackage: this.compressDataPackage,
            }),
        }));
    };
    DataPackageLoader.prototype.printBufferContent = function (content) {
        if (content) {
            PluginLogger_1.default.eventLog("[datapackage] content=", new Uint8Array(content, 0, 64).toString());
        }
    };
    return DataPackageLoader;
}(Instance_1.default));
exports["default"] = new DataPackageLoader();


/***/ }),

/***/ "./src/lib/DefaultLanguageMap.ts":
/*!***************************************!*\
  !*** ./src/lib/DefaultLanguageMap.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var defaultLanguageMap_CN = {
    // initialization of i18n support
    reminder: "提示",
    restartGame: '重启游戏',
    confirm: '确定',
    restartGameContent: '\n请重新打开游戏',
    ifInteractable: '[可交互]',
    loadingPage_firstStartText: '首次加载中，请耐心等待',
    loadingPage_initText: '分包加载中',
    loadingPage_downloadingText: '资源下载中',
    loadingPage_compilingText: '资源编译中',
    loadingPage_completeText: '游戏初始化',
    showAbort_title: '程序遇到错误',
    showAbort_content: '可尝试重启游戏\n或通过"右上角菜单-反馈与投诉"提交功能异常反馈',
    webglContext_notSupport: '不支持',
    webglContext_upgradeTip: '，请升级',
    webglContext_sysTag: '系统',
    webglContext_tap: 'TapTap',
    startCheckIs32Kuaishou_content: '当前为32位版本\n请升级最新版本',
    startCheckIs32Kuaishou_confirm: '确认升级',
    handleWASMDownloadError_title: '下载wasm代码包失败',
    handleAssetsDownloadError_title: '资源下载失败',
    showResultInfo_title: '检测报告',
    showResult_LaunchOptAdvice: '启动优化建议: ',
    showResult_preloadOptAdvice: '预下载优化建议: ',
    showResult_wasmOptAdvice: 'wasm分包优化建议: ',
    showResult_netOptAdvice: '网络优化建议: ',
    showResult_frameRateOptAdvice: '帧率优化建议: ',
    showResult_openDebugger: '<打开调试查看功能文档>\n',
    showResult_title: '优化建议',
    showBaseInfo_wasmDownloadTime: 'wasm下载耗时: ',
    showBaseInfo_wasmSize: 'wasm包大小: ',
    showBaseInfo_assetsDownloadTime: '资源包下载耗时: ',
    showBaseInfo_assetsSize: '资源包大小: ',
    showBaseInfo_ifZipped: '资源包是否压缩: ',
    showBaseInfo_engineInitTime: '引擎初始化耗时: ',
    showBaseInfo_engineCompleteTime: '引擎初始化完成耗时: ',
    showBaseInfo_preConfigNum: '预下载配置个数: ',
    showBaseInfo_totalPreNum: '总预下载完成个数: ',
    showBaseInfo_totalPreSize: '总预下载完成大小: ',
    showBaseInfo_preNumWhenEngineComplete: '引擎初始化完成时预载个数: ',
    showBaseInfo_preSizeWhenEngineComplete: '引擎初始化完成时预载大小: ',
    showAssetInfo_netTime: '网络时长: ',
    showAssetInfo_netProportion: '网络时长占比: ',
    showAssetInfo_beginTime: '距首个网络请求开始时长: ',
    showAssetInfo_totalCachedReqNum: '总请求个数(含命中本地缓存): ',
    showAssetInfo_totalReqNum: '实际网络请求个数(未命中本地缓存): ',
    showAssetInfo_autoCachedAssetsNum: '自动缓存资源个数: ',
    showAssetInfo_notAutoCachedAssetsNum: '非自动缓存资源个数: ',
    showAssetInfo_autoCachedNetNum: '自动缓存资源网络个数: ',
    showAssetInfo_textureNum: '纹理个数: ',
    showAssetInfo_preLoadedTotalAssetsSize: '总资源大小(含预载): ',
    showAssetInfo_preUnloadedTotalAssetsNum: '总资源大小(不含预载): ',
    showAssetInfo_autoCachedAssetsSize: '自动缓存资源大小: ',
    showAssetInfo_notAutoCachedAssetsSize: '未自动缓存资源大小: ',
    showAssetInfo_autoCachedNetSize: '自动缓存资源网络大小: ',
    showAssetInfo_textureSize: '纹理大小: ',
    showAssetInfo_ifTextureCached: '是否缓存纹理: ',
    showAssetInfo_avgConcurrentNum: '平均并发数: ',
    showAssetInfo_maxConcurrentNum: '最大并发数: ',
    showAssetInfo_avgReqJankTime: '平均请求阻塞时长: ',
    showAssetInfo_top5ReqJankTime: 'TOP5请求阻塞时长: ',
    showAssetInfo_avgReadCacheTime: '平均读缓存耗时: ',
    showAssetInfo_top5ReadCacheTime: 'TOP5读缓存耗时: ',
    showAssetInfo_top5NetTime: 'TOP5网络耗时: ',
    showAssetInfo_CDNCacheNum: '命中CDN缓存数: ',
    showAssetInfo_HTTP2Num: '启用HTTP2.0个数: ',
    showAssetInfo_ifHTTP2Enabled: '是否开启HTTP2.0: ',
    showAssetInfo_serverZippedAssetsNum: '资源开启服务器压缩个数: ',
    showAssetInfo_ifServerEnabledAssetsZip: '资源是否开启服务器压缩: ',
    showAssetInfo_ifReqCatalog: '是否请求catalog: ',
    showAssetInfo_ifCatalogWithVersion: 'catalog是否带版本信息: ',
    showAssetInfo_ifReqCatalogHashHotUpdate: '是否请求catalog.hash热更新: ',
    showAssetInfo_ifCacheCatalog: '是否缓存catalog: ',
    showAssetInfo_ifReqSettings: '是否请求settings: ',
    showAssetInfo_ifCacheSettings: '是否缓存settings: ',
    showFrameInfo_longLastingFrameNum: '长耗时帧个数: ',
    showFrameInfo_longestFrameTime: '最长耗时帧耗时: ',
    showFrameInfo_top5FrameTime: 'TOP5帧耗时: ',
    showFrameInfo_top5FrameNetConcurrent: 'TOP5帧网络并发: ',
    showFrameInfo_totalJankTime: '总卡顿时长: ',
    showFrameInfo_jankRate: '卡顿率: ',
    showFrameInfo_setMonitorFPS: '设置监控FPS: ',
    showFrameInfo_setMonitorTime: '设置监控时长: ',
    showFrameInfo_showResultAfterLaunch: '可交互结束监控: ',
    showFrameInfo_actualMonitorTime: '实际监控时长: ',
    showFrameInfo_appRuntime: '运行时长: ',
    // end of initialization
    // leiyang: update some popup notifications on 2025-03-10
    commonMonitor_haventUseCodeSplit: '未使用wasm代码分包',
    commonMonitor_largeAssetPackage: '首资源包较大',
    commonMonitor_noContentEncoding: '首资源包未开启服务器压缩',
    commonMonitor_longCallmainCost: 'callmain耗时较长，请用安卓cpuprofile分析热点函数',
    requestMonitor_disableH2: "未开启http2",
    requestMonitor_noCDNCache: "未命中CDN缓存",
    requestMonitor_cacheBundleSettings: "请勿缓存settings.json",
    requestMonitor_noCacheCatalog: "可将catalog.json配置为可缓存文件",
    requestMonitor_noCatalogHash: "catalog.json被缓存且无hash/版本信息, 会导致无法更新",
    requestMonitor_requestCataHash: "请勿请求catalog.hash来做资源热更新，小游戏平台不支持",
    requestMonitor_lessCacheableCount: "可缓存文件过少，检查缓存配置",
    requestMonitor_lessParallelCount: "网络并发数过少",
    requestMonitor_lessNetworkTime: "网络未充分利用",
    requestMonitor_serverNotCachedAssets: "未开启服务器压缩资源个数",
    frameMonitor_longFrame: "存在长耗时帧",
    frameMonitor_totalJankTime: "总卡顿时长",
    frameMonitor_jankRate: "卡顿时长占比",
    frameMonitor_showResult_frameRateOptAdvice: "帧率优化建议",
    frameMonitor_cpuprofile: "请使用安卓cpuprofile分析卡顿问题",
    pluginMonitor_noPreloadAssets: "未使用预下载能力",
    pluginMonitor_tooManyAssets: "预下载资源个数较多",
    pluginMonitor_tooLargeAssetSize: "预下载资源量较大",
    pluginMonitor_lowDownloadSpeed: "已发起预下载，但未完成，请检查预下载资源是否过大，或是否下载过慢",
    pluginMonitor_smallAssetSize: "预下载资源较小，请将大资源调整到预下载列表顶部",
    wasmSplitMonitor_loadDurationCallmain: "wasm子包在callmain期间加载，请使用分包工具继续收集",
    wasmSplitMonitor_loadSubwasmEarly: "wasm子包加载时机过早，请使用分包工具继续收集",
    wasmSplitMonitor_longFetchPending: "缺失函数过多，请使用分包工具继续收集",
    // end of update on 2025-03-10
};
var customLanguageMap = (_b = (_a = SystemEnvironmentVariables_1.default.ks.customObj) === null || _a === void 0 ? void 0 : _a.languageMap) !== null && _b !== void 0 ? _b : defaultLanguageMap_CN;
var languageMap = new Proxy(customLanguageMap, {
    get: function (target, key) {
        var _a;
        return (_a = target[key]) !== null && _a !== void 0 ? _a : defaultLanguageMap_CN[key];
    }
});
exports["default"] = languageMap;


/***/ }),

/***/ "./src/lib/EmptyClass.ts":
/*!*******************************!*\
  !*** ./src/lib/EmptyClass.ts ***!
  \*******************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var EmptyClass = /** @class */ (function () {
    function EmptyClass() {
    }
    return EmptyClass;
}());
exports["default"] = EmptyClass;


/***/ }),

/***/ "./src/lib/ErrorProp.ts":
/*!******************************!*\
  !*** ./src/lib/ErrorProp.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ImagePreviewer_1 = __webpack_require__(/*! ../coverview/ImagePreviewer */ "./src/coverview/ImagePreviewer.ts");
var EmptyClass_1 = __importDefault(__webpack_require__(/*! ./EmptyClass */ "./src/lib/EmptyClass.ts"));
var isMiniGamePlugin = SystemEnvironmentVariables_1.default.isMiniGamePlugin;
var ErrorProp = /** @class */ (function (_super) {
    __extends(ErrorProp, _super);
    function ErrorProp() {
        var _this = _super.call(this) || this;
        _this.unityGamePlugin = {
            body: {
                zIndex: 1000009,
                position: "absolute",
                overflow: "visible",
                hidden: false,
                width: 184,
                height: 110,
                top: SystemEnvironmentVariables_1.default.systemInfo.screenHeight / 3,
                left: (SystemEnvironmentVariables_1.default.systemInfo.screenWidth - 184) / 2,
            },
            title: {
                position: "absolute",
                left: 0,
                top: 0,
                width: 184,
                height: 40,
                lineHeight: 40,
                textAlign: "center",
                color: "#ff0000",
                fontSize: 18,
                fontWeight: 500,
                backgroundColor: "#ffffff",
            },
            restartBtn: {
                position: "absolute",
                left: 0,
                top: 70,
                width: 184,
                height: 40,
                lineHeight: 40,
                textAlign: "center",
                backgroundColor: "#07C160",
                borderRadius: 4,
                color: "#ffffff",
                fontSize: 16,
            },
        };
        return _this;
    }
    ErrorProp.getInstance = function () {
        this.instance || (this.instance = new ErrorProp());
        return this.instance;
    };
    ErrorProp.prototype.create = function () {
        return this.createPromise();
    };
    ErrorProp.prototype.destroy = function () {
        return __awaiter(this, void 0, void 0, function () {
            var coverview, webviewLayout, gameInstance;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        coverview = SystemEnvironmentVariables_1.default.pluginEnv.coverview;
                        webviewLayout = coverview === null || coverview === void 0 ? void 0 : coverview.webviewLayout;
                        return [4 /*yield*/, this.create()];
                    case 1:
                        gameInstance = _a.sent();
                        gameInstance.body
                            .animate({
                            opacity: 0,
                            duration: 300,
                        })
                            .then(function () {
                            webviewLayout === null || webviewLayout === void 0 ? void 0 : webviewLayout.remove(gameInstance.body);
                        });
                        return [2 /*return*/];
                }
            });
        });
    };
    ErrorProp.prototype.createPromise = function () {
        var _this = this;
        return new Promise(function (initTextElement, dataProcessingIndex) {
            _this.parseLoadingComponentStyle().then(initTextElement).catch(dataProcessingIndex);
        });
    };
    ErrorProp.prototype.parseLoadingComponentStyle = function () {
        return __awaiter(this, void 0, void 0, function () {
            function parseLoadingComponent(loadingComponentStyle) {
                loadingComponentStyle = loadingComponentStyle.trim().replace(/<!--[\s\S]*?-->/g, "");
                function _parseXmlDeclaration() {
                    if (extractBackgroundImage(/^<\?xml\s*/)) {
                        var _parsedAttributes = {};
                        while (!hasNoLoadingComponents() && !isBackgroundImageAtStart("?>")) {
                            var extractedAttribute = extractAttribute();
                            if (!extractedAttribute) {
                                return { attributes: _parsedAttributes };
                            }
                            _parsedAttributes[extractedAttribute.name] = extractedAttribute.value;
                        }
                        extractBackgroundImage(/\?>\s*/);
                        return { attributes: _parsedAttributes };
                    }
                    return { attributes: {} };
                }
                function parseHtmlElement() {
                    var htmlElementTag = extractBackgroundImage(/^<([\w-:.]+)\s*/);
                    if (htmlElementTag) {
                        var parsedHtmlElement = {
                            name: htmlElementTag[1],
                            attributes: {},
                            children: [],
                        };
                        while (!hasNoLoadingComponents() &&
                            !isBackgroundImageAtStart(">") &&
                            !isBackgroundImageAtStart("/>")) {
                            var _extractedAttribute = extractAttribute();
                            if (!_extractedAttribute) {
                                return parsedHtmlElement;
                            }
                            parsedHtmlElement.attributes[_extractedAttribute.name] = _extractedAttribute.value;
                        }
                        if (extractBackgroundImage(/^\s*\/>\s*/)) {
                            return parsedHtmlElement;
                        }
                        extractBackgroundImage(/\?>\s*/);
                        parsedHtmlElement.content = extractTextBeforeTag();
                        var nestedHtmlElement = void 0;
                        while ((nestedHtmlElement = parseHtmlElement())) {
                            parsedHtmlElement.children.push(nestedHtmlElement);
                        }
                        extractBackgroundImage(/^<\/[\w-:.]+>\s*/);
                        return parsedHtmlElement;
                    }
                    return null;
                }
                function extractAttribute() {
                    var matchedAttribute = extractBackgroundImage(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);
                    if (matchedAttribute) {
                        var value = matchedAttribute[2].replace(/^['"]|['"]$/g, "");
                        return { name: matchedAttribute[1], value: value };
                    }
                    return null;
                }
                function extractBackgroundImage(regex) {
                    var result = loadingComponentStyle.match(regex);
                    if (result) {
                        loadingComponentStyle = loadingComponentStyle.slice(result[0].length);
                        return result;
                    }
                    return null;
                }
                function hasNoLoadingComponents() {
                    return loadingComponentStyle.length === 0;
                }
                function isBackgroundImageAtStart(backgroundImage) {
                    return loadingComponentStyle.indexOf(backgroundImage) === 0;
                }
                function extractTextBeforeTag() {
                    var textBeforeHtmlTag = extractBackgroundImage(/^([^<]*)/);
                    return textBeforeHtmlTag ? textBeforeHtmlTag[1] : "";
                }
                return {
                    declaration: _parseXmlDeclaration(),
                    root: parseHtmlElement() || { name: "", attributes: {}, children: [] },
                };
            }
            var parseLoadingComponentMarkup, __parseLoadingComponentStyle, ___parseLoadingComponentStyle, coverview, webviewLayout, coverviewInit, loadingComponentStyleParser;
            return __generator(this, function (_a) {
                parseLoadingComponentMarkup = "\n    <view id=\"body\">\n      <text id=\"title\" value=\"\u7A0B\u5E8F\u9047\u5230\u9519\u8BEF\"></text>\n      <text id=\"restart-btn\" value=\"\u91CD\u542F\u6E38\u620F\"></text>\n    </view>\n  ";
                __parseLoadingComponentStyle = (0, ImagePreviewer_1.getComponent)(this);
                ___parseLoadingComponentStyle = parseLoadingComponent(parseLoadingComponentMarkup).root;
                coverview = SystemEnvironmentVariables_1.default.pluginEnv.coverview;
                webviewLayout = coverview === null || coverview === void 0 ? void 0 : coverview.webviewLayout;
                coverviewInit = coverview === null || coverview === void 0 ? void 0 : coverview.init;
                loadingComponentStyleParser = JSON.parse(JSON.stringify(this.unityGamePlugin));
                coverviewInit.call(this, ___parseLoadingComponentStyle, loadingComponentStyleParser);
                webviewLayout.add(__parseLoadingComponentStyle.body);
                __parseLoadingComponentStyle.restartBtn.on("click", function () {
                    if (SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram) {
                        SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram({});
                    }
                });
                return [2 /*return*/, __parseLoadingComponentStyle.body.ready()];
            });
        });
    };
    return ErrorProp;
}((isMiniGamePlugin ? ImagePreviewer_1.ComponentManager : EmptyClass_1.default)));
exports["default"] = ErrorProp;


/***/ }),

/***/ "./src/lib/EventEmitter.ts":
/*!*********************************!*\
  !*** ./src/lib/EventEmitter.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EventEmitter = exports.eventEmitter = void 0;
// module 6729
var EventEmitter = /** @class */ (function () {
    function EventEmitter() {
        this._events = {};
        this._eventsCount = 0;
        this.delimiter = "~";
    }
    // 获取所有事件名称
    EventEmitter.prototype.eventNames = function () {
        var events = this._events;
        var eventKeys = [];
        if (this._eventsCount === 0) {
            return eventKeys;
        }
        for (var eventKey in events) {
            if (events.hasOwnProperty(eventKey)) {
                eventKeys.push(this.delimiter ? eventKey.slice(1) : eventKey);
            }
        }
        if (Object.getOwnPropertySymbols) {
            return eventKeys.concat(Object.getOwnPropertySymbols(events));
        }
        else {
            return eventKeys;
        }
    };
    // 获取特定事件的监听器
    EventEmitter.prototype.listeners = function (eventName) {
        var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
        var eventListeners = this._events[eventKey];
        if (!eventListeners) {
            return [];
        }
        if (eventListeners.fn) {
            return [eventListeners.fn];
        }
        return eventListeners.map(function (listener) { return listener.fn; });
    };
    // 获取特定事件的监听器数量
    EventEmitter.prototype.listenerCount = function (eventName) {
        var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
        var eventHandler = this._events[eventKey];
        if (!eventHandler) {
            return 0;
        }
        if (eventHandler.fn) {
            return 1;
        }
        return eventHandler.length;
    };
    // 发射事件
    EventEmitter.prototype.emit = function (eventName) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
        var eventListener = this._events[eventKey];
        if (!eventListener) {
            return false;
        }
        if (eventListener.fn) {
            if (eventListener.once) {
                this.removeListener(eventName, eventListener.fn);
            }
            eventListener.fn.apply(eventListener.context, args);
        }
        else {
            var eventHandlers = eventListener;
            for (var i = 0; i < eventHandlers.length; i++) {
                if (eventHandlers[i].once) {
                    this.removeListener(eventName, eventHandlers[i].fn);
                }
                eventHandlers[i].fn.apply(eventHandlers[i].context, args);
            }
        }
        return true;
    };
    // 添加事件监听器
    EventEmitter.prototype.on = function (eventName, listener, context) {
        this._addListener(eventName, listener, false, context);
        return this;
    };
    // 添加一次性事件监听器
    EventEmitter.prototype.once = function (eventName, listener, context) {
        this._addListener(eventName, listener, true, context);
        return this;
    };
    EventEmitter.prototype._addListener = function (eventName, listener, once, context) {
        if (typeof listener !== "function") {
            throw new TypeError("The listener must be a function");
        }
        var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
        var listenerObj = {
            fn: listener,
            context: context || this,
            once: once,
        };
        if (this._events[eventKey]) {
            if (this._events[eventKey].fn) {
                this._events[eventKey] = [this._events[eventKey], listenerObj];
            }
            else {
                this._events[eventKey].push(listenerObj);
            }
        }
        else {
            this._events[eventKey] = listenerObj;
            this._eventsCount++;
        }
        return this;
    };
    EventEmitter.prototype.removeListener = function (eventName, listener, context, once) {
        var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
        if (!this._events[eventKey]) {
            return this;
        }
        if (!listener) {
            this._updateRequestOptions(eventKey);
            return this;
        }
        var eventHandlers = this._events[eventKey];
        if (eventHandlers.fn) {
            if (eventHandlers.fn === listener &&
                (!once || !!eventHandlers.once) &&
                (!context || eventHandlers.context === context)) {
                this._updateRequestOptions(eventKey);
            }
        }
        else {
            var filteredEventHandlers = eventHandlers.filter(function (handler) {
                return (handler.fn !== listener ||
                    (once && !handler.once) ||
                    (context && handler.context !== context));
            });
            if (filteredEventHandlers.length) {
                if (filteredEventHandlers.length === 1) {
                    this._events[eventKey] = filteredEventHandlers[0];
                }
                else {
                    this._events[eventKey] = filteredEventHandlers;
                }
            }
            else {
                this._updateRequestOptions(eventKey);
            }
        }
        return this;
    };
    EventEmitter.prototype._updateRequestOptions = function (eventKey) {
        if (--this._eventsCount === 0) {
            this._events = {};
        }
        else {
            delete this._events[eventKey];
        }
    };
    EventEmitter.prototype.removeAllListeners = function (eventName) {
        if (eventName) {
            var eventKey = this.delimiter ? this.delimiter + eventName : eventName;
            if (this._events[eventKey]) {
                this._updateRequestOptions(eventKey);
            }
        }
        else {
            this._events = {};
            this._eventsCount = 0;
        }
        return this;
    };
    return EventEmitter;
}());
exports.EventEmitter = EventEmitter;
var eventEmitter = new EventEmitter();
exports.eventEmitter = eventEmitter;


/***/ }),

/***/ "./src/lib/EventHandler.ts":
/*!*********************************!*\
  !*** ./src/lib/EventHandler.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.EventHandler = void 0;
// module 9308
var FrameConstructor_1 = __importDefault(__webpack_require__(/*! ./FrameConstructor */ "./src/lib/FrameConstructor.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var EventHandler = /** @class */ (function () {
    function EventHandler(defaultExport, GlobalVariable) {
        this.events = [];
        this.frameBase = defaultExport;
        this.eventsStruct = GlobalVariable;
    }
    EventHandler.prototype.registerEvent = function (eventObject) {
        var boundEvents = [];
        if (Array.isArray(eventObject.bind)) {
            boundEvents.push.apply(boundEvents, eventObject.bind);
        }
        else {
            boundEvents.push(eventObject.bind);
        }
        eventObject.bind = boundEvents;
        var eventCheckResult = EventHandler.EventCheck(this.eventsStruct, eventObject);
        if (eventCheckResult !== null) {
            this.events.push(eventCheckResult);
        }
    };
    EventHandler.prototype.getEvents = function (eventType) {
        if (!eventType) {
            return this.events;
        }
        var filteredEvents = [];
        this.events.forEach(function (event) {
            if (event.event === eventType) {
                filteredEvents.push(event);
            }
        });
        return filteredEvents;
    };
    EventHandler.prototype.exportEvents = function () {
        var eventArray = [];
        this.events.forEach(function (event) {
            eventArray.push({
                event: event.event,
                params: event.params,
                bind: event.bind.map(function (bindItem) { return ({
                    type: bindItem.type,
                    uid: bindItem.uid,
                }); }),
                keep: !!event.keep,
            });
        });
        return eventArray;
    };
    EventHandler.prototype.importEvents = function (eventArray) {
        var _this = this;
        eventArray.forEach(function (actionHandler) {
            var actionData = {
                event: actionHandler.event,
                params: actionHandler.params,
                bind: actionHandler.bind.map(function (parameterValue) {
                    var operationData = {
                        type: parameterValue.type,
                        uid: parameterValue.uid,
                    };
                    _this.frameBase.getFrameBase().getOperaData().delegateUid2Ob(parameterValue.type, parameterValue.uid, operationData, 'ob');
                    return operationData;
                }),
                keep: !!actionHandler.keep,
            };
            _this.events.push(actionData);
        });
    };
    EventHandler.prototype.launchEvent = function (event) {
        for (var i = 0; i < this.events.length; i++) {
            if (this.events[i] === event) {
                if (!event.keep) {
                    this.events.splice(i, 1);
                }
                FrameConstructor_1.default.eventEmitter.emit(this.frameBase.getFrameBase(), CaseType_1.FrameBaseCaseType.EventLaunch, event);
                return;
            }
        }
    };
    EventHandler.EventCheck = function (eventDefinition, eventData) {
        var eventKeys = Object.keys(eventDefinition);
        if (eventKeys.indexOf(eventData.event) < 0) {
            console.error("\u4E8B\u4EF6\u5B9A\u4E49\u8303\u56F4 ".concat(JSON.stringify(eventKeys), " \u4E0D\u5B58\u5728\u6CE8\u518C\u76EE\u6807 event \u7C7B\u578B ").concat(eventData.event));
            return null;
        }
        var eventDefinitionDetails = eventDefinition[eventData.event];
        var params = (0, Utils_1.checkParams)(eventDefinitionDetails.params, eventData.params) || {};
        var boundElements = [];
        if (Array.isArray(eventData.bind)) {
            boundElements.push.apply(boundElements, eventData.bind);
        }
        else {
            boundElements.push(eventData.bind);
        }
        var boundObjects = boundElements.map(function (moduleExport) { return ({
            type: Types_1.OperaDataType.StoryLine,
            uid: moduleExport.getUid(),
            ob: moduleExport,
        }); });
        return {
            event: eventData.event,
            params: params,
            bind: boundObjects,
            keep: !!eventData.keep,
        };
    };
    return EventHandler;
}());
exports.EventHandler = EventHandler;
exports["default"] = EventHandler;


/***/ }),

/***/ "./src/lib/EventListener.ts":
/*!**********************************!*\
  !*** ./src/lib/EventListener.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventEmitter = /** @class */ (function () {
    function EventEmitter() {
        this.eventListeners = {};
    }
    EventEmitter.prototype.on = function (eventType, handler, context) {
        var _a;
        var listeners = (_a = this.eventListeners)[eventType] || (_a[eventType] = []);
        listeners.push({ fn: handler, ctx: context });
        return this;
    };
    EventEmitter.prototype.once = function (eventType, handler, context) {
        var _this = this;
        var wrapper = function () {
            var args = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                args[_i] = arguments[_i];
            }
            _this.off(eventType, wrapper);
            handler.apply(context, args);
        };
        wrapper._original = handler;
        return this.on(eventType, wrapper, context);
    };
    EventEmitter.prototype.emit = function (eventType) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var listeners = (this.eventListeners[eventType] || []).slice();
        listeners.forEach(function (listener) {
            listener.fn.apply(listener.ctx, args);
        });
        return this;
    };
    EventEmitter.prototype.off = function (eventType, handler) {
        if (!eventType) {
            this.eventListeners = {};
            return this;
        }
        if (!handler) {
            delete this.eventListeners[eventType];
            return this;
        }
        var listeners = this.eventListeners[eventType];
        if (listeners) {
            this.eventListeners[eventType] = listeners.filter(function (listener) { return listener.fn !== handler &&
                listener.fn._original !== handler; });
            if (!this.eventListeners[eventType].length) {
                delete this.eventListeners[eventType];
            }
        }
        return this;
    };
    return EventEmitter;
}());
exports["default"] = EventEmitter;


/***/ }),

/***/ "./src/lib/EventManager.ts":
/*!*********************************!*\
  !*** ./src/lib/EventManager.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
// module 8788
var EventManager = /** @class */ (function () {
    function EventManager() {
        this.events = new Map();
    }
    EventManager.prototype.registerEvent = function (eventName, callback) {
        if (this.events.has(eventName)) {
            var eventCallbacks = this.events.get(eventName);
            if (!(eventCallbacks === null || eventCallbacks === void 0 ? void 0 : eventCallbacks.includes(callback))) {
                eventCallbacks === null || eventCallbacks === void 0 ? void 0 : eventCallbacks.push(callback);
            }
        }
        else {
            this.events.set(eventName, [callback]);
        }
    };
    EventManager.prototype.emit = function (eventKey) {
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        if (eventKey && this.events.has(eventKey)) {
            var callbacks = this.events.get(eventKey);
            callbacks === null || callbacks === void 0 ? void 0 : callbacks.forEach(function (callback) {
                callback.apply(void 0, args);
            });
        }
    };
    return EventManager;
}());
exports["default"] = EventManager;


/***/ }),

/***/ "./src/lib/Events.ts":
/*!***************************!*\
  !*** ./src/lib/Events.ts ***!
  \***************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.HttpRequestCompleteEvent = exports.EventTrigger = exports.GameLaunchEventDetail = exports.GameEventDetail = void 0;
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var EventEmitter_1 = __webpack_require__(/*! ./EventEmitter */ "./src/lib/EventEmitter.ts");
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var GameEventDetail = /** @class */ (function () {
    function GameEventDetail(unityManager) {
        this.isVisible = !!unityManager.isVisible;
        this.useCodeSplit = !!unityManager.codeType;
        this.isHighPerformance = !!SystemEnvironmentVariables_1.default.isWK;
        this.loadDataPackageFromSubpackage = true;
        this.needDownloadDataPackage = !!DataPackageLoader_1.default.getPrimaryDataCachePath();
        this.loadingPageType = unityManager.loadingPageType;
        this.features = GameFeatures_1.gameFeatures.getFeatures();
    }
    return GameEventDetail;
}());
exports.GameEventDetail = GameEventDetail;
var GameLaunchEventDetail = /** @class */ (function (_super) {
    __extends(GameLaunchEventDetail, _super);
    function GameLaunchEventDetail(unityManager, type, costTimeMs) {
        var _this = _super.call(this, unityManager) || this;
        _this.type = type;
        _this.data = {
            costTimeMs: costTimeMs,
            runTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            isVisible: _this.isVisible,
            useCodeSplit: _this.useCodeSplit,
            isHighPerformance: _this.isHighPerformance,
            loadDataPackageFromSubpackage: _this.loadDataPackageFromSubpackage,
            needDownloadDataPackage: _this.needDownloadDataPackage,
        };
        delete _this.isVisible;
        delete _this.useCodeSplit;
        delete _this.isHighPerformance;
        delete _this.loadDataPackageFromSubpackage;
        delete _this.needDownloadDataPackage;
        delete _this.loadingPageType;
        delete _this.features;
        return _this;
    }
    return GameLaunchEventDetail;
}(GameEventDetail));
exports.GameLaunchEventDetail = GameLaunchEventDetail;
var EventTrigger = /** @class */ (function (_super) {
    __extends(EventTrigger, _super);
    function EventTrigger() {
        return _super.call(this) || this;
    }
    EventTrigger.prototype.init = function (unityManager) {
        this.unityManager = unityManager;
        this.bindFunction();
    };
    EventTrigger.prototype.triggerEvent = function (actionEvent, actionDetails) {
        var _a;
        EventEmitter_1.eventEmitter.emit(actionEvent, actionDetails);
        if (actionEvent === Types_1.GameEvents.LaunchProgress && (actionDetails === null || actionDetails === void 0 ? void 0 : actionDetails.type) && Types_1.GameLaunchStatusMap[actionDetails.type]) {
            (_a = GameGlobalVars_1.default.customEvents) === null || _a === void 0 ? void 0 : _a.emit(Types_1.GameLaunchStatusMap[actionDetails.type], actionDetails);
        }
    };
    EventTrigger.prototype.bindFunction = function () {
        var context = this;
        Object.values(Types_1.GameEvents).forEach(function (event) {
            if (event === Types_1.GameEvents.LaunchProgress) {
                context.unityManager[event] = function (callback) {
                    if (typeof callback === "function") {
                        EventEmitter_1.eventEmitter.on(event, callback);
                    }
                    if (context.unityManager.launchData.length > 0) {
                        context.unityManager.launchData.forEach(function (callback) {
                            context.triggerEvent(event, callback);
                        });
                    }
                };
            }
            else {
                context.unityManager[event] = function (callback) {
                    if (typeof callback === "function") {
                        EventEmitter_1.eventEmitter.on(event, callback);
                    }
                };
            }
        });
    };
    return EventTrigger;
}(Instance_1.default));
exports.EventTrigger = EventTrigger;
var HttpRequestCompleteEvent = /** @class */ (function () {
    function HttpRequestCompleteEvent(detail) {
        this.status = detail.status;
        this.errMsg = detail.errMsg;
        this.cachePath = detail.xhrObj.cachePath;
        this.response = detail.xhrObj.response;
        this.cacheable = detail.xhrObj.cacheable;
        this.isReadFromCache = detail.xhrObj.isReadFromCache;
    }
    return HttpRequestCompleteEvent;
}());
exports.HttpRequestCompleteEvent = HttpRequestCompleteEvent;


/***/ }),

/***/ "./src/lib/FileSystem.ts":
/*!*******************************!*\
  !*** ./src/lib/FileSystem.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Constants_1 = __webpack_require__(/*! ./Constants */ "./src/lib/Constants.ts");
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var FileSystem = /** @class */ (function (_super) {
    __extends(FileSystem, _super);
    function FileSystem() {
        var _this = _super.call(this) || this;
        _this.inited = false;
        _this.fileStats = [];
        _this.fileInfoMap = new Map();
        _this.dirs = [];
        _this.fs = SystemEnvironmentVariables_1.default.tjInstance.getFileSystemManager();
        _this.totalSize = 0;
        _this.isOldUser = false;
        _this.cacheDirInited = false;
        _this.cleanAllCachePromise = undefined;
        _this.initPromise = undefined;
        return _this;
    }
    FileSystem.prototype.cleanAllCache = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        // Memoize the promise to prevent concurrent executions
                        if (!this.cleanAllCachePromise) {
                            this.cleanAllCachePromise = this.executeCleanAllTask().finally(function () {
                                // Reset the promise only after all awaiting calls are complete
                                _this.cleanAllCachePromise = undefined;
                            });
                        }
                        return [4 /*yield*/, this.cleanAllCachePromise];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    FileSystem.prototype.executeCleanAllTask = function () {
        return __awaiter(this, void 0, void 0, function () {
            var wasOldUser, error_1;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 2, , 3]);
                        // Synchronously remove directory
                        this.fs.rmdirSync(GameGlobalVars_1.default.gameFileCache, true);
                        wasOldUser = this.isOldUser;
                        // Reset cache directory initialization state
                        this.cacheDirInited = false;
                        // Re-initialize (await the promise)
                        return [4 /*yield*/, this.init()];
                    case 1:
                        // Re-initialize (await the promise)
                        _a.sent();
                        // Restore user status after initialization
                        this.isOldUser = wasOldUser;
                        return [2 /*return*/, true];
                    case 2:
                        error_1 = _a.sent();
                        // Error handling with detailed message
                        PluginLogger_1.default.pluginError("删除插件缓存目录失败: ", error_1.errMsg ||
                            error_1.message ||
                            "Unknown error", error_1);
                        return [2 /*return*/, false];
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.createCacheDir = function () {
        var fs = this.fs;
        try {
            fs.accessSync(GameGlobalVars_1.default.gameFileCache);
            this.isOldUser = true;
        }
        catch (error) {
            fs.mkdirSync(GameGlobalVars_1.default.gameFileCache, true);
            PluginLogger_1.default.pluginWarn("".concat(GameGlobalVars_1.default.gameFileCache, "\u76EE\u5F55\u4E0D\u5B58\u5728\uFF0C\u521B\u5EFA\u76EE\u5F55"));
            this.isOldUser = false;
        }
        return this.isOldUser;
    };
    FileSystem.prototype.init = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.initPromise) {
                            this.initPromise = this.executeInit();
                        }
                        return [4 /*yield*/, this.initPromise];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.executeInit = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.cacheDirInited) {
                            this.cacheDirInited = true;
                            this.createCacheDir();
                        }
                        this.dirs = [];
                        this.fileStats = [];
                        this.fileInfoMap = new Map();
                        this.totalSize = 0;
                        return [4 /*yield*/, this.getStats()];
                    case 1:
                        _a.sent();
                        this.handleStats();
                        this.calculateSize();
                        this.fileStats = [];
                        this.initPromise = undefined;
                        if (this.inited) {
                            this.checkNeedReportStat();
                        }
                        this.inited = true;
                        PluginLogger_1.default.eventLog("缓存文件数=", this.fileInfoMap.size, ",总文件大小=", this.totalSize);
                        return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.checkNeedReportStat = function () {
        if (this.totalSize >= (0, SystemUtils_1.maxAllowSize)()) {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.STAT_SIZE_EXCEED,
                ErrorMsg: "exceed_max_size",
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify({
                    fileCount: this.fileInfoMap.size,
                    totalSize: this.totalSize,
                    maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                }),
            }));
        }
        else {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.STAT_SIZE_NORMAL,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify({
                    fileCount: this.fileInfoMap.size,
                    totalSize: this.totalSize,
                    maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                }),
            }));
        }
    };
    FileSystem.prototype.removeOldCache = function () {
        var erasableFiles = this.getErasableFiles();
        var fileGrouping = {};
        erasableFiles.forEach(function (fileInfo) {
            var filePathKey = "".concat(fileInfo.dirname, "/").concat(fileInfo.shortFilename);
            var fullFilePath = "".concat(fileInfo.dirname, "/").concat(fileInfo.filename);
            if (fileGrouping[filePathKey]) {
                fileGrouping[filePathKey].sameFiles.push(fullFilePath);
                if (fileInfo.lastAccessedTime > fileGrouping[filePathKey].latestTime) {
                    fileGrouping[filePathKey].latestFile = fullFilePath;
                    fileGrouping[filePathKey].latestTime = fileInfo.lastAccessedTime;
                }
            }
            else {
                fileGrouping[filePathKey] = {
                    sameFiles: [fullFilePath],
                    latestFile: fullFilePath,
                    latestTime: fileInfo.lastAccessedTime,
                };
            }
        });
        var self = this;
        Object.keys(fileGrouping).forEach(function (key) {
            if (fileGrouping[key].sameFiles.length > 1) {
                self.removeFilesExclude(fileGrouping[key].latestFile);
            }
        });
    };
    FileSystem.prototype.mkdir = function (folder, cacheFolder) {
        if (cacheFolder === void 0) { cacheFolder = GameGlobalVars_1.default.gameFileCache; }
        var self = this;
        return new Promise(function (resolve, reject) {
            var directoryPath = (0, Utils_1.resolvePath)(cacheFolder, folder);
            if (self.dirs.includes(directoryPath)) {
                resolve();
            }
            else {
                self.fs.access({
                    path: directoryPath,
                    success: function () {
                        self.dirs.push(directoryPath);
                        resolve();
                    },
                    fail: function () {
                        self.fs.mkdir({
                            dirPath: directoryPath,
                            recursive: true,
                            success: function () {
                                self.dirs.push(directoryPath);
                                resolve();
                            },
                            fail: function (error) {
                                if (error.errMsg.includes("exist")) {
                                    resolve();
                                }
                                else {
                                    reject(error);
                                }
                            },
                        });
                    },
                });
            }
        });
    };
    FileSystem.prototype.removeFile = function (filePath, deleteLocal) {
        return __awaiter(this, void 0, void 0, function () {
            var fileInfo, error_2;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!filePath) {
                            return [2 /*return*/];
                        }
                        if (!this.initPromise) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.initPromise];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        fileInfo = this.findFile(filePath, true);
                        if (!(fileInfo && (fileInfo.isReadyToDelete = true) && deleteLocal)) return [3 /*break*/, 7];
                        _a.label = 3;
                    case 3:
                        _a.trys.push([3, 5, , 7]);
                        TimeLogManager_1.TimeLogManager.timeStart("\u5220\u9664\u6587\u4EF6".concat(fileInfo.path));
                        return [4 /*yield*/, new Promise(function (resolve, reject) {
                                _this.fs.unlink({
                                    filePath: fileInfo.path,
                                    success: function () {
                                        var fileSize = fileInfo.size;
                                        _this.totalSize -= fileSize;
                                        _this.fileInfoMap.delete(fileInfo.subPath);
                                        PluginLogger_1.default.debugLog("\u5220\u9664\u6587\u4EF6: ".concat(fileInfo.shortFilename, ", md5:").concat(fileInfo.md5, ", size:").concat((0, SystemUtils_1.sizeToKB)(fileInfo.size), "KB, \u8017\u65F6:").concat(TimeLogManager_1.TimeLogManager.timeEnd("\u5220\u9664\u6587\u4EF6".concat(fileInfo.path), true), "ms"));
                                        resolve();
                                    },
                                    fail: function (errorDetails) {
                                        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                            ReportType: Types_1.ReportType.DELETE_FILE,
                                            ErrorMsg: errorDetails.errMsg,
                                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                            ExternInfo: JSON.stringify({
                                                type: "deletefile",
                                                filepath: fileInfo.path,
                                                totalSize: _this.totalSize,
                                            }),
                                        }));
                                        if (errorDetails.errMsg.includes("no such file or directory")) {
                                            _this.totalSize -= fileInfo.size;
                                            _this.fileInfoMap.delete(fileInfo.subPath);
                                        }
                                        reject(errorDetails);
                                    },
                                });
                            })];
                    case 4:
                        _a.sent();
                        return [3 /*break*/, 7];
                    case 5:
                        error_2 = _a.sent();
                        PluginLogger_1.default.pluginError("\u5220\u9664\u6587\u4EF6\u5931\u8D25: ".concat(fileInfo.path), error_2.errMsg || error_2.message, error_2);
                        return [4 /*yield*/, this.init()];
                    case 6:
                        _a.sent();
                        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.DELETE_FILE,
                            ErrorMsg: "".concat(error_2.message || error_2.errMsg),
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                            ExternInfo: JSON.stringify({
                                type: "deletefile",
                                filepath: fileInfo.path,
                                totalSize: this.totalSize,
                            }),
                        }));
                        return [3 /*break*/, 7];
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.removeFilesExclude = function (path) {
        return __awaiter(this, void 0, void 0, function () {
            var self, fileKey, fileHash, dirname, fileInfos, filteredFilesWithDifferentHash;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        self = this;
                        fileKey = (0, Utils_1.resolveShortFilename)(path);
                        fileHash = (0, Utils_1.getFileHash)(path);
                        dirname = (0, Utils_1.resolveDirname)(path);
                        if (!path.trim() || !fileKey || !fileHash) {
                            return [2 /*return*/];
                        }
                        fileInfos = this.findFilesByShortFilename(fileKey, dirname);
                        filteredFilesWithDifferentHash = fileInfos.filter(function (file) { return fileHash && file.md5 && file.md5 !== fileHash; });
                        if (filteredFilesWithDifferentHash.length) {
                            PluginLogger_1.default.pluginLog("\u5220\u9664".concat(fileKey, "\u65E7\u7F13\u5B58"));
                        }
                        return [4 /*yield*/, Promise.all(filteredFilesWithDifferentHash.map(function (fileInfo) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, self.removeFile(fileInfo.path, true)];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); }))];
                    case 1:
                        _a.sent();
                        return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.getErasableFiles = function () {
        return Array.from(this.fileInfoMap.values())
            .filter(function (fileInfo) {
            var isErasable = fileInfo.erasable;
            var isReadyToDelete = fileInfo.isReadyToDelete;
            return !!isErasable && !isReadyToDelete;
        })
            .filter(function (fileInfo) {
            return (!GameGlobalVars_1.default.unityNamespace.isErasableFile ||
                GameGlobalVars_1.default.unityNamespace.isErasableFile({
                    path: "".concat(fileInfo.dirname, "/").concat(fileInfo.filename),
                    filename: fileInfo.filename,
                    shortFilename: fileInfo.shortFilename,
                    dirname: fileInfo.dirname,
                    lastAccessedTime: fileInfo.lastAccessedTime,
                    size: fileInfo.size,
                    md5: fileInfo.md5,
                }));
        })
            .sort(function (fileInfoPre, fileInfoNext) {
            return fileInfoPre.lastAccessedTime - fileInfoNext.lastAccessedTime;
        });
    };
    FileSystem.prototype.releaseMemory = function () {
        return __awaiter(this, arguments, void 0, function (size, defaultMemorySize) {
            var erasableFiles, requiredSpace, toBeErasableFiles, toBeReleasedSize, fileInfo;
            var _this = this;
            if (size === void 0) { size = 0; }
            if (defaultMemorySize === void 0) { defaultMemorySize = GameGlobalVars_1.default.unityNamespace.releaseMemorySize || 31457280; }
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        erasableFiles = this.getErasableFiles();
                        requiredSpace = size - (0, SystemUtils_1.maxAllowSize)() + this.totalSize;
                        if (!(size && erasableFiles && erasableFiles.length && !(requiredSpace <= 0))) {
                            return [2 /*return*/, Types_1.ReleaseMemoryResultTypes.NO_NEED_RELEASE_MEMORY];
                        }
                        if (size > (0, SystemUtils_1.maxAllowSize)()) {
                            PluginLogger_1.default.pluginWarn("\u6240\u9700\u5B58\u50A8\u5BB9\u91CF".concat((0, SystemUtils_1.sizeToMB)(size), "MB\u8D85\u8FC7\u6700\u5927\u503C").concat((0, SystemUtils_1.sizeToMB)((0, SystemUtils_1.maxAllowSize)()), "MB, \u4E0D\u6267\u884C\u6E05\u7406"));
                            return [2 /*return*/, Types_1.ReleaseMemoryResultTypes.EXCEED_MEMORY];
                        }
                        toBeErasableFiles = [];
                        requiredSpace = defaultMemorySize + requiredSpace;
                        toBeReleasedSize = requiredSpace;
                        while (requiredSpace > 0) {
                            fileInfo = erasableFiles.shift();
                            if (!fileInfo)
                                break;
                            if (!fileInfo.isReadyToDelete) {
                                fileInfo.isReadyToDelete = true;
                                toBeErasableFiles.push(fileInfo);
                            }
                            requiredSpace -= fileInfo.size;
                        }
                        if (toBeErasableFiles.length) {
                            PluginLogger_1.default.eventLog("\u9700\u8981\u91CA\u653E".concat((0, SystemUtils_1.sizeToMB)(toBeReleasedSize), "MB\u5B58\u50A8\u7A7A\u95F4"));
                        }
                        return [4 /*yield*/, Promise.all(toBeErasableFiles.map(function (fileInfo) { return __awaiter(_this, void 0, void 0, function () {
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0: return [4 /*yield*/, this.removeFile(fileInfo.path, true)];
                                        case 1:
                                            _a.sent();
                                            return [2 /*return*/];
                                    }
                                });
                            }); }))];
                    case 1:
                        _a.sent();
                        return [2 /*return*/, Types_1.ReleaseMemoryResultTypes.RELEASED_MEMORY];
                }
            });
        });
    };
    FileSystem.prototype.addFile = function (file) {
        var fileSize = file.size;
        var filePath = file.path;
        var path = (0, LogUtils_1.resolveCachePath)(filePath);
        if (!this.findFile(filePath)) {
            var filename = (0, Utils_1.resolveFilename)(filePath);
            var dirname = (0, Utils_1.resolveDirname)(filePath);
            var fileInfo = {
                path: path,
                subPath: (0, Utils_1.resolvePath)(dirname, filename),
                size: fileSize,
                filename: filename,
                dirname: dirname,
                shortFilename: (0, Utils_1.resolveShortFilename)(filename),
                md5: (0, Utils_1.getFileHash)(filename),
                lastAccessedTime: parseInt(String(Date.now() / 1000), 10),
                erasable: true,
            };
            this.fileInfoMap.set(fileInfo.subPath, fileInfo);
            this.totalSize += fileSize;
        }
    };
    FileSystem.prototype.calculateSize = function () {
        var totalFileSize = 0;
        try {
            Array.from(this.fileInfoMap.values()).forEach(function (fileInfo) {
                totalFileSize += fileInfo.size;
            });
        }
        catch (error) {
            console.error("Error calculating file size:", error);
        }
        this.totalSize = totalFileSize;
    };
    FileSystem.prototype.getUsedSize = function () {
        PluginLogger_1.default.pluginLog("getUsedSize: ".concat(GameGlobalVars_1.default.userDataPath, "\u76EE\u5F55\u603B\u5927\u5C0F: ").concat((0, SystemUtils_1.sizeToMB)(this.totalSize), "MB"));
        return this.totalSize;
    };
    FileSystem.prototype.updateAccessTime = function (filePath, isDataFile) {
        if (isDataFile === void 0) { isDataFile = false; }
        if ((!filePath.includes("ksfile://") &&
            !filePath.includes("http://") &&
            !filePath.includes("https://")) ||
            filePath.includes(GameGlobalVars_1.default.userDataPath)) {
            var foundedFile = this.findFile(filePath);
            if (foundedFile) {
                foundedFile.lastAccessedTime = parseInt(String(Date.now() / 1000), 10);
                if (isDataFile) {
                    this.fs.readFile({
                        filePath: foundedFile.path,
                        success: function () {
                        },
                    });
                }
            }
        }
    };
    FileSystem.prototype.findFile = function (filepath, includeDeleted) {
        if (includeDeleted === void 0) { includeDeleted = false; }
        if (!filepath || !filepath.trim()) {
            return null;
        }
        var isCache = filepath.includes(Constants_1.GameFileCacheDirname);
        var dirname = (0, Utils_1.resolveDirname)(filepath, isCache);
        var filename = (0, Utils_1.resolveFilename)(filepath);
        var fileInfo = this.fileInfoMap.get((0, Utils_1.resolvePath)(dirname, filename));
        if (!fileInfo || (!includeDeleted && fileInfo.isReadyToDelete)) {
            return null;
        }
        else {
            return fileInfo;
        }
    };
    FileSystem.prototype.getFileInfo = function (filepath) {
        return this.findFile(filepath) || null;
    };
    FileSystem.prototype.findFilesByShortFilename = function (shortFilename, directoryName) {
        return this.getErasableFiles().filter(function (fileInfo) {
            return fileInfo.shortFilename === shortFilename && fileInfo.dirname === directoryName;
        });
    };
    FileSystem.prototype.isSameFile = function (path, fileInfo) {
        var dirname = (0, Utils_1.resolveDirname)(path);
        var filename = (0, Utils_1.resolveFilename)(path);
        return dirname === fileInfo.dirname && filename === fileInfo.filename;
    };
    FileSystem.prototype.checkFileExistInSystem = function (filepath) {
        return __awaiter(this, void 0, void 0, function () {
            var trimmedFilepath, resolvedPath, error_3;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        trimmedFilepath = filepath === null || filepath === void 0 ? void 0 : filepath.trim();
                        if (!trimmedFilepath) {
                            return [2 /*return*/];
                        }
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        resolvedPath = (0, LogUtils_1.resolveCachePath)(filepath);
                        return [4 /*yield*/, this.statAsyncCatch(resolvedPath)];
                    case 2: return [2 /*return*/, _a.sent()];
                    case 3:
                        error_3 = _a.sent();
                        console.error("Error check file exists: ".concat(filepath), error_3);
                        return [2 /*return*/];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    FileSystem.prototype.statAsyncCatch = function (filePath, isRecursive) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        _this.fs.stat({
                            path: filePath,
                            recursive: isRecursive,
                            success: function (rs) {
                                resolve(rs.stats);
                            },
                            fail: function (error) {
                                PluginLogger_1.default.pluginError("FileSystem_statAsyncCatch: ".concat(filePath), error.errMsg, error);
                                reject(error);
                            },
                        });
                    })];
            });
        });
    };
    FileSystem.prototype.statSyncCatch = function (filePath, isRecursive) {
        try {
            return this.fs.statSync(filePath, isRecursive);
        }
        catch (error) {
            PluginLogger_1.default.pluginError("FileSystem_statSyncCatch: ".concat(filePath, " "), error.errMsg || error.message, error);
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.DEFAULT,
                ErrorMsg: error.errMsg || error.message,
                ExternInfo: JSON.stringify({
                    path: filePath,
                    async: false,
                }),
            }));
        }
    };
    FileSystem.prototype.handleStats = function () {
        var _this = this;
        var fileStats = this.fileStats;
        if (fileStats && Array.isArray(fileStats)) {
            fileStats.forEach(function (fileState) {
                var fileInfo = _this.handleFileInfo(fileState);
                _this.fileInfoMap.set((0, Utils_1.resolvePath)(fileInfo.dirname, fileInfo.filename), fileInfo);
            });
        }
    };
    FileSystem.prototype.handleFileInfo = function (fileState) {
        var filepath = fileState.path;
        var fileStats = fileState.stats;
        var formatedFilepath = (0, SystemUtils_1.formatPath)(filepath);
        var filename = (0, Utils_1.resolveFilename)(formatedFilepath);
        var isCache = formatedFilepath.includes(Constants_1.GameFileCacheDirname);
        var dirname = (0, Utils_1.resolveDirname)(formatedFilepath, isCache);
        return {
            path: (0, LogUtils_1.resolveCachePath)(formatedFilepath, isCache) || (0, Utils_1.resolvePath)(GameGlobalVars_1.default.userDataPath, formatedFilepath),
            subPath: (0, Utils_1.resolvePath)(dirname, filename),
            filename: filename,
            dirname: dirname,
            shortFilename: (0, Utils_1.resolveShortFilename)(formatedFilepath),
            md5: (0, Utils_1.getFileHash)(formatedFilepath),
            size: fileStats.size,
            lastAccessedTime: fileStats.lastAccessedTime,
            erasable: isCache,
        };
    };
    FileSystem.prototype.getStats = function () {
        return __awaiter(this, void 0, void 0, function () {
            var fileStatsArray, fileStats, fileStats, error_4;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        fileStatsArray = [];
                        if (!!this.inited) return [3 /*break*/, 1];
                        fileStats = this.statSyncCatch(GameGlobalVars_1.default.userDataPath, true);
                        if (fileStats) {
                            fileStatsArray = Array.from(fileStats).filter(function (statFile) { return statFile.stats.isFile(); });
                        }
                        return [3 /*break*/, 4];
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.statAsyncCatch(GameGlobalVars_1.default.userDataPath, true)];
                    case 2:
                        fileStats = _a.sent();
                        if (fileStats) {
                            fileStatsArray = Array.from(fileStats).filter(function (statFile) { return statFile.stats.isFile(); });
                        }
                        return [3 /*break*/, 4];
                    case 3:
                        error_4 = _a.sent();
                        console.error('Error during statAsyncCatch:', error_4);
                        return [3 /*break*/, 4];
                    case 4:
                        this.fileStats = fileStatsArray;
                        return [2 /*return*/];
                }
            });
        });
    };
    return FileSystem;
}(Instance_1.default));
exports["default"] = FileSystem;


/***/ }),

/***/ "./src/lib/FileSystemManager.ts":
/*!**************************************!*\
  !*** ./src/lib/FileSystemManager.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./src/lib/Buffer.ts");
var WorkerManager_1 = __importDefault(__webpack_require__(/*! ./WorkerManager */ "./src/lib/WorkerManager.ts"));
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var FileSystemManager = /** @class */ (function () {
    function FileSystemManager() {
    }
    FileSystemManager.checkIsNewUser = function () {
        return !FileSystemManager.fileSystem.isOldUser;
    };
    Object.defineProperty(FileSystemManager, "nativeFileSystemManager", {
        get: function () {
            return SystemEnvironmentVariables_1.default.tjInstance.getFileSystemManager();
        },
        enumerable: false,
        configurable: true
    });
    FileSystemManager.statAsyncCatch = function (filePath, isRecursive, ignoreError) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve) {
                        _this.nativeFileSystemManager.getFileInfo({
                            filePath: filePath,
                            success: function (result) {
                                resolve(result);
                            },
                            fail: function (error) {
                                if (!ignoreError) {
                                    ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                        ReportType: Types_1.ReportType.DEFAULT,
                                        ErrorMsg: "".concat(error.errMsg),
                                        RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                        ExternInfo: JSON.stringify({
                                            type: "statAsyncCatch",
                                            path: filePath,
                                            recursive: isRecursive,
                                        }),
                                    }));
                                }
                                resolve(null);
                            },
                        });
                    })];
            });
        });
    };
    FileSystemManager.checkFileExist = function (filePath) {
        try {
            this.nativeFileSystemManager.accessSync(filePath);
            return true;
        }
        catch (error) {
            return false;
        }
    };
    FileSystemManager.getFileSize = function (filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var fileStats;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, FileSystemManager.statAsyncCatch(filePath)];
                    case 1:
                        fileStats = _a.sent();
                        return [2 /*return*/, (fileStats === null || fileStats === void 0 ? void 0 : fileStats.size) || 0];
                }
            });
        });
    };
    FileSystemManager.getMd5 = function (filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        if (filePath) {
                            _this.nativeFileSystemManager.getFileInfo({
                                filePath: filePath,
                                success: function (result) {
                                    var digestData = result.digest;
                                    resolve(digestData);
                                },
                                fail: reject,
                                complete: function () {
                                },
                            });
                        }
                        else {
                            resolve("");
                        }
                    })];
            });
        });
    };
    // path might be resolved and appended with extra prefix like ksfile://usr/__GAME_CACHE__
    // If we need to readFile without extra prefix, we can use readFileTrunk
    FileSystemManager.readFile = function (path_1, encoding_1) {
        return __awaiter(this, arguments, void 0, function (path, encoding, isDataFile) {
            var _this = this;
            if (isDataFile === void 0) { isDataFile = false; }
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var filePath = path;
                        if (!isDataFile) {
                            filePath = (0, LogUtils_1.resolveCachePath)(path);
                        }
                        _this.nativeFileSystemManager.readFile({
                            filePath: filePath,
                            encoding: encoding,
                            success: function (result) {
                                var _a;
                                if (isDataFile) {
                                    filePath = (0, Utils_1.resolvePath)((_a = GameGlobalVars_1.default.unityNamespace.dataFileSubPrefix) !== null && _a !== void 0 ? _a : "", (0, Utils_1.resolveFilename)(path, ".txt"));
                                }
                                if (FileSystemManager.fileSystem.findFile(filePath)) {
                                    FileSystemManager.fileSystem.updateAccessTime(filePath, isDataFile);
                                }
                                if (SystemEnvironmentVariables_1.default.isIOS && !SystemEnvironmentVariables_1.default.isWK) {
                                    var processedBuffer = (0, Buffer_1.processBuffer)(new Uint8Array(result.data));
                                    result.data = processedBuffer[0];
                                }
                                resolve(result.data);
                            },
                            fail: reject,
                        });
                    })];
            });
        });
    };
    FileSystemManager.readCompressedFile = function (filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        _this.nativeFileSystemManager.readCompressedFile({
                            filePath: filePath,
                            compressionAlgorithm: "br",
                            success: function (result) {
                                return resolve(result.data);
                            },
                            fail: reject,
                        });
                    })];
            });
        });
    };
    FileSystemManager.readCompressedFileSync = function (filePath) {
        return this.nativeFileSystemManager.readCompressedFileSync({
            filePath: filePath,
            compressionAlgorithm: "br",
        });
    };
    FileSystemManager.readFileBuffer = function (filePath_1) {
        return __awaiter(this, arguments, void 0, function (filePath, position, length) {
            var _this = this;
            if (position === void 0) { position = 0; }
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        _this.nativeFileSystemManager.readFile({
                            filePath: filePath,
                            position: position,
                            length: length,
                            success: function (result) {
                                resolve(result.data);
                            },
                            fail: reject,
                        });
                    })];
            });
        });
    };
    // There is no extra path resolving to filePath
    FileSystemManager.readFileTrunk = function (filePath_1) {
        return __awaiter(this, arguments, void 0, function (filePath, isDataFile) {
            var fileSize, resolvedFilePath, foundedFile, fileBufferArray, fileBufferData, readSizeLimit, readOffset, readSize, bufferRead, processedBuffer, buffer, cacheFull;
            var _a;
            if (isDataFile === void 0) { isDataFile = false; }
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, FileSystemManager.getFileSize(filePath)];
                    case 1:
                        fileSize = _b.sent();
                        if (!fileSize) {
                            return [2 /*return*/, new ArrayBuffer(0)];
                        }
                        resolvedFilePath = filePath;
                        if (isDataFile) {
                            resolvedFilePath = (0, Utils_1.resolvePath)((_a = GameGlobalVars_1.default.unityNamespace.dataFileSubPrefix) !== null && _a !== void 0 ? _a : "", (0, Utils_1.resolveFilename)(filePath, ".txt"));
                        }
                        foundedFile = FileSystemManager.fileSystem.findFile(resolvedFilePath);
                        if (foundedFile) {
                            FileSystemManager.fileSystem.updateAccessTime(foundedFile.path, isDataFile);
                        }
                        fileBufferArray = new ArrayBuffer(fileSize);
                        fileBufferData = new Uint8Array(fileBufferArray);
                        readSizeLimit = 8000000;
                        readOffset = 0;
                        _b.label = 2;
                    case 2:
                        if (!(readOffset < fileSize)) return [3 /*break*/, 4];
                        readSize = Math.min(readSizeLimit, fileSize - readOffset);
                        PluginLogger_1.default.pluginLog("read part:", readOffset, readSize);
                        return [4 /*yield*/, FileSystemManager.readFileBuffer(filePath, readOffset, readSize)];
                    case 3:
                        bufferRead = _b.sent();
                        fileBufferData.set(new Uint8Array(bufferRead).subarray(0, readSize), readOffset);
                        if (bufferRead.byteLength > readSize) {
                            PluginLogger_1.default.pluginWarn("\u8BFB\u53D6".concat(filePath, "\u8D85\u8FC7\u8FB9\u754C, byteLength: ").concat(bufferRead.byteLength, "; offset: ").concat(readOffset, "; toread: ").concat(readSize));
                            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.ReportType.OUT_OF_RANGE,
                                ErrorMsg: Types_1.ErrorMessages.OutOfRange,
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                ExternInfo: JSON.stringify({
                                    size: bufferRead.byteLength,
                                    offset: readOffset,
                                    toread: readSize,
                                    filePath: filePath,
                                }),
                            }));
                        }
                        readOffset += readSizeLimit;
                        return [3 /*break*/, 2];
                    case 4:
                        if (!(SystemEnvironmentVariables_1.default.isIOS && SystemEnvironmentVariables_1.default.isWK)) return [3 /*break*/, 7];
                        processedBuffer = (0, Buffer_1.processBuffer)(fileBufferData);
                        buffer = processedBuffer[0];
                        cacheFull = processedBuffer[1];
                        if (!cacheFull) return [3 /*break*/, 6];
                        return [4 /*yield*/, FileSystemManager.cleanAllCache()];
                    case 5:
                        _b.sent();
                        _b.label = 6;
                    case 6: return [2 /*return*/, buffer];
                    case 7: return [2 /*return*/, fileBufferArray];
                }
            });
        });
    };
    FileSystemManager.downloadFileByXMLHttpRequest = function (url) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var xmlHttpRequest = new GameGlobalVars_1.default.unityNamespace.XMLHttpRequest();
                        xmlHttpRequest.open("GET", url);
                        xmlHttpRequest.responseType = "arraybuffer";
                        xmlHttpRequest.onload = function () {
                            resolve(xmlHttpRequest);
                        };
                        xmlHttpRequest.onerror = function (error) {
                            reject(error);
                        };
                        xmlHttpRequest.ontimeout = function () {
                            reject(new Error("timeout"));
                        };
                        xmlHttpRequest.onabort = function () {
                            reject(new Error("abort"));
                        };
                        xmlHttpRequest.send();
                    })];
            });
        });
    };
    FileSystemManager.downloadFileAsync = function (fileUrl) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        SystemEnvironmentVariables_1.default.tjInstance.downloadFile({
                            url: fileUrl,
                            timeout: 60000,
                            success: resolve,
                            fail: reject,
                        });
                    })];
            });
        });
    };
    FileSystemManager.removeExpiredFile = function (expireInDays) {
        if (expireInDays === void 0) { expireInDays = 7; }
        var stat = this.nativeFileSystemManager.stat;
        var unlinkFileSync = this.nativeFileSystemManager.unlinkSync;
        stat({
            path: GameGlobalVars_1.default.gameFileCache,
            recursive: true,
            success: function (result) {
                Object.keys(result.stats).forEach(function (key) {
                    var stats = result.stats[key].stats;
                    if (stats.path !== "/" && stats.isFile() && (Date.now() / 1000 - stats.lastAccessedTime * 1000) / 86400 > expireInDays) {
                        PluginLogger_1.default.pluginWarn("\u5220\u9664\u957F\u65F6\u95F4\u672A\u4F7F\u7528\u8D44\u6E90 ".concat(GameGlobalVars_1.default.gameFileCache, "/").concat(stats.path));
                        unlinkFileSync("".concat(GameGlobalVars_1.default.gameFileCache, "/").concat(stats.path));
                    }
                });
            },
        });
    };
    FileSystemManager.saveFileFS = function (tempFilePath, filePath) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        _this.nativeFileSystemManager.saveFile({
                            tempFilePath: tempFilePath,
                            filePath: filePath,
                            success: resolve,
                            fail: reject,
                        });
                    })];
            });
        });
    };
    FileSystemManager.saveFile = function (cacheFilePath, sourceFilePath) {
        return __awaiter(this, void 0, void 0, function () {
            var dirname, filename, cachePath, foundFile, formatedSourceFilePath, fileSize, releaseMemoryResult, promiseResults, error, saveResult;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        dirname = (0, Utils_1.resolveDirname)(cacheFilePath);
                        filename = (0, Utils_1.resolveFilename)(cacheFilePath);
                        cachePath = (0, LogUtils_1.resolveCachePath)(cacheFilePath);
                        foundFile = FileSystemManager.fileSystem.findFile(cacheFilePath);
                        if (foundFile) {
                            PluginLogger_1.default.pluginLog("".concat(filename, "\u5DF2\u6709\u7F13\u5B58, \u65E0\u987B\u91CD\u590D\u7F13\u5B58"));
                            return [2 /*return*/, foundFile.path];
                        }
                        return [4 /*yield*/, FileSystemManager.fileSystem.removeFilesExclude(cacheFilePath)];
                    case 1:
                        _a.sent();
                        formatedSourceFilePath = (0, SystemUtils_1.formatPath)(sourceFilePath);
                        return [4 /*yield*/, FileSystemManager.getFileSize(formatedSourceFilePath)];
                    case 2:
                        fileSize = _a.sent();
                        return [4 /*yield*/, FileSystemManager.fileSystem.releaseMemory(fileSize)];
                    case 3:
                        releaseMemoryResult = _a.sent();
                        if (!(releaseMemoryResult === Types_1.ReleaseMemoryResultTypes.EXCEED_MEMORY)) return [3 /*break*/, 5];
                        PluginLogger_1.default.pluginWarn("saveFile: \u7A7A\u95F4\u4E0D\u8DB3,\u7F13\u5B58".concat(filename, "\u5931\u8D25"));
                        return [4 /*yield*/, FileSystemManager.fileSystem.init()];
                    case 4:
                        _a.sent();
                        return [2 /*return*/, formatedSourceFilePath];
                    case 5: return [4 /*yield*/, FileSystemManager.fileSystem.mkdir(dirname)];
                    case 6:
                        _a.sent();
                        TimeLogManager_1.TimeLogManager.timeStart("saveFile ".concat(cachePath));
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(FileSystemManager.saveFileFS(formatedSourceFilePath, cachePath))];
                    case 7:
                        promiseResults = _a.sent();
                        error = promiseResults[0], saveResult = promiseResults[1];
                        if (!saveResult) return [3 /*break*/, 8];
                        PluginLogger_1.default.debugLog("\u7F13\u5B58\u6587\u4EF6\uFF1A".concat(filename, "\u6210\u529F,size: ").concat((0, SystemUtils_1.sizeToKB)(fileSize), "KB,\u8017\u65F6:").concat(TimeLogManager_1.TimeLogManager.timeEnd("saveFile ".concat(cachePath)), "ms"));
                        FileSystemManager.fileSystem.addFile({
                            size: fileSize,
                            path: cacheFilePath,
                        });
                        return [2 /*return*/, saveResult.savedFilePath];
                    case 8:
                        PluginLogger_1.default.pluginError("".concat(filename, "\u7F13\u5B58\u5931\u8D25\uFF1A"), error.errMsg || error.message, error);
                        return [4 /*yield*/, FileSystemManager.fileSystem.init()];
                    case 9:
                        _a.sent();
                        return [2 /*return*/, formatedSourceFilePath];
                }
            });
        });
    };
    FileSystemManager.writeFile = function (filePath, fileContent) {
        return __awaiter(this, void 0, void 0, function () {
            var dirname, filename, cachePath, foundFile, fileSize, releaseResult, writeResult, workerManager;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(filePath === null || filePath === void 0 ? void 0 : filePath.trim())) {
                            throw new Error(Types_1.ErrorMessages.EmptyPath);
                        }
                        if (!FileSystemManager.fileSystem.initPromise) return [3 /*break*/, 2];
                        return [4 /*yield*/, FileSystemManager.fileSystem.initPromise];
                    case 1:
                        _a.sent();
                        _a.label = 2;
                    case 2:
                        dirname = (0, Utils_1.resolveDirname)(filePath);
                        filename = (0, Utils_1.resolveFilename)(filePath);
                        cachePath = (0, LogUtils_1.resolveCachePath)(filePath);
                        foundFile = FileSystemManager.fileSystem.findFile(filePath);
                        if (foundFile) {
                            PluginLogger_1.default.pluginLog("".concat(filename, "\u5DF2\u6709\u7F13\u5B58"));
                            return [2 /*return*/, foundFile.path];
                        }
                        return [4 /*yield*/, FileSystemManager.fileSystem.removeFilesExclude(filePath)];
                    case 3:
                        _a.sent();
                        fileSize = fileContent.byteLength;
                        return [4 /*yield*/, FileSystemManager.fileSystem.releaseMemory(fileSize)];
                    case 4:
                        releaseResult = _a.sent();
                        if (!(releaseResult === Types_1.ReleaseMemoryResultTypes.EXCEED_MEMORY)) return [3 /*break*/, 6];
                        PluginLogger_1.default.pluginError("\u7A7A\u95F4\u4E0D\u8DB3,\u5199\u5165".concat(filename, "\u5931\u8D25;"));
                        return [4 /*yield*/, FileSystemManager.fileSystem.init()];
                    case 5:
                        _a.sent();
                        throw new Error(Types_1.ErrorMessages.ExceedMemory);
                    case 6:
                        if (releaseResult === Types_1.ReleaseMemoryResultTypes.CANNOT_RELEASE) {
                            throw new Error(Types_1.ErrorMessages.FrequentWrite);
                        }
                        _a.label = 7;
                    case 7: return [4 /*yield*/, FileSystemManager.fileSystem.mkdir(dirname)];
                    case 8:
                        _a.sent();
                        TimeLogManager_1.TimeLogManager.timeStart("writeFile ".concat(filename));
                        workerManager = WorkerManager_1.default.getInstance();
                        if (!workerManager.supportWorkerFs) return [3 /*break*/, 10];
                        return [4 /*yield*/, FileSystemManager.workerWriteFile({
                                cachePath: cachePath,
                                content: fileContent,
                                fileSize: fileSize,
                                filename: filename,
                                path: filePath,
                            })];
                    case 9:
                        writeResult = _a.sent();
                        return [3 /*break*/, 12];
                    case 10: return [4 /*yield*/, FileSystemManager.normalWriteFile({
                            cachePath: cachePath,
                            content: fileContent,
                            fileSize: fileSize,
                            filename: filename,
                            path: filePath,
                        })];
                    case 11:
                        writeResult = _a.sent();
                        _a.label = 12;
                    case 12: return [2 /*return*/, writeResult];
                }
            });
        });
    };
    FileSystemManager.workerWriteFile = function (fileData) {
        return __awaiter(this, void 0, void 0, function () {
            var cachePath, fileContent, fileSize, filePath, filename;
            return __generator(this, function (_a) {
                cachePath = fileData.cachePath;
                fileContent = fileData.content;
                fileSize = fileData.fileSize;
                filePath = fileData.path;
                filename = fileData.filename;
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var workerManager = WorkerManager_1.default.getInstance();
                        workerManager
                            .writeFile({
                            filePath: cachePath,
                            data: fileContent,
                        })
                            .then(function () {
                            PluginLogger_1.default.debugLog("\u7F13\u5B58 ".concat(filename, "\u6210\u529F;size: ").concat((0, SystemUtils_1.sizeToKB)(fileSize), "KB,\u8017\u65F6: ").concat(TimeLogManager_1.TimeLogManager.timeEnd("writeFile ".concat(filename)), "ms"));
                            FileSystemManager.fileSystem.addFile({
                                size: fileContent.byteLength,
                                path: filePath,
                            });
                            resolve(cachePath);
                        })
                            .catch(function (error) {
                            var _a;
                            PluginLogger_1.default.pluginError("\u7F13\u5B58 ".concat(filename, "\u5931\u8D25\uFF1A"), error, ",totalSize=", FileSystemManager.fileSystem.totalSize, ",size: ", (0, SystemUtils_1.sizeToKB)(fileSize), "KB,耗时：", TimeLogManager_1.TimeLogManager.timeEnd("writeFile ".concat(filename)), "ms");
                            if (((_a = error.errMsg) === null || _a === void 0 ? void 0 : _a.includes("maximum")) &&
                                FileSystemManager.fileSystem.totalSize + fileContent.byteLength <= (0, SystemUtils_1.maxAllowSize)()) {
                                ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                    ReportType: Types_1.ReportType.QUOTA_CONTROL,
                                    ErrorMsg: error.errMsg,
                                    RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                    ExternInfo: JSON.stringify({
                                        type: Types_1.ExternInfoTypes.QuotaControlError,
                                        filename: filename,
                                        size: fileContent.byteLength,
                                        totalSize: FileSystemManager.fileSystem.totalSize,
                                        maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                                    }),
                                }));
                            }
                            if (FileSystemManager.fileSystem.totalSize + fileContent.byteLength >= (0, SystemUtils_1.maxAllowSize)()) {
                                ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                    ReportType: Types_1.ReportType.EXCEED_MAX,
                                    ErrorMsg: error.errMsg,
                                    RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                    ExternInfo: JSON.stringify({
                                        type: Types_1.ExternInfoTypes.ExceedMaxStorage,
                                        filename: filename,
                                        size: fileContent.byteLength,
                                        totalSize: FileSystemManager.fileSystem.totalSize,
                                    }),
                                }));
                            }
                            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.ReportType.WRITEFILE,
                                ErrorMsg: "".concat(error.errMsg),
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                ExternInfo: JSON.stringify({
                                    type: Types_1.ExternInfoTypes.WriteFile,
                                    filename: filename,
                                    size: fileContent.byteLength,
                                    totalSize: FileSystemManager.fileSystem.totalSize,
                                    maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                                }),
                            }));
                            FileSystemManager.fileSystem.init();
                            reject(error);
                        });
                    })];
            });
        });
    };
    FileSystemManager.normalWriteFile = function (file) {
        var _this = this;
        var cachePath = file.cachePath;
        var fileContent = file.content;
        var fileSize = file.fileSize;
        var filePath = file.path;
        var filename = file.filename;
        return new Promise(function (resolve, reject) {
            _this.nativeFileSystemManager.writeFile({
                filePath: cachePath,
                data: fileContent,
                encoding: "binary",
                success: function () {
                    PluginLogger_1.default.debugLog("\u7F13\u5B58 ".concat(filename, "\u6210\u529F;size: ").concat((0, SystemUtils_1.sizeToKB)(fileSize), "KB,\u8017\u65F6: ").concat(TimeLogManager_1.TimeLogManager.timeEnd("writeFile ".concat(filename)), "ms"));
                    FileSystemManager.fileSystem.addFile({
                        size: fileContent.byteLength,
                        path: filePath,
                    });
                    resolve(cachePath);
                },
                fail: function (error) {
                    var _a;
                    PluginLogger_1.default.pluginError("\u7F13\u5B58 ".concat(filename, "\u5931\u8D25\uFF1A"), error.errMsg, ",totalSize=", FileSystemManager.fileSystem.totalSize, ",size: ", (0, SystemUtils_1.sizeToKB)(fileSize), "KB,耗时：", TimeLogManager_1.TimeLogManager.timeEnd("writeFile ".concat(filename)), "ms", error);
                    if (((_a = error.errMsg) === null || _a === void 0 ? void 0 : _a.includes("maximum")) &&
                        FileSystemManager.fileSystem.totalSize + fileContent.byteLength <= (0, SystemUtils_1.maxAllowSize)()) {
                        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.QUOTA_CONTROL,
                            ErrorMsg: error.errMsg,
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                            ExternInfo: JSON.stringify({
                                type: Types_1.ExternInfoTypes.QuotaControlError,
                                filename: filename,
                                size: fileContent.byteLength,
                                totalSize: FileSystemManager.fileSystem.totalSize,
                                maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                            }),
                        }));
                    }
                    ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                        ReportType: Types_1.ReportType.WRITEFILE,
                        ErrorMsg: "".concat(error.errMsg),
                        RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                        ExternInfo: JSON.stringify({
                            type: Types_1.ExternInfoTypes.WriteFile,
                            filename: filename,
                            size: fileContent.byteLength,
                            totalSize: FileSystemManager.fileSystem.totalSize,
                            maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                        }),
                    }));
                    FileSystemManager.fileSystem.init();
                    reject(error);
                },
            });
        });
    };
    FileSystemManager.cleanAllCache = function () {
        return FileSystemManager.fileSystem.cleanAllCache();
    };
    FileSystemManager.removeFile = function (filePath) {
        return FileSystemManager.fileSystem.removeFile(filePath, true);
    };
    FileSystemManager.getFileInfo = function (filePath) {
        return FileSystemManager.fileSystem.getFileInfo(filePath);
    };
    FileSystemManager.getCachePath = function (fileInput) {
        var fileInfo = FileSystemManager.getFileInfo(fileInput);
        if (fileInfo) {
            return fileInfo.path;
        }
        else {
            return "";
        }
    };
    FileSystemManager.readJson = function (filePath_1) {
        return __awaiter(this, arguments, void 0, function (filePath, handleError) {
            var promiseResults, error, saveResult;
            if (handleError === void 0) { handleError = true; }
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!filePath) {
                            return [2 /*return*/, null];
                        }
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(FileSystemManager.readFile(filePath, "utf-8"))];
                    case 1:
                        promiseResults = _a.sent();
                        error = promiseResults[0], saveResult = promiseResults[1];
                        if (saveResult) {
                            return [2 /*return*/, JSON.parse(saveResult)];
                        }
                        if (error && handleError) {
                            PluginLogger_1.default.pluginWarn("\u8BFB\u53D6json: ".concat(filePath, "\u5931\u8D25"), error.errMsg || error.message, error);
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    FileSystemManager.writeJson = function (filePath, dataToWrite) {
        if (filePath && dataToWrite) {
            var jsonDataString = JSON.stringify(dataToWrite);
            this.nativeFileSystemManager.writeFile({
                filePath: filePath,
                data: jsonDataString,
                encoding: "utf-8",
                success: function () {
                    PluginLogger_1.default.pluginLog("\u5199\u5165json: ".concat(filePath, "\u6210\u529F"));
                },
                fail: function (error) {
                    PluginLogger_1.default.pluginWarn("\u5199\u5165json: ".concat(filePath, "\u5931\u8D25"), error.errMsg, error);
                },
            });
        }
    };
    FileSystemManager.mkdir = function (directoryPath, gamePluginIndex) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, FileSystemManager.fileSystem.mkdir(directoryPath, gamePluginIndex)];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    return FileSystemManager;
}());
exports["default"] = FileSystemManager;


/***/ }),

/***/ "./src/lib/FontManager.ts":
/*!********************************!*\
  !*** ./src/lib/FontManager.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var fontPath = "/System/Library/Fonts/LanguageSupport";
var FontManager = /** @class */ (function () {
    function FontManager() {
        this.reportInfo = null;
        this.needReport = undefined;
        this.reportInfo = null;
    }
    FontManager.prototype.init = function (interfaceValue) {
        this.bindInterface(interfaceValue);
    };
    FontManager.prototype.bindInterface = function (fontSettings) {
        var getKsCommonFont = SystemEnvironmentVariables_1.default.pluginEnv.getKsCommonFont, isAndroid = SystemEnvironmentVariables_1.default.isAndroid, isIOS = SystemEnvironmentVariables_1.default.isIOS, version = SystemEnvironmentVariables_1.default.systemInfo.version;
        var isNewVersion = (isAndroid && (0, Utils_1.compareVersions)(version, "8.0.34") > -1) || (isIOS && (0, Utils_1.compareVersions)(version, "8.0.39") > -1);
        fontSettings.font = fontSettings.font || {};
        if (isNewVersion && getKsCommonFont && GameFeatures_1.gameFeatures.get("ksfont") === Types_1.TransferStatus.open) {
            fontSettings.font.getCommonFont = this.getCommonFont.bind(this);
            fontSettings.font.canUseKsFont = true;
        }
        else {
            fontSettings.font.canUseKsFont = false;
        }
        fontSettings.font.reportGetFontCost = this.reportGetFontCost.bind(this);
    };
    FontManager.prototype.getCommonFont = function (response) {
        return __awaiter(this, void 0, void 0, function () {
            var responseSuccessFlag, failedResponsesCount, getPrivateFileSystemManager;
            var _this = this;
            return __generator(this, function (_a) {
                responseSuccessFlag = response.success;
                failedResponsesCount = response.fail;
                TimeLogManager_1.TimeLogManager.timeStart("getSystemFontList");
                getPrivateFileSystemManager = SystemEnvironmentVariables_1.default.pluginEnv.getPrivateFileSystemManager;
                getPrivateFileSystemManager({
                    path: SystemEnvironmentVariables_1.default.isAndroid ? "/system/fonts" : fontPath,
                    success: function (fontDataResponse) {
                        var scanDirCost = TimeLogManager_1.TimeLogManager.timeEnd("getSystemFontList");
                        PluginLogger_1.default.pluginLog("[font]\u626B\u63CF\u5B57\u4F53\u5217\u8868\u8017\u65F6=".concat(scanDirCost, "ms"));
                        var fontFamily = SystemEnvironmentVariables_1.default.isAndroid ? "NotoSansCJK-Regular" : "PingFang";
                        var fontDataObject = fontDataResponse.data.find(function (contentEncodingSetting) { return contentEncodingSetting.includes(fontFamily); });
                        if (fontDataObject) {
                            var fontSubsetRanges = SystemEnvironmentVariables_1.default.isIOS ? [
                                [19968, 40959], [0, 127], [12288, 12351], [8192, 8303], [12800, 13055],
                                [65040, 65055], [65072, 65103], [9728, 9983], [13056, 13311], [65280, 65519],
                                [9984, 10175], [8448, 8527], [9312, 9471], [8528, 8591], [8352, 8399],
                                [8592, 8703], [9632, 9727], [8704, 8959]
                            ] : undefined;
                            var fontDataSource = SystemEnvironmentVariables_1.default.isAndroid ? fontDataObject : (0, Utils_1.resolvePath)(fontPath, fontDataObject);
                            TimeLogManager_1.TimeLogManager.timeStart("getSystemFontData");
                            getPrivateFileSystemManager({
                                path: fontDataSource,
                                subset: fontSubsetRanges,
                                success: function (fontResponse) {
                                    var fontData = fontResponse.data;
                                    if (fontData) {
                                        var fontDataLoadingTime = TimeLogManager_1.TimeLogManager.timeEnd("getSystemFontData");
                                        PluginLogger_1.default.pluginLog("[font]\u8BFB\u53D6\u5B57\u4F53\u6587\u4EF6\u8017\u65F6=".concat(fontDataLoadingTime, "ms, \u5B57\u4F53\u5927\u5C0F=").concat((fontData.byteLength / 1024 / 1024).toFixed(2), "MB"));
                                        responseSuccessFlag(fontData);
                                        _this.reportFontUsage({
                                            scanDirCost: scanDirCost,
                                            readFontDataCost: fontDataLoadingTime,
                                            byteLength: fontData.byteLength
                                        });
                                    }
                                    else {
                                        TimeLogManager_1.TimeLogManager.timeEnd("getSystemFontData");
                                        PluginLogger_1.default.pluginLog("[font]无字体文件内容");
                                        var errMsg = "empty font file";
                                        _this.reportFontError({ errMsg: errMsg });
                                        failedResponsesCount({ errMsg: errMsg });
                                    }
                                },
                                fail: function (fontError) {
                                    TimeLogManager_1.TimeLogManager.timeEnd("getSystemFontData");
                                    _this.reportFontError(fontError);
                                    failedResponsesCount(fontError);
                                }
                            });
                        }
                        else {
                            PluginLogger_1.default.pluginLog("[font]无中文字体");
                            var errMsg = "no support font";
                            _this.reportFontError({ errMsg: errMsg });
                            failedResponsesCount({ errmsg: errMsg });
                        }
                    },
                    fail: function (error) {
                        TimeLogManager_1.TimeLogManager.timeEnd("getSystemFontList");
                        _this.reportFontError(error);
                        failedResponsesCount(error);
                    }
                });
                return [2 /*return*/];
            });
        });
    };
    FontManager.prototype.reportFontUsage = function (fontDataMetrics) {
        var scanDirCost = fontDataMetrics.scanDirCost, readFontDataCost = fontDataMetrics.readFontDataCost, byteLength = fontDataMetrics.byteLength;
        this.needReport = !GameGlobalVars_1.default.isRelease || (GameGlobalVars_1.default.isRelease && Math.random() < 0.2);
        if (this.needReport) {
            this.reportInfo = {
                scanDirCost: scanDirCost,
                readFontDataCost: readFontDataCost,
                byteLength: byteLength
            };
        }
    };
    FontManager.prototype.reportFontError = function (errorEvent) {
        var errMsg = errorEvent.errMsg;
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.FONT,
            ErrorMsg: errMsg,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            ExternInfo: JSON.stringify({
                system: SystemEnvironmentVariables_1.default.systemInfo.system
            })
        }));
    };
    FontManager.prototype.reportGetFontCost = function (invokePendingCost, pluginUsageInfo) {
        if (this.needReport === undefined) {
            this.needReport = !GameGlobalVars_1.default.isRelease || (GameGlobalVars_1.default.isRelease && Math.random() < 0.2);
        }
        if (this.needReport) {
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.FONT,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify(__assign(__assign({}, this.reportInfo), { invokePendingCost: invokePendingCost, loadFromRemote: pluginUsageInfo.loadFromRemote, isReadFromCache: pluginUsageInfo.isReadFromCache, preload: pluginUsageInfo.preloadKSFont }))
            }));
            this.reportInfo = null;
        }
    };
    FontManager.getInstance = function () {
        if (!FontManager.instance) {
            FontManager.instance = new FontManager();
        }
        return FontManager.instance;
    };
    return FontManager;
}());
var fontManager = FontManager.getInstance();
exports["default"] = fontManager;


/***/ }),

/***/ "./src/lib/FrameConstructor.ts":
/*!*************************************!*\
  !*** ./src/lib/FrameConstructor.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
// module 4107
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var FrameCreator_1 = __webpack_require__(/*! ./FrameCreator */ "./src/lib/FrameCreator.ts");
var OperaPlayer_1 = __importDefault(__webpack_require__(/*! ./OperaPlayer */ "./src/lib/OperaPlayer.ts"));
var FrameConstructor = /** @class */ (function () {
    function FrameConstructor(importedFunction, initializeFrame, importDefaultFunction) {
        this.TYPE = Types_1.OperaDataType.Frame;
        this.operaData = initializeFrame;
        if (importedFunction !== null) {
            this.frameType = importedFunction;
            this.uid = String(FrameConstructor.UidIncIndex++);
            try {
                this.element = new ((0, FrameCreator_1.GetFrameElementClass)(importedFunction))(this);
            }
            catch (error) {
                throw {
                    type: Types_1.ExceptionType.Frame,
                    errmsg: "\u52A8\u4F5C\u5E27 ".concat(importedFunction, " \u4E0D\u5B58\u5728\u7279\u5B9A\u7684\u6784\u9020\u51FD\u6570\u3002"),
                };
            }
        }
        else {
            if (!importDefaultFunction) {
                throw 'Frame 快速实例模式缺失数据信息';
            }
            var uid = Number(importDefaultFunction.uid);
            if (FrameConstructor.UidIncIndex <= uid) {
                FrameConstructor.UidIncIndex = uid + 1;
            }
            this.uid = importDefaultFunction.uid;
            this.frameType = importDefaultFunction.frameType;
            try {
                this.element = new ((0, FrameCreator_1.GetFrameElementClass)(importDefaultFunction.frameType))(this);
            }
            catch (error) {
                throw {
                    type: Types_1.ExceptionType.Frame,
                    errmsg: "\u5FEB\u901F\u6A21\u5F0F\u52A8\u4F5C\u5E27 ".concat(importDefaultFunction.frameType, " \u4E0D\u5B58\u5728\u7279\u5B9A\u7684\u6784\u9020\u51FD\u6570\u3002"),
                };
            }
            this.element.importParams(importDefaultFunction.params);
            this.element.importEvents(importDefaultFunction.events);
        }
        this.registerElementEventListener();
        FrameConstructor.proxyFunc(this);
    }
    FrameConstructor.prototype.getUid = function () {
        return this.uid;
    };
    FrameConstructor.prototype.getFrameType = function () {
        return this.frameType;
    };
    FrameConstructor.prototype.getOperaData = function () {
        return this.operaData;
    };
    FrameConstructor.prototype.setParams = function (params) {
        this.element.setParams(params);
    };
    FrameConstructor.prototype.setEvents = function (eventObject) {
        this.element.setEvent(eventObject);
    };
    FrameConstructor.prototype.exportData = function () {
        return {
            frameType: this.frameType,
            uid: this.uid,
            params: this.element.exportParams(),
            events: this.element.exportEvents(),
        };
    };
    FrameConstructor.prototype.registerElementEventListener = function () {
        var _this = this;
        FrameConstructor.eventEmitter.registerEvent(this, function (frameUidIncrementer) {
            var _a, _b, _c;
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (frameUidIncrementer) {
                case CaseType_1.FrameBaseCaseType.ParamChange:
                    (_a = OperaPlayer_1.default.eventEmitter).emit.apply(_a, __spreadArray([_this.operaData, CaseType_1.OperaPlayerCaseType.ElementParamChange], args, false));
                    break;
                case CaseType_1.FrameBaseCaseType.EventLaunch:
                    (_b = OperaPlayer_1.default.eventEmitter).emit.apply(_b, __spreadArray([_this.operaData, CaseType_1.OperaPlayerCaseType.EventLaunch], args, false));
                    break;
                case CaseType_1.FrameBaseCaseType.End:
                    (_c = OperaPlayer_1.default.eventEmitter).emit.apply(_c, __spreadArray([_this.operaData, CaseType_1.OperaPlayerCaseType.End], args, false));
                    break;
            }
        });
    };
    FrameConstructor.prototype.play = function () {
        this.element.actived();
        OperaPlayer_1.default.eventEmitter.emit(this.operaData, CaseType_1.OperaPlayerCaseType.PlayFrame, this);
    };
    FrameConstructor.prototype.nextFrame = function () {
        return null;
    };
    FrameConstructor.prototype.toString = function () {
        return this.element.toString();
    };
    FrameConstructor.proxyFunc = function (valueInput) {
        // Implementation to be added
    };
    FrameConstructor.eventEmitter = new EventManager_1.default();
    FrameConstructor.UidIncIndex = 1;
    return FrameConstructor;
}());
exports["default"] = FrameConstructor;


/***/ }),

/***/ "./src/lib/FrameCreator.ts":
/*!*********************************!*\
  !*** ./src/lib/FrameCreator.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ReportCheckpointCreator = exports.PauseAudioCreator = exports.PlayAudioCreator = exports.AudioCreator = exports.SetTimeoutCreator = exports.CheckPointCreator = exports.ReportCreator = exports.SetParamCreator = exports.PlayVideoCreator = exports.PauseVideoCreator = exports.VideoCreator = exports.VariableCreator = exports.SetPositionAndSizeCreator = exports.SetSizeCreator = exports.SetPositionCreator = exports.MediaCreator = exports.ImageCreator = exports.IfCreator = exports.ExceptionCreator = exports.EndCreator = exports.RectCreator = exports.AnimationCreator = void 0;
exports.GetFrameElementClass = GetFrameElementClass;
exports.GetFrameElementParamsAndEventsStruct = GetFrameElementParamsAndEventsStruct;
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var FrameElement_1 = __importDefault(__webpack_require__(/*! ./FrameElement */ "./src/lib/FrameElement.ts"));
var AnimationConstant_1 = __webpack_require__(/*! ./AnimationConstant */ "./src/lib/AnimationConstant.ts");
var FrameConstructor_1 = __importDefault(__webpack_require__(/*! ./FrameConstructor */ "./src/lib/FrameConstructor.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
// module 7880
var AnimationCreator = /** @class */ (function (_super) {
    __extends(AnimationCreator, _super);
    function AnimationCreator(eventParameters) {
        return _super.call(this, eventParameters, AnimationCreator.ParamsStruct, AnimationCreator.EventsStruct) || this;
    }
    AnimationCreator.ParamsStruct = __assign(__assign(__assign(__assign({}, AnimationConstant_1.PositionStruct), AnimationConstant_1.SizeStruct), AnimationConstant_1.AnimationStruct), { frame: {
            type: [Types_1.FrameType.createImage],
            desc: "需要变动的Frame对象。",
        }, playing: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否正在执行动画。",
        } });
    AnimationCreator.EventsStruct = {
        onEnded: {
            desc: "当动画结束后。",
        },
    };
    return AnimationCreator;
}(FrameElement_1.default));
exports.AnimationCreator = AnimationCreator;
// module 1935
var RectCreator = /** @class */ (function (_super) {
    __extends(RectCreator, _super);
    function RectCreator(params) {
        return _super.call(this, params, RectCreator.ParamsStruct, RectCreator.EventsStruct) || this;
    }
    // 静态属性定义
    RectCreator.ParamsStruct = __assign(__assign(__assign({}, AnimationConstant_1.PositionStruct), AnimationConstant_1.SizeStruct), { color: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "颜色，默认为透明。",
        } });
    RectCreator.EventsStruct = {
        onClick: {
            desc: "当区域被点击。",
        },
    };
    return RectCreator;
}(FrameElement_1.default));
exports.RectCreator = RectCreator;
// module 2911
var EndCreator = /** @class */ (function (_super) {
    __extends(EndCreator, _super);
    function EndCreator(importHandler) {
        return _super.call(this, importHandler) || this;
    }
    EndCreator.prototype.actived = function () {
        FrameConstructor_1.default.eventEmitter.emit(this.frame, CaseType_1.FrameBaseCaseType.End);
    };
    return EndCreator;
}(FrameElement_1.default));
exports.EndCreator = EndCreator;
//module 3285
var ExceptionCreator = /** @class */ (function (_super) {
    __extends(ExceptionCreator, _super);
    function ExceptionCreator(eventParameters) {
        return _super.call(this, eventParameters, ExceptionCreator.ParamsStruct, ExceptionCreator.EventsStruct) || this;
    }
    // 静态属性定义
    ExceptionCreator.ParamsStruct = {
        throw: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否将捕获到的异常继续向上抛出，将被 director.onErr() 捕获。",
            default: true,
        },
    };
    ExceptionCreator.EventsStruct = {
        catch: {
            desc: "当捕获到异常时。",
        },
    };
    return ExceptionCreator;
}(FrameElement_1.default));
exports.ExceptionCreator = ExceptionCreator;
// module 8998
var IfCreator = /** @class */ (function (_super) {
    __extends(IfCreator, _super);
    function IfCreator(importHelper) {
        return _super.call(this, importHelper, IfCreator.ParamsStruct, IfCreator.EventsStruct) || this;
    }
    // 定义方法
    IfCreator.prototype.actived = function () {
        var _this = this;
        var _a, _b;
        var valueAParam = this.getParam("valueA");
        var valueBParam = this.getParam("valueB");
        var areValuesEqual = (((_a = valueAParam === null || valueAParam === void 0 ? void 0 : valueAParam.value) === null || _a === void 0 ? void 0 : _a.toString()) || "") ===
            (((_b = valueBParam === null || valueBParam === void 0 ? void 0 : valueBParam.value) === null || _b === void 0 ? void 0 : _b.toString()) || "");
        var eventName = areValuesEqual ? "isTrue" : "isFalse";
        this.getEvents().forEach(function (event) {
            if (event.event === eventName) {
                _this.$emitEvent(event);
            }
        });
    };
    IfCreator.ParamsStruct = {
        valueA: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "被比较的值或变量A。",
        },
        valueB: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "被比较的值或变量B。",
        },
    };
    IfCreator.EventsStruct = {
        isTrue: {
            desc: "当 valueA == valueB 时执行的事件。",
        },
        isFalse: {
            desc: "当 valueA != valueB 时执行的事件。",
        },
    };
    return IfCreator;
}(FrameElement_1.default));
exports.IfCreator = IfCreator;
// module 7165
var ImageCreator = /** @class */ (function (_super) {
    __extends(ImageCreator, _super);
    function ImageCreator(initializeFrameElementParams) {
        return _super.call(this, initializeFrameElementParams, ImageCreator.ParamsStruct, ImageCreator.EventsStruct) || this;
    }
    ImageCreator.prototype.visible = function (isVisible) {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.setParamPosition, {
            visible: !!isVisible,
            frame: this.frame,
        });
    };
    ImageCreator.ParamsStruct = __assign(__assign(__assign({}, AnimationConstant_1.PositionStruct), AnimationConstant_1.SizeStruct), { url: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "需要载入的图像资源地址。",
        } });
    ImageCreator.EventsStruct = {
        onClick: {
            desc: "当图片被点击。",
        },
    };
    return ImageCreator;
}(FrameElement_1.default));
exports.ImageCreator = ImageCreator;
// module 8003
var MediaCreator = /** @class */ (function (_super) {
    __extends(MediaCreator, _super);
    function MediaCreator(processFrameElementParamsAndEvents) {
        return _super.call(this, processFrameElementParamsAndEvents, MediaCreator.ParamsStruct) || this;
    }
    MediaCreator.ParamsStruct = {
        device: {
            type: Types_1.ParamInputType.Selecet,
            desc: "需要查询的设备类型，目前可查询 phone、pad。",
            selectItems: ["phone", "pad"],
        },
        var: {
            type: Types_1.FrameType.var,
            desc: "当前运行设备满足 Device 条件时被设定的变量(关键帧)。",
        },
        value: {
            type: Types_1.ParamInputType.String,
            desc: "变量(关键帧)设定值。",
        },
    };
    return MediaCreator;
}(FrameElement_1.default));
exports.MediaCreator = MediaCreator;
// module 4480
var SetPositionCreator = /** @class */ (function (_super) {
    __extends(SetPositionCreator, _super);
    function SetPositionCreator(eventHandler) {
        return _super.call(this, eventHandler, SetPositionCreator.ParamsStruct) || this;
    }
    SetPositionCreator.prototype.actived = function () {
        var _a, _b, _c, _d, _e, _f;
        var frameParamValue = (_a = this.getParam("frame")) === null || _a === void 0 ? void 0 : _a.value;
        if (frameParamValue) {
            var _topParamValue = (_b = this.getParam("top")) === null || _b === void 0 ? void 0 : _b.value;
            var _bottomParamValue = (_c = this.getParam("bottom")) === null || _c === void 0 ? void 0 : _c.value;
            var _leftParamValue = (_d = this.getParam("left")) === null || _d === void 0 ? void 0 : _d.value;
            var _rightParamValue = (_e = this.getParam("right")) === null || _e === void 0 ? void 0 : _e.value;
            var visibilityParamValue = (_f = this.getParam("visible")) === null || _f === void 0 ? void 0 : _f.value;
            var _positionParams = {};
            if (_topParamValue !== undefined) {
                _positionParams.top = _topParamValue;
            }
            if (_bottomParamValue !== undefined) {
                _positionParams.bottom = _bottomParamValue;
            }
            if (_leftParamValue !== undefined) {
                _positionParams.left = _leftParamValue;
            }
            if (_rightParamValue !== undefined) {
                _positionParams.right = _rightParamValue;
            }
            if (visibilityParamValue !== undefined) {
                _positionParams.visible = visibilityParamValue;
            }
            if (Object.keys(_positionParams).length > 0) {
                frameParamValue.setParams(_positionParams);
            }
        }
    };
    SetPositionCreator.ParamsStruct = __assign(__assign({}, AnimationConstant_1.PositionStruct), { frame: {
            type: Types_1.ParamInputType.Frame,
            desc: "被修改的 Frame 对象。",
        } });
    return SetPositionCreator;
}(FrameElement_1.default));
exports.SetPositionCreator = SetPositionCreator;
// module 1846
var SetSizeCreator = /** @class */ (function (_super) {
    __extends(SetSizeCreator, _super);
    function SetSizeCreator(paramConstructor) {
        return _super.call(this, paramConstructor, SetSizeCreator.ParamsStruct) || this;
    }
    SetSizeCreator.prototype.actived = function () {
        var _a, _b, _c, _d, _e, _f;
        var frameParam = (_a = this.getParam("frame")) === null || _a === void 0 ? void 0 : _a.value;
        if (frameParam) {
            var widthValue = (_b = this.getParam("width")) === null || _b === void 0 ? void 0 : _b.value;
            var heightValue = (_c = this.getParam("height")) === null || _c === void 0 ? void 0 : _c.value;
            var scaleHeightValue = (_d = this.getParam("scaleHeight")) === null || _d === void 0 ? void 0 : _d.value;
            var scaleWidthValue = (_e = this.getParam("scaleWidth")) === null || _e === void 0 ? void 0 : _e.value;
            var opacityValue = (_f = this.getParam("opacity")) === null || _f === void 0 ? void 0 : _f.value;
            if (widthValue !== undefined) {
                frameParam.setParams({ width: widthValue });
            }
            if (heightValue !== undefined) {
                frameParam.setParams({ height: heightValue });
            }
            if (scaleHeightValue !== undefined) {
                frameParam.setParams({ scaleHeight: scaleHeightValue });
            }
            if (scaleWidthValue !== undefined) {
                frameParam.setParams({ scaleWidth: scaleWidthValue });
            }
            if (opacityValue !== undefined) {
                frameParam.setParams({ opacity: opacityValue });
            }
        }
    };
    SetSizeCreator.ParamsStruct = __assign(__assign({}, AnimationConstant_1.SizeStruct), { frame: {
            type: Types_1.ParamInputType.Frame,
            desc: "被修改的 Frame 对象。",
        } });
    return SetSizeCreator;
}(FrameElement_1.default));
exports.SetSizeCreator = SetSizeCreator;
// module 8030
var SetPositionAndSizeCreator = /** @class */ (function (_super) {
    __extends(SetPositionAndSizeCreator, _super);
    function SetPositionAndSizeCreator(moduleId) {
        return _super.call(this, moduleId, [Types_1.FrameType.setParamSize, Types_1.FrameType.setParamPosition]) || this;
    }
    SetPositionAndSizeCreator.prototype.actived = function () {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l;
        var frameValue = (_a = this.getParam("frame")) === null || _a === void 0 ? void 0 : _a.value;
        if (frameValue) {
            var topParamValue = (_b = this.getParam("top")) === null || _b === void 0 ? void 0 : _b.value;
            var bottomParamValue = (_c = this.getParam("bottom")) === null || _c === void 0 ? void 0 : _c.value;
            var leftParamValue = (_d = this.getParam("left")) === null || _d === void 0 ? void 0 : _d.value;
            var rightParamValue = (_e = this.getParam("right")) === null || _e === void 0 ? void 0 : _e.value;
            var isVisibleParamValue = (_f = this.getParam("visible")) === null || _f === void 0 ? void 0 : _f.value;
            var widthParamValue = (_g = this.getParam("width")) === null || _g === void 0 ? void 0 : _g.value;
            var opacityParamValue = (_h = this.getParam("opacity")) === null || _h === void 0 ? void 0 : _h.value;
            var heightParamValue = (_j = this.getParam("scaleWidth")) === null || _j === void 0 ? void 0 : _j.value;
            var scaleHeightParamValue = (_k = this.getParam("scaleHeight")) === null || _k === void 0 ? void 0 : _k.value;
            var _heightParamValue = (_l = this.getParam("height")) === null || _l === void 0 ? void 0 : _l.value;
            var positionParams = {};
            if (topParamValue !== undefined) {
                positionParams.top = topParamValue;
            }
            if (bottomParamValue !== undefined) {
                positionParams.bottom = bottomParamValue;
            }
            if (leftParamValue !== undefined) {
                positionParams.left = leftParamValue;
            }
            if (rightParamValue !== undefined) {
                positionParams.right = rightParamValue;
            }
            if (isVisibleParamValue !== undefined) {
                positionParams.visible = isVisibleParamValue;
            }
            if (widthParamValue !== undefined) {
                positionParams.width = widthParamValue;
            }
            if (_heightParamValue !== undefined) {
                positionParams.height = _heightParamValue;
            }
            if (scaleHeightParamValue !== undefined) {
                positionParams.scaleHeight = scaleHeightParamValue;
            }
            if (heightParamValue !== undefined) {
                positionParams.scaleWidth = heightParamValue;
            }
            if (opacityParamValue !== undefined) {
                positionParams.opacity = opacityParamValue;
            }
            if (Object.keys(positionParams).length > 0) {
                frameValue.setParams(positionParams);
            }
        }
    };
    SetPositionAndSizeCreator.ParamsStruct = __assign(__assign({}, AnimationConstant_1.SizeStruct), { frame: {
            type: Types_1.ParamInputType.Frame,
            desc: "被修改的 Frame 对象。",
        } });
    return SetPositionAndSizeCreator;
}(FrameElement_1.default));
exports.SetPositionAndSizeCreator = SetPositionAndSizeCreator;
// module 3293
var VariableCreator = /** @class */ (function (_super) {
    __extends(VariableCreator, _super);
    function VariableCreator(actionHandler) {
        return _super.call(this, actionHandler, VariableCreator.ParamsStruct) || this;
    }
    VariableCreator.prototype.toString = function () {
        var _a;
        return ((_a = this.getParam("value")) === null || _a === void 0 ? void 0 : _a.value) || '';
    };
    VariableCreator.ParamsStruct = {
        value: {
            type: Types_1.ParamInputType.String,
            desc: "全局字符串变量。",
        },
        globalName: {
            type: Types_1.ParamInputType.String,
            desc: "全局变量名，设置后可对其进行直接赋值。",
        },
    };
    VariableCreator.EventsStruct = {
        onChange: {
            desc: "当全局变量值被赋值时的事件，即使赋值后仍保持原始值也会产生事件。",
        },
        onChanged: {
            desc: "当全局变量值改变时的事件，仅在变量值真实发生变化时产生事件。",
        },
    };
    return VariableCreator;
}(FrameElement_1.default));
exports.VariableCreator = VariableCreator;
// module 9906
var VideoCreator = /** @class */ (function (_super) {
    __extends(VideoCreator, _super);
    function VideoCreator(frameParameter) {
        return _super.call(this, frameParameter, VideoCreator.ParamsStruct, VideoCreator.EventsStruct) || this;
    }
    VideoCreator.prototype.pause = function () {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.pauseVide, {
            video: this.frame,
        });
    };
    VideoCreator.prototype.play = function () {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.playVideo, {
            video: this.frame,
        });
    };
    VideoCreator.prototype.visible = function (isVisible) {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.setParamPosition, {
            visible: !!isVisible,
            frame: this.frame,
        });
    };
    VideoCreator.ParamsStruct = __assign(__assign(__assign({}, AnimationConstant_1.PositionStruct), AnimationConstant_1.SizeStruct), { url: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "需要载入的视频资源地址。",
        }, autoPlay: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否加载完毕后立即播放。",
        }, playing: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否是播放中。",
            default: false,
        }, objectFit: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "视频的缩放模式，可选值：fill、contain、cover",
            default: "cover",
        }, seek: {
            type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "视频跳转到特定秒数，如果 < 0 则不跳转。",
            default: -1,
        }, loop: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否循环播放。",
            default: false,
        } });
    VideoCreator.EventsStruct = {
        onPlayTimeAt: {
            params: {
                sec: {
                    type: Types_1.ParamInputType.Number,
                    desc: "监听的秒数。",
                },
            },
            desc: "当视频播放到特定秒数时触发下一帧。",
        },
        onEnded: {
            desc: "当视频播放结束后。",
        },
        onPlay: {
            desc: "开始播放。",
        },
    };
    return VideoCreator;
}(FrameElement_1.default));
exports.VideoCreator = VideoCreator;
// module 1997
var PauseVideoCreator = /** @class */ (function (_super) {
    __extends(PauseVideoCreator, _super);
    function PauseVideoCreator(actionResponse) {
        return _super.call(this, actionResponse, PauseVideoCreator.ParamsStruct) || this;
    }
    PauseVideoCreator.prototype.actived = function () {
        var _a;
        (_a = this.getParam("video")) === null || _a === void 0 ? void 0 : _a.value.setParams({
            playing: false,
        });
    };
    PauseVideoCreator.ParamsStruct = {
        video: {
            type: Types_1.FrameType.createVideo,
            desc: "需要暂停的视频 Frame 实例。",
        },
    };
    return PauseVideoCreator;
}(FrameElement_1.default));
exports.PauseVideoCreator = PauseVideoCreator;
// module 6027
var PlayVideoCreator = /** @class */ (function (_super) {
    __extends(PlayVideoCreator, _super);
    function PlayVideoCreator(importHelper) {
        return _super.call(this, importHelper, PlayVideoCreator.ParamsStruct) || this;
    }
    PlayVideoCreator.prototype.actived = function () {
        var _a;
        (_a = this.getParam("video")) === null || _a === void 0 ? void 0 : _a.value.setParams({
            playing: true,
        });
    };
    PlayVideoCreator.ParamsStruct = {
        video: {
            type: Types_1.FrameType.createVideo,
            desc: "需要继续播放的视频 Frame 实例。",
        },
    };
    return PlayVideoCreator;
}(FrameElement_1.default));
exports.PlayVideoCreator = PlayVideoCreator;
// module 1008
var SetParamCreator = /** @class */ (function (_super) {
    __extends(SetParamCreator, _super);
    function SetParamCreator(frameModule) {
        return _super.call(this, frameModule, SetParamCreator.ParamsStruct, SetParamCreator.EventsStruct) || this;
    }
    SetParamCreator.prototype.actived = function () {
        var _a, _b, _c, _d;
        var _frameParam = (_a = this.getParam("frame")) === null || _a === void 0 ? void 0 : _a.value;
        if (_frameParam) {
            var _paramValue = (_c = (_b = this.getParam("param")) === null || _b === void 0 ? void 0 : _b.value) === null || _c === void 0 ? void 0 : _c.toString();
            var __paramValue = this.getParam("value");
            var ___inputValue = void 0;
            if (!__paramValue ||
                (![Types_1.ParamInputType.Boolean, Types_1.ParamInputType.Number, Types_1.ParamInputType.String].includes(__paramValue.type))) {
                ___inputValue = (_d = __paramValue === null || __paramValue === void 0 ? void 0 : __paramValue.value) === null || _d === void 0 ? void 0 : _d.toString();
            }
            else {
                ___inputValue = __paramValue.value;
            }
            var paramsToUpdate = {};
            if (_paramValue) {
                paramsToUpdate[_paramValue] = ___inputValue;
            }
            _frameParam.setParams(paramsToUpdate);
        }
    };
    SetParamCreator.ParamsStruct = {
        frame: {
            type: Types_1.ParamInputType.Frame,
            desc: "被修改的 Frame 对象。",
        },
        param: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "被设置的属性名。",
        },
        value: {
            type: [
                Types_1.ParamInputType.String,
                Types_1.FrameType.var,
                Types_1.ParamInputType.Boolean,
                Types_1.ParamInputType.Number,
            ],
            desc: "被设置的属性值。",
        },
    };
    SetParamCreator.EventsStruct = {};
    return SetParamCreator;
}(FrameElement_1.default));
exports.SetParamCreator = SetParamCreator;
// module 1662
var ReportCreator = /** @class */ (function (_super) {
    __extends(ReportCreator, _super);
    function ReportCreator(parameterHandler) {
        return _super.call(this, parameterHandler, ReportCreator.ParamsStruct, ReportCreator.EventsStruct) || this;
    }
    ReportCreator.ParamsStruct = {
        sceneId: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "自定义上报场景ID。",
        },
        dimension: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "自定义上报维度JSON字符串，请阅读上报说明填写。",
        },
        metric: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "自定义上报指标JSON字符串，请阅读上报说明填写。",
        },
    };
    ReportCreator.EventsStruct = {};
    return ReportCreator;
}(FrameElement_1.default));
exports.ReportCreator = ReportCreator;
// module 1013
var CheckPointCreator = /** @class */ (function (_super) {
    __extends(CheckPointCreator, _super);
    function CheckPointCreator(handleFrameType) {
        return _super.call(this, handleFrameType, CheckPointCreator.ParamsStruct, CheckPointCreator.EventsStruct) || this;
    }
    CheckPointCreator.ParamsStruct = {};
    CheckPointCreator.EventsStruct = {};
    return CheckPointCreator;
}(FrameElement_1.default));
exports.CheckPointCreator = CheckPointCreator;
// module 4005
var SetTimeoutCreator = /** @class */ (function (_super) {
    __extends(SetTimeoutCreator, _super);
    function SetTimeoutCreator(moduleImport) {
        return _super.call(this, moduleImport, SetTimeoutCreator.ParamsStruct, SetTimeoutCreator.EventsStruct) || this;
    }
    SetTimeoutCreator.prototype.cancel = function () {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.setParam, {
            frame: this,
            param: "cancel",
            value: true,
        });
    };
    SetTimeoutCreator.ParamsStruct = {
        timeout: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var, Types_1.ParamInputType.Number],
            desc: "延迟时长，单位 ms。",
        },
        cancel: {
            type: [Types_1.ParamInputType.Boolean],
            desc: "提前取消执行。",
            default: false,
        },
    };
    SetTimeoutCreator.EventsStruct = {
        onEnded: {
            desc: "当延迟结束后。",
        },
        onCancel: {
            desc: "当主动取消时。",
        },
    };
    return SetTimeoutCreator;
}(FrameElement_1.default));
exports.SetTimeoutCreator = SetTimeoutCreator;
// module 9433
var AudioCreator = /** @class */ (function (_super) {
    __extends(AudioCreator, _super);
    function AudioCreator(handleEvent) {
        return _super.call(this, handleEvent, AudioCreator.ParamsStruct, AudioCreator.EventsStruct) || this;
    }
    AudioCreator.prototype.pause = function () {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.pauseAudio, {
            audio: this.frame,
        });
    };
    AudioCreator.prototype.play = function () {
        return this.frame.getOperaData().createFrame(Types_1.FrameType.playAudio, {
            audio: this.frame,
        });
    };
    AudioCreator.ParamsStruct = {
        url: {
            type: [Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "需要载入的音频资源地址。",
        },
        autoPlay: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否加载完毕后立即播放。",
        },
        playing: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否是播放中，修改该属性可以继续/暂停播放。",
            default: false,
        },
        seek: {
            type: [Types_1.ParamInputType.Number, Types_1.ParamInputType.String, Types_1.FrameType.var],
            desc: "音频跳转到特定秒数，如果 < 0 则不跳转。",
            default: -1,
        },
        volume: {
            type: [Types_1.ParamInputType.Number],
            desc: "音频的音量，0～1之间的数值，默认为1。",
            default: 1,
        },
        loop: {
            type: Types_1.ParamInputType.Boolean,
            desc: "是否循环播放，默认不循环。",
            default: false,
        },
    };
    AudioCreator.EventsStruct = {
        onPlayTimeAt: {
            params: {
                sec: {
                    type: Types_1.ParamInputType.Number,
                    desc: "监听的秒数。",
                },
            },
            desc: "当音频播放到特定秒数时触发下一帧。",
        },
        onEnded: {
            desc: "当音频播放结束后。",
        },
        onPlay: {
            desc: "开始播放",
        },
    };
    return AudioCreator;
}(FrameElement_1.default));
exports.AudioCreator = AudioCreator;
// module 1258
var PlayAudioCreator = /** @class */ (function (_super) {
    __extends(PlayAudioCreator, _super);
    function PlayAudioCreator(frameType) {
        return _super.call(this, frameType, PlayAudioCreator.ParamsStruct) || this;
    }
    PlayAudioCreator.prototype.actived = function () {
        var _a;
        (_a = this.getParam("audio")) === null || _a === void 0 ? void 0 : _a.value.setParams({
            playing: true,
        });
    };
    PlayAudioCreator.ParamsStruct = {
        audio: {
            type: Types_1.FrameType.createAudio,
            desc: "需要继续播放的音频 Frame 实例。",
        },
    };
    return PlayAudioCreator;
}(FrameElement_1.default));
exports.PlayAudioCreator = PlayAudioCreator;
// module 7311
var PauseAudioCreator = /** @class */ (function (_super) {
    __extends(PauseAudioCreator, _super);
    function PauseAudioCreator(event) {
        return _super.call(this, event, PauseAudioCreator.ParamsStruct) || this;
    }
    PauseAudioCreator.prototype.actived = function () {
        var _a;
        (_a = this.getParam("audio")) === null || _a === void 0 ? void 0 : _a.value.setParams({
            playing: false,
        });
    };
    PauseAudioCreator.ParamsStruct = {
        audio: {
            type: Types_1.FrameType.createAudio,
            desc: "需要暂停的音频 Frame 实例。",
        },
    };
    return PauseAudioCreator;
}(FrameElement_1.default));
exports.PauseAudioCreator = PauseAudioCreator;
// module 8898
var ReportCheckpointCreator = /** @class */ (function (_super) {
    __extends(ReportCheckpointCreator, _super);
    function ReportCheckpointCreator(importedHelper) {
        return _super.call(this, importedHelper, ReportCheckpointCreator.ParamsStruct, ReportCheckpointCreator.EventsStruct) || this;
    }
    ReportCheckpointCreator.ParamsStruct = {
        num: {
            type: Types_1.ParamInputType.Number,
            desc: "累计创建的检查点个数。",
        },
    };
    ReportCheckpointCreator.EventsStruct = {};
    return ReportCheckpointCreator;
}(FrameElement_1.default));
exports.ReportCheckpointCreator = ReportCheckpointCreator;
function handleFrameTypeEvent(event) {
    switch (event) {
        case Types_1.FrameType.media:
            return MediaCreator;
        case Types_1.FrameType.createVideo:
            return VideoCreator;
        case Types_1.FrameType.end:
            return EndCreator;
        case Types_1.FrameType.var:
            return VariableCreator;
        case Types_1.FrameType.createImage:
            return ImageCreator;
        case Types_1.FrameType.setParamPosition:
            return SetPositionCreator;
        case Types_1.FrameType.setParamSize:
            return SetSizeCreator;
        case Types_1.FrameType.setParamSizeAndPosition:
            return SetPositionAndSizeCreator;
        case Types_1.FrameType.createRect:
            return RectCreator;
        case Types_1.FrameType.pauseVide:
            return PauseVideoCreator;
        case Types_1.FrameType.playVideo:
            return PlayVideoCreator;
        case Types_1.FrameType.createAnimationFunction:
            return AnimationCreator;
        case Types_1.FrameType.exception:
            return ExceptionCreator;
        case Types_1.FrameType.if:
            return IfCreator;
        case Types_1.FrameType.setParam:
            return SetParamCreator;
        case Types_1.FrameType.report:
            return ReportCreator;
        case Types_1.FrameType.checkPoint:
            return CheckPointCreator;
        case Types_1.FrameType.setTimeout:
            return SetTimeoutCreator;
        case Types_1.FrameType.createAudio:
            return AudioCreator;
        case Types_1.FrameType.playAudio:
            return PlayAudioCreator;
        case Types_1.FrameType.pauseAudio:
            return PauseAudioCreator;
        case Types_1.FrameType.reportCheckPointCount:
            return ReportCheckpointCreator;
        default:
            return null;
    }
}
function GetFrameElementClass(event) {
    return handleFrameTypeEvent(event);
}
function GetFrameElementParamsAndEventsStruct(event) {
    var frameTypeEvent = handleFrameTypeEvent(event);
    var paramsStruct = null;
    var eventsStruct = null;
    if (frameTypeEvent !== null) {
        var keys = Object.keys(frameTypeEvent);
        if (keys.includes("ParamsStruct")) {
            paramsStruct = frameTypeEvent.ParamsStruct;
        }
        if (keys.includes("EventsStruct")) {
            eventsStruct = frameTypeEvent.EventsStruct;
        }
    }
    return {
        paramsStruct: paramsStruct,
        eventsStruct: eventsStruct,
    };
}


/***/ }),

/***/ "./src/lib/FrameElement.ts":
/*!*********************************!*\
  !*** ./src/lib/FrameElement.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var FrameConstructor_1 = __importDefault(__webpack_require__(/*! ./FrameConstructor */ "./src/lib/FrameConstructor.ts"));
var EventHandler_1 = __importDefault(__webpack_require__(/*! ./EventHandler */ "./src/lib/EventHandler.ts"));
var FrameCreator_1 = __webpack_require__(/*! ./FrameCreator */ "./src/lib/FrameCreator.ts");
// module 5483
var FrameElement = /** @class */ (function () {
    function FrameElement(frameExports, MyDerivedClass, importDefaultHelper) {
        this.params = {};
        this.frame = frameExports;
        if (Array.isArray(MyDerivedClass)) {
            var mergedEventsStruct_1 = {};
            var mergedParamsStruct_1 = {};
            MyDerivedClass.forEach(function (module) {
                var _a = (0, FrameCreator_1.GetFrameElementParamsAndEventsStruct)(module), paramsStruct = _a.paramsStruct, eventsStruct = _a.eventsStruct;
                if (eventsStruct) {
                    (0, Utils_1.mergeEventsStructA2B)(mergedEventsStruct_1, eventsStruct);
                }
                if (paramsStruct) {
                    (0, Utils_1.mergeParamsStructA2B)(mergedParamsStruct_1, paramsStruct);
                }
            });
            this.paramsStruct = mergedParamsStruct_1;
            this.eventsStruct = mergedEventsStruct_1;
        }
        else {
            this.paramsStruct = MyDerivedClass || {};
            this.eventsStruct = importDefaultHelper || {};
        }
        this.eventsManager = new EventHandler_1.default(this, this.eventsStruct);
        this.initParams();
    }
    FrameElement.prototype.actived = function () { };
    FrameElement.prototype.setParams = function (params) {
        var _this = this;
        var validatedParams = (0, Utils_1.checkParams)(this.paramsStruct, params);
        if (validatedParams) {
            Object.keys(validatedParams).forEach(function (key) {
                if (validatedParams[key] !== null) {
                    _this.params[key] = validatedParams[key];
                }
                else {
                    delete _this.params[key];
                }
            });
        }
    };
    FrameElement.prototype.getParam = function (paramIndex) {
        return this.params[paramIndex];
    };
    FrameElement.prototype.exportParams = function () {
        var _this = this;
        var paramsOutput = {};
        Object.keys(this.params).forEach(function (key) {
            var param = _this.params[key];
            if (param !== null) {
                if (param.type === Types_1.ParamInputType.Frame) {
                    paramsOutput[key] = {
                        value: _this.getFrameUid(param.value),
                        type: Types_1.ParamInputType.Frame,
                        frameType: param.frameType,
                    };
                }
                else {
                    paramsOutput[key] = {
                        type: param.type,
                        value: param.value,
                    };
                }
            }
        });
        return paramsOutput;
    };
    FrameElement.prototype.importParams = function (eventHandlers) {
        var _this = this;
        Object.keys(eventHandlers).forEach(function (key) {
            var eventHandler = eventHandlers[key];
            _this.params[key] = {
                type: eventHandler.type,
                value: eventHandler.value,
                frameType: eventHandler.frameType,
            };
            if (eventHandler.type === Types_1.ParamInputType.Frame) {
                _this.frame.getOperaData().delegateUid2Ob(Types_1.OperaDataType.Frame, eventHandler.value, _this.params[key], 'value');
            }
        });
    };
    FrameElement.prototype.setEvent = function (event) {
        this.eventsManager.registerEvent(event);
    };
    FrameElement.prototype.getEvents = function (event) {
        return this.eventsManager.getEvents(event);
    };
    FrameElement.prototype.$emitEvent = function (event) {
        this.eventsManager.launchEvent(event);
    };
    FrameElement.prototype.exportEvents = function () {
        return this.eventsManager.exportEvents();
    };
    FrameElement.prototype.importEvents = function (eventPayload) {
        this.eventsManager.importEvents(eventPayload);
    };
    FrameElement.prototype.getFrameBase = function () {
        return this.frame;
    };
    FrameElement.prototype.initParams = function () {
        var _this = this;
        var validatedParamsData = {};
        Object.keys(this.paramsStruct).forEach(function (key) {
            var paramDefinition = _this.paramsStruct[key];
            validatedParamsData[key] = null;
            if (paramDefinition.default !== undefined) {
                var checkedParam = (0, Utils_1.checkParamInTypes)(paramDefinition.default, paramDefinition.type);
                if (checkedParam === null) {
                    console.error("\u9ED8\u8BA4\u914D\u7F6E\u9879\u76EE ".concat(paramDefinition, " \u4E2D default \u503C ").concat(paramDefinition.default, " \u6CA1\u6709\u901A\u8FC7\u7C7B\u578B\u68C0\u67E5"));
                    return;
                }
                validatedParamsData[key] = {
                    value: paramDefinition.default,
                    type: checkedParam.type,
                    frameType: checkedParam.frameType,
                };
            }
        });
        this.params = new Proxy(validatedParamsData, {
            get: function (target, prop) {
                return target[prop];
            },
            set: function (target, prop, newValue) {
                var oldValue = target[prop];
                if ((oldValue === null || oldValue === void 0 ? void 0 : oldValue.value) !== (newValue === null || newValue === void 0 ? void 0 : newValue.value)) {
                    target[prop] = newValue;
                    FrameConstructor_1.default.eventEmitter.emit(_this.frame, CaseType_1.FrameBaseCaseType.ParamChange, _this.frame, prop, oldValue, newValue);
                }
                return true;
            },
        });
    };
    FrameElement.prototype.getFrameUid = function (entity) {
        return entity.getUid();
    };
    return FrameElement;
}());
exports["default"] = FrameElement;


/***/ }),

/***/ "./src/lib/FrameMonitor.ts":
/*!*********************************!*\
  !*** ./src/lib/FrameMonitor.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var MonitorConfig_1 = __webpack_require__(/*! ./MonitorConfig */ "./src/lib/MonitorConfig.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var TaskManager_1 = __importDefault(__webpack_require__(/*! ./TaskManager */ "./src/lib/TaskManager.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var GetNowInMs = function () {
    if (performance && typeof performance.now === "function") {
        return performance.now();
    }
    return Date.now();
};
var FrameMonitor = /** @class */ (function (_super) {
    __extends(FrameMonitor, _super);
    function FrameMonitor() {
        var _this = _super.call(this) || this;
        _this.performanceIssuesMap = {
            cpuprofile: DefaultLanguageMap_1.default.frameMonitor_cpuprofile,
        };
        _this.result = {};
        _this.limit = parseInt(String(50), 10);
        _this.currentFrame = 0;
        _this.wrongFrame = {};
        _this.requestID = 0;
        _this.startTime = 0;
        _this.currentTime = 0;
        return _this;
    }
    FrameMonitor.prototype.init = function () {
        var monitorConfig = MonitorConfig_1.MonitorConfig.getInstance();
        var framesPerSecond = monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.Fps);
        this.limit = parseInt(String((1 / framesPerSecond) * 1000), 10);
        this.currentFrame = 0;
        this.wrongFrame = {};
    };
    FrameMonitor.prototype.start = function () {
        if (!this.requestID) {
            this.startTime = GetNowInMs();
            this.currentTime = this.startTime;
            this.requestID = requestAnimationFrame(this.counter.bind(this));
        }
    };
    FrameMonitor.prototype.stop = function () {
        cancelAnimationFrame(this.requestID);
        PluginLogger_1.default.monitorLog("monitor stop. cancelAnimationFrame ".concat(this.requestID));
        this.requestID = 0;
    };
    FrameMonitor.prototype.reset = function () {
        this.stop();
        this.startTime = 0;
        this.currentFrame = 0;
        this.currentTime = 0;
        this.wrongFrame = {};
        this.performanceIssuesMap = undefined;
    };
    FrameMonitor.prototype.showResult = function () {
        this.stop();
        this.result = this.getResultInfo();
        return this.checkResult();
    };
    FrameMonitor.prototype.getRuntime = function () {
        return GetNowInMs() - this.startTime;
    };
    FrameMonitor.prototype.getResultInfo = function () {
        var wrongFrameKeys = Object.keys(this.wrongFrame);
        var frameValues = Object.values(this.wrongFrame);
        var sortedFrameEntries = Object.entries(this.wrongFrame).sort(function (_a, _b) {
            var a = _a[1];
            var b = _b[1];
            return b.frameCost - a.frameCost;
        });
        var highestCostFrameEntry = sortedFrameEntries[0];
        var totalCostTime = frameValues.reduce(function (sum, frame) { return sum + frame.frameCost; }, 0);
        var currentRuntime = this.getRuntime();
        var pluginRuntime = TimeLogManager_1.TimeLogManager.getRuntime();
        var costRatio = Number((totalCostTime / currentRuntime).toFixed(4));
        var monitorConfig = MonitorConfig_1.MonitorConfig.getInstance();
        return {
            frames: wrongFrameKeys,
            frameCount: wrongFrameKeys.length,
            longestFrame: highestCostFrameEntry
                ? {
                    frame: highestCostFrameEntry[0],
                    frameCost: highestCostFrameEntry[1].frameCost,
                    runtime: highestCostFrameEntry[1].runtime,
                }
                : {},
            topFrameCost: sortedFrameEntries
                .slice(0, 5)
                .map(function (_a) {
                var frame = _a[1];
                return frame.frameCost;
            }),
            topFrameNetworkCount: sortedFrameEntries
                .slice(0, 5)
                .map(function (_a) {
                var frame = _a[1];
                return frame.loadingCount;
            }),
            frameInfo: this.wrongFrame,
            totalCostTime: totalCostTime,
            jankRate: costRatio,
            timerRuntime: currentRuntime,
            appRuntime: pluginRuntime,
            configMonitorDuration: monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.MonitorDuration),
            showResultAfterLaunch: monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.ShowResultAfterLaunch),
            configFps: monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.Fps),
        };
    };
    FrameMonitor.prototype.checkResult = function () {
        PluginLogger_1.default.monitorLog("----帧率检测 start ----");
        PluginLogger_1.default.monitorLog("帧率基本信息：", this.result);
        var performanceIssues = [];
        var longestFrameData = this.result.longestFrame;
        if (longestFrameData.frameCost > 1000) {
            performanceIssues.push("".concat(DefaultLanguageMap_1.default.frameMonitor_longFrame, " cost=").concat(longestFrameData.frameCost.toFixed(2), "ms, runtime=").concat(longestFrameData.runtime.toFixed(2), "ms"));
        }
        if (this.result.totalJankTime > 5000) {
            performanceIssues.push("".concat(DefaultLanguageMap_1.default.frameMonitor_totalJankTime, " ").concat(this.result.totalJankTime.toFixed(2), "ms"));
        }
        if (this.result.jankRate > 0.3) {
            performanceIssues.push("".concat(DefaultLanguageMap_1.default.frameMonitor_jankRate, " ").concat(parseInt(String(this.result.jankRate * 100), 10), "%"));
        }
        if (performanceIssues.length && this.performanceIssuesMap) {
            PluginLogger_1.default.monitorWarn("".concat(DefaultLanguageMap_1.default.showResult_frameRateOptAdvice, ":"));
            performanceIssues.push(this.performanceIssuesMap.cpuprofile);
            PluginLogger_1.default.monitorWarn(performanceIssues.join("\n"));
        }
        PluginLogger_1.default.monitorLog("----帧率检测 end ----");
        return performanceIssues;
    };
    FrameMonitor.prototype.counter = function () {
        this.currentFrame += 1;
        var currentTimeStamp = GetNowInMs();
        var timeCost = currentTimeStamp - this.currentTime;
        if (timeCost > this.limit) {
            PluginLogger_1.default.monitorWarn("frame=".concat(this.currentFrame, "; cost=").concat(timeCost, "ms; runtime=").concat(this.getRuntime(), "ms"));
            this.wrongFrame[this.currentFrame] = {
                frameCost: timeCost,
                runtime: this.getRuntime(),
                loadingCount: TaskManager_1.default.loadingCount,
            };
        }
        this.currentTime = currentTimeStamp;
        this.requestID = requestAnimationFrame(this.counter.bind(this));
    };
    return FrameMonitor;
}(Instance_1.default));
exports["default"] = FrameMonitor;


/***/ }),

/***/ "./src/lib/FunctionBinder.ts":
/*!***********************************!*\
  !*** ./src/lib/FunctionBinder.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.snapshotManager = exports.functionBinderMalloc = void 0;
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var FunctionBinder = /** @class */ (function (_super) {
    __extends(FunctionBinder, _super);
    function FunctionBinder() {
        return _super.call(this) || this;
    }
    FunctionBinder.prototype.init = function (unityManagerInstance) {
        this.unityManager = unityManagerInstance;
        this.bindFunction();
    };
    FunctionBinder.prototype.bindFunction = function () { };
    return FunctionBinder;
}(Instance_1.default));
var FunctionBinderMalloc = /** @class */ (function (_super) {
    __extends(FunctionBinderMalloc, _super);
    function FunctionBinderMalloc() {
        return _super.call(this) || this;
    }
    FunctionBinderMalloc.prototype.malloc = function (externalInfo) {
        if ((0, Utils_1.isEmpty)(externalInfo)) {
            return PluginLogger_1.default.pluginError('[malloc report]: invalid params');
        }
        var pluginEnvironment = new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.Malloc,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            ExternInfo: JSON.stringify(externalInfo),
        });
        ReportInitializer_1.default.remoteReporter.send(pluginEnvironment);
    };
    FunctionBinderMalloc.prototype.bindFunction = function () {
        this.unityManager.reporter.alarm = {
            malloc: this.malloc.bind(this),
        };
    };
    return FunctionBinderMalloc;
}(FunctionBinder));
var SnapshotManager = /** @class */ (function (_super) {
    __extends(SnapshotManager, _super);
    function SnapshotManager() {
        return _super.call(this) || this;
    }
    SnapshotManager.prototype.fetchSnapshot = function (snapshotData) {
        this.baseReporter(Types_1.SnapshotType.FETCH_SNAPSHOT, snapshotData);
    };
    SnapshotManager.prototype.restoreSnapshot = function (snapshotData) {
        this.baseReporter(Types_1.SnapshotType.RESTORE_SNAPSHOT, snapshotData);
    };
    SnapshotManager.prototype.baseReporter = function (reportType, executionTime) {
        var pluginEnvironment = new Utils_1.ObjectClassWrapper({
            ReportType: reportType,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        });
        if (executionTime) {
            pluginEnvironment.CostTimeMs = executionTime;
        }
        ReportInitializer_1.default.gameReporter.send(pluginEnvironment);
    };
    SnapshotManager.prototype.bindFunction = function () {
        this.unityManager.reporter.snapshot = {
            fetchSnapshot: this.fetchSnapshot.bind(this),
            restoreSnapshot: this.restoreSnapshot.bind(this),
        };
    };
    return SnapshotManager;
}(FunctionBinder));
var functionBinderMalloc = FunctionBinderMalloc.getInstance();
exports.functionBinderMalloc = functionBinderMalloc;
var snapshotManager = SnapshotManager.getInstance();
exports.snapshotManager = snapshotManager;


/***/ }),

/***/ "./src/lib/GameCanvas.ts":
/*!*******************************!*\
  !*** ./src/lib/GameCanvas.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var GameCanvas = /** @class */ (function (_super) {
    __extends(GameCanvas, _super);
    function GameCanvas() {
        var _this = _super.call(this) || this;
        var canvasElement;
        var isMiniGamePlugin = SystemEnvironmentVariables_1.default.isMiniGamePlugin, _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight, pixelRatio = _a.pixelRatio;
        if (isMiniGamePlugin) {
            var canvas = SystemEnvironmentVariables_1.default.pluginEnv.customEnv.canvas;
            canvasElement = canvas;
        }
        else {
            canvasElement = GameGlobal.canvas;
        }
        canvasElement.id = "";
        canvasElement.style = { width: "".concat(screenWidth, "px"), height: "".concat(screenHeight, "px") };
        canvasElement.width = screenWidth * pixelRatio;
        canvasElement.height = screenHeight * pixelRatio;
        canvasElement.widthNative = 0;
        canvasElement.heightNative = 0;
        _this.canvasElement = canvasElement;
        return _this;
    }
    Object.defineProperty(GameCanvas.prototype, "canvas", {
        get: function () {
            return this.canvasElement;
        },
        enumerable: false,
        configurable: true
    });
    return GameCanvas;
}(Instance_1.default));
exports["default"] = GameCanvas;


/***/ }),

/***/ "./src/lib/GameFeatures.ts":
/*!*********************************!*\
  !*** ./src/lib/GameFeatures.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.gameFeatures = exports.GameFeatures = exports.GameFeatureConfigKeys = void 0;
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var GameFeatureConfigKeys = {
    WasmSplit: 'wasmsplit',
    FileQuota: 'filequota',
    WasmPatch: 'wasmpatch',
    KsFont: 'ksfont',
};
exports.GameFeatureConfigKeys = GameFeatureConfigKeys;
var GameFeatures = /** @class */ (function (_super) {
    __extends(GameFeatures, _super);
    function GameFeatures() {
        var _a;
        var _this = _super.call(this) || this;
        _this.config = (_a = {},
            _a[GameFeatureConfigKeys.WasmSplit] = Types_1.TransferStatus.open,
            _a[GameFeatureConfigKeys.FileQuota] = Types_1.TransferStatus.open,
            _a[GameFeatureConfigKeys.WasmPatch] = Types_1.TransferStatus.open,
            _a[GameFeatureConfigKeys.KsFont] = Types_1.TransferStatus.open,
            _a);
        return _this;
    }
    GameFeatures.prototype.init = function (features) {
        var _this = this;
        if (features && features.length) {
            features.forEach(function (_a) {
                var key = _a.key, value = _a.value;
                _this.set(key, value);
            });
        }
    };
    GameFeatures.prototype.get = function (key) {
        return this.config[key] || Types_1.TransferStatus.open;
    };
    GameFeatures.prototype.set = function (key, value) {
        this.config[key] = value || Types_1.TransferStatus.open;
    };
    GameFeatures.prototype.getFeatureString = function () {
        return Object.entries(this.config)
            .map(function (_a) {
            var key = _a[0], value = _a[1];
            return "".concat(key, "_").concat(value);
        })
            .join(",");
    };
    GameFeatures.prototype.getFeatures = function () {
        return __assign({}, this.config);
    };
    return GameFeatures;
}(Instance_1.default));
exports.GameFeatures = GameFeatures;
var gameFeatures = GameFeatures.getInstance();
exports.gameFeatures = gameFeatures;


/***/ }),

/***/ "./src/lib/GameGlobalVars.ts":
/*!***********************************!*\
  !*** ./src/lib/GameGlobalVars.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ImagePreviewer_1 = __webpack_require__(/*! ../coverview/ImagePreviewer */ "./src/coverview/ImagePreviewer.ts");
var CoverviewLayouts_1 = __webpack_require__(/*! ../coverview/CoverviewLayouts */ "./src/coverview/CoverviewLayouts.ts");
var XMLParser_1 = __importDefault(__webpack_require__(/*! ../coverview/XMLParser */ "./src/coverview/XMLParser.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var GameGlobalVars = /** @class */ (function () {
    function GameGlobalVars() {
    }
    GameGlobalVars.Initialize = function () {
        var _a, _b, _c, _d;
        var sysInfo = SystemEnvironmentVariables_1.default;
        var unityNamespace;
        var instanceId;
        var customEvents;
        if (sysInfo.isMiniGamePlugin) {
            sysInfo.pluginEnv.coverview = {
                Component: ImagePreviewer_1.ComponentManager,
                getPrivateThis: ImagePreviewer_1.getComponent,
                removePrivateThis: ImagePreviewer_1.deleteComponent,
                create: ImagePreviewer_1.parseNode,
                init: ImagePreviewer_1.initComponent,
                webviewLayout: CoverviewLayouts_1.webviewLayout,
                nativeviewLayout: CoverviewLayouts_1.nativeviewLayout,
                xmlParser: XMLParser_1.default,
            };
            var pluginEnv = sysInfo.pluginEnv;
            var customEnv = pluginEnv.customEnv;
            unityNamespace = customEnv.unityNamespace;
            customEvents = customEnv.events;
            instanceId = pluginEnv.instanceId || "";
        }
        else {
            unityNamespace = GameGlobal.unityNamespace;
            instanceId = "";
        }
        if (!sysInfo.enableOffline()) {
            unityNamespace.isCacheableFile = unityNamespace.isCacheableFile || (function (file) { return file.includes("StreamingAssets"); });
        }
        else {
            // By default, all files are cacheable in offline mode
            unityNamespace.isCacheableFile = sysInfo.isOfflineRequest ? sysInfo.isOfflineRequest : true;
        }
        var systemInfo = sysInfo.systemInfo;
        var accountInfo = sysInfo.accountInfo;
        var enableDebug = systemInfo.enableDebug;
        var systemVersion = systemInfo.version;
        var miniProgram = (accountInfo || {}).miniProgram;
        var envVersion = miniProgram.envVersion;
        var isRelease = envVersion === Utils_1.releaseStatus.RELEASE;
        var isDevelopment = envVersion === Utils_1.releaseStatus.DEVELOP;
        var isWkAndNewSDK = sysInfo.isWK && (0, Utils_1.compareVersions)(systemInfo.SDKVersion, "2.19.1") >= 0;
        var enableDebugLog = !!unityNamespace.enableDebugLog;
        var enableTraceLog = !!enableDebug || sysInfo.isDevtools;
        var logManager = ((_b = (_a = sysInfo.tjInstance).getLogManager) === null || _b === void 0 ? void 0 : _b.call(_a, {
            level: 1,
        })) || new LogUtils_1.DefaultLogManager();
        var realtimeLogManager = ((_d = (_c = sysInfo.tjInstance).getRealtimeLogManager) === null || _d === void 0 ? void 0 : _d.call(_c)) ||
            new LogUtils_1.DefaultLogManager();
        var userDataPath = sysInfo.tjInstance.env.USER_DATA_PATH;
        unityNamespace.eventLog = Utils_1.eventLog;
        unityNamespace.timeLog = Utils_1.timeLog;
        GameGlobalVars.tjInstance = sysInfo.tjInstance;
        GameGlobalVars.unityNamespace = unityNamespace;
        GameGlobalVars.bundleHashLength = unityNamespace.bundleHashLength || 32;
        GameGlobalVars.texturesHashLength = unityNamespace.texturesHashLength || 8;
        GameGlobalVars.texturesPath = unityNamespace.texturesPath || "Assets/Textures";
        GameGlobalVars.userDataPath = userDataPath;
        GameGlobalVars.gameFileCache = "".concat(userDataPath, "/__GAME_FILE_CACHE");
        GameGlobalVars.privateFolder = "ksfile://__ksprivate__";
        GameGlobalVars.logManager = logManager;
        GameGlobalVars.envVersion = envVersion;
        GameGlobalVars.isDevelopment = isDevelopment;
        GameGlobalVars.isRelease = isRelease;
        GameGlobalVars.enableTraceLog = enableTraceLog;
        GameGlobalVars.enableDebugLog = enableDebug;
        GameGlobalVars.customEvents = customEvents;
        GameGlobalVars.instanceId = instanceId;
        GameGlobalVars.isWkAndNewSDK = isWkAndNewSDK;
        GameGlobalVars.isAndroidNewVersion = sysInfo.isAndroid && (0, Utils_1.compareVersions)(systemVersion, "8.0.25") === 0;
        GameGlobalVars.realtimeLogManager = realtimeLogManager;
    };
    return GameGlobalVars;
}());
exports["default"] = GameGlobalVars;


/***/ }),

/***/ "./src/lib/GameLogic.ts":
/*!******************************!*\
  !*** ./src/lib/GameLogic.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.gameNetworkType = exports.GameStage = exports.GameVisible = void 0;
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var GameVisible = /** @class */ (function () {
    function GameVisible() {
    }
    GameVisible.SetVisible = function (visible) {
        GameVisible.visible = visible;
    };
    GameVisible.GetVisible = function () {
        return GameVisible.visible;
    };
    GameVisible.GetVisibleIntValue = function () {
        return GameVisible.visible ? 1 : 0;
    };
    GameVisible.visible = true;
    return GameVisible;
}());
exports.GameVisible = GameVisible;
var GameStage = /** @class */ (function () {
    function GameStage() {
    }
    GameStage.SetStage = function (stage) {
        if (GameStage.Validate(stage)) {
            GameStage.stage = Number(stage);
        }
    };
    GameStage.GetStage = function () {
        return GameStage.stage;
    };
    GameStage.Validate = function (stage) {
        var val = Number(stage);
        return (0, Utils_1.isInteger)(val) && !(val < 200) && !(val > 10000);
    };
    GameStage.stage = 0;
    return GameStage;
}());
exports.GameStage = GameStage;
var GameNetworkType = /** @class */ (function () {
    function GameNetworkType() {
        this.networkType = Types_1.NetworkTypes["4g"];
        this.init();
    }
    GameNetworkType.prototype.init = function () {
        var _this = this;
        (0, SystemUtils_1.reportEventLogger)(function (networkType) {
            _this.networkType = networkType;
        });
    };
    GameNetworkType.prototype.getNetworkType = function () {
        return this.networkType;
    };
    return GameNetworkType;
}());
var gameNetworkType = new GameNetworkType();
exports.gameNetworkType = gameNetworkType;


/***/ }),

/***/ "./src/lib/GameTransferReport.ts":
/*!***************************************!*\
  !*** ./src/lib/GameTransferReport.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Validation_1 = __webpack_require__(/*! ./Validation */ "./src/lib/Validation.ts");
// module 6835
var GameTransferReport = /** @class */ (function (_super) {
    __extends(GameTransferReport, _super);
    function GameTransferReport(options) {
        var _this = _super.call(this, options) || this;
        var reportFunc = options.reportFunc, logid = options.logid, _a = options.schemas, schemas = _a === void 0 ? {} : _a, _b = options.base, base = _b === void 0 ? {} : _b, _c = options.reportType, reportType = _c === void 0 ? Validation_1.ValidationTypes.SvrReport : _c, _d = options.asyncGetBase, asyncGetBase = _d === void 0 ? function () { return Promise.resolve({}); } : _d, _e = options.debug, debug = _e === void 0 ? false : _e, _f = options.namespace, namespace = _f === void 0 ? '' : _f, _g = options.skipValidateInProdEnv, skipValidateInProdEnv = _g === void 0 ? true : _g;
        _this.logid = logid;
        _this.schemas = schemas;
        _this.base = base;
        _this.reportType = reportType;
        _this.asyncGetBase = asyncGetBase;
        _this.debug = debug;
        _this.namespace = namespace;
        _this.skipValidateInProdEnv = skipValidateInProdEnv;
        _this.reportFunc = reportFunc;
        if (!reportFunc) {
            console.error("[minigamefe".concat(_this.namespace, "GameTransferReport]: \u672A\u4F20\u5165\u4E0A\u62A5\u51FD\u6570\u3002"));
        }
        return _this;
    }
    GameTransferReport.prototype.setKvStatBase = function (deviceInfo, miniProgramData) {
        if (this.reportType === Validation_1.ValidationTypes.KvStat) {
            var osDetails = (deviceInfo.system || '').split(' ');
            Object.assign(this.schemas, {
                DeviceModel: Validation_1.ValidationConstants.STRING,
                DeviceBrand: Validation_1.ValidationConstants.STRING,
                OsName: Validation_1.ValidationConstants.STRING,
                OsVersion: Validation_1.ValidationConstants.STRING,
                LanguageVersion: Validation_1.ValidationConstants.STRING,
                Count: Validation_1.ValidationConstants.UINT,
                AppId: Validation_1.ValidationConstants.STRING,
                AppVersion: Validation_1.ValidationConstants.UINT,
                AppState: Validation_1.ValidationConstants.UINT,
            });
            this.setBase({
                DeviceModel: deviceInfo.model || '',
                DeviceBrand: deviceInfo.brand || '',
                OsName: osDetails[0] || '',
                OsVersion: osDetails[1] || '',
                LanguageVersion: deviceInfo.language || '',
                Count: 1,
            });
            if (miniProgramData === null || miniProgramData === void 0 ? void 0 : miniProgramData.miniProgram) {
                this.setBase({
                    AppState: miniProgramData.miniProgram.envVersion || 'release',
                    AppId: miniProgramData.miniProgram.appId,
                    AppVersion: 0,
                });
            }
        }
    };
    GameTransferReport.prototype.send = function (eventData, callback) {
        var _this = this;
        if (this.reportFunc && typeof this.reportFunc === 'function') {
            var eventArray_1 = Array.isArray(eventData) ? eventData : [eventData];
            var eventLogs_1 = [];
            var logIdentifier_1 = this.logid;
            this.asyncGetBase().then(function (baseData) {
                _this.setBase(baseData);
                eventArray_1.forEach(function (event) {
                    var eventDataWithBase = __assign(__assign({}, _this.base), event);
                    if (eventDataWithBase.ExternInfo &&
                        typeof eventDataWithBase.ExternInfo === 'object' &&
                        _this.schemas.ExternInfo === Validation_1.ValidationConstants.STRING) {
                        eventDataWithBase.ExternInfo = encodeURIComponent(JSON.stringify(eventDataWithBase.ExternInfo));
                    }
                    _this.validate(eventDataWithBase);
                    if (_this.reportType === Validation_1.ValidationTypes.KvStat) {
                        var currentTimestamp = Math.floor(Date.now() / 1000);
                        Object.assign(eventDataWithBase, {
                            StartTime: currentTimestamp,
                            EndTime: currentTimestamp,
                        });
                    }
                    var logEntry = {
                        log_id: _this.logid,
                        custom_data: eventDataWithBase,
                    };
                    eventLogs_1.push(logEntry);
                    if (_this.debug) {
                        console.log("[minigamefe".concat(_this.namespace, "GameTransferReport]: ").concat(logIdentifier_1), eventDataWithBase);
                    }
                });
                var reportData = {
                    report_list: eventLogs_1,
                };
                _this.reportFunc({
                    req_path: 'comm_datareport',
                    json_data: JSON.stringify(reportData),
                    success: function () {
                        if (callback) {
                            callback(logIdentifier_1, JSON.stringify(reportData));
                        }
                    },
                    fail: function (error) {
                        console.error(error);
                        if (callback) {
                            callback(logIdentifier_1, _this.extractErrorMessage(error));
                        }
                    },
                });
            });
        }
        else {
            console.error('[minigamefe GameTransferReport]: 未传入上报函数!!!');
        }
    };
    GameTransferReport.prototype.extractErrorMessage = function (error) {
        return error.message || JSON.stringify(error);
    };
    return GameTransferReport;
}(Validation_1.Validate));
exports["default"] = GameTransferReport;


/***/ }),

/***/ "./src/lib/GameVideoManager.ts":
/*!*************************************!*\
  !*** ./src/lib/GameVideoManager.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var EventEmitter_1 = __webpack_require__(/*! ./EventEmitter */ "./src/lib/EventEmitter.ts");
var GameVideoManager = /** @class */ (function (_super) {
    __extends(GameVideoManager, _super);
    function GameVideoManager(newCodeSplitValue, __loadingIndicatorStyle) {
        var _this = _super.call(this) || this;
        _this.id = "";
        _this.ready = false;
        _this.lastSeenPlaybackTime = 0;
        _this.initializePlugin(newCodeSplitValue, __loadingIndicatorStyle);
        return _this;
    }
    GameVideoManager.prototype.initializePlugin = function (codeSplitEnabled, __loadingIndicatorStyle) {
        if (this instanceof GameVideoManager) {
            this.id = (0, Utils_1.generateRandomString)(10, true);
            this.GLctx = __loadingIndicatorStyle;
            var videoPluginCreator = void 0;
            var pluginEnv = GameVideoManager.pluginEnvironment.pop();
            var reportAction = GameVideoManager.reportActionHandler[this.id];
            if (pluginEnv) {
                GameVideoManager.reportActionHandler[this.id] = pluginEnv;
                reportAction.src = codeSplitEnabled;
            }
            else {
                var plugin = GameVideoManager.pluginEnvironment.env.pluginEnv;
                videoPluginCreator = plugin === null || plugin === void 0 ? void 0 : plugin.createWKVideo;
                if (videoPluginCreator) {
                    GameVideoManager.reportActionHandler[this.id] = videoPluginCreator.call(plugin);
                }
                GameVideoManager.setupVideoAttributes(this.id);
            }
            if (!reportAction) {
                console.error("创建失败，基础库不支持或尚未初始化完");
            }
        }
    };
    GameVideoManager.setupVideoAttributes = function (id) {
        var _this = this;
        var video = GameVideoManager.reportActionHandler[id];
        if (!video)
            return;
        video.style.display = "none";
        video.muted = true;
        video.setAttribute("muted", "");
        video.setAttribute("playsinline", "");
        video.crossOrigin = "anonymous";
        video.onseeked = function () { return _this.emitEvent(id, "seek"); };
        video.oncanplay = function () { return _this.emitEvent(id, "canplay"); };
        video.onerror = function (error) { return _this.handleError(id, error); };
        video.onended = function () { return _this.emitEvent(id, "ended"); };
    };
    GameVideoManager.emitEvent = function (id, event) {
        var video = GameVideoManager.reportActionHandler[id];
        if (video) {
            video.emit(event);
        }
    };
    GameVideoManager.handleError = function (id, error) {
        var _a, _b, _c;
        var video = GameVideoManager.reportActionHandler[id];
        if (typeof error === "string") {
            video === null || video === void 0 ? void 0 : video.emit("error", error);
        }
        else {
            video === null || video === void 0 ? void 0 : video.emit("error", (_c = (_b = (_a = error.target) === null || _a === void 0 ? void 0 : _a.error) === null || _b === void 0 ? void 0 : _b.code) !== null && _c !== void 0 ? _c : "");
        }
    };
    GameVideoManager.prototype.render = function () {
        var video = GameVideoManager.reportActionHandler[this.id];
        if (this.GLctx && video) {
            var colorFormat = this.GLctx.RGBA;
            var textureFormat = this.GLctx.RGBA;
            this.GLctx.texImage2D(this.GLctx.TEXTURE_2D, 0, colorFormat, textureFormat, this.GLctx.UNSIGNED_BYTE, video);
        }
    };
    GameVideoManager.prototype.seek = function (currentPlaybackTime) {
        this.lastSeenPlaybackTime = currentPlaybackTime;
        var video = GameVideoManager.reportActionHandler[this.id];
        if (video) {
            video.currentTime = currentPlaybackTime;
        }
    };
    GameVideoManager.prototype.play = function () {
        var video = GameVideoManager.reportActionHandler[this.id];
        if (!video) {
            return undefined;
        }
        return video.play();
    };
    GameVideoManager.prototype.pause = function () {
        var video = GameVideoManager.reportActionHandler[this.id];
        if (!video) {
            return undefined;
        }
        return video.pause();
    };
    Object.defineProperty(GameVideoManager.prototype, "isReady", {
        get: function () {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video && !this.ready && video.readyState >= video.HAVE_METADATA) {
                this.ready = true;
            }
            return this.ready;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "isPlaying", {
        get: function () {
            var video = GameVideoManager.reportActionHandler[this.id];
            return video ? !video.paused && !video.ended && this.isReady : false;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "videoWidth", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.videoWidth) !== null && _a !== void 0 ? _a : 0;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "videoHeight", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.videoHeight) !== null && _a !== void 0 ? _a : 0;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "duration", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.duration) !== null && _a !== void 0 ? _a : 0;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "seeking", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.seeking) !== null && _a !== void 0 ? _a : false;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "currentTime", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.currentTime) !== null && _a !== void 0 ? _a : 0;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "volume", {
        set: function (volumeValue) {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video) {
                video.volume = volumeValue;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "playbackRate", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.playbackRate) !== null && _a !== void 0 ? _a : 1;
        },
        set: function (playbackRate) {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video) {
                video.playbackRate = playbackRate;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "muted", {
        set: function (isMuted) {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video) {
                video.muted = isMuted;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "loop", {
        get: function () {
            var _a;
            var video = GameVideoManager.reportActionHandler[this.id];
            return (_a = video === null || video === void 0 ? void 0 : video.loop) !== null && _a !== void 0 ? _a : false;
        },
        set: function (value) {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video) {
                video.loop = value;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(GameVideoManager.prototype, "onended", {
        set: function (callbackFunction) {
            var video = GameVideoManager.reportActionHandler[this.id];
            if (video) {
                video.onended = callbackFunction !== null && callbackFunction !== void 0 ? callbackFunction : null;
            }
        },
        enumerable: false,
        configurable: true
    });
    GameVideoManager.prototype.destroy = function () {
        if (this.loopEndPollInterval) {
            clearInterval(this === null || this === void 0 ? void 0 : this.loopEndPollInterval);
        }
        delete this.onendedCallback;
        var video = GameVideoManager.reportActionHandler[this.id];
        if (video) {
            video.onended = null;
            video.onerror = null;
            video.oncanplay = null;
            video.onseeked = null;
            video.removeAttribute("src");
            video.load();
            GameVideoManager.pluginEnvironment.push(video);
        }
        GameVideoManager.reportActionHandler[this.id] = null;
    };
    GameVideoManager.pluginEnvironment = [];
    return GameVideoManager;
}(EventEmitter_1.EventEmitter));
exports["default"] = GameVideoManager;


/***/ }),

/***/ "./src/lib/GameWasmLoadReporter.ts":
/*!*****************************************!*\
  !*** ./src/lib/GameWasmLoadReporter.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.gameWasmLoadReporter = exports.GameWasmLoadReporter = exports.BaseUnityManagerBinder = void 0;
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var LogReport_1 = __importDefault(__webpack_require__(/*! ./LogReport */ "./src/lib/LogReport.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var BaseUnityManagerBinder = /** @class */ (function (_super) {
    __extends(BaseUnityManagerBinder, _super);
    function BaseUnityManagerBinder() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    BaseUnityManagerBinder.prototype.init = function (unityManager) {
        this.unityManager = unityManager;
        this.bindFunction();
    };
    BaseUnityManagerBinder.prototype.bindFunction = function () {
    };
    return BaseUnityManagerBinder;
}(Instance_1.default));
exports.BaseUnityManagerBinder = BaseUnityManagerBinder;
var GameWasmLoadReporter = /** @class */ (function (_super) {
    __extends(GameWasmLoadReporter, _super);
    function GameWasmLoadReporter() {
        return _super.call(this) || this;
    }
    GameWasmLoadReporter.prototype.beforeLoadSubWasm = function () {
        PluginMonitor_1.default.getInstance().wasmSplitMonitor.startLoadSubWasm();
        TimeLogManager_1.TimeLogManager.printRuntime("首次加载subwasm");
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.BEFORE_LOAD_SUB_WASM,
            CostTimeMs: 0,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
        if (!this.unityManager.mainCalled || TimeLogManager_1.TimeLogManager.timeEnd("游戏主场景耗时", false) < 100) {
            PluginLogger_1.default.eventLog("subwasm在callmain完成前加载");
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.LOAD_SUB_WASM_VERY_EARLY,
                CostTimeMs: 0,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            }));
        }
    };
    GameWasmLoadReporter.prototype.reportMissElem = function (elementData) {
        if (elementData === void 0) { elementData = {
            miss_elem_list: [],
            sub_version: 0,
        }; }
        var missingElementsList = elementData.miss_elem_list;
        var subVersion = elementData.sub_version;
        LogReport_1.default.network
            .gameTransfer({
            url: "gameksagwasmsplitwap_reportsplitmisselem",
            data: {
                device: SystemEnvironmentVariables_1.default.systemInfo.model,
                miss_elem_list: missingElementsList,
                meta_info: {
                    md5: GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5,
                    sub_version: Number(subVersion),
                },
            },
        })
            .then(function (result) {
            var msg = __spreadArray([], result, true)[0];
            PluginLogger_1.default.eventLog("reportsplitmisselem success ", msg);
        })
            .catch(function (error) {
            PluginLogger_1.default.pluginError("reportsplitmisselem fail ", error);
        });
    };
    GameWasmLoadReporter.prototype.reportCalledFuncs = function (eventData) {
        if (eventData === void 0) { eventData = {
            called_func_list: [],
            sub_version: 0,
            func_type: 0,
        }; }
        var calledFunctionList = eventData.called_func_list;
        var subVersion = eventData.sub_version;
        var funcType = eventData.func_type;
        LogReport_1.default.network
            .gameTransfer({
            url: "gameksagwasmsplitwap_reportsplitcalledfuncs",
            data: {
                device: SystemEnvironmentVariables_1.default.systemInfo.model,
                called_func_list: calledFunctionList,
                func_type: funcType,
                meta_info: {
                    md5: GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5,
                    sub_version: Number(subVersion),
                },
            },
        })
            .then(function (result) {
            var msg = __spreadArray([], result, true)[0];
            PluginLogger_1.default.eventLog("reportsplitcalledfuncs success ", msg);
        })
            .catch(function (error) {
            PluginLogger_1.default.pluginError("reportsplitcalledfuncs fail ", error);
        });
    };
    GameWasmLoadReporter.prototype.startFetchJsCode = function () {
        TimeLogManager_1.TimeLogManager.printRuntime("首次拉取js函数");
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.FETCH_JS,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
        if (!this.unityManager.mainCalled ||
            TimeLogManager_1.TimeLogManager.timeEnd("游戏主场景耗时", false) < 100) {
            PluginLogger_1.default.eventLog("在callmain完成前fetchjs");
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.LOAD_SUB_WASM_VERY_EARLY,
                CostTimeMs: 0,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            }));
        }
    };
    GameWasmLoadReporter.prototype.reportWaitTime = function (costTimeMs) {
        PluginLogger_1.default.eventLog("\u52A0\u8F7Dsubwasm\u65F6\uFF0Csignal wait\u65F6\u957F: ".concat(costTimeMs));
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.WAIT_SUB_WASM_END,
            CostTimeMs: costTimeMs,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
    };
    GameWasmLoadReporter.prototype.subWasmDownloaded = function (wasmInfo) {
        var costTime = wasmInfo.costTime;
        var runtime = wasmInfo.runtime;
        var fileSize = wasmInfo.fileSize;
        PluginMonitor_1.default.getInstance().wasmSplitMonitor.finishLoadSubWasm();
        PluginLogger_1.default.eventLog("subwasm下载耗时 ", costTime);
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.SUB_WASM_LOAD,
            CostTimeMs: costTime,
            RunTimeMs: runtime,
            ExternInfo: JSON.stringify({
                fileSize: fileSize,
            }),
        }));
    };
    GameWasmLoadReporter.prototype.subWasmDownloadError = function (error) {
        PluginLogger_1.default.pluginError("subwasm下载失败 ", error);
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.SUB_WASM_LOAD,
            ErrorMsg: "".concat(error.statusCode, "__").concat(error.errMsg),
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
    };
    GameWasmLoadReporter.prototype.subWasmCompiled = function (compilationDuration) {
        PluginLogger_1.default.eventLog("subwasm编译耗时 ", compilationDuration);
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.SUB_WASM_COMPILED,
            CostTimeMs: compilationDuration,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
    };
    GameWasmLoadReporter.prototype.reportMissFuncInPatch = function (index) {
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.MISS_PATCH_FUNC,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            ExternInfo: JSON.stringify({
                index: index,
            }),
        }));
    };
    GameWasmLoadReporter.prototype.bindFunction = function () {
        this.unityManager.reporter.wasmcode = {
            reportMissElem: this.reportMissElem.bind(this),
            reportCalledFuncs: this.reportCalledFuncs.bind(this),
            startFetchJsCode: this.startFetchJsCode.bind(this),
            reportWaitTime: this.reportWaitTime.bind(this),
            beforeLoadSubWasm: this.beforeLoadSubWasm.bind(this),
            subWasmDownloaded: this.subWasmDownloaded.bind(this),
            subWasmDownloadError: this.subWasmDownloadError.bind(this),
            subWasmCompiled: this.subWasmCompiled.bind(this),
        };
        Object.defineProperties(this.unityManager, {
            reportMissElem: {
                value: this.reportMissElem.bind(this),
            },
            reportCalledFuncs: {
                value: this.reportCalledFuncs.bind(this),
            },
            startFetchJsCode: {
                value: this.startFetchJsCode.bind(this),
            },
            reportWaitTime: {
                value: this.reportWaitTime.bind(this),
            },
            beforeLoadSubWasm: {
                value: this.beforeLoadSubWasm.bind(this),
            },
            subWasmDownloaded: {
                value: this.subWasmDownloaded.bind(this),
            },
            subWasmDownloadError: {
                value: this.subWasmDownloadError.bind(this),
            },
            subWasmCompiled: {
                value: this.subWasmCompiled.bind(this),
            },
        });
    };
    return GameWasmLoadReporter;
}(BaseUnityManagerBinder));
exports.GameWasmLoadReporter = GameWasmLoadReporter;
var gameWasmLoadReporter = GameWasmLoadReporter.getInstance();
exports.gameWasmLoadReporter = gameWasmLoadReporter;


/***/ }),

/***/ "./src/lib/GameWasmLoader.ts":
/*!***********************************!*\
  !*** ./src/lib/GameWasmLoader.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Events_1 = __webpack_require__(/*! ./Events */ "./src/lib/Events.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameWasmLoadReporter_1 = __webpack_require__(/*! ./GameWasmLoadReporter */ "./src/lib/GameWasmLoadReporter.ts");
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var GameWasmLoader = /** @class */ (function (_super) {
    __extends(GameWasmLoader, _super);
    function GameWasmLoader() {
        var _this = _super.call(this) || this;
        _this.subWasmModuleName = "wasmcode1";
        _this.retryCount = 1;
        _this.retryDuration = 1500;
        _this.pendingDuration = 60000;
        _this.unityModuleInited = false;
        _this.moduleName = "";
        _this.wasmPath = "";
        _this.filename = "";
        _this.md5 = "";
        return _this;
    }
    GameWasmLoader.prototype.invokeLoadWasmCode = function (retries) {
        return __awaiter(this, void 0, void 0, function () {
            var eventTrigger;
            var _this = this;
            return __generator(this, function (_a) {
                eventTrigger = Events_1.EventTrigger.getInstance();
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var isStopped = retries === 0;
                        var isWasmLoading = false;
                        var unityManager = _this.unityManager;
                        eventTrigger.triggerEvent(Types_1.GameEvents.WasmLoading, new Events_1.GameEventDetail(unityManager));
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_SUBPACKAGE, {
                            progress: 0,
                            status: Types_1.LaunchStageStatus.PENDING,
                        });
                        TimeLogManager_1.TimeLogManager.timeStart("下载wasm代码包");
                        PluginLogger_1.default.eventLog("开始下载wasm代码包");
                        SystemEnvironmentVariables_1.default.tjInstance
                            .loadSubpackage({
                            name: _this.moduleName,
                            success: function () { return __awaiter(_this, void 0, void 0, function () {
                                var shaderCount, costTimeMs, shaderCompilationMonitor, textureContext;
                                return __generator(this, function (_a) {
                                    switch (_a.label) {
                                        case 0:
                                            this.setWasmInfo();
                                            eventTrigger.triggerEvent(Types_1.GameEvents.WasmLoaded, new Events_1.GameEventDetail(unityManager));
                                            TimeLogManager_1.TimeLogManager.printTime("下载wasm代码包");
                                            unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_SUBPACKAGE, {
                                                progress: 100,
                                                status: Types_1.LaunchStageStatus.FULFILLED,
                                            });
                                            unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.LOAD_SUBPACKAGE, TimeLogManager_1.TimeLogManager.timeEnd("下载wasm代码包", false));
                                            if (!PluginMonitor_1.default.getInstance().enableMonitor) return [3 /*break*/, 2];
                                            PluginMonitor_1.default.getInstance().commonMonitor.recordWasm({
                                                duration: TimeLogManager_1.TimeLogManager.timeEnd("下载wasm代码包", false),
                                            });
                                            return [4 /*yield*/, FileSystemManager_1.default.getFileSize("".concat(this.wasmPath))];
                                        case 1:
                                            shaderCount = _a.sent();
                                            PluginMonitor_1.default.getInstance().commonMonitor.recordWasm({
                                                contentLength: shaderCount,
                                            });
                                            _a.label = 2;
                                        case 2:
                                            costTimeMs = TimeLogManager_1.TimeLogManager.timeEnd("下载wasm代码包");
                                            shaderCompilationMonitor = TimeLogManager_1.TimeLogManager.getRuntime();
                                            return [4 /*yield*/, FileSystemManager_1.default.getFileSize(this.wasmPath)];
                                        case 3:
                                            textureContext = _a.sent();
                                            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                                                ReportType: Types_1.GameLaunchStatus.LOAD_SUBPACKAGE,
                                                CostTimeMs: costTimeMs,
                                                RunTimeMs: shaderCompilationMonitor,
                                                ExternInfo: JSON.stringify({
                                                    fileSize: textureContext,
                                                }),
                                            }));
                                            setTimeout(function () {
                                                resolve();
                                            }, 0);
                                            isWasmLoading = true;
                                            unityManager.loadingCount -= 1;
                                            unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_SUBPACKAGE, {
                                                progress: 100,
                                                status: Types_1.LaunchStageStatus.FULFILLED,
                                            });
                                            return [2 /*return*/];
                                    }
                                });
                            }); },
                            fail: function (error) {
                                _this.handleDownloadError(error, isStopped);
                                reject(error);
                            },
                            complete: function () {
                            },
                        })
                            .onProgressUpdate(function (fileStats) {
                            var bytesWrittenInMB = (fileStats.totalBytesWritten / 1048576).toFixed(2);
                            var totalBytesExpectedToWriteInMB = (fileStats.totalBytesExpectedToWrite / 1048576).toFixed(2);
                            if (!GameGlobalVars_1.default.isRelease) {
                                PluginLogger_1.default.pluginLog("wasm代码包下载进度", fileStats.progress, bytesWrittenInMB, "MB;", totalBytesExpectedToWriteInMB, "MB");
                            }
                            unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.LOAD_SUBPACKAGE, {
                                progress: fileStats.progress * 100,
                            });
                        });
                        setTimeout(function () {
                            if (!isWasmLoading) {
                                if (isStopped) {
                                    _this.handleDownloadError(Types_1.ResourceDownloadError.Wasm, isStopped);
                                }
                                PluginLogger_1.default.pluginError(Types_1.ResourceDownloadError.Wasm);
                                reject(new Error(Types_1.ResourceDownloadError.Wasm));
                            }
                        }, _this.pendingDuration);
                    }).then(function () {
                        var unityManager = _this.unityManager;
                        if (unityManager.loadingPageType === Types_1.LoadingPageType.COVER_VIEW) {
                            unityManager.loadingPage.showCompileWasm();
                        }
                        unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.COMPILE_WASM, {
                            status: Types_1.LaunchStageStatus.PENDING,
                        });
                        PluginLogger_1.default.eventLog("start invoke UnityModule");
                        if (GameGlobalVars_1.default.unityNamespace.useDotnetRuntime) {
                            PluginLogger_1.default.eventLog("invoke UnityModule for dotnet");
                            unityManager.gameInstance.Module.preInit = [
                                function () {
                                    PluginLogger_1.default.eventLog("UnityModule preInit");
                                    _this.unityModuleInited = true;
                                    eventTrigger.triggerEvent(Types_1.GameEvents.ModulePrepared);
                                    DataPackageLoader_1.default.processRawData();
                                },
                            ];
                            GameGlobalVars_1.default.unityNamespace.UnityModule(unityManager.gameInstance.Module);
                        }
                        else {
                            PluginLogger_1.default.eventLog("invoke UnityModule for il2cpp");
                            GameGlobalVars_1.default.unityNamespace.UnityModule(unityManager.gameInstance.Module);
                            _this.unityModuleInited = true;
                            eventTrigger.triggerEvent(Types_1.GameEvents.ModulePrepared);
                            DataPackageLoader_1.default.processRawData();
                        }
                    })];
            });
        });
    };
    GameWasmLoader.prototype.init = function (unityManager) {
        this.unityManager = unityManager;
        this.initConfig();
    };
    GameWasmLoader.prototype.loadWasmCode = function () {
        var _this = this;
        return (0, Utils_1.executePromiseWithRetry)(function (retryCount) { return _this.invokeLoadWasmCode(retryCount); }, this.retryCount, this.retryDuration);
    };
    GameWasmLoader.prototype.parallelFetchSubWasm = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                PluginLogger_1.default.eventLog("loadSubPackage1");
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var gameWasmLoadReporter = GameWasmLoadReporter_1.GameWasmLoadReporter.getInstance();
                        gameWasmLoadReporter.beforeLoadSubWasm();
                        TimeLogManager_1.TimeLogManager.timeStart("subWasmLoad");
                        GameGlobalVars_1.default.unityNamespace._subWasmLoading = true;
                        var subWasmLoadProgress = SystemEnvironmentVariables_1.default.tjInstance.loadSubpackage({
                            name: _this.subWasmModuleName,
                            success: function () {
                                GameGlobalVars_1.default.unityNamespace._subWasmLoading = false;
                                GameGlobalVars_1.default.unityNamespace._subWasmLoaded = true;
                                console.log("[PLUGIN TIME LOG]下载小游戏分包1: ", TimeLogManager_1.TimeLogManager.timeEnd("subWasmLoad", false), "ms");
                                PluginLogger_1.default.eventLog("下载代码分包1完毕");
                                var subWasmLoadTime = TimeLogManager_1.TimeLogManager.timeEnd("subWasmLoad");
                                var runtimeValue = TimeLogManager_1.TimeLogManager.getRuntime();
                                FileSystemManager_1.default
                                    .getFileSize("".concat(_this.subWasmModuleName, "/").concat(_this.filename))
                                    .then(function (fileSize) {
                                    PluginLogger_1.default.eventLog("subwasm download size=".concat(fileSize));
                                    gameWasmLoadReporter.subWasmDownloaded({
                                        costTime: subWasmLoadTime,
                                        runtime: runtimeValue,
                                        fileSize: fileSize,
                                    });
                                });
                                resolve();
                            },
                            fail: function (error) {
                                GameGlobalVars_1.default.unityNamespace._subWasmLoading = false;
                                console.error("[PLUGIN SUBWASM ERROR]load subwasm subpackage fail: ", error);
                                gameWasmLoadReporter.subWasmDownloadError(error);
                                reject();
                            },
                            complete: function () {
                            },
                        });
                        var currentProgressValue = 0;
                        subWasmLoadProgress.onProgressUpdate(function (progressInfo) {
                            var progressValue = Math.floor(progressInfo.progress / 10);
                            if (progressValue !== currentProgressValue) {
                                var writtenBytesInMB = (progressInfo.totalBytesWritten / 1048576).toFixed(2);
                                var totalBytesExpectedToWriteMB = (progressInfo.totalBytesExpectedToWrite / 1048576).toFixed(2);
                                console.log("代码分包1下载进度", progressInfo.progress, writtenBytesInMB, "MB;", totalBytesExpectedToWriteMB, "MB");
                            }
                            currentProgressValue = progressValue;
                        });
                    })];
            });
        });
    };
    GameWasmLoader.prototype.setWasmInfo = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2 /*return*/, FileSystemManager_1.default.writeFile(this.filename, new ArrayBuffer(1))];
            });
        });
    };
    GameWasmLoader.prototype.initConfig = function () {
        var codeSplit = GameGlobalVars_1.default.isWkAndNewSDK && this.unityManager.codeType === Types_1.CodeType.codeSplit;
        var instantiateWasm = GameGlobalVars_1.default.unityNamespace.instantiateWasm;
        if (!instantiateWasm && codeSplit) {
            this.moduleName = "wasmcode_wk";
        }
        else {
            this.moduleName = "wasmcode";
        }
        this.md5 = GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5;
        this.filename = "".concat(this.md5, ".").concat(GameGlobalVars_1.default.unityNamespace.GAME_NAME, ".wasm.code.unityweb.wasm.br");
        this.wasmPath = "".concat(this.moduleName, "/").concat(this.filename);
        this.unityManager.gameInstance.Module.wasmPath = this.wasmPath;
    };
    GameWasmLoader.prototype.handleDownloadError = function (error, shouldPromptErrorDialog) {
        var errorMessage = error;
        if (typeof error != "number" && typeof error != "string") {
            errorMessage = error.errMsg || error.message;
        }
        PluginLogger_1.default.pluginError("下载wasm代码包失败", ": networkType=", GameLogic_1.gameNetworkType.getNetworkType(), ", isVisible=", GameLogic_1.GameVisible.GetVisible(), ", errMsg=", errorMessage, ", error=", error);
        (0, TimeLogManager_1.reportEndPerformance)("下载wasm代码包", Date.now(), errorMessage);
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.GameLaunchStatus.LOAD_SUBPACKAGE,
            ErrorMsg: errorMessage,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
        if (shouldPromptErrorDialog) {
            var canRestart_1 = !SystemEnvironmentVariables_1.default.isPC &&
                errorMessage === Types_1.ResourceDownloadError.Wasm &&
                !!SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram;
            PluginLogger_1.default.pluginError("wasm代码包下载最终失败");
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: DefaultLanguageMap_1.default.handleWASMDownloadError_title,
                confirmText: canRestart_1 ? DefaultLanguageMap_1.default.restartGame : DefaultLanguageMap_1.default.confirm,
                content: "".concat(errorMessage).concat(SystemEnvironmentVariables_1.default.isPC && errorMessage === Types_1.ResourceDownloadError.Wasm ? DefaultLanguageMap_1.default.restartGameContent : ""),
                showCancel: false,
                success: function () {
                    if (canRestart_1) {
                        SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram({});
                    }
                },
            });
        }
    };
    return GameWasmLoader;
}(Instance_1.default));
exports["default"] = GameWasmLoader;


/***/ }),

/***/ "./src/lib/HttpRequestTask.ts":
/*!************************************!*\
  !*** ./src/lib/HttpRequestTask.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var RequestStatus;
(function (RequestStatus) {
    RequestStatus[RequestStatus["Ok"] = 0] = "Ok";
    RequestStatus[RequestStatus["Fail"] = 1] = "Fail";
})(RequestStatus || (RequestStatus = {}));
var HttpRequestTask = /** @class */ (function () {
    function HttpRequestTask(task) {
        this.status = 0;
        this.init(task);
        this.triggerBeforeRequest();
    }
    HttpRequestTask.prototype.init = function (task) {
        this.info = {
            url: task.url,
            startTime: Date.now(),
        };
        this.taskId = task.taskId || (0, Utils_1.generateRandomString)(10, true);
    };
    HttpRequestTask.prototype.genResult = function () {
    };
    HttpRequestTask.prototype.requestSuccess = function (response, useWebRequest) {
        if (useWebRequest === void 0) { useWebRequest = false; }
        this.status = RequestStatus.Ok;
        if (useWebRequest) {
            this.xhrRequestSuccess(response);
        }
        else {
            this.ksRequestSuccess(response);
        }
        this.handleComplete();
        this.triggerAfterSuccess();
    };
    HttpRequestTask.prototype.requestFail = function (error) {
        this.status = RequestStatus.Fail;
        this.handleComplete();
        this.triggerAfterFail();
    };
    HttpRequestTask.prototype.triggerBeforeRequest = function () {
        var _a;
        (_a = this.beforeRequest) === null || _a === void 0 ? void 0 : _a.call(this, this);
    };
    HttpRequestTask.prototype.triggerAfterSuccess = function () {
        var _a;
        (_a = this.afterSuccess) === null || _a === void 0 ? void 0 : _a.call(this, this);
    };
    HttpRequestTask.prototype.triggerAfterFail = function () {
        var _a;
        (_a = this.afterFail) === null || _a === void 0 ? void 0 : _a.call(this, this);
    };
    HttpRequestTask.prototype.xhrRequestSuccess = function (response) {
        this.info.statusCode = response.status;
        if ((0, Utils_1.isSuccessfulHttpStatus)(this.info.statusCode)) {
            var request = response.originXhr || response;
            this.setProfile(request.profile);
            this.checkContentEncoding((0, Utils_1.getResponseHeaderValue)(request, "Content-Encoding"));
            this.checkCDNCache((0, Utils_1.getResponseHeaderValue)(request, "X-Cache-Lookup") || (0, Utils_1.getResponseHeaderValue)(request, "X-Cache"), (0, Utils_1.getResponseHeaderValue)(request, "Age"));
            this.setContentLength(response.response);
            this.info.cacheable = response.cacheable;
            this.info.isReadFromCache = !!response.isReadFromCache;
            this.info.isTexture = (0, Utils_1.isTextureURL)(this.info.url);
        }
    };
    HttpRequestTask.prototype.ksRequestSuccess = function (response) {
        this.info.statusCode = response.statusCode;
        if (this.info.statusCode === 200) {
            this.setProfile(response.profile);
            this.checkContentEncoding((0, Utils_1.getHeaderValue)(response.header, "Content-Encoding"));
            this.checkCDNCache((0, Utils_1.getHeaderValue)(response.header, "X-Cache-Lookup") ||
                (0, Utils_1.getHeaderValue)(response.header, "X-Cache"), (0, Utils_1.getHeaderValue)(response.header, "Age"));
            this.setContentLength(response.data);
        }
    };
    HttpRequestTask.prototype.checkContentEncoding = function (encoding) {
        if (encoding === void 0) { encoding = ""; }
        var normalizedEncodingValue = encoding.toLowerCase();
        this.info.enableContentEncoding = normalizedEncodingValue.includes("gzip") || normalizedEncodingValue.includes("br");
    };
    HttpRequestTask.prototype.checkCDNCache = function (cache, age) {
        if (cache === void 0) { cache = ""; }
        if (age === void 0) { age = ""; }
        var normalizedCdnCache = cache.toLowerCase();
        if (normalizedCdnCache) {
            this.info.hitCache = normalizedCdnCache.includes("hit");
        }
        else {
            this.info.hitCache = !!age && Number(age) > 0;
        }
    };
    HttpRequestTask.prototype.setProfile = function (info) {
        if (info) {
            this.info.receivedBytedCount = info.receivedBytedCount || 0;
            this.info.protocol = info.protocol;
            if (info.requestEnd && info.requestStart) {
                this.info.duration = info.requestEnd - info.requestStart;
                this.info.pendingDuration = info.requestStart - this.info.startTime;
            }
        }
    };
    HttpRequestTask.prototype.handleComplete = function () {
        this.info.endTime = Date.now();
        this.info.duration = this.info.duration || this.info.endTime - this.info.startTime;
        this.info.pendingDuration = this.info.pendingDuration || 0;
    };
    HttpRequestTask.prototype.setContentLength = function (content) {
        if (typeof content == "string") {
            this.info.receivedBytedCount = content.length;
        }
        else if (content.byteLength) {
            this.info.receivedBytedCount = content.byteLength;
        }
        else {
            var contentJsonString = JSON.stringify(content);
            this.info.receivedBytedCount = contentJsonString.length;
        }
    };
    return HttpRequestTask;
}());
exports["default"] = HttpRequestTask;


/***/ }),

/***/ "./src/lib/HttpTaskManager.ts":
/*!************************************!*\
  !*** ./src/lib/HttpTaskManager.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var HttpTaskManager = /** @class */ (function () {
    function HttpTaskManager() {
        this.httpTasks = new Map();
    }
    HttpTaskManager.prototype.isSameTask = function (taskComparison, comparisonTask) {
        return taskComparison.url === comparisonTask.url;
    };
    HttpTaskManager.prototype.hasTask = function (urlCheck) {
        return this.httpTasks.has(urlCheck.url);
    };
    HttpTaskManager.prototype.addTask = function (httpTask) {
        if (!this.hasTask(httpTask)) {
            this.httpTasks.set(httpTask.url, httpTask);
        }
    };
    HttpTaskManager.prototype.removeTask = function (task) {
        if (this.hasTask(task)) {
            this.httpTasks.delete(task.url);
        }
    };
    HttpTaskManager.prototype.getTaskByUrl = function (taskId) {
        if (taskId) {
            return this.httpTasks.get(taskId) || null;
        }
        else {
            return null;
        }
    };
    return HttpTaskManager;
}());
exports["default"] = HttpTaskManager;


/***/ }),

/***/ "./src/lib/InitializeUnityPlugin.ts":
/*!******************************************!*\
  !*** ./src/lib/InitializeUnityPlugin.ts ***!
  \******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./UnityManager */ "./src/lib/UnityManager.ts"));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Events_1 = __webpack_require__(/*! ./Events */ "./src/lib/Events.ts");
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var WebglRender_1 = __webpack_require__(/*! ./WebglRender */ "./src/lib/WebglRender.ts");
var GameWasmLoader_1 = __importDefault(__webpack_require__(/*! ./GameWasmLoader */ "./src/lib/GameWasmLoader.ts"));
var PreloadTaskManager_1 = __importDefault(__webpack_require__(/*! ./PreloadTaskManager */ "./src/lib/PreloadTaskManager.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var GameCanvas_1 = __importDefault(__webpack_require__(/*! ./GameCanvas */ "./src/lib/GameCanvas.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var InitializeUnityPlugin = /** @class */ (function (_super) {
    __extends(InitializeUnityPlugin, _super);
    function InitializeUnityPlugin(unityManagerInstance) {
        var _this = _super.call(this) || this;
        _this.unityFsInited = false;
        _this.runDependencies = 0;
        _this.denpendencyIds = [];
        _this.unityManager = unityManagerInstance;
        return _this;
    }
    InitializeUnityPlugin.prototype.onAbort = function (filePath) {
        var _a;
        var unityModule = this.gameInstance.Module;
        var a = "abort(".concat(filePath, ") at ").concat(((_a = (filePath == null ? undefined : filePath.stack)) === null || _a === void 0 ? void 0 : _a.toString) ? filePath.stack.toString() : unityModule.stackTrace());
        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: GameLogic_1.GameStage.GetStage() || Types_1.ReportType.ON_ABORT,
            ErrorMsg: "".concat(a).slice(0, 1024),
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            ExternInfo: JSON.stringify({ isAbort: true }),
        }));
        GameGlobalVars_1.default.logManager.warn(a);
    };
    InitializeUnityPlugin.prototype.wasmInstantiated = function () {
        var _this = this;
        var unityPluginDelegate;
        var eventTrigger = Events_1.EventTrigger.getInstance();
        eventTrigger.triggerEvent(Types_1.GameEvents.WasmInstantiated, new Events_1.GameEventDetail(this.unityManager));
        this.unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.COMPILE_WASM, { status: Types_1.LaunchStageStatus.FULFILLED });
        this.unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.PREPARE_GAME, { status: Types_1.LaunchStageStatus.PENDING });
        if (this.unityManager.loadingPageType === Types_1.LoadingPageType.COVER_VIEW) {
            this.unityManager.loadingPage.completeCompileAnimation();
        }
        TimeLogManager_1.TimeLogManager.printTime("wasm编译耗时");
        this.unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.COMPILE_WASM, TimeLogManager_1.TimeLogManager.timeEnd("wasm编译耗时", false));
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.GameLaunchStatus.COMPILE_WASM,
            CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("wasm编译耗时"),
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
        }));
        var index = UnityManager_1.default.getInstance();
        if (index && index.wasmInited && typeof index.wasmInited === "function") {
            index.wasmInited();
        }
        var gameFeatures = GameFeatures_1.GameFeatures.getInstance();
        if (this.unityManager.codeType === Types_1.CodeType.codeSplit && (GameGlobalVars_1.default.isAndroidNewVersion || gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.WasmSplit) !== Types_1.TransferStatus.open)) {
            this.gameInstance.Module.addRunDependency("subWasmInstantiated");
            if ((unityPluginDelegate = this.unityManager.parallelFetchSubWasmTask) !== null && unityPluginDelegate !== undefined) {
                unityPluginDelegate.then(function () {
                    if (GameGlobalVars_1.default.unityNamespace && GameGlobalVars_1.default.unityNamespace.compileSubWasm) {
                        var compiledWasmPromise = GameGlobalVars_1.default.unityNamespace.compileSubWasm.call(GameGlobalVars_1.default.unityNamespace);
                        if (compiledWasmPromise) {
                            compiledWasmPromise.then(function () {
                                _this.gameInstance.Module.removeRunDependency("subWasmInstantiated");
                            });
                        }
                    }
                });
            }
        }
    };
    InitializeUnityPlugin.prototype.calledMainCb = function () {
        var _this = this;
        var preloadTaskManager = PreloadTaskManager_1.default.getInstance();
        preloadTaskManager.setConcurrent(1);
        PluginMonitor_1.default.getInstance().preloadMonitor.genResultAfterCallmain();
        PluginMonitor_1.default.getInstance().showResultAfterDuration();
        this.unityManager.mainCalled = true;
        var eventTrigger = Events_1.EventTrigger.getInstance();
        eventTrigger.triggerEvent(Types_1.GameEvents.CalledMain, new Events_1.GameEventDetail(this.unityManager));
        TimeLogManager_1.TimeLogManager.printTime("callMain耗时");
        TimeLogManager_1.TimeLogManager.printRuntime("游戏启动耗时");
        TimeLogManager_1.TimeLogManager.timeStart("游戏主场景耗时");
        this.unityManager.triggerLaunchProgress(Types_1.GameLaunchStatus.PREPARE_GAME, TimeLogManager_1.TimeLogManager.timeEnd("callMain耗时", false));
        PluginMonitor_1.default.getInstance().commonMonitor.recordCallmain({
            duration: TimeLogManager_1.TimeLogManager.timeEnd("callMain耗时", false),
            launchTime: TimeLogManager_1.TimeLogManager.getRuntime(),
        });
        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.GameLaunchStatus.PREPARE_GAME,
            CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("callMain耗时"),
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            PreloadedSize: preloadTaskManager.loadedSize || 0,
        }));
        PluginLogger_1.default.pluginLog("callMain完成时已预载资源大小: ", preloadTaskManager.loadedSize);
        this.unityManager.launchStage.setProgress(Types_1.GameLaunchStatus.PREPARE_GAME, { status: Types_1.LaunchStageStatus.FULFILLED });
        if (this.unityManager.loadingPageType === Types_1.LoadingPageType.LONG_VIDEO) {
            this.unityManager.hideLoadingPage();
            if (GameGlobalVars_1.default.unityNamespace.Browser) {
                PluginLogger_1.default.pluginLog("是默认启动页，callMain完成开始游戏主循环");
                GameGlobalVars_1.default.unityNamespace.Browser.mainLoop.resume();
            }
        }
        else if (this.unityManager.loadingPageType === Types_1.LoadingPageType.INTERACTIVE_VIDEO) {
            PluginLogger_1.default.pluginLog("是可交互视频启动页，重新创建渲染器");
            WebglRender_1.WebglRenderManagerBase.getRenderer().refresh();
            if (GameGlobalVars_1.default.unityNamespace.isInteractiveEnd) {
                PluginLogger_1.default.pluginLog("callmain结束时已完成可交互阶段，直接显示游戏画面");
                this.unityManager.hideFinalPage();
            }
        }
        else if (this.unityManager.loadingPageType === Types_1.LoadingPageType.COVER_VIEW) {
            if (this.unityManager.hideAfterCallmain) {
                this.unityManager.hideLoadingPage();
            }
            if (GameGlobalVars_1.default.unityNamespace.Browser) {
                GameGlobalVars_1.default.unityNamespace.Browser.mainLoop.resume();
            }
        }
        DataPackageLoader_1.default.releaseDataPackage();
        if (!SystemEnvironmentVariables_1.default.isWK) {
            setTimeout(function () {
                var _compileSubWasmFunction;
                if ((_compileSubWasmFunction = GameGlobalVars_1.default.unityNamespace.compileSubWasm) !== null && _compileSubWasmFunction !== undefined) {
                    _compileSubWasmFunction.call(GameGlobalVars_1.default.unityNamespace);
                }
            }, 30000);
        }
        if (!GameGlobalVars_1.default.isRelease) {
            setTimeout(function () {
                if (!_this.unityManager.gameStarted) {
                    PluginLogger_1.default.pluginError("[开发阶段提示 不影响线上版本]请使用自定义上报能力 KS.ReportGameStart, 便于分析数据做启动优化。</url>");
                }
            }, 60000);
        }
    };
    InitializeUnityPlugin.prototype.unityFileSystemInit = function () {
        var unityModule = this.gameInstance.Module;
        if (!unityModule.indexedDB) {
            PluginLogger_1.default.pluginWarn("IndexedDB is not available. Data will not persist in cache and PlayerPrefs will not be saved.");
        }
        GameGlobalVars_1.default.unityNamespace.FS.mkdir("/idbfs");
        GameGlobalVars_1.default.unityNamespace.FS.mount(GameGlobalVars_1.default.unityNamespace.IDBFS, {}, "/idbfs");
        this.unityFsInited = true;
        if (unityModule.rawData) {
            unityModule.processRawData();
        }
    };
    InitializeUnityPlugin.prototype.printErr = function (httpResponseState) {
        var unityManager = this.unityManager;
        if (!unityManager.gameStarted && TimeLogManager_1.TimeLogManager.getRuntime() < 60000) {
            if (!(0, Utils_1.IsStillWaitingOnDependencies)(httpResponseState)) {
                ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                    ReportType: GameLogic_1.GameStage.GetStage() || UnityManager_1.default.getCurrentStage(true),
                    ErrorMsg: "".concat(httpResponseState).slice(0, 1024),
                    RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                    ExternInfo: JSON.stringify({
                        mainCalled: unityManager.mainCalled,
                    }),
                }));
            }
        }
        if (unityManager.onLogError) {
            var errorMessage = typeof httpResponseState == "string"
                ? httpResponseState
                : httpResponseState.message;
            unityManager.onLogError(errorMessage);
        }
        console.error(httpResponseState);
    };
    InitializeUnityPlugin.prototype.monitorRunDependencies = function (httpResponseHandler, loadingCount) {
        if (loadingCount) {
            if (httpResponseHandler < this.runDependencies) {
                this.denpendencyIds = this.denpendencyIds.filter(function (dependencyId) { return dependencyId !== loadingCount; });
            }
            else {
                this.denpendencyIds.push(loadingCount);
            }
        }
        this.runDependencies = httpResponseHandler;
        if (this.runDependencies === 0) {
            PluginLogger_1.default.eventLog("no dependencies, invoke run");
        }
    };
    InitializeUnityPlugin.prototype.init = function (unityManagerInstance) {
        this.unityManager = unityManagerInstance;
        this.initInstance();
        this.checkDependenciesRemoved();
    };
    InitializeUnityPlugin.prototype.checkDependenciesRemoved = function () {
        var context = this;
        setTimeout(function () {
            if (context.runDependencies !== 0) {
                PluginLogger_1.default.pluginError("still waiting runDependencies, ids=", context.denpendencyIds);
                ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                    ReportType: Types_1.ReportType.WaitingRemoveDependencies,
                    ExternInfo: JSON.stringify({
                        runDependencies: context.runDependencies,
                        denpendencyIds: context.denpendencyIds,
                    }),
                }));
            }
        }, 30000);
    };
    InitializeUnityPlugin.prototype.initInstance = function () {
        var _this = this;
        var gameCanvas = GameCanvas_1.default.getInstance();
        var gameWasmLoader = GameWasmLoader_1.default.getInstance();
        this.gameInstance = {
            onProgress: undefined,
            compatibilityCheck: undefined,
            Module: {
                IsTjHostGame: true,
                IsKsHostGame: true,
                preLoadDataPath: DataPackageLoader_1.default.downloadFilename,
                wasmPath: gameWasmLoader.wasmPath,
                graphicsAPI: ["WebGL 2.0", "WebGL 1.0"],
                instantiateWasm: GameGlobalVars_1.default.unityNamespace.instantiateWasm,
                onAbort: this.onAbort.bind(this),
                monitorRunDependencies: this.monitorRunDependencies.bind(this),
                wasmInstantiated: this.wasmInstantiated.bind(this),
                onRuntimeInitialized: function () {
                },
                calledMainCb: this.calledMainCb.bind(this),
                unityFileSystemInit: this.unityFileSystemInit.bind(this),
                tuanjieFileSystemInit: this.unityFileSystemInit.bind(this),
                processRawData: DataPackageLoader_1.default.processRawData,
                preRun: [],
                postRun: [],
                print: function (error) {
                    console.log(error);
                },
                printErr: this.printErr.bind(this),
                Jobs: {},
                canvas: gameCanvas.canvas,
                buildDownloadProgress: {},
                resolveBuildUrl: Utils_1.resolveStreamingURL,
                streamingAssetsUrl: function () {
                    return (0, Utils_1.resolveStreamingURL)("StreamingAssets");
                },
                pthreadMainPrefixURL: "Build/",
                webglContextAttributes: {
                    premultipliedAlpha: 1,
                    preserveDrawingBuffer: 1,
                },
                /** add legacy module props to avoid potential issues */
                arguments: [],
                thisProgram: "./this.program",
                quit: undefined,
                read: undefined,
                readAsync: undefined,
                readBinary: undefined,
                setWindowTitle: undefined,
                wasmBinary: undefined,
                noExitRuntime: undefined,
                INITIAL_MEMORY: undefined
            },
            SetFullscreen: function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                if (_this.gameInstance.Module.SetFullscreen) {
                    return _this.gameInstance.Module.SetFullscreen.apply(_this.gameInstance.Module, args);
                }
            },
            SendMessage: function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                if (_this.gameInstance.Module.SendMessage) {
                    return _this.gameInstance.Module.SendMessage.apply(_this.gameInstance.Module, args);
                }
            },
        };
        this.unityManager.gameInstance = this.gameInstance;
    };
    return InitializeUnityPlugin;
}(Instance_1.default));
exports["default"] = InitializeUnityPlugin;


/***/ }),

/***/ "./src/lib/Instance.ts":
/*!*****************************!*\
  !*** ./src/lib/Instance.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance = /** @class */ (function () {
    function Instance() {
    }
    Instance.getInstance = function () {
        if (!this.instance) {
            this.instance = new this();
        }
        return this.instance;
    };
    Instance.instance = null;
    return Instance;
}());
exports["default"] = Instance;


/***/ }),

/***/ "./src/lib/KeyValueReporter.ts":
/*!*************************************!*\
  !*** ./src/lib/KeyValueReporter.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Validation_1 = __webpack_require__(/*! ./Validation */ "./src/lib/Validation.ts");
var KeyValueReporter = /** @class */ (function (_super) {
    __extends(KeyValueReporter, _super);
    function KeyValueReporter(options) {
        var _this = _super.call(this, options) || this;
        var reportFunc = options.reportFunc, logid = options.logid, protocolParams = options.protocolParams, schemas = options.schemas, _a = options.base, base = _a === void 0 ? {} : _a, _b = options.asyncGetBase, asyncGetBase = _b === void 0 ? function () { return Promise.resolve({}); } : _b, _c = options.debug, debug = _c === void 0 ? false : _c, namespace = options.namespace, _d = options.skipValidateInProdEnv, skipValidateInProdEnv = _d === void 0 ? true : _d;
        var logIdentifierMap = {
            19283: 'GameComponent',
            19335: 'GameWhatsNew',
            20285: 'MidasFriendPayment',
            21494: 'KSGameWASMLaunchClose',
            21493: 'KSGameWASMLaunchException',
            21492: 'KSGameWASMLaunchTime',
            21898: 'GameLifeMiniGameCardAction',
            20267: 'GameAdsSkipCard',
        };
        _this.logid = typeof logid === 'number' && logIdentifierMap[logid] ? logIdentifierMap[logid] : logid;
        if (debug && typeof logid === 'number' && logIdentifierMap[logid]) {
            console.warn("[minigamefe".concat(namespace ? " ".concat(namespace, " ") : '', "KeyValueReporter]: logid ").concat(logid, " auto map to ").concat(_this.logid, "!"));
        }
        _this.schemas = schemas;
        _this.base = base;
        _this.reportFunc = reportFunc || (function () { });
        _this.protocolParams = protocolParams;
        _this.asyncGetBase = asyncGetBase;
        _this.debug = debug;
        _this.namespace = namespace || '';
        _this.skipValidateInProdEnv = skipValidateInProdEnv;
        if (!reportFunc) {
            console.error("[minigamefe".concat(_this.namespace, "KeyValueReporter]: \u672A\u4F20\u5165\u4E0A\u62A5\u51FD\u6570\u3002"));
        }
        return _this;
    }
    KeyValueReporter.prototype.setAppInfoBase = function (value) {
        Object.assign(this.schemas, {
            AppId: Validation_1.ValidationConstants.STRING,
            AppVersion: Validation_1.ValidationConstants.UINT,
            AppState: Validation_1.ValidationConstants.UINT,
        });
        this.protocolParams.unshift('AppId', 'AppVersion', 'AppState');
        this.setBase(value);
    };
    KeyValueReporter.prototype.send = function (inputValue, callback) {
        var _this = this;
        var inputValueArray = Array.isArray(inputValue) ? inputValue : [inputValue];
        this.asyncGetBase().then(function (baseValue) {
            _this.setBase(baseValue);
            inputValueArray.forEach(function (item) {
                var argumentValues = __assign(__assign({}, _this.base), item);
                _this.validate(argumentValues);
                var values = _this.protocolParams.map(function (param) { return argumentValues[param] || ''; });
                var encodedValues = values.map(encodeURIComponent).join(',');
                _this.reportFunc({
                    key: _this.logid,
                    value: encodedValues,
                    immediately: true,
                });
                if (callback || _this.sendCbk) {
                    (callback || _this.sendCbk)(_this.logid, encodedValues);
                }
                if (_this.debug) {
                    (argumentValues.IsError ? console.error : console.log)("[minigamefe".concat(_this.namespace, "keyValueReport]: ").concat(_this.logid), argumentValues);
                }
            });
        });
    };
    return KeyValueReporter;
}(Validation_1.Validate));
exports["default"] = KeyValueReporter;


/***/ }),

/***/ "./src/lib/LaunchStage.ts":
/*!********************************!*\
  !*** ./src/lib/LaunchStage.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
var WebglRender_1 = __webpack_require__(/*! ./WebglRender */ "./src/lib/WebglRender.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var LaunchStage = /** @class */ (function (_super) {
    __extends(LaunchStage, _super);
    function LaunchStage(useCoverView) {
        return _super.call(this, useCoverView) || this;
    }
    LaunchStage.prototype.setProgress = function (launchStatus, progress) {
        var _this = this;
        if (progress === void 0) { progress = {
            progress: 0,
            status: Types_1.LaunchStageStatus.DEFAULT,
        }; }
        var progressValue = progress.progress;
        var progressStatus = progress.status;
        var progressData = LaunchStage.launchProgress[launchStatus];
        this.updateStatus(progressData, progressStatus);
        this.updateProgress(progressData, progressValue || 0);
        if (!this.useCoverView) {
            var progressTitle = progressData.title;
            var currentStatus = progressData.status;
            var currentProgressValue = progressData.progress || 0;
            var fakeProgressValue_1 = progressData.fakeProgress;
            var previousStatus = progressData.previousStatus;
            var timer = progressData.timer;
            var isProgressKeyGreaterThanPrepareGame = launchStatus > Types_1.GameLaunchStatus.PREPARE_GAME;
            if (currentStatus === Types_1.LaunchStageStatus.FULFILLED && timer) {
                if (!isProgressKeyGreaterThanPrepareGame) {
                    this.renderProgress("".concat(progressTitle), { progress: 100 });
                }
                clearInterval(timer);
                progressData.timer = null;
            }
            if (!isProgressKeyGreaterThanPrepareGame &&
                !(previousStatus === null || previousStatus === void 0 ? void 0 : previousStatus.some(function (state) {
                    return LaunchStage.launchProgress[state].status !== Types_1.LaunchStageStatus.FULFILLED;
                }))) {
                if (fakeProgressValue_1 !== undefined && currentStatus !== Types_1.LaunchStageStatus.FULFILLED) {
                    this.renderProgress("".concat(progressTitle), {
                        progress: 0,
                    });
                    progressData.timer = setInterval(function () {
                        var currentProgressValue = fakeProgressValue_1 || 0;
                        var currentProgressTitle = progressData.title;
                        if (progressData.status !== Types_1.LaunchStageStatus.FULFILLED) {
                            var updatedProgressValue = currentProgressValue + 5 > 100 ? 100 : currentProgressValue + 5;
                            progressData.fakeProgress = updatedProgressValue;
                            var matchedResult = (currentProgressTitle.match(/(\.)+/g) || [""])[0].length;
                            var title = currentProgressTitle.includes(".") ? currentProgressTitle.replace(/(\.)+$/g, "...".substring(2 - matchedResult)) : "".concat(currentProgressTitle, ".");
                            progressData.title = title;
                            _this.renderProgress("".concat(title), {
                                progress: updatedProgressValue / 100,
                                originContent: currentProgressTitle.replace(/(\.)+$/g, ""),
                            });
                        }
                    }, 700);
                }
                else {
                    this.renderProgress("".concat(progressTitle, " ").concat(currentProgressValue ? "".concat(currentProgressValue.toFixed(2), "%") : ""), {
                        progress: currentProgressValue / 100,
                    });
                }
            }
        }
    };
    LaunchStage.prototype.updateStatus = function (statusUpdate, newStatus) {
        if (newStatus) {
            if (statusUpdate.status === Types_1.LaunchStageStatus.DEFAULT ||
                statusUpdate.status === Types_1.LaunchStageStatus.PENDING) {
                statusUpdate.status = newStatus;
            }
        }
    };
    LaunchStage.prototype.updateProgress = function (statusUpdate, progressValue) {
        if (progressValue && progressValue <= 100) {
            if (progressValue > 100) {
                statusUpdate.progress = 100;
            }
            else {
                statusUpdate.progress = Math.max(progressValue, 0);
            }
        }
    };
    LaunchStage.launchProgress = (_a = {},
        _a[Types_1.GameLaunchStatus.LOAD_SUBPACKAGE] = {
            stage: "LOAD_SUBPACKAGE",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: "分包下载中",
            progress: 0,
            previousStatus: [Types_1.GameLaunchStatus.LOAD_ASSETS],
            priority: 1,
        },
        _a[Types_1.GameLaunchStatus.LOAD_ASSETS] = {
            stage: "LOAD_ASSETS",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: DefaultLanguageMap_1.default.loadingPage_downloadingText,
            progress: 0,
            priority: 2,
        },
        _a[Types_1.GameLaunchStatus.UNZIP_ASSETS] = {
            stage: "UNZIP_ASSETS",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: "资源解析中",
            fakeProgress: 0,
            timer: null,
            previousStatus: [Types_1.GameLaunchStatus.LOAD_SUBPACKAGE],
            priority: 3,
        },
        _a[Types_1.GameLaunchStatus.READ_ASSETS] = {
            stage: "READ_ASSETS",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: DefaultLanguageMap_1.default.loadingPage_compilingText,
            fakeProgress: 0,
            timer: null,
            previousStatus: [Types_1.GameLaunchStatus.LOAD_SUBPACKAGE],
            priority: 4,
        },
        _a[Types_1.GameLaunchStatus.COMPILE_WASM] = {
            stage: "COMPILE_WASM",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: "资源编译中",
            fakeProgress: 0,
            timer: null,
            previousStatus: [Types_1.GameLaunchStatus.READ_ASSETS],
            priority: 5,
        },
        _a[Types_1.GameLaunchStatus.PREPARE_GAME] = {
            stage: "PREPARE_GAME",
            status: Types_1.LaunchStageStatus.DEFAULT,
            title: DefaultLanguageMap_1.default.loadingPage_completeText,
            fakeProgress: 0,
            timer: null,
            previousStatus: [Types_1.GameLaunchStatus.COMPILE_WASM, Types_1.GameLaunchStatus.READ_ASSETS],
            priority: 6,
        },
        _a);
    return LaunchStage;
}(WebglRender_1.WebglRenderManager));
exports["default"] = LaunchStage;


/***/ }),

/***/ "./src/lib/LoadingPageLongVideo.ts":
/*!*****************************************!*\
  !*** ./src/lib/LoadingPageLongVideo.ts ***!
  \*****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var LoadingPageLongVideo = /** @class */ (function () {
    function LoadingPageLongVideo(video) {
        this.loadingPageType = Types_1.LoadingPageType.LONG_VIDEO;
        this.inited = false;
        this.visible = false;
        this.playing = false;
        this.loadingVideo = null;
        if (!this.inited) {
            this.init(video);
        }
    }
    LoadingPageLongVideo.prototype.showLoadingPage = function () {
        var _this = this;
        return new Promise(function (resolve) {
            if (_this.loadingVideo && !_this.visible) {
                _this.visible = true;
                _this.loadingVideo.width = SystemEnvironmentVariables_1.default.systemInfo.screenWidth;
                _this.loadingVideo.height = SystemEnvironmentVariables_1.default.systemInfo.screenHeight;
                _this.loadingVideo.x = 0;
                _this.loadingVideo.y = 0;
                _this.loadingVideo.play();
                _this.loadingVideo.onplay(function () {
                    _this.playing = true;
                });
                resolve();
            }
            else {
                resolve();
            }
        });
    };
    LoadingPageLongVideo.prototype.hideLoadingPage = function () {
        if (this.loadingVideo && this.visible) {
            this.playing = false;
            this.visible = false;
            this.loadingVideo.pause();
            this.loadingVideo.destroy();
            this.loadingVideo = null;
        }
    };
    LoadingPageLongVideo.prototype.init = function (video) {
        this.inited = true;
        if (video.src) {
            this.loadingVideo = SystemEnvironmentVariables_1.default.tjInstance.createVideo({
                width: 1,
                height: 1,
                x: -1,
                y: -1,
                src: video.src,
                controls: false,
                showProgress: false,
                showProgressInControlMode: false,
                autoplay: false,
                loop: true,
                enableProgressGesture: false,
                showCenterPlayBtn: false,
                underGameView: true,
                objectFit: "cover",
            });
        }
    };
    return LoadingPageLongVideo;
}());
exports["default"] = LoadingPageLongVideo;


/***/ }),

/***/ "./src/lib/LoadingPageView.ts":
/*!************************************!*\
  !*** ./src/lib/LoadingPageView.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./UnityManager */ "./src/lib/UnityManager.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var ParseXmlContent_1 = __importDefault(__webpack_require__(/*! ./ParseXmlContent */ "./src/lib/ParseXmlContent.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var ImagePreviewer_1 = __webpack_require__(/*! ../coverview/ImagePreviewer */ "./src/coverview/ImagePreviewer.ts");
var EmptyClass_1 = __importDefault(__webpack_require__(/*! ./EmptyClass */ "./src/lib/EmptyClass.ts"));
var calculateResponsiveStyles = function (httpError, interactiveResult, __fileSize) {
    var responsiveStyles = {};
    var percentageProperties = ["width", "right", "left"];
    var propertiesToCheck = [
        "width",
        "height",
        "top",
        "right",
        "bottom",
        "left",
        "backgroundColor",
        "color",
        "padding",
        "fontSize",
        "lineHeight",
    ];
    propertiesToCheck.forEach(function (property) {
        var httpErrorValue = httpError[property];
        if (httpErrorValue !== undefined && httpErrorValue !== null) {
            if (typeof httpErrorValue === "string" && httpErrorValue.includes("%")) {
                var percentage = parseFloat(httpErrorValue.replace("%", "")) / 100;
                if (percentageProperties.includes(property)) {
                    httpErrorValue = interactiveResult * percentage;
                }
                else {
                    httpErrorValue = __fileSize * percentage;
                }
            }
            responsiveStyles[property] = httpErrorValue;
        }
    });
    return responsiveStyles;
};
function filterLoadingCountChildren(loadingCountValue, handlePreloadList) {
    loadingCountValue.children = loadingCountValue.children.filter(function (child) {
        return child.attributes.id !== handlePreloadList;
    });
}
var isMiniGamePlugin = SystemEnvironmentVariables_1.default.isMiniGamePlugin;
var LoadingPageView = /** @class */ (function (_super) {
    __extends(LoadingPageView, _super);
    function LoadingPageView(property) {
        var _a, _b, _c;
        var _this = _super.call(this) || this;
        _this.loadingOuterInfo = {};
        _this.loadingInnerInfo = {};
        _this.backgroundImageInfo = {};
        _this.useBackgroundImage = false;
        _this.completed = false;
        _this.iconConfig = {};
        _this.extensionButton = [];
        _this.trueInnerImageWidth = 0;
        _this.xmlString = "";
        _this.totalLaunchTime = (_a = property.totalLaunchTime) !== null && _a !== void 0 ? _a : 15000;
        _this.needDownload = property.needDownload;
        _this.hideAfterCallmain = (_b = property.hideAfterCallmain) !== null && _b !== void 0 ? _b : false;
        _this.textConfig = property.textConfig;
        _this.barConfig = property.barConfig;
        _this.materialConfig = property.materialConfig;
        _this.iconConfig = property.iconConfig || {};
        _this.designWidth = property.designWidth;
        _this.designHeight = property.designHeight;
        _this.scaleMode = property.scaleMode;
        _this.extensionButton = property.extensionButton || [];
        _this.visible = (_c = property.visible) !== null && _c !== void 0 ? _c : true;
        _this.scaleX = 1;
        _this.scaleY = 1;
        var screenWidth = SystemEnvironmentVariables_1.default.systemInfo.screenWidth;
        var screenHeight = SystemEnvironmentVariables_1.default.systemInfo.screenHeight;
        var portrait = screenWidth < screenHeight;
        _this.isDefaultLoading = !_this.designWidth;
        if (_this.isDefaultLoading) {
            _this.designWidth = screenWidth;
            _this.designHeight = screenHeight;
        }
        else {
            var designWidthBasedOnLoadingProperties = portrait ? 375 : 667;
            var designHeightBasedOnLoadingProperties = portrait ? 667 : 375;
            _this.designWidth = _this.designWidth || designWidthBasedOnLoadingProperties;
            _this.designHeight = _this.designHeight || designHeightBasedOnLoadingProperties;
        }
        _this.scaleMode = _this.scaleMode || (portrait ? Types_1.ScaleMode.FIXED_WIDTH : Types_1.ScaleMode.FIXED_HEIGHT);
        if (!(0, ImagePreviewer_1.getComponent)(_this)) {
            (0, ImagePreviewer_1.setComponent)(_this);
        }
        var imageViewer = (0, ImagePreviewer_1.getComponent)(_this);
        imageViewer.isLoaded = false;
        imageViewer.isShowed = false;
        imageViewer.loadPromise = _this.loadImagePromise.bind(_this);
        imageViewer.onProgress = function () {
            if (imageViewer.bgImg) {
                imageViewer.bgImg.style.hidden = true;
            }
            if (imageViewer.video) {
                imageViewer.video.offProgress(imageViewer.onProgress);
            }
        };
        // this.load().then(() => {
        //     imageViewer.isLoaded = true;
        //     if (imageViewer.video) {
        //         imageViewer.video.onProgress(imageViewer.onProgress);
        //     }
        // });
        _this.loadingPageElement = {
            body: {
                position: "relative",
                overflow: "hidden",
                hidden: false,
                opacity: 1,
                width: screenWidth,
                height: screenHeight,
            },
            video: {
                position: "absolute",
                top: 0,
                left: 0,
                width: screenWidth,
                height: screenHeight,
            },
            container: {
                position: "absolute",
                overflow: "hidden",
                hidden: false,
                top: 0,
                left: 0,
                backgroundColor: "#ffffff",
            },
            bgImg: {
                position: "absolute",
                top: 0,
                left: 0,
                width: screenWidth,
                height: screenHeight,
            },
            loadingWrap: {
                position: "absolute",
                overflow: "hidden",
                textAlign: "center",
                width: 240,
                height: 24,
                borderRadius: 12,
                backgroundColor: "#000000",
                opacity: 0.5,
                bottom: 64,
                left: (screenWidth - 240) / 2,
            },
            loadingInnerWrap: {
                position: "absolute",
                overflow: "hidden",
                width: 236,
                height: 20,
                bottom: 66,
                borderRadius: 10,
                left: (screenWidth - 240) / 2 + 2,
            },
            loadingInner: {
                position: "absolute",
                overflow: "hidden",
                width: 236,
                height: 20,
                borderRadius: 10,
                backgroundColor: "#07c160",
                top: 0,
                left: -236,
            },
            loadingInnerFake: {
                position: "absolute",
                overflow: "hidden",
                width: 236,
                height: 20,
                borderRadius: 10,
                backgroundColor: "#07c160",
                top: 0,
                left: -236,
            },
            loadingInnerSecond: {
                position: "absolute",
                overflow: "hidden",
                width: 236,
                height: 20,
                borderRadius: 10,
                backgroundColor: "#07c160",
                top: 0,
                left: -236,
            },
            loadingText: {
                position: "absolute",
                textAlign: "center",
                color: "#ffffff",
                letterSpacing: 1,
                fontSize: 12,
                width: 240,
                height: 20,
                lineHeight: 20,
            },
            unityLogo: {
                position: "absolute",
                width: 64,
                height: 24,
                bottom: 20,
                left: (screenWidth - 64) / 2,
            },
        };
        return _this;
    }
    LoadingPageView.prototype.loadImagePromise = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a, screenWidth, screenHeight, parsedClassInstance_1, ratioOfParsedToClassInstance_1, coverViewInitDuration_1, runtimeDuration_1, error_1, error_2;
            var _this = this;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0:
                        console.log('loadingPageView loadPromise entry');
                        _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight;
                        TimeLogManager_1.TimeLogManager.timeStart('loadImage');
                        _b.label = 1;
                    case 1:
                        _b.trys.push([1, 6, , 7]);
                        // Calculate layout dimensions and scaling
                        this.stageSize = this.calculateStageSize(this.scaleMode, screenWidth, screenHeight, this.designWidth, this.designHeight);
                        this.offsetX = (screenWidth - this.stageSize.displayWidth) / 2;
                        this.offsetY = (screenHeight - this.stageSize.displayHeight) / 2;
                        this.displayWidth = this.stageSize.displayWidth;
                        this.displayHeight = this.stageSize.displayHeight;
                        this.scaleX = this.stageSize.scaleX;
                        this.scaleY = this.stageSize.scaleY;
                        // Process responsive styles
                        this.barComputedStyle = calculateResponsiveStyles(this.barConfig.style, this.designWidth, this.designHeight);
                        this.textComputedStyle = calculateResponsiveStyles(this.textConfig.style, this.designWidth, this.designHeight);
                        // Update extension buttons with responsive styles and unique IDs
                        if (this.extensionButton) {
                            this.extensionButton = this.extensionButton
                                .filter(function (button) { return !!button.style; })
                                .map(function (button) { return (__assign(__assign({}, button), { id: "extension".concat((0, Utils_1.generateRandomString)(10, true)), style: calculateResponsiveStyles(button.style, _this.designWidth, _this.designHeight) })); });
                        }
                        parsedClassInstance_1 = TimeLogManager_1.TimeLogManager.timeEnd('loadImage');
                        ratioOfParsedToClassInstance_1 = TimeLogManager_1.TimeLogManager.getRuntime();
                        PluginLogger_1.default.eventLog('[coverview-loadImage] cost=', parsedClassInstance_1);
                        // Initialize cover view
                        TimeLogManager_1.TimeLogManager.timeStart('coverviewInit');
                        _b.label = 2;
                    case 2:
                        _b.trys.push([2, 4, , 5]);
                        return [4 /*yield*/, ParseXmlContent_1.default.call(this)];
                    case 3:
                        _b.sent();
                        coverViewInitDuration_1 = TimeLogManager_1.TimeLogManager.timeEnd('coverviewInit');
                        runtimeDuration_1 = TimeLogManager_1.TimeLogManager.getRuntime();
                        PluginLogger_1.default.eventLog('[coverview-init] cost=', coverViewInitDuration_1);
                        UnityManager_1.default.getInstance().initReporter().then(function () {
                            ReportInitializer_1.default.gameReporter.send([
                                new Utils_1.ObjectClassWrapper({
                                    ReportType: Types_1.GameLaunchStatus.LOAD_BACKGROUND_IMAGE,
                                    CostTimeMs: parsedClassInstance_1,
                                    RunTimeMs: ratioOfParsedToClassInstance_1,
                                    ExternInfo: JSON.stringify({
                                        height: _this.backgroundImageInfo.height,
                                        width: _this.backgroundImageInfo.width,
                                    }),
                                }),
                                new Utils_1.ObjectClassWrapper({
                                    ReportType: Types_1.GameLaunchStatus.COVER_VIEW_INIT,
                                    CostTimeMs: coverViewInitDuration_1,
                                    RunTimeMs: runtimeDuration_1,
                                }),
                            ]);
                        });
                        return [3 /*break*/, 5];
                    case 4:
                        error_1 = _b.sent();
                        PluginLogger_1.default.pluginError('[coverview-init]', error_1);
                        UnityManager_1.default.getInstance().initReporter().then(function () {
                            var _coverViewInitDuration = TimeLogManager_1.TimeLogManager.timeEnd('coverviewInit');
                            var __runtimeDuration = TimeLogManager_1.TimeLogManager.getRuntime();
                            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.COVER_VIEW_INIT,
                                CostTimeMs: _coverViewInitDuration,
                                RunTimeMs: __runtimeDuration,
                                ErrorMsg: error_1.errMsg || error_1.message,
                            }));
                        });
                        return [3 /*break*/, 5];
                    case 5:
                        ;
                        return [3 /*break*/, 7];
                    case 6:
                        error_2 = _b.sent();
                        // Handle loadImage errors
                        PluginLogger_1.default.pluginError('[loadImagePromise]', error_2);
                        return [3 /*break*/, 7];
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.calculateStageSize = function (scaleMode, screenWidth, screenHeight, designWidth, designHeight) {
        var parsedRootElement = screenWidth;
        var attributeValue = screenHeight;
        var _classInstance = designWidth;
        var __parseRootElement = designHeight;
        var ratioOfParsedRootElementToClassInstance = parsedRootElement / _classInstance || 0;
        var ratioOfAttributeValueToParsedRootElement = attributeValue / __parseRootElement || 0;
        switch (scaleMode) {
            case Types_1.ScaleMode.EXACT_FIT:
                break;
            case Types_1.ScaleMode.FIXED_HEIGHT:
                _classInstance = Math.round(parsedRootElement / ratioOfAttributeValueToParsedRootElement);
                ratioOfParsedRootElementToClassInstance = ratioOfAttributeValueToParsedRootElement;
                break;
            case Types_1.ScaleMode.FIXED_WIDTH:
                __parseRootElement = Math.round(attributeValue / ratioOfParsedRootElementToClassInstance);
                ratioOfAttributeValueToParsedRootElement = ratioOfParsedRootElementToClassInstance;
                break;
            case Types_1.ScaleMode.NO_BORDER:
                if (ratioOfParsedRootElementToClassInstance > ratioOfAttributeValueToParsedRootElement) {
                    attributeValue = Math.round(__parseRootElement * ratioOfParsedRootElementToClassInstance);
                    ratioOfAttributeValueToParsedRootElement = ratioOfParsedRootElementToClassInstance;
                }
                else {
                    parsedRootElement = Math.round(_classInstance * ratioOfAttributeValueToParsedRootElement);
                    ratioOfParsedRootElementToClassInstance = ratioOfAttributeValueToParsedRootElement;
                }
                break;
            case Types_1.ScaleMode.SHOW_ALL:
                if (ratioOfParsedRootElementToClassInstance > ratioOfAttributeValueToParsedRootElement) {
                    parsedRootElement = Math.round(_classInstance * ratioOfAttributeValueToParsedRootElement);
                    ratioOfParsedRootElementToClassInstance = ratioOfAttributeValueToParsedRootElement;
                }
                else {
                    attributeValue = Math.round(__parseRootElement * ratioOfParsedRootElementToClassInstance);
                    ratioOfAttributeValueToParsedRootElement = ratioOfParsedRootElementToClassInstance;
                }
                break;
            case Types_1.ScaleMode.FIXED_NARROW:
                if (ratioOfParsedRootElementToClassInstance > ratioOfAttributeValueToParsedRootElement) {
                    _classInstance = Math.round(parsedRootElement / ratioOfAttributeValueToParsedRootElement);
                    ratioOfParsedRootElementToClassInstance = ratioOfAttributeValueToParsedRootElement;
                }
                else {
                    __parseRootElement = Math.round(attributeValue / ratioOfParsedRootElementToClassInstance);
                    ratioOfAttributeValueToParsedRootElement = ratioOfParsedRootElementToClassInstance;
                }
                break;
            case Types_1.ScaleMode.FIXED_WIDE:
                if (ratioOfParsedRootElementToClassInstance > ratioOfAttributeValueToParsedRootElement) {
                    __parseRootElement = Math.round(attributeValue / ratioOfParsedRootElementToClassInstance);
                    ratioOfAttributeValueToParsedRootElement = ratioOfParsedRootElementToClassInstance;
                }
                else {
                    _classInstance = Math.round(parsedRootElement / ratioOfAttributeValueToParsedRootElement);
                    ratioOfParsedRootElementToClassInstance = ratioOfAttributeValueToParsedRootElement;
                }
                break;
            default:
                _classInstance = parsedRootElement;
                __parseRootElement = attributeValue;
        }
        return {
            displayWidth: parsedRootElement,
            displayHeight: attributeValue,
            stageWidth: _classInstance,
            stageHeight: __parseRootElement,
            scaleX: ratioOfParsedRootElementToClassInstance,
            scaleY: ratioOfAttributeValueToParsedRootElement,
        };
    };
    LoadingPageView.prototype.load = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
                        if (!!imagePreviewer.isLoaded) return [3 /*break*/, 2];
                        imagePreviewer.isLoaded = true;
                        return [4 /*yield*/, imagePreviewer.loadPromise()];
                    case 1: return [2 /*return*/, _a.sent()];
                    case 2: return [2 /*return*/, Promise.resolve()];
                }
            });
        });
    };
    LoadingPageView.prototype.resume = function () {
        return __awaiter(this, void 0, void 0, function () {
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.load()];
                    case 1:
                        _b.sent();
                        this.show();
                        _a = this.latestStage;
                        switch (_a) {
                            case Types_1.GamePluginStage.Downloading: return [3 /*break*/, 2];
                            case Types_1.GamePluginStage.CompileWasm: return [3 /*break*/, 4];
                            case Types_1.GamePluginStage.PrepareGame: return [3 /*break*/, 6];
                        }
                        return [3 /*break*/, 8];
                    case 2: return [4 /*yield*/, this.startDownloadAnimation()];
                    case 3:
                        _b.sent();
                        return [3 /*break*/, 8];
                    case 4: return [4 /*yield*/, this.showCompileWasm()];
                    case 5:
                        _b.sent();
                        return [3 /*break*/, 8];
                    case 6: return [4 /*yield*/, this.startCompileAnimation()];
                    case 7:
                        _b.sent();
                        return [3 /*break*/, 8];
                    case 8: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.destory = function () {
        var coverview = SystemEnvironmentVariables_1.default.pluginEnv.coverview;
        var webviewLayout = coverview === null || coverview === void 0 ? void 0 : coverview.webviewLayout;
        var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
        imagePreviewer.body.animate({
            opacity: 0,
            duration: 300,
        }).then(function () {
            webviewLayout.remove(imagePreviewer.body);
        });
    };
    LoadingPageView.prototype.renderVideo = function () {
        var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
        if (this.visible && imagePreviewer.video) {
            imagePreviewer.video.muted = false;
            imagePreviewer.video.play();
            setTimeout(function () {
                imagePreviewer.video.play();
            }, 250);
        }
    };
    LoadingPageView.prototype.show = function () {
        var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
        if (this.visible) {
            imagePreviewer.body.style.hidden = false;
            if (this.materialConfig.backgroundVideo) {
                this.renderVideo();
            }
        }
    };
    LoadingPageView.prototype.hide = function () {
        var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
        imagePreviewer.body.style.hidden = true;
    };
    LoadingPageView.prototype.showCompileWasm = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.latestStage = Types_1.GamePluginStage.CompileWasm;
                        if (!this.visible) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.load()];
                    case 1:
                        _a.sent();
                        this.setLoadingText(this.textConfig.compilingText);
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.setLoadingText = function (httpResponse) {
        if (this.visible) {
            var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
            if (this.visible) {
                imagePreviewer.loadingText.value = httpResponse;
            }
        }
    };
    LoadingPageView.prototype.loopText = function (taskCompleteEvent, _currentIndex, imagePreviewIndex) {
        var _this = this;
        if (_currentIndex === void 0) { _currentIndex = 0; }
        var imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
        if (!imagePreviewer[imagePreviewIndex] && taskCompleteEvent) {
            var r = taskCompleteEvent[_currentIndex];
            if (this.needDownload && this.textConfig.firstStartText) {
                r += "(".concat(this.textConfig.firstStartText, ")");
            }
            this.setLoadingText(r || '正在加载资源');
            this.loopTextTimer = setTimeout(function () {
                if (!imagePreviewer[imagePreviewIndex]) {
                    var nextIndex = _currentIndex + 1 >= taskCompleteEvent.length ? 0 : _currentIndex + 1;
                    _this.loopText(taskCompleteEvent, nextIndex, imagePreviewIndex);
                }
            }, this.textConfig.textDuration);
        }
    };
    LoadingPageView.prototype.startDownloadAnimation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.latestStage = Types_1.GamePluginStage.Downloading;
                        if (!this.visible) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.load()];
                    case 1:
                        _a.sent();
                        imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
                        this.loopText(this.textConfig.downloadingText, 0, 'downloaded');
                        return [4 /*yield*/, imagePreviewer.loadingInner.nextLayout()];
                    case 2:
                        _a.sent();
                        imagePreviewer.loadingInner.animate({
                            left: this.trueInnerImageWidth * -0.3,
                            duration: this.totalLaunchTime * 0.7,
                        });
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.completeDownloadAnimation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.visible) return [3 /*break*/, 3];
                        return [4 /*yield*/, this.load()];
                    case 1:
                        _a.sent();
                        imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
                        imagePreviewer.downloaded = true;
                        return [4 /*yield*/, imagePreviewer.loadingInnerFake.nextLayout()];
                    case 2:
                        _a.sent();
                        imagePreviewer.loadingInnerFake.animate({
                            left: this.trueInnerImageWidth * -0.3,
                            duration: this.needDownload ? 300 : 200,
                        });
                        _a.label = 3;
                    case 3: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.startCompileAnimation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer_1;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.latestStage = Types_1.GamePluginStage.PrepareGame;
                        if (!this.visible) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.load()];
                    case 1:
                        _a.sent();
                        imagePreviewer_1 = (0, ImagePreviewer_1.getComponent)(this);
                        imagePreviewer_1.loadingInnerSecond.style.left = this.trueInnerImageWidth * -0.3;
                        imagePreviewer_1.loadingInnerSecond.nextLayout().then(function () {
                            _this.setLoadingText(_this.textConfig.initText);
                            imagePreviewer_1.loadingInnerSecond.animate({
                                left: _this.trueInnerImageWidth * -0.1,
                                duration: _this.totalLaunchTime * 0.9,
                            });
                        });
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.completeCompileAnimation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer;
            return __generator(this, function (_a) {
                if (this.visible) {
                    imagePreviewer = (0, ImagePreviewer_1.getComponent)(this);
                    if (!imagePreviewer.downloaded) {
                        if (this.loopTextTimer) {
                            clearTimeout(this.loopTextTimer);
                            this.loopTextTimer = null;
                        }
                        this.loopText(this.textConfig.downloadingText, 0, 'downloaded');
                    }
                }
                return [2 /*return*/];
            });
        });
    };
    LoadingPageView.prototype.completeCallmainAnimation = function () {
        return __awaiter(this, void 0, void 0, function () {
            var imagePreviewer_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!this.visible) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.load()];
                    case 1:
                        _a.sent();
                        imagePreviewer_2 = (0, ImagePreviewer_1.getComponent)(this);
                        this.setLoadingText(this.textConfig.completeText);
                        if (this.hideAfterCallmain) {
                            imagePreviewer_2.loadingInnerFake.nextLayout().then(function () {
                                imagePreviewer_2.loadingInnerFake.style.left = 0;
                            });
                        }
                        else {
                            imagePreviewer_2.loadingInnerFake.nextLayout().then(function () {
                                imagePreviewer_2.compiled = true;
                                imagePreviewer_2.loadingInnerFake.animate({
                                    left: 0,
                                    duration: 300,
                                }).then();
                            });
                        }
                        _a.label = 2;
                    case 2: return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.complete = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (this.completed) {
                            return [2 /*return*/];
                        }
                        this.completed = true;
                        return [4 /*yield*/, this.completeCallmainAnimation()];
                    case 1:
                        _a.sent();
                        this.destory();
                        return [2 /*return*/];
                }
            });
        });
    };
    LoadingPageView.prototype.parseXML = function (xmlString) {
        this.xmlString = xmlString.trim().replace(/<!--[\s\S]*?-->/g, '');
        return {
            declaration: this.parseXmlDeclaration(),
            root: this.parseRootElement() || { name: "root", attributes: {}, children: [] },
        };
    };
    LoadingPageView.prototype.parseXmlDeclaration = function () {
        if (this.findAndProcessMatch(/^<\?xml\s*/)) {
            var parsedAttributes = {};
            while (!this.hasNoPendingLoadingCount() && !this.isLoadingFileInitiated("?>")) {
                var htmlAttribute = this.extractHtmlAttribute();
                if (!htmlAttribute) {
                    return { attributes: parsedAttributes };
                }
                parsedAttributes[htmlAttribute.name] = htmlAttribute.value;
            }
            this.findAndProcessMatch(/\?>\s*/);
            return { attributes: parsedAttributes };
        }
        return { attributes: {} };
    };
    LoadingPageView.prototype.parseRootElement = function () {
        var matchRootElementTag = this.findAndProcessMatch(/^<([\w-:.]+)\s*/);
        if (matchRootElementTag) {
            var parsedElement = {
                name: matchRootElementTag[1],
                attributes: {},
                children: [],
            };
            while (!this.hasNoPendingLoadingCount() &&
                !this.isLoadingFileInitiated(">") &&
                !this.isLoadingFileInitiated("/>")) {
                var htmlAttribute = this.extractHtmlAttribute();
                if (!htmlAttribute) {
                    return parsedElement;
                }
                parsedElement.attributes[htmlAttribute.name] = htmlAttribute.value;
            }
            if (this.findAndProcessMatch(/^\s*\/>\s*/)) {
                return parsedElement;
            }
            this.findAndProcessMatch(/\?>\s*/);
            parsedElement.content = this.extractPlainTextFromContent();
            var nestedElement = void 0;
            while ((nestedElement = this.parseRootElement())) {
                parsedElement.children.push(nestedElement);
            }
            this.findAndProcessMatch(/^<\/[\w-:.]+>\s*/);
            return parsedElement;
        }
        return null;
    };
    LoadingPageView.prototype.extractHtmlAttribute = function () {
        var htmlAttributeMatch = this.findAndProcessMatch(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);
        if (htmlAttributeMatch) {
            var value = htmlAttributeMatch[2].replace(/^['"]|['"]$/g, "");
            return { name: htmlAttributeMatch[1], value: value };
        }
        return null;
    };
    LoadingPageView.prototype.findAndProcessMatch = function (regexPattern) {
        var result = this.xmlString.match(regexPattern);
        if (result) {
            this.xmlString = this.xmlString.slice(result[0].length);
            return result;
        }
        return null;
    };
    LoadingPageView.prototype.hasNoPendingLoadingCount = function () {
        return this.xmlString.length === 0;
    };
    LoadingPageView.prototype.isLoadingFileInitiated = function (loadedFileSize) {
        return this.xmlString.indexOf(loadedFileSize) === 0;
    };
    LoadingPageView.prototype.extractPlainTextFromContent = function () {
        var extractedPlainText = this.findAndProcessMatch(/^([^<]*)/);
        return extractedPlainText ? extractedPlainText[1] : "";
    };
    Object.defineProperty(LoadingPageView.prototype, "isVisible", {
        get: function () {
            return this.visible;
        },
        set: function (value) {
            this.visible = value;
            if (value) {
                this.resume().then();
            }
            else {
                this.hide();
            }
        },
        enumerable: false,
        configurable: true
    });
    return LoadingPageView;
}((isMiniGamePlugin ? ImagePreviewer_1.ComponentManager : EmptyClass_1.default)));
exports["default"] = LoadingPageView;


/***/ }),

/***/ "./src/lib/LoadingViewerController.ts":
/*!********************************************!*\
  !*** ./src/lib/LoadingViewerController.ts ***!
  \********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var LogReporter_1 = __importDefault(__webpack_require__(/*! ./LogReporter */ "./src/lib/LogReporter.ts"));
var ProgressManager_1 = __importDefault(__webpack_require__(/*! ./ProgressManager */ "./src/lib/ProgressManager.ts"));
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
var SessionRecorder_1 = __webpack_require__(/*! ./SessionRecorder */ "./src/lib/SessionRecorder.ts");
var ViewElementCreator_1 = __webpack_require__(/*! ./ViewElementCreator */ "./src/lib/ViewElementCreator.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var LoadingViewerController = /** @class */ (function (_super) {
    __extends(LoadingViewerController, _super);
    function LoadingViewerController() {
        var _this = _super.call(this) || this;
        _this.viewer = null;
        _this.logger = null;
        _this.director = null;
        _this.isRunning = false;
        _this.configInfo = {
            playPath: "",
            decompress: "br",
            progressStyle: {},
            useCustomProgress: false,
        };
        _this.levels = [];
        _this.progressAnimationStatus = {
            running: false,
            toStop: false,
            callback: null,
        };
        _this.customProgressValue = 0;
        _this.wasmReady = false;
        _this.pushMsgQueue = [];
        if (GameGlobalVars_1.default.customEvents) {
            _this.director = new OperaPlayerHandler_1.OperaPlayerHandler(ProgressManager_1.default);
            GameGlobalVars_1.default.customEvents.emit(Types_1.GameLaunchStatusDetail.launchOperaInit, _this);
            if (_this.configInfo.playPath) {
                _this.init();
            }
            else {
                _this.destroy();
            }
            GameGlobalVars_1.default.customEvents.on(Types_1.GameLaunchStatusDetail.compileWasm, function () {
                _this.levels.push(Types_1.GameLaunchStatusDetail.compileWasm);
                _this.refreshProgress();
            });
            GameGlobalVars_1.default.customEvents.on(Types_1.GameLaunchStatusDetail.readAssets, function () {
                _this.levels.push(Types_1.GameLaunchStatusDetail.readAssets);
                _this.refreshProgress();
            });
            GameGlobalVars_1.default.customEvents.on(Types_1.GameLaunchStatusDetail.prepareGame, function () {
                while (_this.levels.length < 3) {
                    _this.levels.push(Types_1.GameLaunchStatusDetail.prepareGame);
                }
                _this.refreshProgress();
            });
            GameGlobalVars_1.default.customEvents.on(Types_1.GameLaunchStatusDetail.launchOperaMsgBridgeFromWasm, function (currentContext) {
                return _this.parseWasmMsg(currentContext);
            });
            _this.refreshProgress();
        }
        return _this;
    }
    Object.defineProperty(LoadingViewerController.prototype, "used", {
        get: function () {
            return !!this.configInfo.playPath;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(LoadingViewerController.prototype, "running", {
        // Getter and Setter for `running`
        get: function () {
            return this.isRunning;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(LoadingViewerController.prototype, "config", {
        // Getter and Setter for `config`
        get: function () {
            return this.configInfo;
        },
        set: function (eventConfig) {
            Object.assign(this.configInfo, eventConfig);
        },
        enumerable: false,
        configurable: true
    });
    // Method for handling director events
    LoadingViewerController.prototype.onEnd = function (event) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.onEnd(event);
    };
    LoadingViewerController.prototype.onErr = function (error) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.onErr(error);
    };
    LoadingViewerController.prototype.offErr = function (error) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.offErr(error);
    };
    LoadingViewerController.prototype.end = function () {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.end();
    };
    LoadingViewerController.prototype.setGlobalVar = function (globalVariableKey, globalValue) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.setGlobalVar(globalVariableKey, globalValue);
    };
    LoadingViewerController.prototype.getGlobalVar = function (globalVariableName) {
        var _a, _b;
        return (_b = (_a = this.director) === null || _a === void 0 ? void 0 : _a.getGlobalVar(globalVariableName)) !== null && _b !== void 0 ? _b : null;
    };
    LoadingViewerController.prototype.onGlobalVarChange = function (globalVariable, event) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.onGlobalVarChange(globalVariable, event);
    };
    LoadingViewerController.prototype.offGlobalVarChange = function (globalVarChangeEvent, callbackFunction) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.offGlobalVarChange(globalVarChangeEvent, callbackFunction);
    };
    LoadingViewerController.prototype.onWeakNetwork = function (networkEvent) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.onWeakNetwork(networkEvent);
    };
    LoadingViewerController.prototype.offWeakNetwork = function (event) {
        var _a;
        return (_a = this.director) === null || _a === void 0 ? void 0 : _a.offWeakNetwork(event);
    };
    LoadingViewerController.prototype.isPlayStoryLine = function (isValidValue) {
        return !!isValidValue;
    };
    LoadingViewerController.prototype.setAudioMute = function (isAudioMuted) {
        var _a;
        var pluginEnv = SystemEnvironmentVariables_1.default.pluginEnv;
        var ksWasmSdk = (_a = pluginEnv === null || pluginEnv === void 0 ? void 0 : pluginEnv.customEnv) === null || _a === void 0 ? void 0 : _a.KSWASMSDK;
        if (ksWasmSdk === null || ksWasmSdk === void 0 ? void 0 : ksWasmSdk.KSSetAudioMute) {
            ksWasmSdk.KSSetAudioMute(isAudioMuted);
        }
    };
    Object.defineProperty(LoadingViewerController.prototype, "customProgress", {
        set: function (progressValue) {
            if (this.configInfo.useCustomProgress) {
                this.customProgressValue = Math.min(Math.max(progressValue, 0), 1);
                if (this.levels.length === 3) {
                    this.setPercentage(70 + this.customProgressValue * 30);
                }
            }
        },
        enumerable: false,
        configurable: true
    });
    LoadingViewerController.prototype.refreshProgress = function () {
        var _this = this;
        if (this.isRunning) {
            if (this.levels.length === 0) {
                this.progressToValueWithAnimation(1, 1)
                    .then(function () {
                    _this.progressCacheAnimation(11);
                })
                    .catch(function () {
                });
            }
            if (this.levels.length === 1) {
                if (this.levels[0] === Types_1.GameLaunchStatusDetail.compileWasm) {
                    this.progressToValueWithAnimation(15, 400)
                        .then(function () {
                        _this.progressCacheAnimation(25);
                    })
                        .catch(function () {
                    });
                    return;
                }
                if (this.levels[0] === Types_1.GameLaunchStatusDetail.readAssets) {
                    this.progressToValueWithAnimation(25, 400)
                        .then(function () {
                        _this.progressCacheAnimation(35);
                    })
                        .catch(function () {
                    });
                    return;
                }
            }
            if (this.levels.length === 2) {
                if (this.levels[1] === Types_1.GameLaunchStatusDetail.compileWasm) {
                    this.progressToValueWithAnimation(50, 400)
                        .then(function () {
                        _this.progressCacheAnimation(60);
                    })
                        .catch(function () {
                    });
                    return;
                }
                if (this.levels[1] === Types_1.GameLaunchStatusDetail.readAssets) {
                    this.progressToValueWithAnimation(35, 400)
                        .then(function () {
                        _this.progressCacheAnimation(45);
                    })
                        .catch(function () {
                    });
                    return;
                }
            }
            if (this.levels.length === 3) {
                this.progressToValueWithAnimation(70, 400)
                    .then(function () {
                    if (_this.configInfo.useCustomProgress) {
                        _this.customProgress = _this.customProgressValue;
                    }
                    else {
                        _this.progressToValueWithAnimation(100, 800)
                            .then(function () {
                        })
                            .catch(function () {
                        });
                    }
                })
                    .catch(function () {
                });
            }
        }
    };
    LoadingViewerController.prototype.cancelProgressAnimation = function () {
        var _this = this;
        return new Promise(function (resolve) {
            if (_this.progressAnimationStatus.running) {
                _this.progressAnimationStatus.toStop = true;
                _this.progressAnimationStatus.callback = function () {
                    resolve(true);
                };
            }
            else {
                resolve(true);
            }
        });
    };
    LoadingViewerController.prototype.progressToValueWithAnimation = function (progressValue, progressStep) {
        return __awaiter(this, void 0, void 0, function () {
            var currentProgress, stepsToComplete, stepProgressIncrement, currentProgressStep;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        currentProgress = this.getPercentage();
                        if (progressValue < currentProgress) {
                            return [2 /*return*/, true];
                        }
                        return [4 /*yield*/, this.cancelProgressAnimation()];
                    case 1:
                        _a.sent();
                        this.progressAnimationStatus.running = true;
                        this.progressAnimationStatus.toStop = false;
                        stepsToComplete = Math.floor(progressStep / 25);
                        stepProgressIncrement = (progressValue - currentProgress) / stepsToComplete;
                        currentProgressStep = 0;
                        _a.label = 2;
                    case 2:
                        if (!(currentProgressStep < stepsToComplete && !this.progressAnimationStatus.toStop)) return [3 /*break*/, 4];
                        this.setPercentage(currentProgress + currentProgressStep * stepProgressIncrement);
                        return [4 /*yield*/, this.delay(25)];
                    case 3:
                        _a.sent();
                        currentProgressStep++;
                        return [3 /*break*/, 2];
                    case 4:
                        this.progressAnimationStatus.running = false;
                        if (this.progressAnimationStatus.callback) {
                            this.progressAnimationStatus.callback();
                            this.progressAnimationStatus.callback = null;
                        }
                        return [2 /*return*/, false];
                }
            });
        });
    };
    LoadingViewerController.prototype.delay = function (delayInMilliseconds) {
        return new Promise(function (resolve) {
            setTimeout(function () {
                resolve();
            }, delayInMilliseconds);
        });
    };
    LoadingViewerController.prototype.progressCacheAnimation = function (event) {
        this.progressToValueWithAnimation(event, 3000).then(function () {
        });
    };
    LoadingViewerController.prototype.setPercentage = function (percentageValue) {
        var _a;
        if ((_a = this.director) === null || _a === void 0 ? void 0 : _a.progress) {
            this.director.progress.percentage = percentageValue;
        }
    };
    LoadingViewerController.prototype.getPercentage = function () {
        var _a, _b, _c;
        return (_c = (_b = (_a = this.director) === null || _a === void 0 ? void 0 : _a.progress) === null || _b === void 0 ? void 0 : _b.percentage) !== null && _c !== void 0 ? _c : 0;
    };
    LoadingViewerController.prototype.pushMsg = function (callbackFunction, args) {
        if (this.wasmReady) {
            GameGlobalVars_1.default.customEvents.emit(Types_1.GameLaunchStatusDetail.launchOperaPushMsgToWasm, callbackFunction, args);
        }
        else {
            this.pushMsgQueue.push({ callback: callbackFunction, args: args });
        }
    };
    LoadingViewerController.prototype.parseWasmMsg = function (jsonData) {
        var parsedJsonData = JSON.parse(jsonData);
        if (parsedJsonData.function) {
            switch (parsedJsonData.function) {
                case "KSLaunchOperaReady":
                    this.wasmReady = true;
                    this.pushMsgQueue.forEach(function (msg) {
                        GameGlobalVars_1.default.customEvents.emit(Types_1.GameLaunchStatusDetail.launchOperaPushMsgToWasm, msg.callback, msg.args);
                    });
                    this.pushMsgQueue = [];
                    return this.responseWasmMsg("ok");
                case "getRunning":
                    return this.responseWasmMsg(this.running);
                case "setPercentage":
                    this.customProgress = parsedJsonData.args[0];
                    return this.responseWasmMsg(null);
                case "end":
                    return this.responseWasmMsg(this.end());
                case "setGlobalVar":
                    return this.responseWasmMsg(this.setGlobalVar(parsedJsonData.args[0], parsedJsonData.args[1]));
                case "getGlobalVar":
                    return this.responseWasmMsg(this.getGlobalVar(parsedJsonData.args[0]));
                case "isPlayStoryLine":
                    return this.responseWasmMsg(this.isPlayStoryLine(parsedJsonData.args[0]));
                default:
                    return undefined;
            }
        }
    };
    LoadingViewerController.prototype.responseWasmMsg = function (responseData) {
        if (responseData !== undefined) {
            return JSON.stringify({ response: responseData });
        }
    };
    LoadingViewerController.prototype.destroy = function () {
        this.director = null;
        this.viewer = null;
        this.logger = null;
    };
    LoadingViewerController.prototype.init = function () {
        return __awaiter(this, void 0, void 0, function () {
            var fileSystemManager, fileData, compressedData, error_1;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 3, , 4]);
                        fileSystemManager = SystemEnvironmentVariables_1.default.tjInstance.getFileSystemManager();
                        fileSystemManager.accessSync(this.configInfo.playPath);
                        fileData = void 0;
                        if (!this.configInfo.decompress || this.configInfo.decompress === "br") {
                            fileData = fileSystemManager.readFileSync(this.configInfo.playPath, "utf-8").toString();
                        }
                        else {
                            compressedData = FileSystemManager_1.default.readCompressedFileSync(this.configInfo.playPath);
                            fileData = SystemEnvironmentVariables_1.default.tjInstance.decode({ data: compressedData, format: "utf-8" });
                        }
                        this.viewer = new ViewElementCreator_1.ViewerElementsCreator();
                        this.logger = new SessionRecorder_1.SessionRecorder();
                        if (!this.director) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.director.init(this.viewer, fileData, {
                                report: new LogReporter_1.default(),
                                logger: this.logger,
                            })];
                    case 1:
                        _a.sent();
                        if (this.director) {
                            this.director.progress.style = this.configInfo.progressStyle;
                            this.isRunning = true;
                            this.setAudioMute(true);
                            this.director.play();
                        }
                        _a.label = 2;
                    case 2:
                        if (this.director) {
                            this.director.onEnd(function () {
                                _this.pushMsg("onEnd");
                                _this.isRunning = false;
                                _this.setAudioMute(false);
                                _this.destroy();
                            });
                            this.director.onErr(function (wasmFunctionParameters) {
                                _this.pushMsg("onErr", wasmFunctionParameters);
                            });
                        }
                        return [3 /*break*/, 4];
                    case 3:
                        error_1 = _a.sent();
                        console.error("[Launch Opera]: An error occurred reading compressed file ".concat(this.configInfo.playPath), error_1);
                        this.destroy();
                        return [3 /*break*/, 4];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    return LoadingViewerController;
}(Instance_1.default));
exports["default"] = LoadingViewerController;


/***/ }),

/***/ "./src/lib/LogReport.ts":
/*!******************************!*\
  !*** ./src/lib/LogReport.ts ***!
  \******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Validation_1 = __webpack_require__(/*! ./Validation */ "./src/lib/Validation.ts");
var EventListener_1 = __importDefault(__webpack_require__(/*! ./EventListener */ "./src/lib/EventListener.ts"));
var GameTransferReport_1 = __importDefault(__webpack_require__(/*! ./GameTransferReport */ "./src/lib/GameTransferReport.ts"));
var KeyValueReporter_1 = __importDefault(__webpack_require__(/*! ./KeyValueReporter */ "./src/lib/KeyValueReporter.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var FELibVersion = "1.1.60";
var RequestRejectType;
(function (RequestRejectType) {
    RequestRejectType["GAMETRANSFER_IS_NOT_EXIST"] = "gameTransfer is not exist";
    RequestRejectType["REQUEST_IS_NOT_EXIST"] = "request is not exist";
    RequestRejectType["UPLOADFILE_IS_NOT_EXIST"] = "uploadFile is not exist";
    RequestRejectType["LOGIN_IS_NOT_EXIST"] = "login is not exist";
    RequestRejectType["URL_IS_EMPTY"] = "request url is empty.";
    RequestRejectType["HEADER_INVALID"] = "request header is invalid";
    RequestRejectType["METHOD_IS_NOT_EXIST"] = "method is not exist";
})(RequestRejectType || (RequestRejectType = {}));
;
var LogConstants = {
    QualityReportType: Types_1.QualityReportType,
    RequestRejectType: RequestRejectType,
    ReportType: Types_1.SystemInfo,
    PluginReportType: Types_1.BackgroundModeEvent,
};
var RequestFuncNames;
(function (RequestFuncNames) {
    RequestFuncNames["login"] = "login";
    RequestFuncNames["gameTransfer"] = "gameTransfer";
    RequestFuncNames["request"] = "request";
    RequestFuncNames["uploadFile"] = "uploadFile";
    RequestFuncNames["downloadFile"] = "downloadFile";
    RequestFuncNames["webTransfer"] = "webTransfer";
})(RequestFuncNames || (RequestFuncNames = {}));
var Config = /** @class */ (function () {
    function Config() {
        this.options = {
            debug: false,
            logReport: false,
            qualityReportType: Types_1.QualityReportType.KeyValueReport,
            pluginAppId: "",
            pluginVersion: "",
            xlogName: "minigamefe",
        };
    }
    Config.prototype.set = function (optionsObject) {
        Object.assign(this.options, optionsObject);
    };
    Config.prototype.get = function (optionIndex) {
        return this.options[optionIndex];
    };
    return Config;
}());
var LogReportConfig = new Config();
var ReportRequest = /** @class */ (function () {
    function ReportRequest(conf) {
        this.namespace = "";
        this.errCodeIgnoreList = [];
        this.debug = !!conf.debug;
        this.quality = conf.quality;
        this.namespace = conf.namespace ? " ".concat(conf.namespace, " ") : " ";
    }
    ReportRequest.prototype.innerRequest = function (requestData, requestDetails) {
        var _this = this;
        return new Promise(function (storageSyncFunction, responseDataParser) {
            var RequestConstructor = requestDetails.Constructor, funcName = requestDetails.funcName, reportType = requestDetails.reportType;
            if (funcName === RequestFuncNames.login || requestData.url) {
                var requestDetails_1 = new RequestConstructor(requestData);
                requestDetails_1.optionsFilter(requestData);
                requestDetails_1.on("success", function () {
                    if (_this.debug && requestData.silent !== true) {
                        console.log("[minigamefe".concat(_this.namespace, "Network]: ").concat(funcName, " end with success"), requestDetails_1.response);
                    }
                    var response = requestDetails_1.response, sourceResponse = requestDetails_1.sourceResponse, costTime = requestDetails_1.costTime;
                    var errorCode = response.errcode;
                    var errmsg = response.errmsg;
                    if (requestData.reduceErrmsgBeforeReport && typeof requestData.reduceErrmsgBeforeReport === "function") {
                        errmsg = requestData.reduceErrmsgBeforeReport(response);
                    }
                    if (funcName === RequestFuncNames.login && !response.code) {
                        errmsg = response.errMsg;
                        errorCode = 9999;
                    }
                    if (Number.isFinite(errorCode) && Number(errorCode) !== 0 && requestData.silent !== true && !_this.errCodeIgnoreList.includes(Number(errorCode))) {
                        if (_this.quality) {
                            _this.quality.innerReport({
                                Type: reportType,
                                Target: requestData.url || "",
                                Params: requestData.data,
                                CostTime: costTime,
                                Result: {
                                    errcode: errorCode,
                                    errmsg: errmsg,
                                },
                                IsError: 1,
                            });
                        }
                    }
                    storageSyncFunction([response, sourceResponse]);
                });
                requestDetails_1.on("error", function (error) {
                    if (requestData.silent !== true) {
                        if (_this.debug) {
                            console.error("[minigamefe".concat(_this.namespace, "Network]: ").concat(funcName, " end with error"), requestData, error);
                        }
                        if (_this.quality) {
                            _this.quality.innerReport({
                                Type: reportType,
                                Target: requestData.url || "",
                                CostTime: requestDetails_1.costTime,
                                Params: requestData.data,
                                Result: (0, Utils_1.extractErrorMessage)(error),
                                IsError: 1,
                            });
                        }
                    }
                    responseDataParser(error);
                });
                requestDetails_1.on("complete", function (isErrorFlag) {
                    if (isErrorFlag === void 0) { isErrorFlag = 0; }
                    if (requestData.silent !== true && Math.random() < 0.1) {
                        if (_this.quality) {
                            _this.quality.innerReport({
                                Type: Types_1.SystemInfo.CgiSpeedMeasure,
                                Target: requestData.url || "",
                                Params: requestData.data,
                                CostTime: requestDetails_1.costTime,
                                IsError: isErrorFlag,
                            });
                        }
                    }
                });
                if (_this.debug && requestData.silent !== true) {
                    console.log("[minigamefe".concat(_this.namespace, "Network]: ").concat(funcName, " start"), requestData);
                }
                requestDetails_1.send();
            }
            else {
                responseDataParser(RequestRejectType.URL_IS_EMPTY);
            }
        });
    };
    ReportRequest.prototype.addIgnoreErrCode = function (errorCodes) {
        var _this = this;
        var errorCodeArray = Array.isArray(errorCodes) ? errorCodes : [errorCodes];
        errorCodeArray.forEach(function (code) {
            if (!_this.errCodeIgnoreList.includes(code)) {
                _this.errCodeIgnoreList.push(code);
            }
        });
    };
    ReportRequest.prototype.removeIgnoreErrCode = function (errorCodes) {
        var _this = this;
        var errorCodeArray = Array.isArray(errorCodes) ? errorCodes : [errorCodes];
        errorCodeArray.forEach(function (code) {
            if (_this.errCodeIgnoreList.includes(code)) {
                _this.errCodeIgnoreList = _this.errCodeIgnoreList.filter(function (item) { return item !== code; });
            }
        });
    };
    ReportRequest.prototype.setRequestQualityReporter = function (quality) {
        this.quality = quality;
    };
    return ReportRequest;
}());
var sessionIdKey = "minigamefe_session_id";
function updateURLSessionId(url, sessionId) {
    if (!url) {
        return "";
    }
    var updatedUrl = url;
    var updatedSessionId = sessionId;
    var storage = SystemEnvironmentVariables_1.default.ks;
    var getStorageSync = storage === null || storage === void 0 ? void 0 : storage.getStorageSync;
    if (getStorageSync == null) {
        updatedSessionId || (updatedSessionId = undefined);
    }
    else {
        updatedSessionId || (updatedSessionId = getStorageSync.call(storage, sessionIdKey));
    }
    if (updatedSessionId) {
        updatedUrl = (0, Utils_1.updateQueryParam)(updatedUrl, "session_id", updatedSessionId);
    }
    return updatedUrl;
}
var BaseRequest = /** @class */ (function (_super) {
    __extends(BaseRequest, _super);
    function BaseRequest(options, requestFunc) {
        var _this = _super.call(this) || this;
        _this.startTime = 0;
        _this.costTime = 0;
        _this.resAsResponse = false;
        _this.options = options;
        _this.requestFunc = requestFunc;
        return _this;
    }
    BaseRequest.prototype.optionsFilter = function (options) {
        if (options.sessionId) {
            options.url = updateURLSessionId(options.url, options.sessionId);
        }
        return options;
    };
    BaseRequest.prototype.send = function () {
        var _this = this;
        this.startTime = Date.now();
        var callbacks = {
            success: function (response) {
                _this.sourceResponse = response;
                _this.costTime = Date.now() - _this.startTime;
                var parsedResponse = _this.resAsResponse ? response : response.data || {};
                if (typeof parsedResponse === 'string') {
                    try {
                        parsedResponse = JSON.parse(parsedResponse);
                    }
                    catch (error) {
                        parsedResponse = {};
                    }
                }
                _this.response = parsedResponse;
                _this.emit('success');
                _this.emit('complete', 0);
            },
            fail: function (error) {
                _this.costTime = Date.now() - _this.startTime;
                _this.emit('error', error);
                _this.emit('complete', 1);
            }
        };
        this.requestFunc(__assign(__assign({}, this.options), callbacks));
    };
    return BaseRequest;
}(EventListener_1.default));
var SessionLogin = /** @class */ (function (_super) {
    __extends(SessionLogin, _super);
    function SessionLogin() {
        var _this = _super.call(this, {}, SystemEnvironmentVariables_1.default.isMiniGamePlugin ? SystemEnvironmentVariables_1.default.ks.login : SystemEnvironmentVariables_1.default.ks.login) || this;
        _this.resAsResponse = true;
        return _this;
    }
    return SessionLogin;
}(BaseRequest));
var SessionRequest = /** @class */ (function (_super) {
    __extends(SessionRequest, _super);
    function SessionRequest(options) {
        return _super.call(this, options, SystemEnvironmentVariables_1.default.isMiniGamePlugin ? SystemEnvironmentVariables_1.default.ks.request : SystemEnvironmentVariables_1.default.ks.request) || this;
    }
    SessionRequest.prototype.optionsFilter = function (options) {
        options.timeout = options.timeout || 30000;
        options.header && (options.header = Object.assign({
            "content-type": "application/json; charset=utf-8",
        }, options.header || {}));
        options.method = options.method ? options.method.toUpperCase() : "GET";
        if (options.sessionId) {
            options.url = updateURLSessionId(options.url, options.sessionId);
        }
        return options;
    };
    return SessionRequest;
}(BaseRequest));
var SessionUploadFile = /** @class */ (function (_super) {
    __extends(SessionUploadFile, _super);
    function SessionUploadFile(options) {
        return _super.call(this, options, SystemEnvironmentVariables_1.default.isMiniGamePlugin ? SystemEnvironmentVariables_1.default.ks.uploadFile : SystemEnvironmentVariables_1.default.ks.uploadFile) || this;
    }
    return SessionUploadFile;
}(BaseRequest));
var SessionDownloadFile = /** @class */ (function (_super) {
    __extends(SessionDownloadFile, _super);
    function SessionDownloadFile(options) {
        return _super.call(this, options, SystemEnvironmentVariables_1.default.isMiniGamePlugin ? SystemEnvironmentVariables_1.default.ks.downloadFile : SystemEnvironmentVariables_1.default.ks.downloadFile) || this;
    }
    return SessionDownloadFile;
}(BaseRequest));
var API_BASE = "https://game.weixin.qq.com";
var SessionStorage = /** @class */ (function () {
    function SessionStorage(options) {
        this.sessionId = "";
        this.login = options.login;
        this.request = options.request;
    }
    SessionStorage.prototype.getSessionId = function (appId) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, this.checkSession().catch(function () {
                        return _this.loginKsGame(appId);
                    })];
            });
        });
    };
    SessionStorage.prototype.clearSessionId = function () {
        var _a;
        this.sessionId = '';
        var storage = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.ks;
        (_a = storage === null || storage === void 0 ? void 0 : storage.removeStorageSync) === null || _a === void 0 ? void 0 : _a.call(storage, sessionIdKey);
    };
    SessionStorage.prototype.checkSession = function () {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var _a;
            var storage = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.ks;
            var sessionId = (_a = _this.sessionId) !== null && _a !== void 0 ? _a : storage === null || storage === void 0 ? void 0 : storage.getStorageSync(sessionIdKey);
            if (!sessionId) {
                reject({ errMsg: "尚未保存sessionId" });
                return;
            }
            var checkSession = storage === null || storage === void 0 ? void 0 : storage.checkSession;
            if (!checkSession) {
                reject({ errMsg: "checkSession方法不存在" });
                return;
            }
            checkSession.call(storage, {
                success: function () { return resolve({ sessionId: sessionId }); },
                fail: function (error) {
                    _this.clearSessionId();
                    reject(error);
                }
            });
        });
    };
    SessionStorage.prototype.loginKsGame = function (appId) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                this.isLoginPromise || (this.isLoginPromise = new Promise(function (resolve, reject) {
                    _this.login({})
                        .then(function (_a) {
                        var result = _a[0];
                        var params = { code: result.code };
                        if (appId)
                            params.appid = appId;
                        return _this.request({
                            url: "".concat(API_BASE, "/cgi-bin/gameweappauthwap/login"),
                            data: params,
                            method: "POST"
                        });
                    })
                        .then(function (_a) {
                        var _b, _c;
                        var responseData = _a[0];
                        if ((_b = responseData === null || responseData === void 0 ? void 0 : responseData.data) === null || _b === void 0 ? void 0 : _b.session_id) {
                            var ks = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.ks;
                            if (!SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
                                (_c = ks === null || ks === void 0 ? void 0 : ks.setStorageSync) === null || _c === void 0 ? void 0 : _c.call(ks, sessionIdKey, responseData.data.session_id);
                            }
                            _this.sessionId = responseData.data.session_id;
                            resolve({ sessionId: responseData.data.session_id });
                        }
                        else {
                            reject({ errMsg: "登录出错" });
                        }
                    })
                        .catch(function () { return reject({ errMsg: "登录出错" }); });
                }));
                return [2 /*return*/, this.isLoginPromise.finally(function () {
                        _this.isLoginPromise = undefined;
                    })];
            });
        });
    };
    return SessionStorage;
}());
var ReportNetworkBase = /** @class */ (function (_super) {
    __extends(ReportNetworkBase, _super);
    function ReportNetworkBase(conf) {
        var _this = _super.call(this, conf) || this;
        _this.login = _this.initKsMethod({
            funcName: RequestFuncNames.login,
            Constructor: SessionLogin,
            reportType: Types_1.SystemInfo.Login,
        });
        _this.request = _this.initKsMethod({
            funcName: RequestFuncNames.request,
            Constructor: SessionRequest,
            reportType: Types_1.SystemInfo.Request,
        });
        _this.uploadFile = _this.initKsMethod({
            funcName: RequestFuncNames.uploadFile,
            Constructor: SessionUploadFile,
            reportType: Types_1.SystemInfo.UploadFile,
        });
        _this.downloadFile = _this.initKsMethod({
            funcName: RequestFuncNames.downloadFile,
            Constructor: SessionDownloadFile,
            reportType: Types_1.SystemInfo.DownloadFile,
        });
        _this.session = new SessionStorage({
            login: _this.login,
            request: _this.request,
        });
        _this.pluginAppId = conf.pluginAppId || "";
        return _this;
    }
    ReportNetworkBase.prototype.initKsMethod = function (reportDetail) {
        var _this = this;
        var funcName = reportDetail.funcName, constructorReference = reportDetail.Constructor, reportType = reportDetail.reportType;
        var ks = SystemEnvironmentVariables_1.default.ks;
        if (ks && ks[funcName]) {
            var reportDetail_1 = {
                Constructor: constructorReference,
                funcName: funcName,
                reportType: reportType,
            };
            var sendRequest = function (request) {
                if (request === void 0) { request = {}; }
                return _this.innerRequest(request, reportDetail_1);
            };
            if (funcName === RequestFuncNames.request || funcName === RequestFuncNames.uploadFile) {
                return this.initMethodNeedSession(sendRequest);
            }
            else {
                return sendRequest;
            }
        }
        console.warn("[minigamfe".concat(this.namespace, "]: \u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 ").concat(funcName, "\u3002"));
        return function () {
            return new Promise(function (resolve, reject) {
                reject(RequestRejectType.METHOD_IS_NOT_EXIST);
            });
        };
    };
    ReportNetworkBase.prototype.initMethodNeedSession = function (sendRequest) {
        var _this = this;
        return function (request) {
            if (request.needSession) {
                return _this.session
                    .getSessionId(_this.pluginAppId)
                    .then(function (session) { return sendRequest(Object.assign(request, session)); })
                    .then(function (requestContext) {
                    var _a = __spreadArray([], requestContext, true), error = _a[0], result = _a[1];
                    var errorCode = error.errcode;
                    if ((result === null || result === void 0 ? void 0 : result.statusCode) === 401 ||
                        "".concat(errorCode) === "-1702220400" ||
                        "".concat(errorCode) === "-1702220401" ||
                        "".concat(errorCode) === "-1702220407" ||
                        "".concat(errorCode) === "-1702220402" ||
                        "".concat(errorCode) === "40001") {
                        _this.session.clearSessionId();
                        return _this.session.getSessionId(_this.pluginAppId)
                            .then(function (session) { return sendRequest(Object.assign(request, session)); });
                    }
                    else {
                        return [error, result];
                    }
                });
            }
            else {
                return sendRequest(request);
            }
        };
    };
    return ReportNetworkBase;
}(ReportRequest));
var ReportGameTransfer = /** @class */ (function (_super) {
    __extends(ReportGameTransfer, _super);
    function ReportGameTransfer(options) {
        var _this = _super.call(this) || this;
        _this.startTime = 0;
        _this.costTime = 0;
        _this.options = options;
        _this.isSupportNoStringifyReqData = (0, Utils_1.compareVersions)(SystemEnvironmentVariables_1.default.systemInfo.SDKVersion, "2.29.1") >= 0;
        return _this;
    }
    ReportGameTransfer.prototype.optionsFilter = function (options) {
        if (options.sessionId && options.data && !options.data.session_id) {
            options.data.session_id = options.sessionId;
        }
        options.timeout = options.timeout || 30000;
        return options;
    };
    ReportGameTransfer.prototype.send = function () {
        var _this = this;
        var _a;
        var startTime = Date.now();
        var _b = this.options, url = _b.url, _c = _b.data, data = _c === void 0 ? {} : _c, _d = _b.flat, flat = _d === void 0 ? false : _d, timeout = _b.timeout;
        var isDataObject = data && (0, Utils_1.isObject)(data);
        if (isDataObject) {
            data["requestTime_".concat(Math.random().toString(36).slice(2, 12))] = Date.now();
        }
        var requestConfig = {
            req_path: url,
            timeout: timeout,
            success: function (response) {
                _this.costTime = Date.now() - startTime;
                _this.sourceResponse = response;
                var processResponse = function (_a) {
                    var rawData = _a.rawData, respData = _a.respData;
                    try {
                        return JSON.parse(rawData || (respData === null || respData === void 0 ? void 0 : respData.data) || "");
                    }
                    catch (_b) {
                        return {};
                    }
                };
                _this.response = processResponse(response);
                _this.emit('success');
                _this.emit('complete', 0);
            },
            fail: function (error) {
                _this.costTime = Date.now() - startTime;
                _this.emit('error', error);
                _this.emit('complete', 1);
            }
        };
        if (!flat) {
            var jsonData = isDataObject ? JSON.stringify(data) : data;
            if (this.isSupportNoStringifyReqData) {
                requestConfig.reqData = {
                    req_path: url,
                    json_data: jsonData
                };
                delete requestConfig.req_path;
            }
            else {
                requestConfig.json_data = jsonData;
            }
        }
        if (flat && isDataObject) {
            Object.assign(requestConfig, this.isSupportNoStringifyReqData ? { reqData: __assign(__assign({}, data), { req_path: url }) } : data);
            if (this.isSupportNoStringifyReqData) {
                delete requestConfig.req_path;
            }
        }
        (_a = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.pluginEnv) === null || _a === void 0 ? void 0 : _a.gameTransfer(requestConfig);
    };
    return ReportGameTransfer;
}(EventListener_1.default));
var ReportNetwork = /** @class */ (function (_super) {
    __extends(ReportNetwork, _super);
    function ReportNetwork(conf) {
        var _this = _super.call(this, conf) || this;
        _this.gameTransfer = _this.initGameTransfer();
        return _this;
    }
    ReportNetwork.prototype.initGameTransfer = function () {
        var _this = this;
        if (SystemEnvironmentVariables_1.default.pluginEnv.gameTransfer) {
            var reportDetail_2 = {
                Constructor: ReportGameTransfer,
                funcName: RequestFuncNames.gameTransfer,
                reportType: Types_1.SystemInfo.GameTransfer,
            };
            return this.initMethodNeedSession(function (request) {
                return _this.innerRequest(request, reportDetail_2);
            });
        }
        console.warn("[minigamfe".concat(this.namespace, "]: \u5F53\u524D\u63D2\u4EF6\u4E0D\u652F\u6301 gameTransfer\u3002"));
        return function () {
            return new Promise(function (resolve, reject) {
                reject(RequestRejectType.GAMETRANSFER_IS_NOT_EXIST);
            });
        };
    };
    return ReportNetwork;
}(ReportNetworkBase));
var ReportSchemas = {
    BenchmarkLevel: Validation_1.ValidationConstants.UINT,
    NetworkType: Validation_1.ValidationConstants.STRING,
    RuntimeType: Validation_1.ValidationConstants.UINT,
    PluginAppId: Validation_1.ValidationConstants.STRING,
    PluginVersion: Validation_1.ValidationConstants.STRING,
    Scene: Validation_1.ValidationConstants.UINT,
    SDKVersion: Validation_1.ValidationConstants.STRING,
    IsVisible: Validation_1.ValidationConstants.UINT,
    Type: Validation_1.ValidationConstants.UINT,
    Target: Validation_1.ValidationConstants.STRING,
    Params: Validation_1.ValidationConstants.STRING,
    Result: Validation_1.ValidationConstants.STRING,
    CostTime: Validation_1.ValidationConstants.UINT,
    ExternInfo: Validation_1.ValidationConstants.STRING,
    CustomKey1: Validation_1.ValidationConstants.STRING,
    CustomKey2: Validation_1.ValidationConstants.STRING,
    CustomKey3: Validation_1.ValidationConstants.STRING,
    IsError: Validation_1.ValidationConstants.UINT,
    FELibVersion: Validation_1.ValidationConstants.STRING,
    Query: Validation_1.ValidationConstants.STRING,
};
var ReportProtocolParams = [
    "BenchmarkLevel",
    "NetworkType",
    "RuntimeType",
    "PluginAppId",
    "PluginVersion",
    "Scene",
    "SDKVersion",
    "IsVisible",
    "Type",
    "Target",
    "Params",
    "Result",
    "CostTime",
    "ExternInfo",
    "CustomKey1",
    "CustomKey2",
    "CustomKey3",
    "IsError",
    "FELibVersion",
    "Query",
];
function formatMessage(data, fieldName) {
    var formattedData = data || "";
    if ((0, Utils_1.isObject)(formattedData)) {
        try {
            formattedData = JSON.stringify(formattedData);
        }
        catch (error) {
            console.error("[minigamefe stringify error]: ".concat(error));
            formattedData = "";
        }
    }
    else {
        formattedData = String(formattedData);
    }
    if (formattedData.length >= 1024) {
        formattedData = formattedData.substring(0, 1024);
        console.warn("[minigamefe stringify warning]: ".concat(fieldName, " \u4E0A\u62A5\u957F\u5EA6\u8D85\u8FC71024, \u5DF2\u88C1\u526A"));
    }
    return formattedData;
}
var RequestReport = /** @class */ (function (_super) {
    __extends(RequestReport, _super);
    function RequestReport(config) {
        var _this = _super.call(this, config) || this;
        var reportFunc = config.reportFunc, asyncGetBase = config.asyncGetBase, reportType = config.reportType;
        var asyncGetBaseFunction = asyncGetBase === undefined ? function () { return Promise.resolve({}); } : asyncGetBase;
        _this.reportType = Validation_1.ValidationTypes.SvrReport;
        _this.reportFunc = reportFunc;
        if (!reportFunc) {
            console.error("[minigamefe".concat(_this.namespace, "RequestReport]: \u672A\u4F20\u5165\u4E0A\u62A5\u51FD\u6570\u3002"));
        }
        _this.asyncGetBase = asyncGetBaseFunction;
        if (reportType !== undefined) {
            _this.reportType = reportType;
        }
        return _this;
    }
    RequestReport.prototype.setKvStatBase = function (base, miniProgramInfo) {
        if (this.reportType === Validation_1.ValidationTypes.KvStat) {
            var systemInfos = (base.system || "").split(" ");
            Object.assign(this.schemas, {
                DeviceModel: Validation_1.ValidationConstants.STRING,
                DeviceBrand: Validation_1.ValidationConstants.STRING,
                OsName: Validation_1.ValidationConstants.STRING,
                OsVersion: Validation_1.ValidationConstants.STRING,
                LanguageVersion: Validation_1.ValidationConstants.STRING,
                Count: Validation_1.ValidationConstants.UINT,
                AppId: Validation_1.ValidationConstants.STRING,
                AppVersion: Validation_1.ValidationConstants.UINT,
                AppState: Validation_1.ValidationConstants.UINT,
            });
            this.setBase({
                DeviceModel: base.model || "",
                DeviceBrand: base.brand || "",
                OsName: systemInfos[0] || "",
                OsVersion: systemInfos[1] || "",
                LanguageVersion: base.language || "",
                Count: 1,
            });
            if (miniProgramInfo == null ? undefined : miniProgramInfo.miniProgram) {
                this.setBase({
                    AppState: Utils_1.releaseStages[miniProgramInfo.miniProgram.envVersion] || Utils_1.releaseStages.release,
                    AppId: miniProgramInfo.miniProgram.appId,
                    AppVersion: 0,
                });
            }
        }
    };
    return RequestReport;
}(Validation_1.Validate));
var RequestQualityReporter = /** @class */ (function () {
    function RequestQualityReporter(config) {
        var _a, _b, _c;
        this.benchmarkLevel = 0;
        this.network = "";
        this.runtimeType = Types_1.moduleVersion.UnKnow;
        this.sdkVersion = "0.0.0";
        this.isVisible = Types_1.FrontBackground.Front;
        this.scene = 0;
        this.query = "";
        this.pluginAppId = "";
        this.pluginVersion = "";
        this.inited = false;
        var systemInfo = config.systemInfo, launchInfo = config.launchInfo, onShow = config.onShow, onHide = config.onHide, _d = config.pluginAppId, pluginAppId = _d === void 0 ? "" : _d, _e = config.pluginVersion, pluginVersion = _e === void 0 ? "" : _e;
        if (!onShow || !onHide) {
            console.error("[minigamefe stringify warning]: please inject QualityConfig correctly");
            this.inited = false;
            return;
        }
        this.inited = true;
        this.onShow = onShow;
        this.onHide = onHide;
        this.benchmarkLevel = (systemInfo.benchmarkLevel || 1) + 100;
        this.sdkVersion = systemInfo.SDKVersion || "0.0.0";
        this.launchInfo = launchInfo;
        this.scene = ((_a = this.launchInfo) === null || _a === void 0 ? void 0 : _a.scene) || 0;
        if (!(0, Utils_1.isEmpty)((_b = this.launchInfo) === null || _b === void 0 ? void 0 : _b.query)) {
            this.query = encodeURIComponent(JSON.stringify((_c = this.launchInfo) === null || _c === void 0 ? void 0 : _c.query));
        }
        this.runtimeType = (0, Utils_1.getPlatformVM)(systemInfo);
        this.pluginAppId = pluginAppId;
        this.pluginVersion = pluginVersion;
        this.bindNativeEvent();
        this.reporter = this.createReporter(config);
        this.reporter.setBase({
            BenchmarkLevel: this.benchmarkLevel,
            RuntimeType: this.runtimeType,
            Scene: +this.scene,
            SDKVersion: this.sdkVersion,
            IsVisible: this.isVisible,
            PluginAppId: pluginAppId,
            PluginVersion: pluginVersion,
            FELibVersion: FELibVersion,
            Query: this.query,
        });
    }
    RequestQualityReporter.prototype.createReporter = function (config) {
        var _a = config.type, reportType = _a === void 0 ? Types_1.QualityReportType.KeyValueReport : _a, reportKeyValue = config.reportKeyValue, debug = config.debug, gameTransfer = config.gameTransfer, systemInfo = config.systemInfo, accountInfo = config.accountInfo, getNetworkType = config.getNetworkType, onNetworkStatusChange = config.onNetworkStatusChange, request = config.request, namespace = config.namespace;
        var currentNetworkType = "";
        var fetchNetworkType = function () {
            return new Promise(function (resolve) {
                if (currentNetworkType) {
                    resolve({ NetworkType: currentNetworkType });
                }
                else {
                    getNetworkType === null || getNetworkType === void 0 ? void 0 : getNetworkType({
                        success: function (networkResponse) {
                            currentNetworkType = networkResponse.networkType;
                            resolve({ NetworkType: currentNetworkType });
                        },
                        fail: function () {
                            currentNetworkType = "unknown";
                            resolve({ NetworkType: currentNetworkType });
                        },
                    });
                }
            });
        };
        var reporter;
        if (reportType === Types_1.QualityReportType.KeyValueReport) {
            reporter = new KeyValueReporter_1.default({
                reportFunc: reportKeyValue,
                logid: 26340,
                schemas: ReportSchemas,
                protocolParams: ReportProtocolParams,
                debug: debug,
                namespace: namespace,
                asyncGetBase: fetchNetworkType,
            });
        }
        else if (reportType === Types_1.QualityReportType.GameTransferReport) {
            reporter = new GameTransferReport_1.default({
                reportFunc: gameTransfer,
                logid: 26340,
                schemas: ReportSchemas,
                reportType: Validation_1.ValidationTypes.KvStat,
                debug: debug,
                namespace: namespace,
                asyncGetBase: fetchNetworkType,
            });
            reporter.setKvStatBase(systemInfo, accountInfo);
        }
        else {
            console.warn("[minigamefe]: 当前选择 reqeust 进行质量上报, 请自行确保兼容性");
            reporter = new RequestReport({
                reportFunc: request,
                logid: 26340,
                schemas: ReportSchemas,
                debug: debug,
                namespace: namespace,
                asyncGetBase: fetchNetworkType,
                reportType: Validation_1.ValidationTypes.KvStat,
            });
            reporter.setKvStatBase(systemInfo, accountInfo);
        }
        if (reportType === Types_1.QualityReportType.GameTransferReport || reportType === Types_1.QualityReportType.KsRequestReport) {
            (0, SystemUtils_1.HandleNetworkValidation)(function (event) {
                currentNetworkType = event;
                reporter.setBase({ NetworkType: event });
            }, getNetworkType, onNetworkStatusChange);
        }
        return reporter;
    };
    RequestQualityReporter.prototype.bindNativeEvent = function () {
        var _this = this;
        this.onHide(function () {
            _this.isVisible = Types_1.FrontBackground.Background;
            _this.reporter.setBase({ IsVisible: _this.isVisible });
        });
        this.onShow(function (result) {
            if (!(0, Utils_1.isEmpty)(result === null || result === void 0 ? void 0 : result.query)) {
                _this.query = encodeURIComponent(JSON.stringify(result.query));
            }
            _this.isVisible = Types_1.FrontBackground.Front;
            _this.reporter.setBase({ IsVisible: _this.isVisible, Query: _this.query });
        });
    };
    RequestQualityReporter.prototype.innerReport = function (report) {
        this.reporter.send(Object.assign(report, {
            CostTime: (0, Utils_1.isFiniteNumber)(report.CostTime) ? report.CostTime : 0,
            Params: formatMessage(report.Params, "Params"),
            Result: formatMessage(report.Result, "Result"),
            ExternInfo: formatMessage(report.ExternInfo, "ExternInfo"),
        }));
    };
    RequestQualityReporter.prototype.report = function (report) {
        // @ts-ignore
        if ((0, Utils_1.getBackgroundMode)().indexOf(report.Type) > -1) {
            console.error("[minigamefe quality report]: \u82E5\u4E3A\u81EA\u5B9A\u4E49\u4E0A\u62A5, Type \u8BF7\u4E0D\u8981\u4F7F\u7528\u5185\u7F6E\u679A\u4E3E\u503C ".concat(report.Type, ", \u5185\u7F6E\u679A\u4E3E\u53EF\u89C1 mgp.consts.ReportType"));
        }
        if (this.inited) {
            this.innerReport(report);
        }
    };
    RequestQualityReporter.prototype.setCustomKey = function (customKeys) {
        if (this.inited) {
            this.reporter.setBase({
                CustomKey1: (customKeys.CustomKey1 && formatMessage(customKeys.CustomKey1, "CustomKey1")) || "",
                CustomKey2: (customKeys.CustomKey2 && formatMessage(customKeys.CustomKey2, "CustomKey2")) || "",
                CustomKey3: (customKeys.CustomKey3 && formatMessage(customKeys.CustomKey3, "CustomKey3")) || "",
            });
        }
    };
    RequestQualityReporter.prototype.clearCustomKey = function () {
        if (this.inited) {
            this.reporter.setBase({
                CustomKey1: "",
                CustomKey2: "",
                CustomKey3: "",
            });
        }
    };
    return RequestQualityReporter;
}());
var ReporterWithErrorHandling = /** @class */ (function () {
    function ReporterWithErrorHandling(quality) {
        var pluginAppId = LogReportConfig.get("pluginAppId") || SystemEnvironmentVariables_1.default.pluginAppId;
        this.identifier = "".concat(pluginAppId, "/plugin.js");
        this.quality = quality;
        this.init();
    }
    ReporterWithErrorHandling.prototype.init = function () {
        var _this = this;
        var _a, _b;
        (_b = (_a = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.ks) === null || _a === void 0 ? void 0 : _a.onError) === null || _b === void 0 ? void 0 : _b.call(_a, function (err) {
            _this.processError(err.message);
        });
    };
    ReporterWithErrorHandling.prototype.processError = function (errorMsg) {
        var _a, _b;
        if (!errorMsg.includes(this.identifier))
            return;
        var lines = errorMsg.split('\n');
        var target = (_a = lines[0]) !== null && _a !== void 0 ? _a : '';
        var customKey = (_b = lines[2]) === null || _b === void 0 ? void 0 : _b.split(':')[0];
        this.quality.innerReport({
            Type: Types_1.SystemInfo.BadJs,
            Target: target,
            CostTime: 0,
            Result: errorMsg,
            CustomKey1: customKey
        });
    };
    return ReporterWithErrorHandling;
}());
var LogLevel;
(function (LogLevel) {
    LogLevel["log"] = "log";
    LogLevel["info"] = "info";
    LogLevel["warn"] = "warn";
    LogLevel["error"] = "error";
})(LogLevel || (LogLevel = {}));
function reportingInteractionFunction(map, array, data) {
    var logDetailIndex = String(array.push(data) - 1);
    map.set(data, logDetailIndex);
    return logDetailIndex;
}
var XLogReport = /** @class */ (function () {
    function XLogReport(config) {
        var reportFunc = config.reportFunc, base = config.base, debug = config.debug, delimiter = config.delimiter, namespace = config.namespace;
        this.reportFunc = null;
        this.debug = false;
        this.base = {};
        this.delimiter = " ";
        this.namespace = "";
        if (reportFunc) {
            this.reportFunc = reportFunc;
            if (base) {
                this.setBase(base);
            }
            this.debug = !!debug;
            if (delimiter) {
                this.delimiter = delimiter;
            }
            this.namespace = namespace ? " ".concat(namespace, " ") : " ";
        }
        else {
            console.error("[minigamefe XLog]: 未传入上报函数。");
        }
    }
    XLogReport.prototype.setBase = function (updateValues) {
        this.base = __assign(__assign({}, this.base), updateValues);
    };
    XLogReport.prototype.log = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        this.report(LogLevel.log, args);
    };
    XLogReport.prototype.info = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        this.report(LogLevel.info, args);
    };
    XLogReport.prototype.warn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        this.report(LogLevel.warn, args);
    };
    XLogReport.prototype.error = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        this.report(LogLevel.error, args);
    };
    XLogReport.prototype.getLogStr = function (type, args) {
        var _this = this;
        var _a;
        if (!this.reportFunc) {
            console.error("[minigamefe".concat(this.namespace, "XLog]: \u672A\u4F20\u5165\u4E0A\u62A5\u51FD\u6570\u3002"));
            return "";
        }
        if (!(args === null || args === void 0 ? void 0 : args.length))
            return "";
        var logContent = "";
        args.forEach(function (result) {
            if (logContent.length > 0)
                logContent += _this.delimiter;
            var processedResult = result;
            if (typeof processedResult === "object") {
                if (processedResult instanceof TypeError) {
                    processedResult = processedResult.message;
                }
                else {
                    processedResult = _this.processOtherObject(processedResult);
                }
            }
            logContent += String(processedResult).trim();
        });
        var logObject = __assign(__assign({}, this.base), { type: type, content: logContent });
        var logString = "[minigamefe".concat(this.namespace, "XLog]: ").concat(JSON.stringify(logObject));
        (_a = console[type]) === null || _a === void 0 ? void 0 : _a.call(console, logString);
        return logString;
    };
    XLogReport.prototype.processOtherObject = function (obj) {
        var map = new Map();
        var interactionData = [];
        var array = [];
        var index = +reportingInteractionFunction(map, interactionData, obj);
        var hasInteractions = !index;
        for (; index < interactionData.length;) {
            hasInteractions = true;
            array[index] = JSON.stringify(interactionData[index++], stringifyReplacer);
        }
        return "[".concat(array.join(","), "]");
        function stringifyReplacer(key, value) {
            if (hasInteractions) {
                hasInteractions = !hasInteractions;
                return value;
            }
            switch (typeof value) {
                case "object":
                    if (value === null) {
                        return value;
                    }
                    break;
                case "string":
                    return (map.get(value) || reportingInteractionFunction(map, interactionData, value));
            }
            return value;
        }
    };
    XLogReport.prototype.report = function (reportKey, logData) {
        var _a;
        var reporter = (_a = this.reportFunc) === null || _a === void 0 ? void 0 : _a[reportKey];
        if (typeof reporter === 'function') {
            var logString = this.getLogStr(reportKey, logData);
            logString && reporter(logString);
        }
        else {
            console.error("[minigamefe".concat(this.namespace, "XLog]: ").concat(this.reportFunc ? '上报函数格式错误' : '未传入上报函数'));
        }
    };
    return XLogReport;
}());
var LogReport = /** @class */ (function () {
    function LogReport() {
        this.version = FELibVersion;
        this.consts = LogConstants;
        this.env = SystemEnvironmentVariables_1.default;
        this.util = {};
        this.config = LogReportConfig;
        this.reporter = {
            GameTransferReport: GameTransferReport_1.default,
            KeyValueReporter: KeyValueReporter_1.default,
        };
    }
    LogReport.prototype.init = function (config) {
        var _a, _b;
        var initStartTime = Date.now();
        this.env = SystemEnvironmentVariables_1.default;
        console.log("[minigamefe mgp]: inited");
        // reportingInteraction.g.mgp = this;
        this.config.set(config);
        this.network = new ReportNetwork({
            pluginAppId: this.config.get("pluginAppId") || SystemEnvironmentVariables_1.default.pluginAppId || "",
            debug: this.config.get("debug") || false,
            namespace: "mgp",
        });
        if (SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
            var pluginEnv = SystemEnvironmentVariables_1.default.pluginEnv;
            if (pluginEnv.gameTransfer || pluginEnv.reportKeyValue) {
                this.quality = new RequestQualityReporter({
                    debug: this.config.get("debug") && this.config.get("logReport"),
                    type: this.config.get("qualityReportType"),
                    pluginAppId: this.config.get("pluginAppId") || SystemEnvironmentVariables_1.default.pluginAppId || "",
                    pluginVersion: this.config.get("pluginVersion") || SystemEnvironmentVariables_1.default.pluginVersion || "",
                    launchInfo: SystemEnvironmentVariables_1.default.ks.getLaunchOptionsSync(),
                    accountInfo: SystemEnvironmentVariables_1.default.accountInfo,
                    systemInfo: SystemEnvironmentVariables_1.default.systemInfo,
                    onShow: SystemEnvironmentVariables_1.default.ks.onShow,
                    onHide: SystemEnvironmentVariables_1.default.ks.onHide,
                    getNetworkType: SystemEnvironmentVariables_1.default.ks.getNetworkType,
                    onNetworkStatusChange: SystemEnvironmentVariables_1.default.ks.onNetworkStatusChange,
                    gameTransfer: (_a = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.pluginEnv) === null || _a === void 0 ? void 0 : _a.gameTransfer,
                    reportKeyValue: (_b = SystemEnvironmentVariables_1.default === null || SystemEnvironmentVariables_1.default === void 0 ? void 0 : SystemEnvironmentVariables_1.default.pluginEnv) === null || _b === void 0 ? void 0 : _b.reportKeyValue,
                    request: SystemEnvironmentVariables_1.default.ks.request,
                    namespace: "mgp",
                });
                this.network.setRequestQualityReporter(this.quality);
                this.quality.innerReport({
                    Type: Types_1.SystemInfo.Default,
                    Target: "init",
                    CostTime: Date.now() - initStartTime,
                });
                new ReporterWithErrorHandling(this.quality);
            }
            else {
                console.warn("[minigamefe mgp]: 当前环境不支持质量上报。");
                this.quality = {
                    report: function () {
                    },
                };
            }
            var debug = this.config.get("debug");
            if (pluginEnv.getXLogManager) {
                this.xlog = new XLogReport({
                    reportFunc: pluginEnv.getXLogManager(),
                    namespace: "mgp",
                    base: {
                        name: this.config.get("xlogName"),
                    },
                    debug: debug,
                });
                if (debug) {
                    console.info("[minigamefe mgp]: 当前插件已支持 xlog, 建议在关键操作打客户端日志。");
                }
            }
            else {
                this.xlog = console;
                if (debug) {
                    console.info("[minigamefe mgp]: 当前客户端不支持 xlog, 降级为 console。");
                }
            }
        }
        else {
            console.warn("[minigamefe mgp]: please use mgp in minigame plugin");
        }
    };
    return LogReport;
}());
var logReport = new LogReport();
exports["default"] = logReport;


/***/ }),

/***/ "./src/lib/LogReporter.ts":
/*!********************************!*\
  !*** ./src/lib/LogReporter.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Reporter_1 = __importDefault(__webpack_require__(/*! ./Reporter */ "./src/lib/Reporter.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var LogReport_1 = __importDefault(__webpack_require__(/*! ./LogReport */ "./src/lib/LogReport.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var LogReporter = /** @class */ (function (_super) {
    __extends(LogReporter, _super);
    function LogReporter() {
        var _this = _super.call(this) || this;
        _this.loggerQueue = [];
        _this.loggerId = 0;
        _this.registerSysReportEvent();
        SystemEnvironmentVariables_1.default.tjInstance.onHide(_this.onHide.bind(_this));
        return _this;
    }
    LogReporter.getInstance = function () {
        if (!this.instance) {
            this.instance = new this();
        }
        return this.instance;
    };
    LogReporter.prototype.destroy = function () {
        this.upload();
        SystemEnvironmentVariables_1.default.tjInstance.offHide(this.onHide.bind(this));
    };
    LogReporter.prototype.onHide = function () {
        this.upload();
    };
    LogReporter.prototype.registerSysReportEvent = function () {
        var _this = this;
        Reporter_1.default.eventEmitter.registerEvent(this, function (layoutUpdateHandler) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (layoutUpdateHandler) {
                case CaseType_1.ReportCaseType.sys:
                    var reportArgument = args[0];
                    if (reportArgument.id !== "0" &&
                        reportArgument.status !== Types_1.ReportStatusType.checkPoint &&
                        (!reportArgument.event || LogReporter.watchEvents.indexOf(reportArgument.event) === -1)) {
                        return;
                    }
                    ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                        ReportType: Types_1.ReportStatusType[reportArgument.status],
                        ExternInfo: JSON.stringify({
                            hash: _this.hash,
                            id: reportArgument.id,
                            time: _this.calCostTime(),
                            event: reportArgument.event || "-",
                        }),
                    }));
                    break;
                case CaseType_1.ReportCaseType.err:
                    var errInfo = args[0];
                    ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                        ReportType: Types_1.GameLaunchStatus.LAUNCH_OPERA_FRAME_START,
                        ErrorMsg: JSON.stringify(errInfo.errinfo),
                        RunTimeMs: _this.calCostTime(),
                    }));
                    break;
                case CaseType_1.ReportCaseType.logger:
                    _this.pushLoggerMsg(args[0]);
                    break;
            }
        });
    };
    LogReporter.prototype.pushLoggerMsg = function (logEntry) {
        var _this = this;
        this.loggerQueue.push(logEntry);
        this.throttle(function () { return _this.upload(); });
    };
    LogReporter.prototype.throttle = function (callback, timeoutDuration) {
        if (timeoutDuration === void 0) { timeoutDuration = 2000; }
        if (this.autoUploadLoggerHandler) {
            clearTimeout(this.autoUploadLoggerHandler);
        }
        this.autoUploadLoggerHandler = setTimeout(callback, timeoutDuration);
    };
    LogReporter.prototype.upload = function () {
        if (this.autoUploadLoggerHandler) {
            clearTimeout(this.autoUploadLoggerHandler);
            this.autoUploadLoggerHandler = null;
        }
        var loggerQueueJson = JSON.stringify(this.loggerQueue);
        this.loggerQueue = [];
        LogReport_1.default.quality.report({
            Type: Types_1.BackgroundModeEvent.Info,
            Target: "lac-op",
            ExternInfo: loggerQueueJson,
            Result: String(this.loggerId),
            CustomKey1: this.hash,
        });
        this.loggerId += 1;
    };
    LogReporter.watchEvents = ["onClick"];
    return LogReporter;
}(Reporter_1.default));
exports["default"] = LogReporter;


/***/ }),

/***/ "./src/lib/LogUtils.ts":
/*!*****************************!*\
  !*** ./src/lib/LogUtils.ts ***!
  \*****************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.DefaultLogManager = void 0;
exports.resolveCachePath = resolveCachePath;
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var DefaultLogManager = /** @class */ (function () {
    function DefaultLogManager() {
    }
    DefaultLogManager.prototype.log = function (msg) {
        console.log(msg);
    };
    DefaultLogManager.prototype.info = function (msg) {
        console.info(msg);
    };
    DefaultLogManager.prototype.warn = function (msg) {
        console.warn(msg);
    };
    DefaultLogManager.prototype.error = function (msg) {
        console.error(msg);
    };
    return DefaultLogManager;
}());
exports.DefaultLogManager = DefaultLogManager;
function resolveCachePath(path, isCache) {
    if (isCache === void 0) { isCache = true; }
    var trimmedPath = path === null || path === void 0 ? void 0 : path.trim();
    if (!trimmedPath) {
        return "";
    }
    if (trimmedPath.includes(GameGlobalVars_1.default.userDataPath)) {
        return trimmedPath;
    }
    var resolvedPath = (0, Utils_1.resolveDirname)(trimmedPath, isCache);
    var filename = (0, Utils_1.resolveFilename)(trimmedPath);
    var cachePath = (0, Utils_1.resolvePath)(isCache ? GameGlobalVars_1.default.gameFileCache : GameGlobalVars_1.default.userDataPath, resolvedPath, filename);
    if (resolvedPath.includes("/http:") || resolvedPath.includes("/https:")) {
        if (!GameGlobalVars_1.default.isRelease) {
            PluginLogger_1.default.pluginError({
                url: trimmedPath,
                cachePath: cachePath,
                dataCDN: GameGlobalVars_1.default.unityNamespace.DATA_CDN,
            });
        }
        return "";
    }
    return cachePath;
}


/***/ }),

/***/ "./src/lib/MonitorConfig.ts":
/*!**********************************!*\
  !*** ./src/lib/MonitorConfig.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.MonitorConfigKeys = exports.MonitorConfig = void 0;
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var MonitorConfigKeys = {
    Fps: "fps",
    EnableMonitor: "enableMonitor",
    MonitorDuration: "monitorDuration",
    ShowResultAfterLaunch: "showResultAfterLaunch",
    ShowSuggestModal: "showSuggestModal",
    ShowReportModal: "SHOW_REPORT_MODAL",
};
exports.MonitorConfigKeys = MonitorConfigKeys;
var MonitorConfig = /** @class */ (function (_super) {
    __extends(MonitorConfig, _super);
    function MonitorConfig() {
        var _a;
        var _this = _super.call(this) || this;
        _this.config = (_a = {},
            _a[MonitorConfigKeys.Fps] = 10,
            _a[MonitorConfigKeys.MonitorDuration] = 30000,
            _a[MonitorConfigKeys.ShowResultAfterLaunch] = true,
            _a[MonitorConfigKeys.ShowSuggestModal] = true,
            _a);
        _this.init();
        return _this;
    }
    MonitorConfig.prototype.getConfig = function (key) {
        return this.config[key];
    };
    MonitorConfig.prototype.setConfig = function (key, value) {
        this.config[key] = value;
    };
    MonitorConfig.prototype.init = function () {
        var _a;
        try {
            var monitorConfig = ((_a = GameGlobalVars_1.default.unityNamespace) === null || _a === void 0 ? void 0 : _a.monitorConfig) || {};
            var clonedMonitorConfiguration = JSON.parse(JSON.stringify(monitorConfig));
            var isInjectConfigEnabledAndForceEnabled = !!clonedMonitorConfiguration.INJECT_CONIFG &&
                !!clonedMonitorConfiguration.FORCE_ENABLE;
            clonedMonitorConfiguration.enableMonitor =
                !!clonedMonitorConfiguration.enableMonitor ||
                    isInjectConfigEnabledAndForceEnabled;
            this.config = __assign(__assign({}, this.config), clonedMonitorConfiguration);
            this.config.SHOW_REPORT_MODAL =
                !!clonedMonitorConfiguration.SHOW_REPORT_MODAL;
        }
        catch (error) {
            this.config.enableMonitor = false;
        }
    };
    return MonitorConfig;
}(Instance_1.default));
exports.MonitorConfig = MonitorConfig;


/***/ }),

/***/ "./src/lib/Opera.ts":
/*!**************************!*\
  !*** ./src/lib/Opera.ts ***!
  \**************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var Common_1 = __webpack_require__(/*! ./Common */ "./src/lib/Common.ts");
var VideoPlayerInitializer_1 = __webpack_require__(/*! ./VideoPlayerInitializer */ "./src/lib/VideoPlayerInitializer.ts");
var FrameConstructor_1 = __importDefault(__webpack_require__(/*! ./FrameConstructor */ "./src/lib/FrameConstructor.ts"));
// module 6520
var Opera = /** @class */ (function () {
    function Opera(parsedData, director) {
        this.name = '';
        this.author = '';
        this.hash = 'none';
        this.delegateQueue = [];
        this.frames = [];
        this.storyLines = [];
        this.director = director || new EventManager_1.default();
        if (parsedData) {
            this.loadOperaData(parsedData);
        }
        else {
            this.EndFrame = this.createFrame(Types_1.FrameType.end);
        }
    }
    Opera.prototype.createFrame = function (frameData, frameParams, frameEvents) {
        var _this = this;
        this.frames.push(frameData);
        OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(this.director, CaseType_1.DirctorCaseType.FrameCreate, frameData);
        if (frameParams) {
            this.setFrameParams(frameData, frameParams);
        }
        if (frameEvents) {
            if (Array.isArray(frameEvents)) {
                frameEvents.forEach(function (event) { return _this.setFrameEvents(frameData, event); });
            }
            else {
                this.setFrameEvents(frameData, frameEvents);
            }
        }
        return frameData;
    };
    Opera.prototype.setFrameParams = function (eventParams, eventParamsSetter) {
        eventParams.setParams(eventParamsSetter);
    };
    Opera.prototype.setFrameEvents = function (eventManager, eventData) {
        eventManager.setEvents(eventData);
    };
    Opera.prototype.createStoryLine = function () {
        var storyLineInstance = new VideoPlayerInitializer_1.CreateEventInstance(this);
        this.storyLines.push(storyLineInstance);
        this.mainStoryLine || (this.mainStoryLine = storyLineInstance);
        return storyLineInstance;
    };
    Opera.prototype.createTempStoryLine = function (utilityFunctionParameter) {
        return new VideoPlayerInitializer_1.CreateEventInstance(this, utilityFunctionParameter);
    };
    Opera.prototype.getFrameById = function (uid) {
        for (var _i = 0, _a = this.frames; _i < _a.length; _i++) {
            var frame = _a[_i];
            if (frame.getUid() === uid) {
                return frame;
            }
        }
        return null;
    };
    Opera.prototype.getStoryLineById = function (uid) {
        for (var _i = 0, _a = this.storyLines; _i < _a.length; _i++) {
            var storyLine = _a[_i];
            if (storyLine.getUid() === uid) {
                return storyLine;
            }
        }
        return null;
    };
    Opera.prototype.exportData = function (storyData, hashFunction) {
        var _a;
        var storyDataDetails = {
            frames: this.exportDataFrame(),
            storyLines: this.exportDataStoryLines(),
            mainStoryLine: (_a = this.mainStoryLine) === null || _a === void 0 ? void 0 : _a.getUid(),
        };
        if (hashFunction) {
            this.hash = hashFunction(JSON.stringify(storyDataDetails)).substring(0, 8);
        }
        var exportedData = {
            name: (storyData === null || storyData === void 0 ? void 0 : storyData.name) || this.name,
            author: (storyData === null || storyData === void 0 ? void 0 : storyData.author) || this.author,
            version: Opera.Version,
            hash: this.hash,
            opera: storyDataDetails,
        };
        return JSON.stringify(exportedData);
    };
    Opera.prototype.exportDataFrame = function () {
        return this.frames.map(function (frame) { return frame.exportData(); });
    };
    Opera.prototype.exportDataStoryLines = function () {
        return this.storyLines.map(function (storyLine) { return storyLine.exportData(); });
    };
    Opera.prototype.loadOperaData = function (jsonData) {
        var _this = this;
        var parsedData = JSON.parse(jsonData);
        if (!Opera.CheckOperaDataStruct(parsedData)) {
            throw '传入数据不符合 OperaData 结构要求。';
        }
        var name = parsedData.name, author = parsedData.author, version = parsedData.version, hash = parsedData.hash, opera = parsedData.opera;
        if ((0, Common_1.compareVersion)(version, Opera.Version) > 0) {
            var versionWarningMessage = "\u5267\u672C\u7248\u672C ".concat(version, " \u5927\u4E8E\u5F53\u524D OperaData \u89E3\u91CA\u5668\u7248\u672C ").concat(Opera.Version, "\uFF0C\u65E0\u6CD5\u5BFC\u5165\u6570\u636E\u3002");
            console.warn("[launch-opera] ".concat(versionWarningMessage));
            throw versionWarningMessage;
        }
        this.name = name;
        this.author = author;
        this.hash = hash;
        opera.frames.forEach(function (frameData) {
            var frameInstance = new FrameConstructor_1.default(null, _this, frameData);
            _this.frames.push(frameInstance);
            OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(_this.director, CaseType_1.DirctorCaseType.FrameCreate, frameInstance);
        });
        opera.storyLines.forEach(function (storyLineData) {
            var newStoryLine = new VideoPlayerInitializer_1.VideoPlayerInitializer(_this, storyLineData);
            _this.storyLines.push(newStoryLine);
        });
        this.todoDelegate();
        this.mainStoryLine = this.getStoryLineById(opera.mainStoryLine);
        OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(this.director, CaseType_1.DirctorCaseType.OperaDataMounted, this);
    };
    Opera.prototype.delegateUid2Ob = function (eventType, eventID, toBaseValue, propertyIndex) {
        this.delegateQueue.push({
            type: eventType,
            uid: eventID,
            toBase: toBaseValue,
            toProp: propertyIndex,
        });
    };
    Opera.prototype.todoDelegate = function () {
        var _this = this;
        this.delegateQueue.forEach(function (delegateItem) {
            if (delegateItem.type === Types_1.OperaDataType.Frame) {
                delegateItem.toBase[delegateItem.toProp] = _this.getFrameById(delegateItem.uid);
            }
            else if (delegateItem.type === Types_1.OperaDataType.StoryLine) {
                delegateItem.toBase[delegateItem.toProp] = _this.getStoryLineById(delegateItem.uid);
            }
        });
        this.delegateQueue = [];
    };
    Opera.prototype.registerOperaPlayerEventListener = function () {
        // Implementation to be added
    };
    Opera.CheckOperaDataStruct = function (validateConfig) {
        return (typeof validateConfig.name === 'string' &&
            typeof validateConfig.author === 'string' &&
            typeof validateConfig.version === 'string' &&
            validateConfig.opera &&
            validateConfig.opera.frames &&
            validateConfig.opera.storyLines &&
            typeof validateConfig.opera.mainStoryLine === 'string');
    };
    Opera.eventEmitter = new EventManager_1.default();
    return Opera;
}());
Opera.Version = '1.0.6';
exports["default"] = Opera;


/***/ }),

/***/ "./src/lib/OperaPlayer.ts":
/*!********************************!*\
  !*** ./src/lib/OperaPlayer.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var Opera_1 = __importDefault(__webpack_require__(/*! ./Opera */ "./src/lib/Opera.ts"));
// module 6705
var OperaPlayer = /** @class */ (function (_super) {
    __extends(OperaPlayer, _super);
    function OperaPlayer(jsonVersion, operaData) {
        var _this = _super.call(this, jsonVersion, operaData) || this;
        _this.collectsParams = [];
        _this.currentRuntime = { storyLineStack: [], frame: null };
        _this.collectsParams = [];
        _this.registerOperaPlayerEventListener();
        return _this;
    }
    OperaPlayer.prototype.setGlobalVar = function (targetValue, _targetValue) {
        this.frames.forEach(function (_operaData) {
            var _a, _b;
            var globalName = (_b = (_a = _operaData.element.getParam('globalName')) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.toString();
            if (_operaData.getFrameType() === Types_1.FrameType.var && globalName === targetValue) {
                _operaData.setParams({ value: _targetValue });
            }
        });
    };
    OperaPlayer.prototype.getGlobalVar = function (globalNameToValue) {
        var _a, _b, _c;
        for (var _i = 0, _d = this.frames; _i < _d.length; _i++) {
            var iteratorValue = _d[_i];
            var globalName = (_b = (_a = iteratorValue.element.getParam('globalName')) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.toString();
            if (iteratorValue.getFrameType() === Types_1.FrameType.var && globalName === globalNameToValue) {
                var valueParameter = (_c = iteratorValue.element.getParam('value')) === null || _c === void 0 ? void 0 : _c.value;
                return valueParameter === null || valueParameter === void 0 ? void 0 : valueParameter.toString();
            }
        }
        return undefined;
    };
    OperaPlayer.prototype.getCurrentStoryLine = function () {
        if (!this.currentRuntime || this.currentRuntime.storyLineStack.length === 0) {
            return null;
        }
        return this.currentRuntime.storyLineStack[0];
    };
    OperaPlayer.prototype.nextFrame = function () {
        if (!this.currentRuntime) {
            if (!this.mainStoryLine) {
                var errorDetails = {
                    type: Types_1.ExceptionType.Director,
                    errmsg: '剧本没有主故事线无法播放，请先创建主故事线。',
                };
                OperaPlayer.eventEmitter.emit(this.director, CaseType_1.DirctorCaseType.Exception, errorDetails);
                return false;
            }
            this.currentRuntime = { storyLineStack: [], frame: null };
            OperaPlayer.eventEmitter.emit(this, CaseType_1.OperaPlayerCaseType.PlayStoryLine, this.mainStoryLine);
        }
        if (this.currentRuntime.storyLineStack.length > 0) {
            var nextFrameResult = this.currentRuntime.storyLineStack[0].nextFrame();
            if (!nextFrameResult) {
                this.currentRuntime.storyLineStack.shift();
            }
            this.pushCollectChangedParams();
            return !!nextFrameResult;
        }
        this.pushCollectChangedParams();
        return false;
    };
    OperaPlayer.prototype.registerOperaPlayerEventListener = function () {
        var self = this;
        Opera_1.default.eventEmitter.registerEvent(this, function (event) {
            var _a, _b, _c, _d, _e, _f, _g;
            var _h;
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (event) {
                case CaseType_1.OperaPlayerCaseType.ElementParamChange:
                    (_a = OperaPlayer.eventEmitter).emit.apply(_a, __spreadArray([self.director, CaseType_1.DirctorCaseType.FrameElementParamChange], args, false));
                    self.collectChangedParams(args[0], args[1], args[2], args[3]);
                    break;
                case CaseType_1.OperaPlayerCaseType.PlayFrame:
                    var frameParams = args[0];
                    self.updateRunttimeFrame(frameParams);
                    (_b = OperaPlayer.eventEmitter).emit.apply(_b, __spreadArray([self.director, CaseType_1.DirctorCaseType.PlayFrame], args, false));
                    break;
                case CaseType_1.OperaPlayerCaseType.PlayStoryLine:
                    var storyLineParameter = args[0];
                    (_h = self.currentRuntime) === null || _h === void 0 ? void 0 : _h.storyLineStack.unshift(storyLineParameter);
                    (_c = OperaPlayer.eventEmitter).emit.apply(_c, __spreadArray([self.director, CaseType_1.DirctorCaseType.PlayStoryLine], args, false));
                    break;
                case CaseType_1.OperaPlayerCaseType.EventLaunch:
                    var eventEmitterForElementParamChange = args[0];
                    self.todoEventLaunch(eventEmitterForElementParamChange);
                    break;
                case CaseType_1.OperaPlayerCaseType.Exception:
                    (_d = OperaPlayer.eventEmitter).emit.apply(_d, __spreadArray([self.director, CaseType_1.DirctorCaseType.Exception], args, false));
                    break;
                case CaseType_1.OperaPlayerCaseType.End:
                    (_e = OperaPlayer.eventEmitter).emit.apply(_e, __spreadArray([self.director, CaseType_1.DirctorCaseType.End], args, false));
                    break;
                case CaseType_1.OperaPlayerCaseType.ReportStoryEnd:
                    (_f = OperaPlayer.eventEmitter).emit.apply(_f, __spreadArray([self.director, CaseType_1.DirctorCaseType.ReportStoryEnd], args, false));
                    break;
                case CaseType_1.OperaPlayerCaseType.ReportStoryStart:
                    (_g = OperaPlayer.eventEmitter).emit.apply(_g, __spreadArray([self.director, CaseType_1.DirctorCaseType.ReportStoryStart], args, false));
                    break;
            }
        });
    };
    OperaPlayer.prototype.updateRunttimeFrame = function (_frameValue) {
        this.currentRuntime.frame = _frameValue;
    };
    OperaPlayer.prototype.todoEventLaunch = function (event) {
        var _this = this;
        var tempStoryLine = this.createTempStoryLine(event);
        event.bind.forEach(function (properties) {
            tempStoryLine.add(_this.getBindEventOb(properties));
        });
        tempStoryLine.play();
    };
    OperaPlayer.prototype.getBindEventOb = function (event) {
        if (event.type === Types_1.OperaDataType.StoryLine) {
            return this.getFrameById(event.uid);
        }
        else if (event.type === Types_1.OperaDataType.Frame) {
            return this.getStoryLineById(event.uid);
        }
        else {
            return undefined;
        }
    };
    OperaPlayer.prototype.collectChangedParams = function (frameData, paramName, oldParamValue, newParamValue) {
        this.collectsParams.push({
            frame: frameData,
            paramName: paramName,
            oldValue: oldParamValue,
            newValue: newParamValue,
        });
    };
    OperaPlayer.prototype.pushCollectChangedParams = function () {
        var _this = this;
        var frameParamsMap = new Map();
        this.collectsParams.forEach(function (currentContext) {
            var _a;
            if (frameParamsMap.has(currentContext.frame)) {
                var currentFrameParams = frameParamsMap.get(currentContext.frame);
                if (currentFrameParams[currentContext.paramName]) {
                    currentFrameParams[currentContext.paramName].value = currentContext.newValue;
                }
                else {
                    currentFrameParams[currentContext.paramName] = {
                        value: currentContext.newValue,
                        oldValue: currentContext.oldValue,
                    };
                }
            }
            else {
                var frameParameter = (_a = {},
                    _a[currentContext.paramName] = {
                        value: currentContext.newValue,
                        oldValue: currentContext.oldValue,
                    },
                    _a);
                frameParamsMap.set(currentContext.frame, frameParameter);
            }
        });
        frameParamsMap.forEach(function (isValidOperation, eventEmitterArguments) {
            OperaPlayer.eventEmitter.emit(_this.director, CaseType_1.DirctorCaseType.FrameElementParamChangeUpdate, eventEmitterArguments, isValidOperation);
        });
        this.collectsParams = [];
    };
    OperaPlayer.eventEmitter = new EventManager_1.default();
    return OperaPlayer;
}(Opera_1.default));
exports["default"] = OperaPlayer;


/***/ }),

/***/ "./src/lib/OperaPlayerHandler.ts":
/*!***************************************!*\
  !*** ./src/lib/OperaPlayerHandler.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.OperaPlayerHandler = void 0;
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var ViewElementManager_1 = __webpack_require__(/*! ./ViewElementManager */ "./src/lib/ViewElementManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var SessionRecorder_1 = __webpack_require__(/*! ./SessionRecorder */ "./src/lib/SessionRecorder.ts");
var Reporter_1 = __importDefault(__webpack_require__(/*! ./Reporter */ "./src/lib/Reporter.ts"));
var OperaPlayer_1 = __importDefault(__webpack_require__(/*! ./OperaPlayer */ "./src/lib/OperaPlayer.ts"));
// module 4339
var OperaPlayerHandler = /** @class */ (function () {
    function OperaPlayerHandler(eventEmitterInstance) {
        this.operaPlayerReady = false;
        this.viewerReady = false;
        this.callbackErr = [];
        this.callbackEnd = [];
        this.callbackWeakNetwork = [];
        this.callbackGlobalVar = [];
        this.component = {};
        this.componentPrototype = eventEmitterInstance;
        return this.initProxy();
    }
    OperaPlayerHandler.prototype.init = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                try {
                    this.viewer.setDirctor(this);
                    this.registerOperaDataEventListener();
                    this.initCompnents(this.componentPrototype);
                    this.operaPlayer = new OperaPlayer_1.default({}, this);
                    if (this.report) {
                        this.report.hash = this.operaPlayer.hash;
                    }
                }
                catch (error) {
                    this.throwErr(error);
                }
                return [2 /*return*/];
            });
        });
    };
    OperaPlayerHandler.prototype.play = function (eventHandler) {
        SessionRecorder_1.SessionRecorder.eventEmitter.emit(this.logger, CaseType_1.LoggerCaseType.Reset);
        if (eventHandler) {
            eventHandler.bindDirector(this);
            eventHandler.exec();
        }
        while (this.operaPlayer.nextFrame()) { }
    };
    OperaPlayerHandler.prototype.end = function () {
        OperaPlayerHandler.eventEmitter.emit(this, CaseType_1.DirctorCaseType.End);
    };
    OperaPlayerHandler.prototype.nextFrame = function () {
        this.operaPlayer.nextFrame();
    };
    OperaPlayerHandler.prototype.print = function () {
        console.log(this.operaPlayer.exportData());
    };
    OperaPlayerHandler.prototype.onErr = function (callback) {
        if (!this.callbackErr.includes(callback)) {
            this.callbackErr.push(callback);
        }
    };
    OperaPlayerHandler.prototype.throwErr = function (errorInfo) {
        var errorDetails = { errinfo: errorInfo };
        Reporter_1.default.eventEmitter.emit(this.report, CaseType_1.ReportCaseType.err, errorDetails);
        this.callbackErr.forEach(function (callback) {
            if (typeof callback === 'function') {
                callback(errorInfo);
            }
        });
    };
    OperaPlayerHandler.prototype.onEnd = function (callback) {
        if (!this.callbackEnd.includes(callback)) {
            this.callbackEnd.push(callback);
        }
    };
    OperaPlayerHandler.prototype.throwEnd = function () {
        var _this = this;
        var eventDetails = {
            id: '0',
            event: '-',
            status: Types_1.ReportStatusType.end,
        };
        Reporter_1.default.eventEmitter.emit(this.report, CaseType_1.ReportCaseType.sys, eventDetails);
        this.callbackEnd.forEach(function (callback) {
            if (typeof callback === 'function') {
                callback(_this.logger);
            }
        });
        SessionRecorder_1.SessionRecorder.eventEmitter.emit(this.logger, CaseType_1.LoggerCaseType.End);
        Reporter_1.default.eventEmitter.emit(this.report, CaseType_1.ReportCaseType.end);
    };
    OperaPlayerHandler.prototype.offErr = function (callback) {
        var index = this.callbackErr.indexOf(callback);
        if (index !== -1) {
            this.callbackErr.splice(index, 1);
        }
    };
    OperaPlayerHandler.prototype.onWeakNetwork = function (callback) {
        if (!this.callbackWeakNetwork.includes(callback)) {
            this.callbackWeakNetwork.push(callback);
        }
    };
    OperaPlayerHandler.prototype.throwWeakNetwork = function (networkEvent) {
        this.callbackWeakNetwork.forEach(function (callback) {
            if (typeof callback === 'function') {
                callback(networkEvent);
            }
        });
    };
    OperaPlayerHandler.prototype.offWeakNetwork = function (callback) {
        var index = this.callbackWeakNetwork.indexOf(callback);
        if (index !== -1) {
            this.callbackWeakNetwork.splice(index, 1);
        }
    };
    OperaPlayerHandler.prototype.setGlobalVar = function (variableName, value) {
        SessionRecorder_1.SessionRecorder.eventEmitter.emit(this.logger, CaseType_1.LoggerCaseType.LoggerPush, {
            t: Types_1.LoggerType.GlobalVarAction,
            l: {
                n: variableName,
                v: value,
            },
        });
        this.operaPlayer.setGlobalVar(variableName, value);
    };
    OperaPlayerHandler.prototype.getGlobalVar = function (variableName) {
        return this.operaPlayer.getGlobalVar(variableName);
    };
    OperaPlayerHandler.prototype.onGlobalVarChange = function (globalName, callback) {
        this.callbackGlobalVar.push({ globalName: globalName, callback: callback });
    };
    OperaPlayerHandler.prototype.offGlobalVarChange = function (globalName, callback) {
        var index = this.callbackGlobalVar.findIndex(function (item) { return item.globalName === globalName && item.callback === callback; });
        if (index !== -1) {
            this.callbackGlobalVar.splice(index, 1);
        }
    };
    OperaPlayerHandler.prototype.checkReady = function () {
        if (this.operaPlayerReady && this.viewerReady) {
            var eventData = {
                id: '0',
                event: '-',
                status: Types_1.ReportStatusType.start,
            };
            Reporter_1.default.eventEmitter.emit(this.report, CaseType_1.ReportCaseType.sys, eventData);
        }
    };
    OperaPlayerHandler.prototype.registerOperaDataEventListener = function () {
        var self = this;
        OperaPlayerHandler.eventEmitter.registerEvent(this, function (eventHandler) {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j;
            var _k, _l;
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (eventHandler) {
                case CaseType_1.DirctorCaseType.FrameElementParamChange:
                    if (self.operaPlayerReady) {
                        (_a = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_a, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.FrameElementParamChange], args, false));
                    }
                    break;
                case CaseType_1.DirctorCaseType.UpdateParams:
                    self.operaPlayer.pushCollectChangedParams();
                    break;
                case CaseType_1.DirctorCaseType.FrameCreate:
                    (_b = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_b, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.FrameCreate], args, false));
                    break;
                case CaseType_1.DirctorCaseType.PlayFrame:
                    (_c = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_c, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.PlayFrame], args, false));
                    break;
                case CaseType_1.DirctorCaseType.PlayStoryLine:
                    self.play();
                    break;
                case CaseType_1.DirctorCaseType.OperaDataMounted:
                    Object.keys(self.component).forEach(function (componentName) {
                        self.component[componentName].created(args[0]);
                    });
                    (_d = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_d, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.OperaDataMounted], args, false));
                    self.operaPlayerReady = true;
                    self.checkReady();
                    break;
                case CaseType_1.DirctorCaseType.ViewerReady:
                    self.viewerReady = true;
                    self.checkReady();
                    break;
                case CaseType_1.DirctorCaseType.Exception:
                    self.throwErr(args[0]);
                    break;
                case CaseType_1.DirctorCaseType.End:
                    (_e = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_e, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.End], args, false));
                    self.throwEnd();
                    break;
                case CaseType_1.DirctorCaseType.FrameElementParamChangeUpdate:
                    (_f = ViewElementManager_1.ViewerElementHandler.eventEmitter).emit.apply(_f, __spreadArray([self.viewer, CaseType_1.ViewerBaseCaseType.FrameElementParamChangeUpdate], args, false));
                    var eventEmitter = args[0];
                    if (eventEmitter.getFrameType() === Types_1.FrameType.var) {
                        var eventGlobalName_1 = (_l = (_k = eventEmitter.element.getParam('globalName')) === null || _k === void 0 ? void 0 : _k.value) === null || _l === void 0 ? void 0 : _l.toString();
                        var eventArgumentValue_1 = args[1].value;
                        if (eventGlobalName_1 && eventArgumentValue_1) {
                            self.callbackGlobalVar.forEach(function (item) {
                                if (item.globalName === eventGlobalName_1) {
                                    item.callback(eventArgumentValue_1);
                                }
                            });
                        }
                    }
                    break;
                case CaseType_1.DirctorCaseType.Report:
                    (_g = Reporter_1.default.eventEmitter).emit.apply(_g, __spreadArray([self.report, CaseType_1.ReportCaseType.custom], args, false));
                    break;
                case CaseType_1.DirctorCaseType.ReportStoryEnd:
                    self.reportStoryLine(args[0], Types_1.ReportStatusType.end);
                    break;
                case CaseType_1.DirctorCaseType.ReportStoryStart:
                    self.reportStoryLine(args[0], Types_1.ReportStatusType.start);
                    break;
                case CaseType_1.DirctorCaseType.CheckPoint:
                    self.reportStoryLine(self.operaPlayer.getCurrentStoryLine(), Types_1.ReportStatusType.checkPoint);
                    break;
                case CaseType_1.DirctorCaseType.ReportCheckPointCount:
                    var eventDetails = {
                        id: '0',
                        event: args[0] || '-1',
                        status: Types_1.ReportStatusType.checkPointCount,
                    };
                    Reporter_1.default.eventEmitter.emit(self.report, CaseType_1.ReportCaseType.sys, eventDetails);
                    break;
                case CaseType_1.DirctorCaseType.LoggerPush:
                    (_h = SessionRecorder_1.SessionRecorder.eventEmitter).emit.apply(_h, __spreadArray([self.logger, CaseType_1.LoggerCaseType.LoggerPush], args, false));
                    break;
                case CaseType_1.DirctorCaseType.ReportLogger:
                    (_j = Reporter_1.default.eventEmitter).emit.apply(_j, __spreadArray([self.report, CaseType_1.ReportCaseType.logger], args, false));
                    break;
                case CaseType_1.DirctorCaseType.LoggerEmitEvent:
                    self.loggerEmitEvent(args[0]);
                    break;
                case CaseType_1.DirctorCaseType.WeakNetwork:
                    self.throwWeakNetwork(args[0]);
                    break;
            }
        });
    };
    OperaPlayerHandler.prototype.reportStoryLine = function (eventObject, eventStatus) {
        var _a;
        var eventDetails = {
            id: (eventObject === null || eventObject === void 0 ? void 0 : eventObject.getUid()) || '-1',
            event: ((_a = eventObject === null || eventObject === void 0 ? void 0 : eventObject.getRelatedEvent()) === null || _a === void 0 ? void 0 : _a.event) || '-',
            status: eventStatus,
        };
        Reporter_1.default.eventEmitter.emit(this.report, CaseType_1.ReportCaseType.sys, eventDetails);
    };
    OperaPlayerHandler.prototype.initCompnents = function (componentInput) {
        var _this = this;
        var componentsList = [];
        if (componentInput) {
            if (Array.isArray(componentInput)) {
                componentsList.push.apply(componentsList, componentInput);
            }
            else {
                componentsList.push(componentInput);
            }
            componentsList.forEach(function (component) {
                if (!_this.component[component.componentName]) {
                    _this.component[component.componentName] = new component(_this);
                }
            });
        }
    };
    OperaPlayerHandler.prototype.initProxy = function () {
        var _this = this;
        return new Proxy(this, {
            get: function (target, propertyName) { var _a, _b; return (_a = Reflect.get(target, propertyName)) !== null && _a !== void 0 ? _a : (_b = _this.component[propertyName]) === null || _b === void 0 ? void 0 : _b.handler; }
        });
    };
    OperaPlayerHandler.prototype.loggerEmitEvent = function (logDetails) {
        console.log(logDetails, logDetails.l);
        switch (logDetails.t) {
            case Types_1.LoggerType.GlobalVarAction:
                var logDetailsLocal = logDetails.l;
                this.setGlobalVar(logDetailsLocal.n, logDetailsLocal.v);
                break;
            case Types_1.LoggerType.ViewAction:
                ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.LoggerEmitEvent, logDetails.l);
                break;
        }
    };
    OperaPlayerHandler.eventEmitter = new EventManager_1.default();
    return OperaPlayerHandler;
}());
exports.OperaPlayerHandler = OperaPlayerHandler;


/***/ }),

/***/ "./src/lib/ParseXmlContent.ts":
/*!************************************!*\
  !*** ./src/lib/ParseXmlContent.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var WebglRender_1 = __webpack_require__(/*! ./WebglRender */ "./src/lib/WebglRender.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./UnityManager */ "./src/lib/UnityManager.ts"));
var ImagePreviewer_1 = __webpack_require__(/*! ../coverview/ImagePreviewer */ "./src/coverview/ImagePreviewer.ts");
// import {nativeviewLayout} from "../coverview/CoverviewLayouts";
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var pixiGraphicsLibrary = __webpack_require__(/*! ../coverview/pixi.min */ "./src/coverview/pixi.min.js");
function initStyles() {
    var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight;
    return {
        body: {
            position: "relative",
            overflow: "hidden",
            hidden: false,
            opacity: 1,
            width: screenWidth,
            height: screenHeight,
        },
        video: {
            position: "absolute",
            top: 0,
            left: 0,
            width: screenWidth,
            height: screenHeight,
        },
        container: {
            position: "absolute",
            overflow: "hidden",
            hidden: false,
            top: 0,
            left: 0,
            backgroundColor: "#ffffff",
        },
        bgImg: {
            position: "absolute",
            top: 0,
            left: 0,
            width: screenWidth,
            height: screenHeight,
        },
        loadingWrap: {
            position: "absolute",
            overflow: "hidden",
            textAlign: "center",
            width: 240,
            height: 24,
            borderRadius: 12,
            backgroundColor: "#000000",
            opacity: 0.5,
            bottom: 64,
            left: (screenWidth - 240) / 2,
        },
        loadingInnerWrap: {
            position: "absolute",
            overflow: "hidden",
            width: 236,
            height: 20,
            bottom: 66,
            borderRadius: 10,
            left: (screenWidth - 240) / 2 + 2,
        },
        loadingInner: {
            position: "absolute",
            overflow: "hidden",
            width: 236,
            height: 20,
            borderRadius: 10,
            backgroundColor: "#07c160",
            top: 0,
            left: -236,
        },
        loadingInnerFake: {
            position: "absolute",
            overflow: "hidden",
            width: 236,
            height: 20,
            borderRadius: 10,
            backgroundColor: "#07c160",
            top: 0,
            left: -236,
        },
        loadingInnerSecond: {
            position: "absolute",
            overflow: "hidden",
            width: 236,
            height: 20,
            borderRadius: 10,
            backgroundColor: "#07c160",
            top: 0,
            left: -236,
        },
        loadingText: {
            position: "absolute",
            textAlign: "center",
            color: "#ffffff",
            letterSpacing: 1,
            fontSize: 12,
            width: 240,
            height: 20,
            lineHeight: 20,
        },
        unityLogo: {
            position: "absolute",
            width: 64,
            height: 24,
            bottom: 20,
            left: (screenWidth - 64) / 2,
        },
    };
}
function parseXmlContent() {
    var _this = this;
    var _a, _b;
    var _c = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _c.screenWidth, screenHeight = _c.screenHeight, enableDebug = _c.enableDebug, coverviewCustomized = SystemEnvironmentVariables_1.default.pluginEnv.coverviewCustomized, ks = SystemEnvironmentVariables_1.default.ks;
    function parseXML(xmlContent) {
        xmlContent = xmlContent.trim().replace(/<!--[\s\S]*?-->/g, "");
        return {
            declaration: parseXmlDeclaration(),
            root: parseRootElement(),
        };
        function parseXmlDeclaration() {
            if (findAndProcessMatch(/^<\?xml\s*/)) {
                var parsedAttributes = {};
                while (!isEmpty() && !startsWith("?>")) {
                    var htmlAttribute = extractHtmlAttribute();
                    if (!htmlAttribute) {
                        return { attributes: parsedAttributes, };
                    }
                    parsedAttributes[htmlAttribute.name] = htmlAttribute.value;
                }
                findAndProcessMatch(/\?>\s*/);
                return { attributes: parsedAttributes, };
            }
        }
        function parseRootElement() {
            var matchRootElementTag = findAndProcessMatch(/^<([\w-:.]+)\s*/);
            if (matchRootElementTag) {
                var parsedElement = {
                    name: matchRootElementTag[1],
                    attributes: {},
                    children: [],
                };
                while (!isEmpty() && !startsWith(">") && !startsWith("/>")) {
                    var htmlAttribute = extractHtmlAttribute();
                    if (!htmlAttribute) {
                        return parsedElement;
                    }
                    parsedElement.attributes[htmlAttribute.name] =
                        htmlAttribute.value;
                }
                if (findAndProcessMatch(/^\s*\/>\s*/)) {
                    return parsedElement;
                }
                findAndProcessMatch(/\??>\s*/);
                parsedElement.content = extractPlainTextFromContent();
                var nestedElement = void 0;
                while ((nestedElement = parseRootElement())) {
                    parsedElement.children.push(nestedElement);
                }
                findAndProcessMatch(/^<\/[\w-:.]+>\s*/);
                return parsedElement;
            }
        }
        function extractHtmlAttribute() {
            var htmlAttributeMatch = findAndProcessMatch(/([\w:-]+)\s*=\s*("[^"]*"|'[^']*'|\w+)\s*/);
            if (htmlAttributeMatch) {
                var value = htmlAttributeMatch[2].replace(/^['"]|['"]$/g, "");
                return { name: htmlAttributeMatch[1], value: value, };
            }
        }
        function findAndProcessMatch(regexPattern) {
            var result = xmlContent.match(regexPattern);
            if (result) {
                xmlContent = xmlContent.slice(result[0].length);
                return result;
            }
        }
        function isEmpty() {
            return xmlContent.length === 0;
        }
        function startsWith(prefix) {
            return xmlContent.indexOf(prefix) === 0;
        }
        function extractPlainTextFromContent() {
            var extractedPlainText = findAndProcessMatch(/^([^<]*)/);
            if (extractedPlainText) {
                return extractedPlainText[1];
            }
            else {
                return "";
            }
        }
    }
    var parseXmlMessage = "\n                <view id=\"body\"> \n                    <view id=\"container\"> \n                        <image id=\"bg-img\" /> \n                        <video id=\"video\" controls=\"false\" obeymuteswitch=\"true\" pagegesture=\"false\" loop=\"true\" muted=\"true\" autoplay=\"false\" object-fit=\"cover\" enable-progress-gesture=\"false\" enable-play-gesture=\"false\" show-center-play-btn=\"false\" auto-insert=\"false\"></video> \n                        <view id=\"loading-wrap\"></view> \n                        <view id=\"loading-inner-wrap\"></view> \n                        <view id=\"loading-inner\"></view> \n                        <view id=\"loading-inner-fake\"></view> \n                        <view id=\"loading-inner-second\"></view> \n                        <text id=\"loading-text\" value=\"\u6B63\u5728\u52A0\u8F7D\"></text> \n                        <image id=\"unity-logo\" src=\"\" /> \n                    </view> \n                 </view> ";
    if (!(0, ImagePreviewer_1.getComponent)(this)) {
        (0, ImagePreviewer_1.setComponent)(this);
    }
    // const imagePreviewer = getComponent(this);
    var root = parseXML(parseXmlMessage).root;
    var styles = JSON.parse(JSON.stringify(initStyles()));
    var container = findChildById(root, "container");
    var video = findChildById(root, "video");
    var bgImg = findChildById(root, "bg-img");
    var unityLogo = findChildById(root, "unity-logo");
    styles.body.hidden = !this.isVisible;
    if (this.materialConfig.backgroundImage) {
        bgImg.attributes.src = this.materialConfig.backgroundImage;
        var _d = this.backgroundImageInfo, backgroundImageWidth = _d.width, backgroundImageHeight = _d.height;
        if (this.isDefaultLoading) {
            var scaledWidth = (backgroundImageWidth / backgroundImageHeight) * screenHeight;
            if (scaledWidth < screenWidth) {
                var scaledHeight = (backgroundImageHeight / backgroundImageWidth) * screenWidth;
                styles.bgImg.width = screenWidth / this.scaleX;
                styles.bgImg.height = scaledHeight / this.scaleY;
                styles.bgImg.top = -(scaledHeight - screenHeight) / 2 / this.scaleY;
            }
            else {
                styles.bgImg.height = screenHeight / this.scaleY;
                styles.bgImg.width = scaledWidth / this.scaleX;
                styles.bgImg.left = -(scaledWidth - screenWidth) / 2 / this.scaleX;
            }
        }
        else {
            styles.bgImg.height = this.designHeight;
            styles.bgImg.width = this.designWidth;
            styles.bgImg.left = 0;
            styles.bgImg.top = 0;
        }
    }
    else {
        filterElementChildrenById(container, "bg-img");
    }
    if ((_a = this.extensionButton) === null || _a === void 0 ? void 0 : _a.length) {
        this.extensionButton.forEach(function (item) {
            container.children.push({
                name: "image",
                content: "",
                children: [],
                attributes: {
                    id: item.id,
                    src: item.image,
                },
            });
            var styleAttributes = {};
            Object.keys(item.style).forEach(function (style) {
                if (item.style[style] !== undefined) {
                    styleAttributes[style] = item.style[style];
                }
            });
            styles[item.id] = Object.assign({
                position: "absolute",
            }, styleAttributes);
        });
    }
    if (this.materialConfig.backgroundVideo) {
        if (this.isDefaultLoading) {
            styles.video.height = screenHeight / this.scaleY;
            styles.video.width = screenWidth / this.scaleX;
        }
        else {
            styles.video.height = this.designHeight;
            styles.video.width = this.designWidth;
        }
        video.attributes.src = this.materialConfig.backgroundVideo;
    }
    else {
        filterElementChildrenById(container, "video");
    }
    if (this.iconConfig.visible) {
        unityLogo.attributes.src = this.materialConfig.iconImage;
    }
    else {
        filterElementChildrenById(container, "unity-logo");
    }
    styles.container.width = this.designWidth;
    styles.container.height = this.designHeight;
    styles.container.left = (screenWidth - this.designWidth) / 2;
    styles.container.top = (screenHeight - this.designHeight) / 2;
    styles.container.scaleWidth = this.scaleX;
    styles.container.scaleHeight = this.scaleY;
    var barComputedStyle = this.barComputedStyle;
    var barWrapStyle = {
        width: barComputedStyle.width,
        height: barComputedStyle.height,
        borderRadius: barComputedStyle.borderRadius || barComputedStyle.height / 2,
        left: barComputedStyle.left || (this.designWidth - barComputedStyle.width) / 2,
        bottom: barComputedStyle.bottom,
        right: barComputedStyle.right,
        top: barComputedStyle.top,
    };
    mergeStyles(styles.loadingWrap, barWrapStyle);
    var calculatedStyles = {
        width: barComputedStyle.width - barComputedStyle.padding * 2,
        height: barComputedStyle.height - barComputedStyle.padding * 2,
        borderRadius: (barComputedStyle.height - barComputedStyle.padding * 2) / 2,
        backgroundColor: barComputedStyle.backgroundColor,
        left: -(barComputedStyle.width - barComputedStyle.padding * 2),
    };
    mergeStyles(styles.loadingInnerWrap, {
        width: calculatedStyles.width,
        height: calculatedStyles.height,
        borderRadius: calculatedStyles.borderRadius,
        left: styles.loadingWrap.left + barComputedStyle.padding,
        bottom: barComputedStyle.bottom + barComputedStyle.padding,
    });
    this.trueInnerImageWidth = calculatedStyles.width;
    copyStyles(styles.loadingInner, calculatedStyles);
    copyStyles(styles.loadingInnerFake, calculatedStyles);
    copyStyles(styles.loadingInnerSecond, calculatedStyles);
    var textConfigStyle = this.textConfig.style;
    styles.loadingText.width = textConfigStyle.width;
    styles.loadingText.left = (this.designWidth - textConfigStyle.width) / 2;
    styles.loadingText.height = textConfigStyle.height;
    styles.loadingText.lineHeight = textConfigStyle.height;
    styles.loadingText.bottom = textConfigStyle.bottom;
    styles.loadingText.color = textConfigStyle.color;
    styles.loadingText.fontSize = textConfigStyle.fontSize;
    if (this.iconConfig.visible) {
        var iconStyle = this.iconConfig.style;
        styles.unityLogo.width = iconStyle.width;
        styles.unityLogo.height = iconStyle.height;
        styles.unityLogo.bottom = iconStyle.bottom;
        styles.unityLogo.left = (this.designWidth - iconStyle.width) / 2;
    }
    (0, ImagePreviewer_1.initComponent)(this, root, styles);
    // nativeviewLayout.add(imagePreviewer.body);
    // if (systemInformation.isWK && enableDebug && this.iconConfig.visible) {
    //     let clickCount = 0;
    //     imagePreviewer.unityLogo.on("click", () => {
    //         if ((clickCount += 1) === 3) {
    //             this.destory();
    //         }
    //     });
    // }
    var _e = ks.getSystemInfoSync(), pixelRatio = _e.pixelRatio, windowWidth = _e.windowWidth, windowHeight = _e.windowHeight;
    var view = ks.createCanvas();
    var application = new pixiGraphicsLibrary.Application({
        width: windowWidth * pixelRatio,
        height: windowHeight * pixelRatio,
        view: view,
        backgroundColor: 0xffffff,
        antialias: true,
        resolution: pixelRatio,
        forceCanvas: true,
    });
    application.renderer.resize(windowWidth, windowHeight);
    var imageSrc;
    if (coverviewCustomized) {
        imageSrc = this.materialConfig.backgroundImage;
    }
    else {
        // receive base64 image data as input
        var defaultCoverview = ((_b = ks.customObj) === null || _b === void 0 ? void 0 : _b.defaultCoverview) || "";
        var overrideCoverview = false;
        // tap default coverview override check
        if (typeof defaultCoverview === 'string' && defaultCoverview.trim() !== '') {
            if (defaultCoverview.startsWith('data:image/')) {
                overrideCoverview = true;
            }
        }
        if (overrideCoverview) {
            imageSrc = defaultCoverview;
        }
        else {
            imageSrc = this.materialConfig.backgroundImage;
        }
    }
    return new Promise(function (resolve) {
        pixiGraphicsLibrary.loader
            .add("bgImage", imageSrc)
            .add("iconImage", _this.materialConfig.iconImage)
            .load(function (initializeBackground, element) {
            var backgroundTexture = element.bgImage.texture;
            var backgroundTextureOriginalWidth = backgroundTexture.width;
            var backgroundTextureOriginalHeight = backgroundTexture.height;
            var backgroundScaleFactor = Math.max(windowWidth / backgroundTextureOriginalWidth, windowHeight / backgroundTextureOriginalHeight);
            var backgroundSprite = new pixiGraphicsLibrary.Sprite(backgroundTexture);
            backgroundSprite.width = backgroundTextureOriginalWidth * backgroundScaleFactor;
            backgroundSprite.height = backgroundTextureOriginalHeight * backgroundScaleFactor;
            backgroundSprite.x = (windowWidth - backgroundSprite.width) / 2;
            backgroundSprite.y = (windowHeight - backgroundSprite.height) / 2;
            application.stage.addChild(backgroundSprite);
            var loadingOverlayGraphics = new pixiGraphicsLibrary.Graphics();
            var loadingIndicatorBorderRadius = styles.loadingWrap.borderRadius;
            var loadingBarWidth = styles.loadingWrap.width;
            var loadingBarHeight = styles.loadingWrap.height;
            loadingOverlayGraphics.alpha = styles.loadingWrap.opacity;
            loadingOverlayGraphics.beginFill(0);
            loadingOverlayGraphics.drawRoundedRect(styles.loadingWrap.left, windowHeight - styles.loadingWrap.bottom - styles.loadingWrap.height -
                5, loadingBarWidth, loadingBarHeight, loadingIndicatorBorderRadius);
            loadingOverlayGraphics.endFill();
            application.stage.addChild(loadingOverlayGraphics);
            var initializeBackgroundAndSetupLoadingOverlay = new pixiGraphicsLibrary.Graphics();
            application.stage.addChild(initializeBackgroundAndSetupLoadingOverlay);
            var loadingOverlayTexture = element.iconImage.texture;
            var sprite = new pixiGraphicsLibrary.Sprite(loadingOverlayTexture);
            sprite.anchor.set(0.5, 0.5);
            sprite.x = windowWidth - styles.unityLogo.left - styles.unityLogo.width / 2;
            sprite.y = windowHeight - styles.unityLogo.bottom - styles.unityLogo.height / 2;
            sprite.height = styles.unityLogo.height;
            sprite.width = styles.unityLogo.width;
            application.stage.addChild(sprite);
            var container = new pixiGraphicsLibrary.Container();
            container.x = styles.loadingWrap.left + styles.loadingWrap.width / 2;
            container.y = windowHeight - styles.loadingWrap.bottom - styles.loadingWrap.height / 1.35;
            container.width = styles.loadingWrap.width;
            container.height = styles.loadingWrap.height;
            application.stage.addChild(container);
            var unityManager = UnityManager_1.default.getInstance();
            var text = new pixiGraphicsLibrary.Text(DefaultLanguageMap_1.default.loadingPage_initText, {
                fontSize: "12px",
                fill: 0xffffff,
                align: "center",
            });
            text.anchor.set(0.5, 0.5);
            text.x = container.width / 2;
            text.y = container.height / 2;
            container.addChild(text);
            var progress = 0;
            var currentStage = -1;
            var renderer = (0, WebglRender_1.initializeWebglRendering)(GameGlobalVars_1.default.unityNamespace.globalGL, windowWidth, windowHeight);
            function updateLoadingBar(progress) {
                initializeBackgroundAndSetupLoadingOverlay.clear();
                initializeBackgroundAndSetupLoadingOverlay.beginFill(0x07C160);
                initializeBackgroundAndSetupLoadingOverlay.drawRoundedRect(styles.loadingWrap.left + 3, windowHeight - styles.loadingWrap.bottom - styles.loadingWrap.height - 2.5, (styles.loadingWrap.width - 6) * progress, styles.loadingWrap.height - 5, styles.loadingWrap.borderRadius - 1.8);
                initializeBackgroundAndSetupLoadingOverlay.endFill();
            }
            function updateProgressBar() {
                progress += Math.random() * 0.003;
                if (progress > 1) {
                    progress = 1;
                }
                updateLoadingBar(progress);
                var latestStage = unityManager.loadingPage.latestStage;
                if (latestStage !== currentStage) {
                    currentStage = latestStage;
                    var loadingStageText = "";
                    switch (currentStage) {
                        case 0:
                            loadingStageText = DefaultLanguageMap_1.default.loadingPage_downloadingText;
                            break;
                        case 1:
                            loadingStageText = DefaultLanguageMap_1.default.loadingPage_compilingText;
                            break;
                        case 2:
                            loadingStageText = DefaultLanguageMap_1.default.loadingPage_completeText;
                            break;
                        default:
                            loadingStageText = DefaultLanguageMap_1.default.loadingPage_firstStartText;
                    }
                    container.removeChildren();
                    var text_1 = new pixiGraphicsLibrary.Text(loadingStageText, {
                        fontSize: "12px",
                        fill: 0xffffff,
                        align: "center",
                    });
                    text_1.anchor.set(0.5, 0.5);
                    text_1.x = container.width / 2;
                    text_1.y = container.height / 2;
                    container.addChild(text_1);
                    progress = (1 / 4) * (currentStage + 1);
                    updateLoadingBar(progress);
                }
                application.render();
                if (progress <= 1) {
                    var animationFrameId = requestAnimationFrame(updateProgressBar);
                    if (unityManager.mainCalled == false) {
                        renderer(view);
                    }
                    else {
                        cancelAnimationFrame(animationFrameId);
                        application.destroy(true, true);
                        return;
                    }
                }
            }
            updateProgressBar();
            // imagePreviewer.body.update();
            // imagePreviewer.body.ready();
            resolve(1);
        });
    });
    // if (this?.extensionButton?.forEach) {
    //     this.extensionButton.forEach((element: any) => {
    //         imagePreviewer[element.id].on("click", () => {
    //             element?.callback?.call(element);
    //         });
    //     });
    // }
}
function findChildById(elements, id) {
    var foundChild = null;
    for (var _i = 0, _a = elements.children; _i < _a.length; _i++) {
        var child = _a[_i];
        if (child.attributes && child.attributes.id === id) {
            foundChild = child;
            break;
        }
        if (child.children.length > 0) {
            var foundChildElement = findChildById(child, id);
            if (foundChildElement !== null) {
                foundChild = foundChildElement;
                break;
            }
        }
    }
    return foundChild;
}
function filterElementChildrenById(element, id) {
    element.children = element.children.filter(function (item) { return item.attributes.id !== id; });
}
function mergeStyles(styles, toMergeStyles) {
    if (styles && typeof styles === 'object') {
        Object.keys(toMergeStyles).forEach(function (key) {
            if (!(0, Utils_1.isEmpty)(toMergeStyles[key])) {
                styles[key] = toMergeStyles[key];
            }
        });
    }
}
function copyStyles(target, source) {
    target.width = source.width;
    target.height = source.height;
    target.backgroundColor = source.backgroundColor;
    target.left = source.left;
}
exports["default"] = parseXmlContent;


/***/ }),

/***/ "./src/lib/ParsedRequest.ts":
/*!**********************************!*\
  !*** ./src/lib/ParsedRequest.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, exports) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var ParsedRequest = /** @class */ (function () {
    function ParsedRequest(request) {
        var responseHeaders = request.getAllResponseHeaders();
        var headersMap = new Map();
        responseHeaders
            .trim()
            .split(/[\r\n]+/)
            .forEach(function (val) {
            var valParts = val.split(": ");
            var key = valParts.shift();
            var headerVal = valParts.join(": ");
            headersMap.set(key, headerVal);
        });
        this.headers = headersMap;
        this.url = request.paramsCache.url;
        this.ok = request.status >= 200 && request.status < 300;
        this.status = request.status;
        this.statusText = request.statusText;
        this.parsedBody = new Uint8Array(request.response);
        this.originXHR = request;
    }
    return ParsedRequest;
}());
exports["default"] = ParsedRequest;


/***/ }),

/***/ "./src/lib/PatchManager.ts":
/*!*********************************!*\
  !*** ./src/lib/PatchManager.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.PatchManager = void 0;
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameWasmLoadReporter_1 = __webpack_require__(/*! ./GameWasmLoadReporter */ "./src/lib/GameWasmLoadReporter.ts");
var PrivateFileSystemManager_1 = __importDefault(__webpack_require__(/*! ./PrivateFileSystemManager */ "./src/lib/PrivateFileSystemManager.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PatchManager = /** @class */ (function (_super) {
    __extends(PatchManager, _super);
    function PatchManager() {
        var _this = _super.call(this) || this;
        _this.patchInstantiated = false;
        _this.patchFetched = false;
        _this.useCodeSplit = true;
        _this.isNewRuntime = false;
        _this.supportPrivateFs = false;
        _this.canUsePatch = false;
        _this.patchBasePath = "".concat(GameGlobalVars_1.default.gameFileCache, "/__PATCH_DIR");
        _this.fs = FileSystemManager_1.default;
        _this.createTime = 0;
        _this.isBr = false;
        _this.md5 = "";
        _this.subVersion = 0;
        _this.patchPath = "";
        _this.brPatchPath = "";
        _this.defaultPatchPath = "";
        _this.needFetchPatch = true;
        _this.redirModIndexList = [];
        _this.redirIndexPath = "";
        _this.patchFuncIndexList = [];
        _this.patchFuncIndexPath = "";
        var gamePluginInitializer = SystemEnvironmentVariables_1.default.pluginEnv.getPrivateFileSystemManager;
        var pluginIndex = !!gamePluginInitializer;
        var pluginInstance = gamePluginInitializer ? gamePluginInitializer() : undefined;
        var errorHandlerFunction = SystemEnvironmentVariables_1.default.isIOS && (0, Utils_1.compareVersions)(SystemEnvironmentVariables_1.default.systemInfo.version, "8.0.30") >= 0;
        var pluginInitializer = SystemEnvironmentVariables_1.default.isAndroid && (0, Utils_1.compareVersions)(SystemEnvironmentVariables_1.default.systemInfo.version, "8.0.27") >= 0;
        if (pluginIndex && pluginInstance && (errorHandlerFunction || pluginInitializer)) {
            _this.supportPrivateFs = true;
            _this.patchBasePath = "".concat(GameGlobalVars_1.default.privateFolder, "/__PATCH_DIR");
            PrivateFileSystemManager_1.default.setFs(pluginInstance);
            _this.fs = PrivateFileSystemManager_1.default;
        }
        _this.patchConfigPath = "".concat(_this.patchBasePath, "/patchconfig.json");
        _this.brPatchPath = "".concat(_this.patchBasePath, "/patch.wasm.br");
        _this.defaultPatchPath = "".concat(_this.patchBasePath, "/patch.wasm");
        _this.redirIndexPath = "".concat(_this.patchBasePath, "/redirIndexList.json");
        _this.patchFuncIndexPath = "".concat(_this.patchBasePath, "/patchFuncIndexList.json");
        _this.fs.mkdir("", _this.patchBasePath);
        PluginLogger_1.default.eventLog("\u4F7F\u7528".concat(_this.supportPrivateFs ? "私有" : "公共", "\u76EE\u5F55\u5B58\u50A8patch"));
        return _this;
    }
    PatchManager.prototype.instantiatePatch = function (filename, _currentStage, previewerInstance) {
        return __awaiter(this, void 0, void 0, function () {
            var isPluginInitialized, patchFileExists, patchInstance, compileTime, error_1, timeoutPromise;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        _a.trys.push([0, 5, 6, 7]);
                        isPluginInitialized = GameFeatures_1.gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.WasmPatch) !== Types_1.TransferStatus.open;
                        if (!this.canUsePatch || isPluginInitialized) {
                            PluginLogger_1.default.pluginWarn(isPluginInitialized ? "禁用patch包" : "基础库版本过低，不支持使用patch包");
                            return [2 /*return*/, Promise.resolve(null)];
                        }
                        return [4 /*yield*/, this.initConfigPromise];
                    case 1:
                        _a.sent();
                        return [4 /*yield*/, this.fetchPatchPromise];
                    case 2:
                        _a.sent();
                        return [4 /*yield*/, this.statPatchFile()];
                    case 3:
                        patchFileExists = _a.sent();
                        if (!patchFileExists) {
                            PluginLogger_1.default.pluginWarn("[非报错可忽略]patch文件不存在");
                            return [2 /*return*/, Promise.resolve(null)];
                        }
                        if (!this.isPatchMatched()) {
                            PluginLogger_1.default.pluginLog("[非报错可忽略]patch版本不匹配");
                            return [2 /*return*/, Promise.resolve(null)];
                        }
                        PluginLogger_1.default.eventLog("开始编译patch");
                        TimeLogManager_1.TimeLogManager.timeStart("instantiatePatch");
                        return [4 /*yield*/, KSWebAssembly.instantiate(this.patchPath, _currentStage)];
                    case 4:
                        patchInstance = _a.sent();
                        this.patchInstantiated = true;
                        compileTime = TimeLogManager_1.TimeLogManager.timeEnd("instantiatePatch");
                        PluginLogger_1.default.eventLog("patch\u7F16\u8BD1\u8017\u65F6: ".concat(compileTime, "ms"));
                        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.COMPILE_PATCH,
                            CostTimeMs: compileTime,
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                        }));
                        this.modMemoryIndex(previewerInstance);
                        return [2 /*return*/, Promise.resolve(patchInstance)];
                    case 5:
                        error_1 = _a.sent();
                        PluginLogger_1.default.pluginWarn("[非报错可忽略]patch编译失败", error_1);
                        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.COMPILE_PATCH,
                            ErrorMsg: error_1.errMsg || error_1.message,
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                        }));
                        TimeLogManager_1.TimeLogManager.timeEnd("instantiatePatch");
                        return [2 /*return*/, Promise.reject(error_1)];
                    case 6:
                        timeoutPromise = new Promise(function (resolve) {
                            setTimeout(function () {
                                PluginLogger_1.default.eventLog("长时间未完成下载/编译patch, 跳过patch能力");
                                resolve(null);
                            }, 10000);
                        });
                        return [2 /*return*/, Promise.race([timeoutPromise, Promise.resolve()])];
                    case 7: return [2 /*return*/];
                }
            });
        });
    };
    PatchManager.prototype.checkNeedReportMissPatchFunc = function (errorMessage) {
        var _a;
        if (((_a = this.patchFuncIndexList) === null || _a === void 0 ? void 0 : _a.length) && this.patchInstantiated && this.patchFuncIndexList.includes(errorMessage)) {
            PluginLogger_1.default.pluginLog("miss patch func, index=".concat(errorMessage));
            GameWasmLoadReporter_1.gameWasmLoadReporter.reportMissFuncInPatch(errorMessage);
        }
    };
    PatchManager.prototype.updateCodeType = function (isCodeSplitEnabled) {
        this.useCodeSplit = isCodeSplitEnabled;
        this.isNewRuntime = GameGlobalVars_1.default.isWkAndNewSDK && this.useCodeSplit;
        if (this.useCodeSplit) {
            this.checkNeedFetchPatch();
        }
    };
    PatchManager.prototype.isPatchMatched = function () {
        return this.subVersion === GameGlobalVars_1.default.unityNamespace.WASM_SPLIT_SUB_VERSION && this.md5 === GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5;
    };
    PatchManager.prototype.checkNeedFetchPatch = function () {
        return __awaiter(this, void 0, void 0, function () {
            var patchExists;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.initConfigPromise = this.initConfig();
                        return [4 /*yield*/, this.initConfigPromise];
                    case 1:
                        patchExists = _a.sent();
                        return [4 /*yield*/, this.readPatchFuncIndexFile()];
                    case 2:
                        _a.sent();
                        return [4 /*yield*/, this.readRedirIndexFile()];
                    case 3:
                        _a.sent();
                        PluginLogger_1.default.eventLog("\u672C\u5730".concat(patchExists ? "\u6709patch, createTime=".concat(this.createTime) : "无patch", ", \u62C9\u53D6\u6700\u65B0patch"));
                        this.needFetchPatch = true;
                        this.fetchPatchPromise = this.fetchPatchFile();
                        return [2 /*return*/];
                }
            });
        });
    };
    PatchManager.prototype.initConfig = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.readConfig()];
                    case 1:
                        _a.sent();
                        return [4 /*yield*/, this.statPatchFile()];
                    case 2: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    PatchManager.prototype.statPatchFile = function () {
        return __awaiter(this, void 0, void 0, function () {
            var patchFileStats;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.fs.statAsyncCatch(this.isBr ? this.brPatchPath : this.defaultPatchPath)];
                    case 1:
                        patchFileStats = _a.sent();
                        PluginLogger_1.default.pluginLog("\u672C\u5730\u662F\u5426\u6709patch\u6587\u4EF6=".concat(!!patchFileStats, ", isbrotli=").concat(this.isBr));
                        return [2 /*return*/, !!patchFileStats];
                }
            });
        });
    };
    PatchManager.prototype.readConfig = function () {
        return __awaiter(this, void 0, void 0, function () {
            var patchConfig;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, this.fs.readJson(this.patchConfigPath, false)];
                    case 1:
                        patchConfig = _a.sent();
                        PluginLogger_1.default.pluginLog("patch配置读取完毕", patchConfig);
                        if (patchConfig) {
                            this.createTime = patchConfig.createTime;
                            this.isBr = patchConfig.isBr;
                            this.md5 = patchConfig.md5;
                            this.subVersion = patchConfig.subVersion;
                            if (this.isBr) {
                                this.patchPath = this.brPatchPath;
                            }
                            else {
                                this.patchPath = this.defaultPatchPath;
                            }
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    PatchManager.prototype.readRedirIndexFile = function () {
        return __awaiter(this, void 0, void 0, function () {
            var redirectModIndexList;
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.fs.readJson(this.redirIndexPath, false)];
                    case 1:
                        redirectModIndexList = _b.sent();
                        PluginLogger_1.default.pluginLog("read redirModIndexList, has content=", !!redirectModIndexList);
                        if (redirectModIndexList) {
                            if (!((_a = this.redirModIndexList) === null || _a === void 0 ? void 0 : _a.length)) {
                                this.redirModIndexList = redirectModIndexList.redirModIndexList;
                            }
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    PatchManager.prototype.readPatchFuncIndexFile = function () {
        return __awaiter(this, void 0, void 0, function () {
            var patchFuncIndexList;
            var _a;
            return __generator(this, function (_b) {
                switch (_b.label) {
                    case 0: return [4 /*yield*/, this.fs.readJson(this.patchFuncIndexPath, false)];
                    case 1:
                        patchFuncIndexList = _b.sent();
                        PluginLogger_1.default.pluginLog("read patchFuncIndexList, has content=", !!patchFuncIndexList);
                        if (patchFuncIndexList) {
                            if (!((_a = this.patchFuncIndexList) === null || _a === void 0 ? void 0 : _a.length)) {
                                this.patchFuncIndexList = patchFuncIndexList.patchFuncIndexList;
                            }
                        }
                        return [2 /*return*/];
                }
            });
        });
    };
    PatchManager.prototype.modMemoryIndex = function (eventBuffer) {
        var _a;
        if (((_a = this.redirModIndexList) === null || _a === void 0 ? void 0 : _a.length) && eventBuffer) {
            var int32ArrayFromEventBuffer_1 = new Int32Array(eventBuffer);
            this.redirModIndexList.forEach(function (index) {
                int32ArrayFromEventBuffer_1[index] += 268435456;
            });
        }
    };
    PatchManager.prototype.fetchPatchFile = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                if (!SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
                    PluginLogger_1.default.pluginLog("非插件模式不拉取patch");
                    return [2 /*return*/, false];
                }
                if (GameFeatures_1.gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.WasmPatch) !== Types_1.TransferStatus.open) {
                    PluginLogger_1.default.pluginLog("已禁用patch, 不拉取最新patch");
                    return [2 /*return*/, false];
                }
                return [2 /*return*/, new Promise(function (resolve) {
                        resolve(false);
                    })];
            });
        });
    };
    PatchManager.prototype.savePatchPackageInfo = function (updateIndexLists) {
        var redir_mod_index_list = updateIndexLists.redir_mod_index_list, patch_func_index_list = updateIndexLists.patch_func_index_list;
        if (redir_mod_index_list === null || redir_mod_index_list === void 0 ? void 0 : redir_mod_index_list.length) {
            PluginLogger_1.default.eventLog("has new redirModIndexList");
            this.redirModIndexList = redir_mod_index_list;
            this.fs.writeJson(this.redirIndexPath, { redirModIndexList: this.redirModIndexList });
        }
        if (patch_func_index_list === null || patch_func_index_list === void 0 ? void 0 : patch_func_index_list.length) {
            PluginLogger_1.default.eventLog("has new patchFuncIndexList");
            this.patchFuncIndexList = patch_func_index_list;
            this.fs.writeJson(this.patchFuncIndexPath, { patchFuncIndexList: this.patchFuncIndexList });
        }
    };
    PatchManager.prototype.savePatchFile = function (patchData) {
        return __awaiter(this, void 0, void 0, function () {
            var decodeBase64, patchBuffer, error_2;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        this.isBr = !!patchData.is_br;
                        decodeBase64 = function (base64String) {
                            var base64StringClean = base64String.replace(/[^A-Za-z0-9+/]/g, "");
                            var base64StringLength = base64StringClean.length;
                            var s = Math.ceil(((base64StringLength * 3 + 1) >>> 2) / 1) * 1;
                            var uint8ArrayBuffer = new Uint8Array(s);
                            var accumulatedValue = 0;
                            var byteIndex = 0;
                            for (var base64Index = 0; base64Index < base64StringLength; base64Index++) {
                                var bitShiftIndex = base64Index & 3;
                                var a = base64StringClean.charCodeAt(base64Index);
                                accumulatedValue |=
                                    ((a > 64 && a < 91)
                                        ? a - 65
                                        : (a > 96 && a < 123)
                                            ? a - 71
                                            : (a > 47 && a < 58)
                                                ? a + 4
                                                : (a === 43)
                                                    ? 62
                                                    : (a === 47)
                                                        ? 63
                                                        : 0) << (18 - bitShiftIndex * 6);
                                if (bitShiftIndex === 3 || base64StringLength - base64Index === 1) {
                                    for (byteIndex = 0; byteIndex < 3 && byteIndex < s; byteIndex++) {
                                        uint8ArrayBuffer[byteIndex] = (accumulatedValue >>> ((16 >>> byteIndex) & 24)) & 255;
                                    }
                                    accumulatedValue = 0;
                                }
                            }
                            return uint8ArrayBuffer.buffer;
                        };
                        patchBuffer = decodeBase64(patchData.buffer);
                        if (this.isBr) {
                            this.patchPath = this.brPatchPath;
                        }
                        else {
                            this.patchPath = this.defaultPatchPath;
                        }
                        PluginLogger_1.default.eventLog("\u6700\u65B0patch\u5927\u5C0F: ".concat(patchBuffer.byteLength, "byte, createTime=").concat(patchData.create_time, ", isbrotli=").concat(this.isBr, ", fetchcost=").concat(TimeLogManager_1.TimeLogManager.timeEnd("fetchwasmpatch")));
                        TimeLogManager_1.TimeLogManager.timeStart("writePatch");
                        _a.label = 1;
                    case 1:
                        _a.trys.push([1, 3, , 4]);
                        return [4 /*yield*/, this.fs.writeFile(this.patchPath, patchBuffer)];
                    case 2:
                        _a.sent();
                        this.subVersion = GameGlobalVars_1.default.unityNamespace.WASM_SPLIT_SUB_VERSION;
                        this.md5 = GameGlobalVars_1.default.unityNamespace.CODE_FILE_MD5;
                        PluginLogger_1.default.eventLog("patch包缓存成功");
                        ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.WRITE_PATCH,
                            CostTimeMs: TimeLogManager_1.TimeLogManager.timeEnd("writePatch"),
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                        }));
                        this.fs.writeJson(this.patchConfigPath, {
                            createTime: patchData.create_time,
                            isBr: this.isBr,
                            md5: this.md5,
                            subVersion: this.subVersion,
                        });
                        return [2 /*return*/, true];
                    case 3:
                        error_2 = _a.sent();
                        PluginLogger_1.default.pluginWarn("[不影响游戏可忽略]patch包缓存失败: ", error_2);
                        TimeLogManager_1.TimeLogManager.timeEnd("writePatch");
                        ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                            ReportType: Types_1.ReportType.WRITE_PATCH,
                            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                            ErrorMsg: "".concat(error_2.errMsg || error_2.message),
                        }));
                        return [2 /*return*/, false];
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    return PatchManager;
}(Instance_1.default));
exports.PatchManager = PatchManager;


/***/ }),

/***/ "./src/lib/PluginLogger.ts":
/*!*********************************!*\
  !*** ./src/lib/PluginLogger.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var LogReport_1 = __importDefault(__webpack_require__(/*! ./LogReport */ "./src/lib/LogReport.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var PluginLogger = /** @class */ (function () {
    function PluginLogger() {
    }
    PluginLogger.eventLog = function () {
        var _a, _b;
        var _c, _d, _e;
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var firstArgument = args[0] || "";
        if (args.length > 1 && ((_c = firstArgument.includes) === null || _c === void 0 ? void 0 : _c.call(firstArgument, "fetch js:"))) {
            (_e = (_d = PluginMonitor_1.default.getInstance().wasmSplitMonitor) === null || _d === void 0 ? void 0 : _d.recordSyncFetchTime) === null || _e === void 0 ? void 0 : _e.call(_d);
        }
        (_a = LogReport_1.default.xlog).info.apply(_a, __spreadArray(["[PLUGIN LOG]"], args, false));
        (_b = GameGlobalVars_1.default.logManager).log.apply(_b, __spreadArray(["[PLUGIN LOG]"], args, false));
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.log.apply(console, __spreadArray(["[PLUGIN LOG ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.debugLog = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (GameGlobalVars_1.default.enableTraceLog && GameGlobalVars_1.default.enableDebugLog) {
            console.log.apply(console, __spreadArray(["[DEBUG LOG ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.debugWarn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (GameGlobalVars_1.default.enableTraceLog && GameGlobalVars_1.default.enableDebugLog) {
            console.warn.apply(console, __spreadArray(["[DEBUG WARN ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.debugError = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (GameGlobalVars_1.default.enableTraceLog && GameGlobalVars_1.default.enableDebugLog) {
            console.error.apply(console, __spreadArray(["[DEBUG ERROR ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.pluginLog = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        GameGlobalVars_1.default.logManager.log(args);
        if (GameGlobalVars_1.default.enableTraceLog && GameGlobalVars_1.default.enableDebugLog) {
            console.log.apply(console, __spreadArray(["[PLUGIN LOG ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.pluginWarn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        GameGlobalVars_1.default.logManager.warn(__spreadArray(["".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), " ")], args, true));
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.warn.apply(console, __spreadArray(["[PLUGIN WARN ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.pluginError = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        GameGlobalVars_1.default.logManager.warn(__spreadArray(["".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), " ")], args, true));
        GameGlobalVars_1.default.realtimeLogManager.error("[PLUGIN ERROR] ".concat(args.join(' ')));
        LogReport_1.default.xlog.error("[PLUGIN ERROR] ".concat(args.join(' ')));
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.error.apply(console, __spreadArray(["[PLUGIN ERROR ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "]")], args, false));
        }
    };
    PluginLogger.monitorLog = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.log.apply(console, __spreadArray(["[PLUGIN MONITOR]"], args, false));
        }
    };
    PluginLogger.monitorWarn = function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        if (GameGlobalVars_1.default.enableTraceLog) {
            console.warn.apply(console, __spreadArray(["[PLUGIN MONITOR]"], args, false));
        }
    };
    return PluginLogger;
}());
exports["default"] = PluginLogger;


/***/ }),

/***/ "./src/lib/PluginMonitor.ts":
/*!**********************************!*\
  !*** ./src/lib/PluginMonitor.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var MonitorConfig_1 = __webpack_require__(/*! ./MonitorConfig */ "./src/lib/MonitorConfig.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var CommonMonitor_1 = __importDefault(__webpack_require__(/*! ./CommonMonitor */ "./src/lib/CommonMonitor.ts"));
var RequestMonitor_1 = __importDefault(__webpack_require__(/*! ./RequestMonitor */ "./src/lib/RequestMonitor.ts"));
var PreloadMonitor_1 = __importDefault(__webpack_require__(/*! ./PreloadMonitor */ "./src/lib/PreloadMonitor.ts"));
var WasmSplitMonitor_1 = __importDefault(__webpack_require__(/*! ./WasmSplitMonitor */ "./src/lib/WasmSplitMonitor.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var FrameMonitor_1 = __importDefault(__webpack_require__(/*! ./FrameMonitor */ "./src/lib/FrameMonitor.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var PluginMonitor = /** @class */ (function (_super) {
    __extends(PluginMonitor, _super);
    function PluginMonitor() {
        var _this = _super.call(this) || this;
        _this.enableMonitor = MonitorConfig_1.MonitorConfig.getInstance().getConfig(MonitorConfig_1.MonitorConfigKeys.EnableMonitor);
        _this.endMonitor = false;
        _this.reportData = {};
        _this.isGameInteractive = false;
        return _this;
    }
    PluginMonitor.prototype.init = function (unityManager) {
        if (this.enableMonitor) {
            PluginLogger_1.default.pluginWarn("[仅开发版/体验版生效]已开启最佳实践检测。");
            this.unityManager = unityManager;
            this.commonMonitor = new CommonMonitor_1.default(unityManager, this);
            this.requestMonitor = new RequestMonitor_1.default(unityManager, this);
            this.preloadMonitor = new PreloadMonitor_1.default(unityManager, this);
            this.wasmSplitMonitor = new WasmSplitMonitor_1.default(unityManager, this);
            FrameMonitor_1.default.getInstance().init();
        }
        else {
            this.commonMonitor = {
                recordAsset: function () {
                },
                recordWasm: function () {
                },
                recordCallmain: function () {
                },
                showResult: function () { return []; },
                reset: function () {
                },
                result: {},
            };
            this.requestMonitor = {
                startLoad: function () {
                },
                completeLoad: function () {
                },
                showResult: function () { return []; },
                reset: function () {
                },
                result: {},
            };
            this.preloadMonitor = {
                setPreloadList: function () {
                },
                finishPreload: function () {
                },
                startLoad: function () {
                },
                completeLoad: function () {
                },
                genResultAfterCallmain: function () {
                },
                showResult: function () { return []; },
                reset: function () {
                },
                result: {},
                callmainInfo: {},
            };
            this.wasmSplitMonitor = {
                recordSyncFetchTime: function () {
                },
                startLoadSubWasm: function () {
                },
                finishLoadSubWasm: function () {
                },
                showResult: function () { return []; },
                reset: function () {
                },
            };
        }
    };
    PluginMonitor.prototype.showResultAfterDuration = function () {
        var _this = this;
        if (!this.endMonitor && this.enableMonitor) {
            var monitorConfig = MonitorConfig_1.MonitorConfig.getInstance();
            FrameMonitor_1.default.getInstance().start();
            var monitorDuration = monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.ShowResultAfterLaunch)
                ? 60000 : monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.MonitorDuration);
            setTimeout(function () {
                _this.showResult();
            }, monitorDuration);
        }
    };
    PluginMonitor.prototype.showResult = function (isGameInteractive) {
        if (isGameInteractive === void 0) { isGameInteractive = false; }
        var monitorConfig = MonitorConfig_1.MonitorConfig.getInstance();
        this.isGameInteractive = isGameInteractive;
        var commonOptimizationSuggestions = this.commonMonitor.showResult();
        var preloadOptimizationSuggestions = this.preloadMonitor.showResult();
        var wasmOptimizationSuggestions = this.wasmSplitMonitor.showResult();
        var requestOptimizationSuggestions = this.requestMonitor.showResult();
        var frameOptimizationSuggestions = FrameMonitor_1.default.getInstance().showResult();
        var optimizationSuggestionsReport = "";
        if (commonOptimizationSuggestions.length) {
            optimizationSuggestionsReport += "===" + DefaultLanguageMap_1.default.showResult_LaunchOptAdvice + ": ===\n";
            optimizationSuggestionsReport += "".concat(commonOptimizationSuggestions.join("\n"), "\n");
        }
        if (preloadOptimizationSuggestions.length) {
            optimizationSuggestionsReport += "===" + DefaultLanguageMap_1.default.showResult_preloadOptAdvice + ": ===\n";
            optimizationSuggestionsReport += "".concat(preloadOptimizationSuggestions.join("\n"), "\n");
        }
        if (wasmOptimizationSuggestions.length) {
            optimizationSuggestionsReport += "===" + DefaultLanguageMap_1.default.showResult_wasmOptAdvice + ": ===\n";
            optimizationSuggestionsReport += "".concat(wasmOptimizationSuggestions.join("\n"), "\n");
        }
        if (requestOptimizationSuggestions.length) {
            optimizationSuggestionsReport += "===" + DefaultLanguageMap_1.default.showResult_netOptAdvice + ": ===\n";
            optimizationSuggestionsReport += "".concat(requestOptimizationSuggestions.join("\n"), "\n");
        }
        if (frameOptimizationSuggestions.length) {
            optimizationSuggestionsReport += "===" + DefaultLanguageMap_1.default.showResult_frameRateOptAdvice + ": ===\n";
            optimizationSuggestionsReport += "".concat(frameOptimizationSuggestions.join("\n"), "\n");
        }
        if (optimizationSuggestionsReport &&
            monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.ShowSuggestModal)) {
            optimizationSuggestionsReport = "".concat(DefaultLanguageMap_1.default.showResult_openDebugger, "\n").concat(optimizationSuggestionsReport);
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: "".concat(DefaultLanguageMap_1.default.showResult_title).concat(isGameInteractive ? DefaultLanguageMap_1.default.ifInteractable : ""),
                content: optimizationSuggestionsReport,
            });
        }
        this.reportInfo();
        this.showResultInfo();
        if (!isGameInteractive || !!monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.ShowResultAfterLaunch)) {
            this.end();
        }
        this.isGameInteractive = false;
    };
    PluginMonitor.prototype.end = function () {
        if (!this.endMonitor && this.enableMonitor) {
            this.commonMonitor.reset();
            this.preloadMonitor.reset();
            this.wasmSplitMonitor.reset();
            this.requestMonitor.reset();
            FrameMonitor_1.default.getInstance().reset();
            this.reportData = {};
            this.endMonitor = true;
        }
    };
    PluginMonitor.prototype.reportInfo = function () {
        this.reportBaseInfo();
        this.reportAssetInfo();
        this.reportFrameInfo();
    };
    PluginMonitor.prototype.showResultInfo = function () {
        var baseInfo = this.showBaseInfo();
        var assetInfo = this.showAssetInfo();
        var frameInfo = this.showFrameInfo();
        var combinedReport = __spreadArray(__spreadArray(__spreadArray([], baseInfo, true), assetInfo, true), frameInfo, true).join("\n");
        PluginLogger_1.default.monitorWarn("[monitor-report]", "\u68C0\u6D4B\u62A5\u544A".concat(this.isGameInteractive ? DefaultLanguageMap_1.default.ifInteractable : "", ": "), combinedReport);
        var monitorConfig = MonitorConfig_1.MonitorConfig.getInstance();
        if (monitorConfig.getConfig(MonitorConfig_1.MonitorConfigKeys.ShowReportModal)) {
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: "".concat(DefaultLanguageMap_1.default.showResultInfo_title).concat(this.isGameInteractive ? DefaultLanguageMap_1.default.ifInteractable : ""),
                content: combinedReport,
                showCancel: false,
                success: function () {
                    SystemEnvironmentVariables_1.default.tjInstance.setClipboardData({
                        data: combinedReport,
                    });
                },
            });
        }
    };
    PluginMonitor.prototype.showBaseInfo = function () {
        var baseInfo = this.reportData.baseInfo;
        return [
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_wasmDownloadTime, ": ").concat(baseInfo.downloadWasm, "ms"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_wasmSize, ": ").concat((baseInfo.wasmContentLength / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_assetsDownloadTime, ": ").concat(baseInfo.downloadDataPackage || 0, "ms"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_assetsSize, ": ").concat((baseInfo.assetContentLength / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_ifZipped, ": ").concat(!!baseInfo.useContentEncoding),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_engineInitTime, ": ").concat(baseInfo.callmain, "ms"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_engineCompleteTime, ": ").concat(baseInfo.launchTime, "ms"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_preConfigNum, ": ").concat(baseInfo.preloadListLength),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_totalPreNum, ": ").concat(baseInfo.preloadCount),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_totalPreSize, ": ").concat((baseInfo.preloadSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_preNumWhenEngineComplete, ": ").concat(baseInfo.preloadCountAfterCallmain),
            "".concat(DefaultLanguageMap_1.default.showBaseInfo_preSizeWhenEngineComplete, ": ").concat((baseInfo.preloadSizeAfterCallmain / 1024 / 1024).toFixed(2), "MB"),
        ];
    };
    PluginMonitor.prototype.showAssetInfo = function () {
        var assetInfo = this.reportData.assetInfo;
        return [
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_netTime, ": ").concat(assetInfo.networkTime, "ms"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_netProportion, ": ").concat((assetInfo.networkUsage * 100).toFixed(1), "%"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_beginTime, ": ").concat(assetInfo.duration, "ms"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_totalCachedReqNum, ": ").concat(assetInfo.loadCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_totalReqNum, ": ").concat(assetInfo.remoteRequestCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_autoCachedAssetsNum, ": ").concat(assetInfo.cacheableCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_notAutoCachedAssetsNum, ": ").concat(assetInfo.noCacheableAssetCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_autoCachedNetNum, ": ").concat(assetInfo.cacheableRemoteCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_textureNum, ": ").concat(assetInfo.texturesCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_preLoadedTotalAssetsSize, ": ").concat((assetInfo.totalSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_preUnloadedTotalAssetsNum, ": ").concat((assetInfo.loadedSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_autoCachedAssetsSize, ": ").concat((assetInfo.cacheableSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_notAutoCachedAssetsSize, ": ").concat((assetInfo.noCacheableAssetSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_autoCachedNetSize, ": ").concat((assetInfo.cacaheableRemoteSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_textureSize, ": ").concat((assetInfo.texturesSize / 1024 / 1024).toFixed(2), "MB"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifTextureCached, ": ").concat(assetInfo.needCacheTextures),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_avgConcurrentNum, ": ").concat(assetInfo.avgLoadingCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_maxConcurrentNum, ": ").concat(assetInfo.maxLoadingCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_avgReqJankTime, ": ").concat(assetInfo.avgPendingDuration, "ms"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_top5ReqJankTime, ": [").concat(assetInfo.topPendingDuration.toString(), "]"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_avgReadCacheTime, ": ").concat(assetInfo.avgReadCacheCost, "ms"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_top5ReadCacheTime, ": [").concat(assetInfo.topReadCacheCost.toString(), "]"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_top5NetTime, ": [").concat(assetInfo.topNetworkTime.toString(), "]"),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_CDNCacheNum, ": ").concat(assetInfo.hitCacheCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_HTTP2Num, ": ").concat(assetInfo.enabledH2Count),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifHTTP2Enabled, ": ").concat(!!assetInfo.useH2),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_serverZippedAssetsNum, ": ").concat(assetInfo.enabledContentEncodingCount),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifServerEnabledAssetsZip, ": ").concat(!!assetInfo.useContentEncoding),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifReqCatalog, ": ").concat(!!assetInfo.requestBundleCatalog),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifCatalogWithVersion, ": ").concat(!!assetInfo.appendHashToCatalog),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifReqCatalogHashHotUpdate, ": ").concat(!!assetInfo.requestCataHash),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifCacheCatalog, ": ").concat(!!assetInfo.cacheCatalog),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifReqSettings, ": ").concat(!!assetInfo.requestBundleSettings),
            "".concat(DefaultLanguageMap_1.default.showAssetInfo_ifCacheSettings, ": ").concat(!!assetInfo.cacheSettings),
        ];
    };
    PluginMonitor.prototype.showFrameInfo = function () {
        var frameInfo = this.reportData.frameInfo;
        return [
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_longLastingFrameNum, ": ").concat(frameInfo.frameCount),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_longestFrameTime, ": ").concat(frameInfo.longestFrame.frameCost || 0, "ms"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_top5FrameTime, ": [").concat(frameInfo.topFrameCost.toString(), "]"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_top5FrameNetConcurrent, ": [").concat(frameInfo.topFrameNetworkCount.toString(), "]"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_totalJankTime, ": ").concat(frameInfo.totalJankTime, "ms"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_jankRate, ": ").concat((frameInfo.jankRate * 100).toFixed(1), "%"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_setMonitorFPS, ": ").concat(frameInfo.configFps, "FPS"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_setMonitorTime, ": ").concat(frameInfo.configMonitorDuration, "ms"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_showResultAfterLaunch, ": ").concat(!!frameInfo.showResultAfterLaunch),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_actualMonitorTime, ": ").concat(frameInfo.timerRuntime, "ms"),
            "".concat(DefaultLanguageMap_1.default.showFrameInfo_appRuntime, ": ").concat(frameInfo.appRuntime, "ms"),
        ];
    };
    PluginMonitor.prototype.reportBaseInfo = function () {
        if (this.enableMonitor) {
            var commonMonitorResult = this.commonMonitor.result;
            var preloadMonitorResult = this.preloadMonitor.result;
            var preloadCallMainInfo = this.preloadMonitor.callmainInfo;
            var eventMap_1 = {
                0: "pluginLaunch",
                1: "downloadWasm",
                2: "compileWasm",
                3: "downloadDataPackage",
                5: "readDataPackage",
                6: "callmain",
            };
            var monitoringData = __assign(__assign({}, this.unityManager.launchData.reduce(function (acc, item) {
                if (eventMap_1[item.type]) {
                    acc[eventMap_1[item.type]] = item.data.costTimeMs;
                }
                return acc;
            }, {})), { launchTime: commonMonitorResult.launchTime, wasmContentLength: commonMonitorResult.wasmContentLength, assetContentLength: commonMonitorResult.assetContentLength, useContentEncoding: commonMonitorResult.useContentEncoding, preloadListLength: preloadMonitorResult.preloadListLength, preloadCount: preloadMonitorResult.loadedCount, preloadSize: preloadMonitorResult.loadedSize, useH2: preloadMonitorResult.useH2, preloadUseContentEncoding: preloadMonitorResult.useContentEncoding, preloadCountAfterCallmain: preloadCallMainInfo.loadedCount, preloadSizeAfterCallmain: preloadCallMainInfo.loadedSize, isGameInteractive: this.isGameInteractive });
            this.reportData.baseInfo = monitoringData;
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.BASE_INFO,
                ExternInfo: JSON.stringify(monitoringData),
            }));
        }
    };
    PluginMonitor.prototype.reportAssetInfo = function () {
        if (this.enableMonitor) {
            var requestMonitorResult = this.requestMonitor.result;
            var assetInfo = __assign(__assign({}, requestMonitorResult), { isGameInteractive: this.isGameInteractive });
            this.reportData.assetInfo = assetInfo;
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.ASSETS_INFO,
                ExternInfo: JSON.stringify(assetInfo),
            }));
        }
    };
    PluginMonitor.prototype.reportFrameInfo = function () {
        if (this.enableMonitor) {
            var frameInfo = __assign(__assign({}, FrameMonitor_1.default.getInstance().result), { isGameInteractive: this.isGameInteractive });
            this.reportData.frameInfo = frameInfo;
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.ReportType.FRAME_INFO,
                ExternInfo: JSON.stringify(frameInfo),
            }));
        }
    };
    return PluginMonitor;
}(Instance_1.default));
exports["default"] = PluginMonitor;


/***/ }),

/***/ "./src/lib/PreloadMonitor.ts":
/*!***********************************!*\
  !*** ./src/lib/PreloadMonitor.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var BaseDataLoader_1 = __importDefault(__webpack_require__(/*! ./BaseDataLoader */ "./src/lib/BaseDataLoader.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var TaskManager_1 = __importDefault(__webpack_require__(/*! ./TaskManager */ "./src/lib/TaskManager.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var PreloadMonitor = /** @class */ (function (_super) {
    __extends(PreloadMonitor, _super);
    function PreloadMonitor(unityManager, monitor) {
        var _this = _super.call(this, unityManager, monitor) || this;
        _this.requestErrors = {
            noPreloadAssets: DefaultLanguageMap_1.default.pluginMonitor_noPreloadAssets,
            tooManyAssets: DefaultLanguageMap_1.default.pluginMonitor_tooManyAssets,
            tooLargeAssetSize: DefaultLanguageMap_1.default.pluginMonitor_tooLargeAssetSize,
            lowDownloadSpeed: DefaultLanguageMap_1.default.pluginMonitor_lowDownloadSpeed,
            smallAssetSize: DefaultLanguageMap_1.default.pluginMonitor_smallAssetSize,
        };
        _this.finished = false;
        _this.preloadInfoList = new Map();
        _this.callmainInfo = {};
        _this.result = {};
        _this.preloadListLength = 0;
        return _this;
    }
    PreloadMonitor.prototype.init = function () {
    };
    PreloadMonitor.prototype.setPreloadList = function (preloadInfoList) {
        this.preloadInfoList = preloadInfoList;
        this.preloadListLength = this.preloadInfoList.size;
    };
    PreloadMonitor.prototype.startLoad = function (taskParameter) {
        var _this = this;
        var task = TaskManager_1.default.genTask(taskParameter);
        this.baseLoad();
        task.afterSuccess = function (newTask) {
            _this.loadedSize += newTask.info.receivedBytedCount || 0;
            _this.baseCheck(newTask);
        };
    };
    PreloadMonitor.prototype.genResultAfterCallmain = function () {
        if ((0, Utils_1.isEmpty)(this.callmainInfo)) {
            this.callmainInfo = this.getResultInfo();
        }
    };
    PreloadMonitor.prototype.finishPreload = function () {
        if (!this.finished && !this.monitor.endMonitor) {
            this.finished = true;
            this.result = this.getResultInfo();
        }
    };
    PreloadMonitor.prototype.reset = function () {
        this.baseReset();
        this.callmainInfo = {};
        this.preloadInfoList = new Map();
        this.finished = false;
        this.requestErrors = undefined;
    };
    PreloadMonitor.prototype.showResult = function () {
        this.genResultAfterCallmain();
        this.finishPreload();
        return this.checkResult();
    };
    PreloadMonitor.prototype.checkResult = function () {
        PluginLogger_1.default.monitorLog("----预下载监控 start----");
        PluginLogger_1.default.monitorLog("预下载基本信息: ", this.result, ", callmain完成时预下载信息", this.callmainInfo);
        var issuesArray = [];
        var preloadListLength = this.preloadListLength;
        if (!preloadListLength && this.requestErrors) {
            issuesArray.push(this.requestErrors.noPreloadAssets);
        }
        if (preloadListLength > 15 && this.requestErrors) {
            issuesArray.push(this.requestErrors.tooManyAssets);
        }
        var callMainInfo = this.callmainInfo;
        var downloadedAssets = this.result;
        if (preloadListLength && callMainInfo) {
            if (callMainInfo.loadingCount && !callMainInfo.loadedCount && this.requestErrors) {
                issuesArray.push(this.requestErrors.lowDownloadSpeed);
            }
            else if (+callMainInfo.loadedSize < 1048576 && this.requestErrors) {
                issuesArray.push(this.requestErrors.smallAssetSize);
            }
        }
        if (preloadListLength && downloadedAssets) {
            if (+downloadedAssets.loadedSize < 5242880 && this.requestErrors) {
                issuesArray.push(this.requestErrors.smallAssetSize);
            }
            if (+downloadedAssets.loadedSize > 20971520 && this.requestErrors) {
                issuesArray.push(this.requestErrors.tooLargeAssetSize);
            }
        }
        if (issuesArray.length) {
            PluginLogger_1.default.monitorWarn("".concat(DefaultLanguageMap_1.default.showResult_preloadOptAdvice, ":"));
            PluginLogger_1.default.monitorWarn(issuesArray.join("\n"));
        }
        PluginLogger_1.default.monitorLog("----预下载监控 end----");
        return issuesArray;
    };
    PreloadMonitor.prototype.getResultInfo = function () {
        return {
            loadedCount: this.loadedCount,
            loadingCount: this.loadCount - this.loadedCount,
            loadedSizeStr: "".concat((this.loadedSize / 1024 / 1024).toFixed(2), "MB"),
            loadedSize: this.loadedSize,
            hitCacheCount: this.hitCacheCount,
            useH2: this.useH2,
            useContentEncoding: this.useContentEncoding,
            preloadListLength: this.preloadListLength,
        };
    };
    return PreloadMonitor;
}(BaseDataLoader_1.default));
exports["default"] = PreloadMonitor;


/***/ }),

/***/ "./src/lib/PreloadTaskManager.ts":
/*!***************************************!*\
  !*** ./src/lib/PreloadTaskManager.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var HttpTaskManager_1 = __importDefault(__webpack_require__(/*! ./HttpTaskManager */ "./src/lib/HttpTaskManager.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var UnityManager_1 = __importDefault(__webpack_require__(/*! ./UnityManager */ "./src/lib/UnityManager.ts"));
var Task_1 = __importDefault(__webpack_require__(/*! ./Task */ "./src/lib/Task.ts"));
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var LogUtils_1 = __webpack_require__(/*! ./LogUtils */ "./src/lib/LogUtils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var PreloadTaskManager = /** @class */ (function (_super) {
    __extends(PreloadTaskManager, _super);
    function PreloadTaskManager() {
        var _this = _super.call(this) || this;
        _this.loadedSize = 0;
        _this.inited = false;
        _this.localLoadingCount = 0;
        _this.defaultMaxParallelCount = 10;
        _this.timer = 0;
        _this.maxCount = _this.defaultMaxParallelCount;
        _this.preloadList = [];
        _this.preloadInfoList = new Map();
        _this.loadedUrls = new Map();
        _this.httpTaskManager = null;
        return _this;
    }
    PreloadTaskManager.prototype.setPreloadList = function (preloadList) {
        var _this = this;
        if (preloadList === void 0) { preloadList = []; }
        if (preloadList.length) {
            preloadList
                .filter(function (url) { return !!(url === null || url === void 0 ? void 0 : url.trim()); })
                .map(function (url) { return _this.handlePreloadInfo(url); })
                .forEach(function (resultData) {
                if ((0, Utils_1.isCacheableURL)(resultData.url)) {
                    _this.preloadInfoList.set(resultData.shortSubPath, resultData);
                }
            });
            var unityManager = UnityManager_1.default.getInstance();
            var isPreloadRequired = !this.preloadList.length && !!unityManager && !unityManager.isAssetsLoading;
            this.preloadList = Array.from(this.preloadInfoList.values()).map(function (info) { return info.url; });
            if (this.inited && isPreloadRequired) {
                this.load();
            }
            PluginMonitor_1.default.getInstance().preloadMonitor.setPreloadList(this.preloadInfoList);
        }
    };
    PreloadTaskManager.prototype.handlePreloadInfo = function (url) {
        var validatedUrl = url.includes("http") ? url : (0, Utils_1.resolvePath)((0, Utils_1.resolveStreamingURL)("StreamingAssets"), url);
        var filename = (0, Utils_1.resolveFilename)((0, Utils_1.resolveURL)(validatedUrl));
        var dirname = (0, Utils_1.resolveDirname)(validatedUrl);
        var hash = (0, Utils_1.getFileHash)(validatedUrl);
        var shortName = (0, Utils_1.resolveShortFilename)(validatedUrl);
        return {
            url: validatedUrl,
            md5: hash,
            shortFilename: shortName,
            filename: filename,
            subPath: (0, Utils_1.resolvePath)(dirname, filename),
            shortSubPath: (0, Utils_1.resolvePath)(dirname, shortName),
        };
    };
    PreloadTaskManager.prototype.releaseAll = function () {
        var _this = this;
        Array.from(this.loadedUrls.keys()).forEach(function (url) {
            _this.releaseTask(new Task_1.default(url));
        });
        this.timer = 0;
    };
    PreloadTaskManager.prototype.load = function () {
        var _this = this;
        return new Promise(function (resolve, reject) { return __awaiter(_this, void 0, void 0, function () {
            var preloadItem, preloadInfo, task, filename, _a, error, result, preload, response, status_1, preloadActionHandler, cachePath, error_2, error_1;
            var _this = this;
            var _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        preloadItem = this.preloadList.shift();
                        if (!preloadItem) {
                            return [2 /*return*/];
                        }
                        preloadInfo = this.handlePreloadInfo(preloadItem);
                        task = new Task_1.default(preloadItem);
                        if (this.getTaskByUrl(preloadItem)) {
                            return [2 /*return*/];
                        }
                        if (FileSystemManager_1.default.getCachePath(preloadItem)) {
                            setTimeout(function () { return _this.load(); }, 0);
                            return [2 /*return*/];
                        }
                        filename = (0, Utils_1.resolveFilename)(preloadItem);
                        _c.label = 1;
                    case 1:
                        _c.trys.push([1, 7, , 8]);
                        PluginMonitor_1.default.getInstance().preloadMonitor.startLoad(preloadItem);
                        this.addTask(task);
                        TimeLogManager_1.TimeLogManager.timeStart("preload:".concat(preloadItem));
                        PluginLogger_1.default.pluginLog("PreloadManager: ".concat(filename, "\u5F00\u59CB\u9884\u8F7D"));
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(FileSystemManager_1.default.downloadFileByXMLHttpRequest(preloadItem))];
                    case 2:
                        _a = _c.sent(), error = _a[0], result = _a[1];
                        preload = this.preloadInfoList.has(preloadInfo.shortSubPath) &&
                            ((_b = this.preloadInfoList.get(preloadInfo.shortSubPath)) === null || _b === void 0 ? void 0 : _b.subPath) !== preloadInfo.subPath;
                        if (!preload) {
                            PluginMonitor_1.default.getInstance().preloadMonitor.completeLoad(preloadItem, result, error);
                        }
                        if (preload || error) {
                            TimeLogManager_1.TimeLogManager.timeEnd("preload:".concat(preloadItem));
                        }
                        if (preload) {
                            task.statusCode = 400;
                            this.removeTask(task);
                            return [2 /*return*/];
                        }
                        if (error) {
                            task.statusCode || (task.statusCode = 400);
                            task.error = error;
                            throw error;
                        }
                        this.loadedUrls.set(preloadItem, true);
                        this.checkNeedReleaseAll();
                        response = result.response;
                        status_1 = result.status;
                        task.statusCode = status_1;
                        if (!(0, Utils_1.isSuccessfulHttpStatus)(status_1)) return [3 /*break*/, 5];
                        PluginLogger_1.default.pluginLog("PreloadManager: ".concat(filename, "\u9884\u8F7D\u5B8C\u6210, \u8017\u65F6: ").concat(TimeLogManager_1.TimeLogManager.timeEnd("preload:".concat(preloadItem)), "ms"));
                        preloadActionHandler = response.byteLength;
                        this.countLoadedFileSize(preloadActionHandler);
                        task.response = response;
                        TimeLogManager_1.TimeLogManager.timeStart("savepreload:".concat(preloadItem));
                        cachePath = (0, LogUtils_1.resolveCachePath)(preloadItem);
                        if (!cachePath) return [3 /*break*/, 4];
                        return [4 /*yield*/, (0, Utils_1.handlePromise)(FileSystemManager_1.default.writeFile(cachePath, response))];
                    case 3:
                        error_2 = (_c.sent())[0];
                        PluginLogger_1.default.pluginLog("PreloadManager: ".concat(preloadItem, "\u7F13\u5B58\u5B8C\u6210\uFF0C\u8017\u65F6: ").concat(TimeLogManager_1.TimeLogManager.timeEnd("savepreload:".concat(preloadItem)), "ms"));
                        if (error_2) {
                            PluginLogger_1.default.pluginError("PreloadManager: ".concat(filename, "\u672A\u6B63\u5E38\u7F13\u5B58"), error_2.errMsg || error_2.message, error_2);
                        }
                        _c.label = 4;
                    case 4: return [3 /*break*/, 6];
                    case 5:
                        this.reportHttpError({
                            filename: filename,
                            url: preloadItem,
                            error: status_1,
                            type: "onerror",
                        });
                        _c.label = 6;
                    case 6:
                        this.removeTask(task, false);
                        return [3 /*break*/, 8];
                    case 7:
                        error_1 = _c.sent();
                        this.reportHttpError({
                            filename: filename,
                            url: preloadItem,
                            error: error_1,
                            type: "catch",
                        });
                        this.removeTask(task, false);
                        return [3 /*break*/, 8];
                    case 8: return [2 /*return*/];
                }
            });
        }); });
    };
    Object.defineProperty(PreloadTaskManager.prototype, "loadingCount", {
        get: function () {
            return this.localLoadingCount;
        },
        set: function (newLoadingCount) {
            var _this = this;
            if (Number.isInteger(newLoadingCount) && newLoadingCount >= 0) {
                if (newLoadingCount < this.maxCount) {
                    setTimeout(function () { return _this.load(); }, 0);
                }
                this.localLoadingCount = newLoadingCount;
            }
        },
        enumerable: false,
        configurable: true
    });
    PreloadTaskManager.prototype.isPreloadedUrl = function (url) {
        return this.loadedUrls.has(url);
    };
    PreloadTaskManager.prototype.init = function (eventData) {
        if (eventData === void 0) { eventData = { preloadList: [] }; }
        var preloadList = eventData.preloadList;
        if (!this.inited) {
            this.setPreloadList(preloadList);
            this.inited = true;
            this.loadedSize = 0;
            this.localLoadingCount = 0;
            this.httpTaskManager = new HttpTaskManager_1.default();
        }
    };
    PreloadTaskManager.prototype.hasTask = function (taskIdentifier) {
        return !!this.httpTaskManager && this.httpTaskManager.hasTask(taskIdentifier);
    };
    PreloadTaskManager.prototype.getTaskByUrl = function (url) {
        return this.httpTaskManager ? this.httpTaskManager.getTaskByUrl(url) : null;
    };
    PreloadTaskManager.prototype.addTask = function (taskIdentifier) {
        if (this.httpTaskManager && !this.httpTaskManager.hasTask(taskIdentifier)) {
            this.httpTaskManager.addTask(taskIdentifier);
            this.loadingCount += 1;
        }
    };
    PreloadTaskManager.prototype.removeTask = function (task, release) {
        if (release === void 0) { release = true; }
        if (this.httpTaskManager && this.httpTaskManager.hasTask(task)) {
            task.emit(Types_1.TaskStatus.COMPLETE);
            this.loadingCount -= 1;
            if (this.loadingCount === 0) {
                PluginMonitor_1.default.getInstance().preloadMonitor.finishPreload();
            }
            var preloadInfo = this.handlePreloadInfo(task.url);
            this.preloadInfoList.delete(preloadInfo.shortSubPath);
            if (release) {
                this.releaseTask(task);
            }
        }
    };
    PreloadTaskManager.prototype.releaseTask = function (task) {
        this.handleRemove(task);
        this.loadedUrls.delete(task.url);
    };
    PreloadTaskManager.prototype.checkNeedReleaseAll = function () {
        var _this = this;
        this.timer || (this.timer = setTimeout(function () { return _this.releaseAll(); }, 60000));
    };
    PreloadTaskManager.prototype.setConcurrent = function (concurrent) {
        if (concurrent === void 0) { concurrent = 1; }
        var inputValue = Number(concurrent) || 1;
        this.maxCount = Math.max(1, Math.min(inputValue, 10));
    };
    PreloadTaskManager.prototype.unShift = function (newItem) {
        this.preloadList.unshift(newItem);
        this.loadingCount = Number(this.loadingCount);
    };
    PreloadTaskManager.prototype.countLoadedFileSize = function (size) {
        if (size === void 0) { size = 0; }
        this.loadedSize += size;
        return this.loadedSize;
    };
    PreloadTaskManager.prototype.reportHttpError = function (errorDetails) {
        var filename = errorDetails.filename, url = errorDetails.url, error = errorDetails.error, type = errorDetails.type;
        var errorMsg = typeof error === "number" ? error : (error === null || error === void 0 ? void 0 : error.errMsg) || (error === null || error === void 0 ? void 0 : error.message) || "empty errMsg";
        PluginLogger_1.default.pluginError("PreloadManager_".concat(type, ": ").concat(filename, "\u9884\u8F7D\u5931\u8D25; networkType: ").concat(GameLogic_1.gameNetworkType.getNetworkType(), "; isVisible: ").concat(GameLogic_1.GameVisible.GetVisible(), ", error=").concat(errorMsg));
        var unityManager = UnityManager_1.default.getInstance();
        if (unityManager.needPluginReport()) {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.GameLaunchStatus.LOAD_ASSET_BUNDLE,
                ErrorMsg: "".concat(errorMsg),
                ErrorType: typeof error === "number" ? error : 0,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify({
                    event: "PreloadManager: ".concat(type),
                    url: url,
                    gameStage: GameLogic_1.GameStage.GetStage(),
                }),
            }));
        }
    };
    PreloadTaskManager.prototype.handleRemove = function (task) {
        var _a;
        if ((_a = this.httpTaskManager) === null || _a === void 0 ? void 0 : _a.hasTask(task)) {
            this.httpTaskManager.removeTask(task);
        }
    };
    return PreloadTaskManager;
}(Instance_1.default));
exports["default"] = PreloadTaskManager;


/***/ }),

/***/ "./src/lib/PrivateFileSystemManager.ts":
/*!*********************************************!*\
  !*** ./src/lib/PrivateFileSystemManager.ts ***!
  \*********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Buffer_1 = __webpack_require__(/*! ./Buffer */ "./src/lib/Buffer.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var PrivateFileSystemManager = /** @class */ (function () {
    function PrivateFileSystemManager() {
        this.privateFs = null;
    }
    PrivateFileSystemManager.getInstance = function () {
        if (!PrivateFileSystemManager.instance) {
            PrivateFileSystemManager.instance = new PrivateFileSystemManager();
        }
        return PrivateFileSystemManager.instance;
    };
    PrivateFileSystemManager.prototype.setFs = function (fileSystem) {
        this.privateFs = fileSystem;
    };
    PrivateFileSystemManager.prototype.statSync = function (filePath, error) {
        try {
            return this.privateFs.statSync(filePath, error);
        }
        catch (err) {
            PluginLogger_1.default.pluginError("PrivateFs_statSync: ", filePath, err.errMsg, err);
            return null;
        }
    };
    PrivateFileSystemManager.prototype.statAsyncCatch = function (filePath, isRecursive) {
        var _this = this;
        return new Promise(function (resolve) {
            _this.privateFs.stat({
                path: filePath,
                recursive: isRecursive,
                success: function (event) { return resolve(event.stats); },
                fail: function () { return resolve(null); },
            });
        });
    };
    PrivateFileSystemManager.prototype.access = function (filePath) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.privateFs.access({
                path: filePath,
                success: resolve,
                fail: reject,
            });
        });
    };
    PrivateFileSystemManager.prototype.mkdir = function (filePath, privateFolder) {
        var _this = this;
        if (privateFolder === void 0) { privateFolder = "privateFolder"; }
        var resolvedPath = (0, Utils_1.resolvePath)(filePath, (0, Utils_1.resolveDirname)(filePath));
        return new Promise(function (resolve, reject) {
            _this.access(resolvedPath)
                .then(function () { return resolve(); })
                .catch(function () {
                _this.privateFs.mkdir({
                    dirPath: resolvedPath,
                    recursive: true,
                    success: resolve,
                    fail: function (errorResponse) {
                        if (errorResponse.errMsg.includes("exist")) {
                            resolve();
                        }
                        else {
                            PluginLogger_1.default.pluginWarn("私有目录创建目录失败: ", resolvedPath, errorResponse.errMsg, errorResponse);
                            reject(errorResponse);
                        }
                    },
                });
            });
        });
    };
    PrivateFileSystemManager.prototype.writeFile = function (filePath, fileData) {
        var _this = this;
        return this.mkdir(filePath).then(function () {
            return new Promise(function (resolve, reject) {
                var filename = (0, Utils_1.resolveFilename)(filePath);
                _this.privateFs.writeFile({
                    filePath: filePath,
                    data: fileData,
                    encoding: "binary",
                    success: function () {
                        PluginLogger_1.default.pluginLog("\u79C1\u6709\u76EE\u5F55\u5199\u5165 ".concat(filename, " \u6210\u529F"));
                        resolve();
                    },
                    fail: function (error) {
                        PluginLogger_1.default.pluginWarn("\u79C1\u6709\u76EE\u5F55\u5199\u5165 ".concat(filename, " \u5931\u8D25"), error);
                        reject(error);
                    },
                });
            });
        });
    };
    PrivateFileSystemManager.prototype.readFile = function (filePath, encodingFormat) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            _this.privateFs.readFile({
                filePath: filePath,
                encoding: encodingFormat,
                success: function (event) {
                    if (SystemEnvironmentVariables_1.default.isIOS && !SystemEnvironmentVariables_1.default.isWK) {
                        var errorBuffer = (0, Buffer_1.processBuffer)(new Uint8Array(event.data));
                        var errorBufferFirstElement = errorBuffer[0];
                        event.data = errorBufferFirstElement;
                    }
                    resolve(event.data);
                },
                fail: reject,
            });
        });
    };
    PrivateFileSystemManager.prototype.readJson = function (filePath, isSingleArgument) {
        if (isSingleArgument === void 0) { isSingleArgument = true; }
        return this.readFile(filePath, "utf-8").then(function (fileContent) {
            var fileContentArray = fileContent.split("\n");
            var filePathContent = fileContentArray[0];
            var jsonContent = fileContentArray[1];
            if (jsonContent && typeof jsonContent === "string") {
                return JSON.parse(jsonContent);
            }
            else {
                if (filePathContent && isSingleArgument) {
                    PluginLogger_1.default.pluginWarn("\u79C1\u6709\u76EE\u5F55\u8BFB\u53D6json: ".concat(filePath, "\u5931\u8D25"), filePathContent.errMsg || filePathContent.message, filePathContent);
                }
                return null;
            }
        }).catch(function () { return null; });
    };
    PrivateFileSystemManager.prototype.writeJson = function (filePath, data) {
        if (filePath && data) {
            var jsonDataString = JSON.stringify(data);
            this.privateFs.writeFile({
                filePath: filePath,
                data: jsonDataString,
                encoding: "utf-8",
                success: function () {
                    PluginLogger_1.default.pluginLog("\u79C1\u6709\u76EE\u5F55\u5199\u5165json: ".concat(filePath, "\u6210\u529F"));
                },
                fail: function (error) {
                    PluginLogger_1.default.pluginWarn("\u79C1\u6709\u76EE\u5F55\u5199\u5165json: ".concat(filePath, "\u5931\u8D25"), error.errMsg, error);
                },
            });
        }
    };
    PrivateFileSystemManager.instance = null;
    return PrivateFileSystemManager;
}());
var privateFileSystemManager = PrivateFileSystemManager.getInstance();
exports["default"] = privateFileSystemManager;


/***/ }),

/***/ "./src/lib/ProgressBar.ts":
/*!********************************!*\
  !*** ./src/lib/ProgressBar.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var UserEventHandler_1 = __importDefault(__webpack_require__(/*! ./UserEventHandler */ "./src/lib/UserEventHandler.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var ProgressBar = /** @class */ (function () {
    function ProgressBar(progress) {
        this.percentageValue = 0;
        this.styleValue = {
            position: Types_1.Position.bottom,
            hidden: false,
            color: "#FFFFFF",
            backgroundColor: "#000000",
            height: 3,
        };
        this.progress = progress;
    }
    Object.defineProperty(ProgressBar.prototype, "percentage", {
        get: function () {
            return this.percentageValue;
        },
        set: function (inputPercentage) {
            var validatedPercentage = Math.min(100, Math.max(0, inputPercentage));
            if (validatedPercentage !== this.percentageValue) {
                this.percentageValue = validatedPercentage;
                this.refresh();
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(ProgressBar.prototype, "style", {
        get: function () {
            return this.styleValue;
        },
        set: function (_styleUpdates) {
            var styleUpdated = false;
            for (var key in _styleUpdates) {
                if (this.styleValue[key] !== _styleUpdates[key]) {
                    this.styleValue[key] = _styleUpdates[key];
                    styleUpdated = true;
                }
            }
            if (styleUpdated) {
                this.refresh();
            }
        },
        enumerable: false,
        configurable: true
    });
    ProgressBar.prototype.refresh = function () {
        UserEventHandler_1.default.eventEmitter.emit(this.progress, CaseType_1.ProgressCaseType.RefreshProgress);
    };
    return ProgressBar;
}());
exports["default"] = ProgressBar;


/***/ }),

/***/ "./src/lib/ProgressManager.ts":
/*!************************************!*\
  !*** ./src/lib/ProgressManager.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var UserEventHandler_1 = __importDefault(__webpack_require__(/*! ./UserEventHandler */ "./src/lib/UserEventHandler.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var ProgressBar_1 = __importDefault(__webpack_require__(/*! ./ProgressBar */ "./src/lib/ProgressBar.ts"));
var ProgressManager = /** @class */ (function (_super) {
    __extends(ProgressManager, _super);
    function ProgressManager(DirectorHandler) {
        var _this = _super.call(this, DirectorHandler) || this;
        _this.progressBar = new ProgressBar_1.default(_this);
        _this.registerProgressEventListener();
        return _this;
    }
    ProgressManager.prototype.created = function (eventHandler) {
        this.operaData = eventHandler;
        this.backFrame = eventHandler.createFrame(Types_1.FrameType.createRect, {
            visible: false,
        });
        this.frontFrame = eventHandler.createFrame(Types_1.FrameType.createRect, {
            visible: false,
        });
    };
    ProgressManager.prototype.refresh = function () {
        var _userStyle = this.progressBar.style;
        if (_userStyle.hidden) {
            this.frontFrame.setParams({
                visible: false,
            });
            this.backFrame.setParams({
                visible: false,
            });
        }
        else {
            var frameParams = {
                visible: true,
                height: _userStyle.height,
                left: 0,
            };
            if (_userStyle.position === Types_1.Position.bottom) {
                frameParams["bottom"] = 0;
            }
            else {
                frameParams["top"] = 0;
            }
            this.frontFrame.setParams(__assign(__assign({}, frameParams), { color: _userStyle.color, width: "".concat(Math.floor(this.progressBar.percentage), "%") }));
            this.backFrame.setParams(__assign(__assign({}, frameParams), { color: _userStyle.backgroundColor, width: "100%" }));
        }
        this.$update();
    };
    ProgressManager.prototype.registerProgressEventListener = function () {
        var _this = this;
        UserEventHandler_1.default.eventEmitter.registerEvent(this, function (frameParams) {
            if (frameParams === CaseType_1.ProgressCaseType.RefreshProgress) {
                _this.refresh();
            }
        });
    };
    return ProgressManager;
}(UserEventHandler_1.default));
ProgressManager.componentName = "progress";
exports["default"] = ProgressManager;


/***/ }),

/***/ "./src/lib/ReportActionHandler.ts":
/*!****************************************!*\
  !*** ./src/lib/ReportActionHandler.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var InitializeUnityPlugin = /** @class */ (function (_super) {
    __extends(InitializeUnityPlugin, _super);
    function InitializeUnityPlugin() {
        return _super.call(this) || this;
    }
    InitializeUnityPlugin.prototype.init = function (unityManagerInstance) {
        this.unityManager = unityManagerInstance;
        this.bindFunction();
        this.xmlDataProcessingModule = unityManagerInstance;
    };
    InitializeUnityPlugin.prototype.bindFunction = function () { };
    return InitializeUnityPlugin;
}(Instance_1.default));
var ReportActionHandler = /** @class */ (function (_super) {
    __extends(ReportActionHandler, _super);
    function ReportActionHandler() {
        return _super.call(this) || this;
    }
    ReportActionHandler.prototype.reportEmptyContent = function (params) {
        if ((0, Utils_1.isEmpty)(params)) {
            return PluginLogger_1.default.pluginError("[ksAssetBundle report]: invalid params");
        }
        var pluginEnvironment = new Utils_1.ObjectClassWrapper({
            ReportType: Types_1.ReportType.KsABReadEmptyContent,
            RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            ExternInfo: JSON.stringify(params),
        });
        ReportInitializer_1.default.remoteReporter.send(pluginEnvironment);
    };
    ReportActionHandler.prototype.bindFunction = function () {
        this.unityManager.reporter.ksAssetBundle = {
            reportEmptyContent: this.reportEmptyContent.bind(this),
        };
    };
    return ReportActionHandler;
}(InitializeUnityPlugin));
exports["default"] = ReportActionHandler;


/***/ }),

/***/ "./src/lib/ReportInitializer.ts":
/*!**************************************!*\
  !*** ./src/lib/ReportInitializer.ts ***!
  \**************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var GameTransferReport_1 = __importDefault(__webpack_require__(/*! ./GameTransferReport */ "./src/lib/GameTransferReport.ts"));
var Validation_1 = __webpack_require__(/*! ./Validation */ "./src/lib/Validation.ts");
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var KeyValueReporter_1 = __importDefault(__webpack_require__(/*! ./KeyValueReporter */ "./src/lib/KeyValueReporter.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var ReportInitializer = /** @class */ (function () {
    function ReportInitializer() {
    }
    ReportInitializer.initialize = function () {
        var isWK = SystemEnvironmentVariables_1.default.isWK, isDevtools = SystemEnvironmentVariables_1.default.isDevtools, _a = SystemEnvironmentVariables_1.default.systemInfo, SDKVersion = _a.SDKVersion, enableDebug = _a.enableDebug, isMiniGamePlugin = SystemEnvironmentVariables_1.default.isMiniGamePlugin, pluginEnv = SystemEnvironmentVariables_1.default.pluginEnv;
        var isGameTransferSupported = isWK && (0, Utils_1.compareVersions)(SDKVersion, "2.20.1") === -1;
        var enableDebugLog = !!GameGlobalVars_1.default.unityNamespace.enableDebugLog;
        var enableTraceLog = !!enableDebug || isDevtools;
        var debug = enableTraceLog && enableDebugLog;
        var reportFunc = function () {
        };
        var gameTransfer = function () {
        };
        if (isMiniGamePlugin) {
            reportFunc = pluginEnv.reportKeyValue || (function (msg) { return console.warn("Try to report", msg); });
            gameTransfer = pluginEnv.gameTransfer || (function () { return console.warn("当前环境没有gameTransfer函数"); });
        }
        if (isGameTransferSupported) {
            ReportInitializer.gameReporter = new GameTransferReport_1.default({
                logid: 21492,
                protocolParams: ["PluginVersion", "IsDownloadCode", "ReportType", "CostTimeMs", "NetworkType", "RunTimeMs", "PreloadedSize", "Scene", "LoadingPageType", "ExternInfo", "CodeType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    ReportType: Validation_1.ValidationConstants.UINT,
                    CostTimeMs: Validation_1.ValidationConstants.UINT,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    PreloadedSize: Validation_1.ValidationConstants.UINT,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                asyncGetBase: SystemUtils_1.getBase,
                debug: debug,
                reportFunc: gameTransfer,
            });
            ReportInitializer.remoteReporter = new GameTransferReport_1.default({
                logid: 21493,
                protocolParams: ["PluginVersion", "NetworkType", "IsDownloadCode", "ReportType", "ErrorMsg", "RunTimeMs", "Scene", "LoadingPageType", "ExternInfo", "CodeType", "ErrorType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    ReportType: Validation_1.ValidationConstants.UINT,
                    ErrorMsg: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    ErrorType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                asyncGetBase: SystemUtils_1.getBase,
                debug: debug,
                reportFunc: gameTransfer,
            });
            ReportInitializer.reportActionHandler = new GameTransferReport_1.default({
                logid: 21494,
                protocolParams: ["PluginVersion", "IsDownloadCode", "NetworkType", "RunTimeMs", "StageType", "Scene", "LoadingPageType", "ActionType", "PositionID", "ActionID", "ExternInfo", "CodeType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    StageType: Validation_1.ValidationConstants.STRING,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ActionType: Validation_1.ValidationConstants.UINT,
                    PositionID: Validation_1.ValidationConstants.UINT,
                    ActionID: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                asyncGetBase: SystemUtils_1.getBase,
                debug: debug,
                reportFunc: gameTransfer,
            });
        }
        else {
            ReportInitializer.gameReporter = new KeyValueReporter_1.default({
                logid: "KSGameWASMLaunchTime",
                protocolParams: ["PluginVersion", "IsDownloadCode", "ReportType", "CostTimeMs", "NetworkType", "RunTimeMs", "PreloadedSize", "Scene", "LoadingPageType", "ExternInfo", "CodeType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    ReportType: Validation_1.ValidationConstants.UINT,
                    CostTimeMs: Validation_1.ValidationConstants.UINT,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    PreloadedSize: Validation_1.ValidationConstants.UINT,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                reportFunc: reportFunc,
            });
            ReportInitializer.remoteReporter = new KeyValueReporter_1.default({
                logid: "KSGameWASMLaunchException",
                protocolParams: ["PluginVersion", "NetworkType", "IsDownloadCode", "ReportType", "ErrorMsg", "RunTimeMs", "Scene", "LoadingPageType", "ExternInfo", "CodeType", "ErrorType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    ReportType: Validation_1.ValidationConstants.UINT,
                    ErrorMsg: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    ErrorType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                reportFunc: reportFunc,
            });
            ReportInitializer.reportActionHandler = new KeyValueReporter_1.default({
                logid: "KSGameWASMLaunchClose",
                protocolParams: ["PluginVersion", "IsDownloadCode", "NetworkType", "RunTimeMs", "StageType", "Scene", "LoadingPageType", "ActionType", "PositionID", "ActionID", "ExternInfo", "CodeType", "IsVisible", "BenchmarkLevel", "RuntimeType", "UnityVersion", "ConvertPluginVersion", "LibVersion", "KuaishouClientVersion", "DataPackageLoadType", "AdSpaceType", "AdType", "MaterialType", "ABTest", "InstanceId"],
                schemas: {
                    PluginVersion: Validation_1.ValidationConstants.STRING,
                    IsDownloadCode: Validation_1.ValidationConstants.UINT,
                    NetworkType: Validation_1.ValidationConstants.STRING,
                    RunTimeMs: Validation_1.ValidationConstants.UINT,
                    StageType: Validation_1.ValidationConstants.STRING,
                    Scene: Validation_1.ValidationConstants.UINT,
                    LoadingPageType: Validation_1.ValidationConstants.UINT,
                    ActionType: Validation_1.ValidationConstants.UINT,
                    PositionID: Validation_1.ValidationConstants.UINT,
                    ActionID: Validation_1.ValidationConstants.UINT,
                    ExternInfo: Validation_1.ValidationConstants.STRING,
                    CodeType: Validation_1.ValidationConstants.UINT,
                    IsVisible: Validation_1.ValidationConstants.UINT,
                    BenchmarkLevel: Validation_1.ValidationConstants.INT,
                    RuntimeType: Validation_1.ValidationConstants.UINT,
                    UnityVersion: Validation_1.ValidationConstants.STRING,
                    ConvertPluginVersion: Validation_1.ValidationConstants.STRING,
                    LibVersion: Validation_1.ValidationConstants.STRING,
                    KuaishouClientVersion: Validation_1.ValidationConstants.STRING,
                    DataPackageLoadType: Validation_1.ValidationConstants.UINT,
                    AdSpaceType: Validation_1.ValidationConstants.UINT,
                    AdType: Validation_1.ValidationConstants.UINT,
                    MaterialType: Validation_1.ValidationConstants.UINT,
                    ABTest: Validation_1.ValidationConstants.STRING,
                    InstanceId: Validation_1.ValidationConstants.STRING,
                },
                reportFunc: reportFunc,
            });
        }
    };
    return ReportInitializer;
}());
exports["default"] = ReportInitializer;


/***/ }),

/***/ "./src/lib/Reporter.ts":
/*!*****************************!*\
  !*** ./src/lib/Reporter.ts ***!
  \*****************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var Common_1 = __webpack_require__(/*! ./Common */ "./src/lib/Common.ts");
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
// module 8852
var Reporter = /** @class */ (function () {
    function Reporter() {
        this.startTimestamp = new Date().getTime();
        this.hash = "";
        this.registerReportEventListener();
    }
    Reporter.prototype.bindDirector = function (directorValue) {
        this.director = directorValue;
    };
    Reporter.prototype.registerReportEventListener = function () {
        var self = this;
        Reporter.eventEmitter.registerEvent(this, function (context) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (context) {
                case CaseType_1.ReportCaseType.custom:
                    self.reportScene(args[0]);
                    break;
                case CaseType_1.ReportCaseType.end:
                    self.destory();
                    break;
            }
        });
    };
    Reporter.prototype.destory = function () {
    };
    Reporter.prototype.reportScene = function (reportData) {
        var self = this;
        if (typeof (0, Common_1.getKs)().reportScene === "function") {
            (0, Common_1.getKs)().reportScene({
                sceneId: reportData.sceneId,
                dimension: reportData.dimension ? JSON.parse(reportData.dimension) : {},
                metric: reportData.metric ? JSON.parse(reportData.metric) : {},
                costTime: this.calCostTime(),
                fail: function (error) {
                    var errorReport = {
                        type: Types_1.ExceptionType.Report,
                        errmsg: "\u81EA\u5B9A\u4E49\u4E0A\u62A5\u5931\u8D25 sceneId: ".concat(reportData.sceneId, " dimension: ").concat(reportData.dimension),
                        err: error,
                    };
                    OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(CaseType_1.DirctorCaseType.Exception, errorReport);
                },
            });
        }
        else {
            var exceptionReport = {
                type: Types_1.ExceptionType.Report,
                errmsg: "自定义上报失败,当前基础库版本过低。",
            };
            OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(CaseType_1.DirctorCaseType.Exception, exceptionReport);
        }
    };
    Reporter.prototype.calCostTime = function () {
        return new Date().getTime() - this.startTimestamp;
    };
    Reporter.eventEmitter = new EventManager_1.default();
    return Reporter;
}());
exports["default"] = Reporter;


/***/ }),

/***/ "./src/lib/RequestMonitor.ts":
/*!***********************************!*\
  !*** ./src/lib/RequestMonitor.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var BaseDataLoader_1 = __importDefault(__webpack_require__(/*! ./BaseDataLoader */ "./src/lib/BaseDataLoader.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var TaskManager_1 = __importDefault(__webpack_require__(/*! ./TaskManager */ "./src/lib/TaskManager.ts"));
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var FrameMonitor_1 = __importDefault(__webpack_require__(/*! ./FrameMonitor */ "./src/lib/FrameMonitor.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var RequestMonitor = /** @class */ (function (_super) {
    __extends(RequestMonitor, _super);
    function RequestMonitor(unityManager, monitor) {
        var _this = _super.call(this, unityManager, monitor) || this;
        _this.requestErrors = {
            disableH2: DefaultLanguageMap_1.default.requestMonitor_disableH2,
            noCDNCache: DefaultLanguageMap_1.default.requestMonitor_noCDNCache,
            cacheBundleSettings: DefaultLanguageMap_1.default.requestMonitor_cacheBundleSettings,
            noCacheCatalog: DefaultLanguageMap_1.default.requestMonitor_noCacheCatalog,
            noCatalogHash: DefaultLanguageMap_1.default.requestMonitor_noCatalogHash,
            requestCataHash: DefaultLanguageMap_1.default.requestMonitor_requestCataHash,
            lessCacheableCount: DefaultLanguageMap_1.default.requestMonitor_lessCacheableCount,
            lessParallelCount: DefaultLanguageMap_1.default.requestMonitor_lessParallelCount,
            lessNetworkTime: DefaultLanguageMap_1.default.requestMonitor_lessNetworkTime,
        };
        _this.cacheableCount = 0;
        _this.cacheableSize = 0;
        _this.noCacheableAssetCount = 0;
        _this.noCacheableAssetSize = 0;
        _this.requestBundleSettings = false;
        _this.cacheSettings = false;
        _this.requestBundleCatalog = false;
        _this.cacheCatalog = false;
        _this.appendHashToCatalog = false;
        _this.requestCataHash = false;
        _this.result = {};
        _this.loadedTasks = [];
        _this.loadedTasksMap = new Map();
        _this.cacheableRemoteCount = 0;
        _this.cacaheableRemoteSize = 0;
        _this.texturesCount = 0;
        _this.texturesSize = 0;
        return _this;
    }
    RequestMonitor.prototype.startLoad = function (url, taskId) {
        var _this = this;
        if (!this.monitor.endMonitor) {
            var task = TaskManager_1.default.genTask(url, taskId);
            this.baseLoad();
            task.afterSuccess = function (taskResult) {
                var receivedBytedCount = taskResult.info.receivedBytedCount || 0;
                var isCacheable = !!taskResult.info.cacheable;
                var isAlreadyLoaded = _this.loadedTasksMap.has(taskResult.info.url);
                if (!isCacheable || (isCacheable && !isAlreadyLoaded)) {
                    _this.loadedTasks.push(taskResult.info);
                    _this.loadedSize += receivedBytedCount;
                }
                if (taskResult.info.url.includes(GameGlobalVars_1.default.unityNamespace.DATA_CDN)) {
                    if (isCacheable) {
                        if (!isAlreadyLoaded) {
                            _this.loadedTasksMap.set(taskResult.info.url, true);
                            _this.cacheableCount += 1;
                            _this.cacheableSize += receivedBytedCount;
                        }
                        if (!taskResult.info.isReadFromCache) {
                            _this.cacheableRemoteCount += 1;
                            _this.cacaheableRemoteSize += receivedBytedCount;
                        }
                    }
                    else {
                        _this.noCacheableAssetCount += 1;
                        _this.noCacheableAssetSize += receivedBytedCount;
                    }
                    if (taskResult.info.isTexture) {
                        if (!isAlreadyLoaded) {
                            _this.loadedTasksMap.set(taskResult.info.url, true);
                            _this.texturesCount += 1;
                            _this.texturesSize += receivedBytedCount;
                        }
                    }
                    _this.baseCheck(taskResult);
                    _this.checkStreamingAssets(taskResult);
                }
                else {
                    _this.noCacheableAssetCount += 1;
                    _this.noCacheableAssetSize += receivedBytedCount;
                }
            };
        }
    };
    RequestMonitor.prototype.reset = function () {
        this.baseReset();
        this.cacheableCount = 0;
        this.requestBundleSettings = false;
        this.cacheSettings = false;
        this.requestBundleCatalog = false;
        this.cacheCatalog = false;
        this.appendHashToCatalog = false;
        this.requestCataHash = false;
        this.loadedTasks = [];
        this.loadedTasksMap.clear();
        this.requestErrors = {};
    };
    RequestMonitor.prototype.showResult = function () {
        this.result = this.getResultInfo();
        return this.checkResult();
    };
    RequestMonitor.prototype.checkResult = function () {
        PluginLogger_1.default.monitorLog("----网络监控 start----");
        PluginLogger_1.default.monitorLog("网络基本信息：", this.result);
        var warnings = [];
        var result = this.result;
        var primaryDataCachePath = DataPackageLoader_1.default.getPrimaryDataCachePath();
        if (result.loadCount) {
            if (!primaryDataCachePath && !result.useH2) {
                warnings.push(this.requestErrors.disableH2);
            }
            if (result.needEnableContentEncodingCount) {
                warnings.push("".concat(DefaultLanguageMap_1.default.requestMonitor_serverNotCachedAssets, ": ").concat(result.needEnableContentEncodingCount));
            }
            if (!result.hitCacheCount) {
                warnings.push(this.requestErrors.noCDNCache);
            }
            if (result.requestBundleSettings && result.cacheSettings) {
                warnings.push(this.requestErrors.cacheBundleSettings);
            }
            if (result.requestBundleCatalog && !result.cacheCatalog) {
                warnings.push(this.requestErrors.noCacheCatalog);
            }
            if (result.requestBundleCatalog && result.cacheCatalog && !result.appendHashToCatalog) {
                warnings.push(this.requestErrors.noCatalogHash);
            }
            if (result.requestCataHash) {
                warnings.push(this.requestErrors.requestCataHash);
            }
            if (+result.cacheableCount < result.loadCount / 2) {
                warnings.push(this.requestErrors.lessCacheableCount);
            }
            if (+result.avgLoadingCount < 5) {
                warnings.push(this.requestErrors.lessParallelCount);
            }
            if (result.networkTime / result.duration < 0.7) {
                warnings.push(this.requestErrors.lessNetworkTime);
            }
            if (warnings.length) {
                PluginLogger_1.default.monitorWarn("".concat(DefaultLanguageMap_1.default.showResult_netOptAdvice, ":"));
                PluginLogger_1.default.monitorWarn(warnings.join("\n"));
            }
        }
        PluginLogger_1.default.monitorLog("----网络监控 end----");
        return warnings;
    };
    RequestMonitor.prototype.getResultInfo = function () {
        var sortedLoadedTasks = this.loadedTasks.slice().sort(function (a, b) { return Number(b.duration) - Number(a.duration); });
        var unCachedTasks = sortedLoadedTasks.filter(function (task) { return !task.isReadFromCache; });
        var cachedTasks = sortedLoadedTasks.filter(function (task) { return !!task.isReadFromCache; });
        var pendingDurationsOfUnCachedTasks = unCachedTasks.map(function (task) { return task.pendingDuration; });
        var cachedDurations = cachedTasks
            .map(function (task) { return task.duration || 0; })
            .sort(function (a, b) { return b - a; });
        if (this.enabledH2Count) {
            this.useH2 = true;
        }
        if (this.enabledContentEncodingCount) {
            this.useContentEncoding = true;
        }
        return {
            useH2: this.useH2,
            enabledH2Count: this.enabledH2Count,
            enabledContentEncodingCount: this.enabledContentEncodingCount,
            useContentEncoding: this.useContentEncoding,
            cacheSettings: this.cacheSettings,
            cacheCatalog: this.cacheCatalog,
            appendHashToCatalog: this.appendHashToCatalog,
            requestCataHash: this.requestCataHash,
            requestBundleSettings: this.requestBundleSettings,
            requestBundleCatalog: this.requestBundleCatalog,
            loadCount: this.loadCount,
            loadedCount: this.loadedCount,
            loadedSizeStr: "".concat((this.loadedSize / 1024 / 1024).toFixed(2), "MB"),
            loadedSize: this.loadedSize,
            totalSize: this.loadedSize + this.monitor.preloadMonitor.result.loadedSize,
            hitCacheCount: this.hitCacheCount,
            cacheableCount: this.cacheableCount,
            loadFromCacheCount: this.loadFromCacheCount,
            startTime: this.startTime,
            duration: this.startTime ? Date.now() - this.startTime : 0,
            networkTime: TaskManager_1.default.totalNetworkTime,
            maxLoadingCount: TaskManager_1.default.maxLoadingCount,
            avgLoadingCount: TaskManager_1.default.avgLoadingCount,
            loadedTasks: sortedLoadedTasks,
            cacheableSize: this.cacheableSize,
            noCacheableAssetCount: this.noCacheableAssetCount,
            noCacheableAssetSize: this.noCacheableAssetSize,
            avgPendingDuration: pendingDurationsOfUnCachedTasks.length
                ? Math.round(pendingDurationsOfUnCachedTasks.reduce(function (sum, duration) { return sum + duration; }, 0) / pendingDurationsOfUnCachedTasks.length)
                : 0,
            topPendingDuration: pendingDurationsOfUnCachedTasks.slice(0, 5),
            remoteRequestCount: unCachedTasks.length,
            cacheableRemoteCount: this.cacheableRemoteCount,
            cacaheableRemoteSize: this.cacaheableRemoteSize,
            needCacheTextures: GameGlobalVars_1.default.unityNamespace.needCacheTextures,
            texturesCount: this.texturesCount,
            texturesSize: this.texturesSize,
            avgReadCacheCost: cachedDurations.length
                ? Math.round(cachedDurations.reduce(function (sum, duration) { return sum + duration; }, 0) / cachedDurations.length)
                : 0,
            topReadCacheCost: cachedDurations.slice(0, 5),
            topNetworkTime: unCachedTasks
                .sort(function (a, b) { return b.duration - a.duration; })
                .slice(0, 5)
                .map(function (task) { return task.duration; }),
            networkUsage: Number((TaskManager_1.default.totalNetworkTime / FrameMonitor_1.default.getInstance().getRuntime()).toFixed(4)),
        };
    };
    RequestMonitor.prototype.checkStreamingAssets = function (task) {
        var requestedUrl = task.info.url;
        var requestedUrlPath = requestedUrl.substring(requestedUrl.lastIndexOf("/"));
        if (!this.requestBundleSettings && requestedUrlPath.includes("settings")) {
            this.requestBundleSettings = true;
            if (task.info.cacheable) {
                this.cacheSettings = true;
            }
        }
        if (!this.requestBundleCatalog && requestedUrlPath.includes("catalog")) {
            this.requestBundleCatalog = true;
            if (task.info.cacheable) {
                this.cacheCatalog = true;
            }
            if (!requestedUrlPath.includes("catalog.")) {
                this.appendHashToCatalog = true;
            }
        }
        if (!this.requestCataHash && requestedUrlPath.includes("catalog") && requestedUrlPath.endsWith("hash")) {
            this.requestCataHash = true;
        }
    };
    return RequestMonitor;
}(BaseDataLoader_1.default));
exports["default"] = RequestMonitor;
;


/***/ }),

/***/ "./src/lib/SessionRecorder.ts":
/*!************************************!*\
  !*** ./src/lib/SessionRecorder.ts ***!
  \************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.SessionRecorder = void 0;
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
// module 7164
var SessionRecorder = /** @class */ (function () {
    function SessionRecorder(loggerModule) {
        this.startTimestamp = -1;
        this.idIndex = 0;
        this.recordQueue = [];
        this.mode = Types_1.RunningType.Record;
        this.running = false;
        this.setTimeoutHandler = [];
        this.registerLoggerEventListener();
        if (loggerModule) {
            this.import(loggerModule);
        }
    }
    SessionRecorder.prototype.bindDirector = function (directorValue) {
        this.director = directorValue;
    };
    SessionRecorder.prototype.export = function () {
        return JSON.stringify({
            recordQueue: this.recordQueue,
        });
    };
    SessionRecorder.prototype.exec = function () {
        if (!this.running) {
            if (this.mode !== Types_1.RunningType.Execute) {
                throw new Error('当前 Logger 不是 Execute 模式，无法执行该操作。');
            }
            for (this.running = true; this.recordQueue.length > 0;) {
                this.emitEvent();
            }
        }
    };
    SessionRecorder.prototype.import = function (_jsonString) {
        var parsedJson = JSON.parse(_jsonString);
        this.recordQueue = parsedJson.recordQueue;
        this.mode = Types_1.RunningType.Execute;
    };
    SessionRecorder.prototype.registerLoggerEventListener = function () {
        var self = this;
        SessionRecorder.eventEmitter.registerEvent(this, function (paramValue) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (paramValue) {
                case CaseType_1.LoggerCaseType.Reset:
                    self.reset();
                    break;
                case CaseType_1.LoggerCaseType.End:
                    self.end();
                    break;
                case CaseType_1.LoggerCaseType.LoggerPush:
                    var eventData = args[0];
                    self.pushEvent(eventData);
                    break;
            }
        });
    };
    SessionRecorder.prototype.reset = function () {
        if (this.startTimestamp === -1) {
            this.startTimestamp = new Date().getTime();
            this.idIndex = 0;
        }
    };
    SessionRecorder.prototype.end = function () {
        this.startTimestamp = -1;
        if (this.setTimeoutHandler.length !== 0) {
            this.setTimeoutHandler.forEach(function (id) {
                clearTimeout(id);
            });
            this.setTimeoutHandler = [];
        }
    };
    SessionRecorder.prototype.emitEvent = function () {
        var _this = this;
        var recordQueueItem = this.recordQueue.shift();
        if (recordQueueItem) {
            var timeoutId = setTimeout(function () {
                OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(_this.director, CaseType_1.DirctorCaseType.LoggerEmitEvent, recordQueueItem.e);
            }, recordQueueItem.tm);
            this.setTimeoutHandler.push(timeoutId);
        }
    };
    SessionRecorder.prototype.pushEvent = function (eventValue) {
        var eventLogEntry = {
            tm: this.getTm(),
            e: eventValue,
            i: this.idIndex++,
        };
        this.recordQueue.push(eventLogEntry);
        OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(this.director, CaseType_1.DirctorCaseType.ReportLogger, eventLogEntry);
    };
    SessionRecorder.prototype.getTm = function () {
        if (this.startTimestamp === -1) {
            return 0;
        }
        else {
            return new Date().getTime() - this.startTimestamp;
        }
    };
    SessionRecorder.Stream2Data = function (valueElement) {
    };
    SessionRecorder.eventEmitter = new EventManager_1.default();
    return SessionRecorder;
}());
exports.SessionRecorder = SessionRecorder;


/***/ }),

/***/ "./src/lib/StyleUtils.ts":
/*!*******************************!*\
  !*** ./src/lib/StyleUtils.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var stylePropertyHandler = {
    PositionAndSizeKeys: [
        "left",
        "right",
        "top",
        "bottom",
        "width",
        "height",
        "opacity",
        "scaleHeight",
        "scaleWidth"
    ],
    isPositionAndSizeChange: function (self) {
        return stylePropertyHandler.PositionAndSizeKeys.some(function (key) { return key in self; });
    },
    isPercent: function (value) {
        return typeof value === "string" && /^(100|[1-9]?\d)%$/.test(value);
    },
    percentCal: function (value, total) {
        if (typeof value === "number") {
            return value;
        }
        var match = value.match(/^(\d+)%$/);
        if (match) {
            return (parseInt(match[1], 10) / 100) * total;
        }
        return 0;
    },
    calPositionAndSizeByParams: function (event, eventType) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j;
        var params = {
            width: (_a = eventType === null || eventType === void 0 ? void 0 : eventType.width) !== null && _a !== void 0 ? _a : event.width,
            height: (_b = eventType === null || eventType === void 0 ? void 0 : eventType.height) !== null && _b !== void 0 ? _b : event.height,
            left: (_c = eventType === null || eventType === void 0 ? void 0 : eventType.left) !== null && _c !== void 0 ? _c : event.left,
            right: (_d = eventType === null || eventType === void 0 ? void 0 : eventType.right) !== null && _d !== void 0 ? _d : event.right,
            top: (_e = eventType === null || eventType === void 0 ? void 0 : eventType.top) !== null && _e !== void 0 ? _e : event.top,
            bottom: (_f = eventType === null || eventType === void 0 ? void 0 : eventType.bottom) !== null && _f !== void 0 ? _f : event.bottom,
            scaleHeight: (_g = eventType === null || eventType === void 0 ? void 0 : eventType.scaleHeight) !== null && _g !== void 0 ? _g : event.scaleHeight,
            scaleWidth: (_h = eventType === null || eventType === void 0 ? void 0 : eventType.scaleWidth) !== null && _h !== void 0 ? _h : event.scaleWidth,
            opacity: (_j = eventType === null || eventType === void 0 ? void 0 : eventType.opacity) !== null && _j !== void 0 ? _j : event.opacity,
        };
        return stylePropertyHandler.calPositionAndSize(params);
    },
    calPositionAndSize: function (videoHandler) {
        var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight;
        var result = {};
        for (var _i = 0, _b = Object.entries(videoHandler); _i < _b.length; _i++) {
            var _c = _b[_i], key = _c[0], val = _c[1];
            if (key === 'opacity' || val === undefined) {
                continue;
            }
            var dimension = ['width', 'left', 'right'].includes(key)
                ? screenWidth
                : screenHeight;
            result[key] = typeof val === 'string'
                ? stylePropertyHandler.percentCal(val, dimension)
                : val;
        }
        if (result.width === undefined) {
            if (result.left === undefined || result.right === undefined) {
                return null;
            }
            result.width = screenWidth - Number(result.left) - Number(result.right);
        }
        if (result.height === undefined) {
            if (result.top === undefined || result.bottom === undefined) {
                return null;
            }
            result.height = screenHeight - Number(result.top) - Number(result.bottom);
        }
        if (result.width === undefined ||
            result.height === undefined ||
            result.left === undefined ||
            result.right === undefined ||
            result.top === undefined ||
            result.bottom === undefined) {
            return null;
        }
        return {
            width: result.width,
            height: result.height,
            left: result.left,
            right: result.right,
            top: result.top,
            bottom: result.bottom,
        };
    },
};
exports["default"] = stylePropertyHandler;


/***/ }),

/***/ "./src/lib/SystemEnvironmentVariables.ts":
/*!***********************************************!*\
  !*** ./src/lib/SystemEnvironmentVariables.ts ***!
  \***********************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var SystemEnvironmentVariables = /** @class */ (function (_super) {
    __extends(SystemEnvironmentVariables, _super);
    function SystemEnvironmentVariables() {
        var _this = _super.call(this) || this;
        _this.isMagicBrush = false;
        _this.isMiniGamePlugin = false;
        _this.isMiniGame = false;
        _this.isMiniProgram = false;
        _this.isIOS = false;
        _this.isAndroid = false;
        _this.isDevtools = false;
        _this.isWindows = false;
        _this.isMac = false;
        _this.isPC = false;
        _this.isWK = false;
        _this.isWKPlus = false;
        _this.isIPad = false;
        _this.enableOffline = function () { return false; };
        _this.resolveOfflinePath = function (input) { return ""; };
        _this.isOfflineRequest = function (input) { return false; };
        _this.systemInfo = {};
        _this.accountInfo = {};
        _this.ks = {};
        _this.runtimeType = Types_1.moduleVersion.UnKnow;
        _this.pluginAppId = '';
        _this.pluginVersion = '';
        _this.pluginEnv = pluginEnv;
        _this.initialize();
        return _this;
    }
    SystemEnvironmentVariables.prototype.initialize = function () {
        var isMagicBrushDefined = typeof mb !== 'undefined' && mb.env !== undefined;
        var isPluginEnvironmentDefined = typeof pluginEnv !== 'undefined';
        var isMiniProgramDefined = !isMagicBrushDefined && typeof Page !== 'undefined';
        var isMiniGameFeatureEnabled = (!isMagicBrushDefined && !isMiniProgramDefined) || isPluginEnvironmentDefined;
        this.isMagicBrush = isMagicBrushDefined;
        this.isMiniGamePlugin = isPluginEnvironmentDefined;
        this.isMiniGame = isMiniGameFeatureEnabled;
        this.isMiniProgram = isMiniProgramDefined;
        if (isMiniGameFeatureEnabled || isMiniProgramDefined) {
            this.handleMiniGameOrMiniProgram();
        }
        else if (isMagicBrushDefined) {
            this.handleMagicBrush();
        }
        this.handleDeviceOrientationChange();
    };
    SystemEnvironmentVariables.prototype.handleMiniGameOrMiniProgram = function () {
        var _this = this;
        var _a, _b, _c;
        if (this.isMiniGamePlugin) {
            var customEnvironment = pluginEnv.customEnv;
            if (customEnvironment && customEnvironment.customEnv) {
                pluginEnv.customEnv = customEnvironment.customEnv;
            }
            if (pluginEnv.customEnv) {
                this.ks = pluginEnv.customEnv.ksh;
            }
        }
        if (this.ks) {
            try {
                this.processSystemInfo(this.ks.getSystemInfoSync());
                this.ks.getSystemInfo({
                    success: function (info) {
                        _this.processSystemInfo(info);
                    }
                });
            }
            catch (error) {
                console.error(error);
            }
            try {
                this.accountInfo = (_c = (_b = (_a = this.ks).getAccountInfoSync) === null || _b === void 0 ? void 0 : _b.call(_a)) !== null && _c !== void 0 ? _c : {
                    miniProgram: {
                        envVersion: 'release',
                    }
                };
            }
            catch (error) {
                console.error(error);
            }
            if (typeof this.ks.enableOffline === "function") {
                this.enableOffline = this.ks.enableOffline;
                this.resolveOfflinePath = this.ks.resolveOfflinePath;
                this.isOfflineRequest = this.ks.isOfflineRequest;
                var originalCreateInnerAudioContext_1 = this.ks.createInnerAudioContext.bind(this.ks);
                var resolveOfflinePath_1 = this.resolveOfflinePath;
                this.ks.createInnerAudioContext = function () {
                    var innerAudioContext = originalCreateInnerAudioContext_1();
                    return new Proxy(innerAudioContext, {
                        set: function (target, property, value) {
                            if (property === 'src') {
                                var modifiedValue = value;
                                if (resolveOfflinePath_1) {
                                    modifiedValue = resolveOfflinePath_1(value);
                                }
                                target[property] = modifiedValue;
                                return true;
                            }
                            target[property] = value;
                            return true;
                        },
                        get: function (target, property) {
                            var value = target[property];
                            if (typeof value === 'function') {
                                return value.bind(innerAudioContext);
                            }
                            return value;
                        }
                    });
                };
            }
        }
        else {
            console.error("ksh is not defined!");
        }
    };
    SystemEnvironmentVariables.prototype.handleMagicBrush = function () {
        var _this = this;
        mb.JSBridge.invoke('getSystemInfoSync', {}, function (result) {
            _this.systemInfo = result;
            _this.runtimeType = (0, Utils_1.getPlatformVM)(_this.systemInfo);
            _this.setSystemEnvironmentVariables(_this.systemInfo);
        });
    };
    SystemEnvironmentVariables.prototype.handleDeviceOrientationChange = function () {
        var _this = this;
        var _a;
        if ((_a = this.ks) === null || _a === void 0 ? void 0 : _a.onDeviceOrientationChange) {
            this.ks.onDeviceOrientationChange(function () {
                _this.ks.getSystemInfo({
                    success: function (systemInfo) {
                        _this.systemInfo = systemInfo || {};
                    }
                });
            });
        }
    };
    SystemEnvironmentVariables.prototype.processSystemInfo = function (systemInfo) {
        var _a, _b;
        this.systemInfo = systemInfo;
        if (!this.systemInfo.screenWidth) {
            this.systemInfo.screenWidth = 0;
            this.systemInfo.screenHeight = 0;
        }
        this.runtimeType = (0, Utils_1.getPlatformVM)(this.systemInfo);
        this.setSystemEnvironmentVariables(this.systemInfo);
        if ((0, Utils_1.compareVersions)(this.systemInfo.SDKVersion, '2.24.4') >= 0 && ((_a = this.ks) === null || _a === void 0 ? void 0 : _a.getAccountInfoSync)) {
            try {
                var pluginAccountInfo = (_b = this.ks.getAccountInfoSync()) === null || _b === void 0 ? void 0 : _b.plugin;
                var accountInfo = pluginAccountInfo !== null && pluginAccountInfo !== void 0 ? pluginAccountInfo : {};
                this.pluginAppId = accountInfo.appId;
                this.pluginVersion = accountInfo.version;
            }
            catch (error) {
                console.error(error);
            }
        }
    };
    SystemEnvironmentVariables.prototype.setSystemEnvironmentVariables = function (systemInfo) {
        var platformName = systemInfo.platform;
        var platformNameLowerCase = platformName === null || platformName === void 0 ? void 0 : platformName.toLocaleLowerCase();
        if (platformNameLowerCase === Types_1.deviceConfig.devtools) {
            this.isDevtools = true;
        }
        else if (platformNameLowerCase === Types_1.deviceConfig.ios) {
            this.isIOS = true;
            this.isWK = !!(window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceMode);
            this.isWKPlus = !!(window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceModePlus);
        }
        else if (platformNameLowerCase === Types_1.deviceConfig.android) {
            this.isAndroid = true;
        }
        else if (platformNameLowerCase === Types_1.deviceConfig.windows) {
            this.isWindows = true;
        }
        else if (platformNameLowerCase === Types_1.deviceConfig.mac) {
            this.isMac = true;
        }
        else if (platformNameLowerCase === undefined) {
            this.isIOS = true;
        }
        if (this.isWindows || this.isMac) {
            this.isPC = true;
        }
        if (systemInfo.model && systemInfo.model.includes('iPad')) {
            this.isIPad = true;
        }
    };
    Object.defineProperty(SystemEnvironmentVariables.prototype, "tjInstance", {
        get: function () {
            return this.isMiniGamePlugin ? this.ks : undefined;
        },
        enumerable: false,
        configurable: true
    });
    return SystemEnvironmentVariables;
}(Instance_1.default));
var systemInformation = SystemEnvironmentVariables.getInstance();
exports["default"] = systemInformation;


/***/ }),

/***/ "./src/lib/SystemUtils.ts":
/*!********************************!*\
  !*** ./src/lib/SystemUtils.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.sizeToMB = sizeToMB;
exports.sizeToKB = sizeToKB;
exports.maxAllowSize = maxAllowSize;
exports.getBase = getBase;
exports.formatPath = formatPath;
exports.convertToRealDevicePixels = convertToRealDevicePixels;
exports.HandleNetworkValidation = HandleNetworkValidation;
exports.reportEventLogger = reportEventLogger;
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var Constants_1 = __webpack_require__(/*! ./Constants */ "./src/lib/Constants.ts");
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var storageSizeUnit = 1024;
function sizeToMB(size) {
    var sizeNumber = Number(size);
    if (sizeNumber && !Number.isNaN(sizeNumber)) {
        return Number((sizeNumber / storageSizeUnit / storageSizeUnit).toFixed(2));
    }
    return 0;
}
function sizeToKB(size) {
    var sizeNumber = Number(size);
    if (sizeNumber && !Number.isNaN(sizeNumber)) {
        return Number((sizeNumber / storageSizeUnit).toFixed(2));
    }
    else {
        return 0;
    }
}
function maxAllowSize() {
    return ((SystemEnvironmentVariables_1.default.isPC ? 2048 : GameGlobalVars_1.default.unityNamespace.maxStorage || 200) - 5) * storageSizeUnit * storageSizeUnit;
}
function getBase() {
    return __awaiter(this, void 0, void 0, function () {
        var systemInfo, _unityNamespace, unityVersion, _convertPluginVersion, a;
        return __generator(this, function (_a) {
            systemInfo = SystemEnvironmentVariables_1.default.systemInfo;
            _unityNamespace = GameGlobalVars_1.default.unityNamespace;
            unityVersion = _unityNamespace.unityVersion;
            _convertPluginVersion = _unityNamespace.convertPluginVersion;
            a = new Utils_1.ObjectClassWrapper({
                PluginVersion: Constants_1.PluginVersion,
                IsVisible: GameLogic_1.GameVisible.GetVisibleIntValue(),
                RuntimeType: SystemEnvironmentVariables_1.default.isWK ? Types_1.RuntimeType.WK : Types_1.RuntimeType.Normal,
                UnityVersion: unityVersion,
                ConvertPluginVersion: _convertPluginVersion,
                LibVersion: systemInfo.SDKVersion,
                KuaishouClientVersion: systemInfo.version,
                InstanceId: GameGlobalVars_1.default.instanceId || "",
            });
            return [2 /*return*/, new Promise(function (cb) {
                    reportEventLogger(function (networkType) {
                        cb(Object.assign(Object.assign({}, a), {
                            NetworkType: networkType,
                        }));
                    });
                })];
        });
    });
}
function formatPath(path) {
    if (SystemEnvironmentVariables_1.default.isPC) {
        return path.replace(/\\/g, Constants_1.PathSplit);
    }
    else {
        return path;
    }
}
function convertToRealDevicePixels(cssSize) {
    var systemInfo = SystemEnvironmentVariables_1.default.systemInfo;
    return cssSize * systemInfo.pixelRatio;
}
function HandleNetworkValidation(callback, getNetworkType, onNetworkStatusChange) {
    var networkType = "";
    if (networkType) {
        if (callback) {
            callback(networkType);
        }
        return;
    }
    getNetworkType({
        success: function (result) {
            networkType = result.networkType;
            if (callback) {
                callback(networkType);
            }
        },
    });
    onNetworkStatusChange(function (result) {
        networkType = result.networkType;
        if (!result.isConnected) {
            networkType = "none";
        }
        if (callback) {
            callback(networkType);
        }
    });
}
;
function reportEventLogger(__eventLogger) {
    HandleNetworkValidation(__eventLogger, SystemEnvironmentVariables_1.default.tjInstance.getNetworkType, SystemEnvironmentVariables_1.default.tjInstance.onNetworkStatusChange);
}


/***/ }),

/***/ "./src/lib/Task.ts":
/*!*************************!*\
  !*** ./src/lib/Task.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {


Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventEmitter_1 = __webpack_require__(/*! ./EventEmitter */ "./src/lib/EventEmitter.ts");
var LoadingStatus = {
    DEFAULT: "default",
    OK: "ok",
    ERROR: "error",
};
var Task = /** @class */ (function () {
    function Task(url) {
        this.emitter = EventEmitter_1.eventEmitter;
        this.url = url;
        this.localStatus = LoadingStatus.DEFAULT;
        this.localStatusCode = undefined;
        this.localResponse = "";
    }
    Object.defineProperty(Task.prototype, "status", {
        get: function () {
            return this.localStatus;
        },
        set: function (status) {
            if (status && !this.localStatus) {
                this.localStatus = status;
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Task.prototype, "error", {
        get: function () {
            return this.localError;
        },
        set: function (error) {
            this.localError = error;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Task.prototype, "statusCode", {
        get: function () {
            return this.localStatusCode || 0;
        },
        set: function (statusCode) {
            if (this.localStatusCode === undefined && Number.isInteger(statusCode)) {
                this.localStatusCode = statusCode;
                if (this.status === LoadingStatus.DEFAULT) {
                    this.status = (statusCode && statusCode >= 200 && statusCode < 300)
                        ? LoadingStatus.OK
                        : LoadingStatus.ERROR;
                }
            }
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(Task.prototype, "response", {
        get: function () {
            return this.localResponse;
        },
        set: function (response) {
            if (this.status === LoadingStatus.DEFAULT) {
                if (response) {
                    this.status = LoadingStatus.OK;
                    this.localResponse = response;
                }
                else {
                    this.status = LoadingStatus.ERROR;
                    this.localResponse = "";
                }
            }
        },
        enumerable: false,
        configurable: true
    });
    Task.prototype.on = function (eventName) {
        var _this = this;
        return new Promise(function (resolve) {
            if (_this.status !== LoadingStatus.DEFAULT) {
                resolve(_this);
            }
            else {
                _this.emitter.on(eventName, function () {
                    resolve(_this);
                });
            }
        });
    };
    Task.prototype.once = function (eventName) {
        var _this = this;
        return new Promise(function (resolve) {
            _this.emitter.once(eventName, function () {
                resolve(_this);
            });
        });
    };
    Task.prototype.emit = function (event) {
        this.emitter.emit(event);
    };
    return Task;
}());
exports["default"] = Task;


/***/ }),

/***/ "./src/lib/TaskManager.ts":
/*!********************************!*\
  !*** ./src/lib/TaskManager.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var HttpRequestTask_1 = __importDefault(__webpack_require__(/*! ./HttpRequestTask */ "./src/lib/HttpRequestTask.ts"));
var TaskManager = /** @class */ (function () {
    function TaskManager() {
        var _this = this;
        this.loadingCount = 0;
        this.loadedCount = 0;
        this.totalNetworkTime = 0;
        this.maxLoadingCount = 0;
        this.avgLoadingCount = 1;
        this.timer = 0;
        this.loadingStartTime = 0;
        this.tasks = new Map();
        this.taskIdMap = new Map();
        this.doRecord = function () {
            if (_this.loadingCount > _this.maxLoadingCount) {
                _this.maxLoadingCount = _this.loadingCount;
            }
            _this.avgLoadingCount = Math.ceil((_this.loadingCount + _this.avgLoadingCount) / 2);
            _this.timer = setTimeout(_this.doRecord, 1000);
        };
    }
    TaskManager.prototype.genTask = function (url, taskId) {
        var request = new HttpRequestTask_1.default({ url: url, taskId: taskId });
        if (!taskId) {
            this.addTaskId(request);
        }
        this.addTask(request);
        return request;
    };
    TaskManager.prototype.addTask = function (request) {
        if (this.loadingCount === 0) {
            this.loadingStartTime = Date.now();
        }
        this.loadingCount += 1;
        if (this.loadingCount === 1) {
            this.doRecord();
        }
        this.tasks.set("".concat(request.info.url, "@").concat(request.taskId), request);
    };
    TaskManager.prototype.removeTask = function (taskInfo) {
        this.loadingCount -= 1;
        this.loadedCount += 1;
        if (this.loadingCount === 0) {
            var elapsedLoadingTime = Date.now() - this.loadingStartTime;
            this.totalNetworkTime += elapsedLoadingTime;
            this.stopRecord();
        }
        this.removeTaskId(taskInfo);
        this.tasks.delete("".concat(taskInfo.info.url, "@").concat(taskInfo.taskId));
    };
    TaskManager.prototype.getTask = function (taskId, taskIndex) {
        var finalTaskIndex = taskIndex || this.getCurrentTaskId(taskId);
        return this.tasks.get("".concat(taskId, "@").concat(finalTaskIndex));
    };
    TaskManager.prototype.addTaskId = function (task) {
        var taskIdArray = this.taskIdMap.get(task.info.url);
        if (taskIdArray) {
            taskIdArray.push(task.taskId);
            this.taskIdMap.set(task.info.url, taskIdArray);
        }
        else {
            this.taskIdMap.set(task.info.url, [task.taskId]);
        }
    };
    TaskManager.prototype.removeTaskId = function (task) {
        var taskIdList = this.taskIdMap.get(task.info.url);
        if (taskIdList === null || taskIdList === void 0 ? void 0 : taskIdList.length) {
            taskIdList.pop();
            if (taskIdList.length === 0) {
                this.taskIdMap.delete(task.info.url);
            }
        }
    };
    TaskManager.prototype.getCurrentTaskId = function (url) {
        var taskIdList = this.taskIdMap.get(url);
        var length = taskIdList === null || taskIdList === void 0 ? void 0 : taskIdList.length;
        if (length && taskIdList) {
            return taskIdList[length - 1];
        }
    };
    TaskManager.prototype.stopRecord = function () {
        if (this.timer) {
            clearTimeout(this.timer);
            this.timer = 0;
        }
    };
    return TaskManager;
}());
exports["default"] = new TaskManager();


/***/ }),

/***/ "./src/lib/TimeLogManager.ts":
/*!***********************************!*\
  !*** ./src/lib/TimeLogManager.ts ***!
  \***********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.TimeLogManager = void 0;
exports.reportStartPerformance = reportStartPerformance;
exports.reportEndPerformance = reportEndPerformance;
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var LogReport_1 = __importDefault(__webpack_require__(/*! ./LogReport */ "./src/lib/LogReport.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var reportedActions = new Set();
function isValueEmptyOrNull(inputValue) {
    return inputValue == null || inputValue.length === 0;
}
function reportPerformance(actionIdentifier, reportTimestamp, isActionStarted, errorMessage) {
    var ks = SystemEnvironmentVariables_1.default.ks;
    if (ks && typeof ks.reportPerformanceImplement === "function") {
        if (actionIdentifier && !reportedActions.has(actionIdentifier)) {
            var isErrorMessageEmpty = isValueEmptyOrNull(errorMessage);
            if (isErrorMessageEmpty) {
                if (isActionStarted) {
                    errorMessage = "";
                }
                else {
                    errorMessage = "success";
                }
            }
            ks.reportPerformanceImplement({
                action: actionIdentifier,
                timestamp: reportTimestamp,
                success: isErrorMessageEmpty,
                errorNo: isErrorMessageEmpty ? 0 : 1,
                errorMsg: errorMessage,
            });
            reportedActions.add(actionIdentifier);
        }
    }
}
function reportStartPerformance(reportAction, reportTime) {
    var mappedActionForReport = undefined;
    if (reportAction === "下载wasm代码包") {
        mappedActionForReport = "launch.1012";
    }
    else if (reportAction.indexOf("下载资源") > -1) {
        mappedActionForReport = "launch.1014";
    }
    else if (reportAction === "fileSystemInit") {
        mappedActionForReport = "launch.1018";
    }
    else if (reportAction.indexOf("wasm编译耗时") > -1) {
        mappedActionForReport = "launch.1020";
    }
    else if (reportAction.indexOf("callMain耗时") > -1) {
        mappedActionForReport = "launch.1022";
    }
    reportPerformance(mappedActionForReport, reportTime, true);
}
function reportEndPerformance(reportAction, reportTime, errorMessage) {
    var mappedActionForReport = undefined;
    if (reportAction === "下载wasm代码包") {
        mappedActionForReport = "launch.1013";
    }
    else if (reportAction.indexOf("下载资源") > -1) {
        mappedActionForReport = "launch.1015";
    }
    else if (reportAction === "fileSystemInit") {
        mappedActionForReport = "launch.1019";
    }
    else if (reportAction.indexOf("wasm编译耗时") > -1) {
        mappedActionForReport = "launch.1021";
    }
    else if (reportAction.indexOf("callMain耗时") > -1) {
        mappedActionForReport = "launch.1023";
    }
    reportPerformance(mappedActionForReport, reportTime, false, errorMessage);
}
var TimeLogManager = /** @class */ (function () {
    function TimeLogManager() {
    }
    TimeLogManager.timeStart = function (event) {
        if (!TimeLogManager.timeMap.has(event)) {
            var currentTimestamp = Date.now();
            reportStartPerformance(event, currentTimestamp);
            TimeLogManager.timeMap.set(event, currentTimestamp);
            return currentTimestamp;
        }
        return 0;
    };
    TimeLogManager.printTime = function (event) {
        var isRunning = event.includes("callMain耗时") && GameGlobalVars_1.default.unityNamespace.DO_RUN_START;
        var isWasmBegin = event.includes("wasm编译耗时") && GameGlobalVars_1.default.unityNamespace.WASM_BEGIN_TIME;
        if (TimeLogManager.timeMap.has(event) || isRunning || isWasmBegin) {
            var duration = TimeLogManager.timeEnd(event, false);
            var logMessage = "[PLUGIN TIME LOG ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "] ").concat(event, ": ").concat(duration, "ms");
            LogReport_1.default.xlog.info(logMessage);
            GameGlobalVars_1.default.logManager.log(logMessage);
            TimeLogManager.timeStrList.push(logMessage);
        }
    };
    TimeLogManager.timeEnd = function (event, shouldDeleteTimeEntry) {
        if (shouldDeleteTimeEntry === void 0) { shouldDeleteTimeEntry = true; }
        var isRunning = event.includes("callMain耗时") && GameGlobalVars_1.default.unityNamespace.DO_RUN_START;
        var isWasmBegin = event.includes("wasm编译耗时") && GameGlobalVars_1.default.unityNamespace.WASM_BEGIN_TIME;
        if (TimeLogManager.timeMap.has(event) || isRunning || isWasmBegin) {
            var endTime = Date.now();
            var startTime = TimeLogManager.timeMap.get(event) || 0;
            reportEndPerformance(event, endTime);
            if (isRunning) {
                startTime = GameGlobalVars_1.default.unityNamespace.DO_RUN_START;
            }
            if (isWasmBegin) {
                startTime = GameGlobalVars_1.default.unityNamespace.WASM_BEGIN_TIME;
            }
            if (shouldDeleteTimeEntry) {
                TimeLogManager.timeMap.delete(event);
            }
            return endTime - startTime;
        }
        return 0;
    };
    TimeLogManager.getRuntime = function (toSeconds) {
        if (toSeconds === void 0) { toSeconds = false; }
        var elapsedTime = Date.now() - TimeLogManager.logStartTime;
        return toSeconds ? +(elapsedTime / 1000).toFixed(2) : elapsedTime;
    };
    TimeLogManager.printRuntime = function (pluginActionName) {
        var formattedLogMessage = "[PLUGIN TIME LOG ".concat((0, Utils_1.formatTimestamp)(Date.now(), "hh:mm.ss.SSS"), "] ").concat(pluginActionName, ": ").concat(TimeLogManager.getRuntime(), "ms");
        LogReport_1.default.xlog.info(formattedLogMessage);
        GameGlobalVars_1.default.logManager.log(formattedLogMessage);
        if (formattedLogMessage.includes("游戏启动耗时")) {
            TimeLogManager.timeStrList.push(formattedLogMessage);
            if (!GameGlobalVars_1.default.unityNamespace.hideTimeLogModal &&
                (!!GameGlobalVars_1.default.unityNamespace.showTimeLogInAllVersion || GameGlobalVars_1.default.envVersion === Utils_1.releaseStatus.DEVELOP)) {
                SystemEnvironmentVariables_1.default.tjInstance.showModal({
                    title: "timelog",
                    content: TimeLogManager.timeStrList.join("\r\n"),
                });
                TimeLogManager.timeStrList = [];
            }
        }
    };
    TimeLogManager.storeTime = function (event) {
        if (!TimeLogManager.storeTimeMap.has(event)) {
            TimeLogManager.storeTimeMap.set(event, {
                CostTimeMs: TimeLogManager.timeEnd(event),
                RunTimeMs: TimeLogManager.getRuntime(),
            });
        }
    };
    TimeLogManager.popTime = function (event) {
        if (TimeLogManager.storeTimeMap.has(event)) {
            var storedTime = TimeLogManager.storeTimeMap.get(event);
            TimeLogManager.storeTimeMap.delete(event);
            return storedTime || null;
        }
        return null;
    };
    TimeLogManager.logStartTime = Date.now();
    TimeLogManager.timeMap = new Map();
    TimeLogManager.storeTimeMap = new Map();
    TimeLogManager.timeStrList = [];
    return TimeLogManager;
}());
exports.TimeLogManager = TimeLogManager;


/***/ }),

/***/ "./src/lib/Types.ts":
/*!**************************!*\
  !*** ./src/lib/Types.ts ***!
  \**************************/
/***/ (function(__unused_webpack_module, exports) {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var _a, _b;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.deviceConfig = exports.moduleVersion = exports.DOMElementType = exports.WeakNetworkLevel = exports.OperaDataType = exports.Position = exports.QualityReportType = exports.BackgroundModeEvent = exports.SystemInfo = exports.FrontBackground = exports.GamePluginStage = exports.ScaleMode = exports.SnapshotType = exports.ReportStatusType = exports.ExceptionType = exports.SysFrameType = exports.FrameType = exports.RunningType = exports.LoggerType = exports.TaskStatus = exports.LaunchStageStatus = exports.ExternInfoTypes = exports.ErrorMessages = exports.WorkerTypes = exports.ReleaseMemoryResultTypes = exports.NetworkTypes = exports.GameLaunchStatusMap = exports.GameEvents = exports.GameLaunchStatusDetail = exports.TransferStatus = exports.ResourceDownloadError = exports.PackageLoadType = exports.Threshold = exports.Ads = exports.GLContextType = exports.RuntimeType = exports.CodeType = exports.ReportType = exports.GameLaunchStatus = exports.AssetsLoadTypeText = exports.AssetsLoadType = exports.LoadingPageType = exports.ParamInputType = void 0;
var LoadingPageType;
(function (LoadingPageType) {
    LoadingPageType[LoadingPageType["LONG_VIDEO"] = 0] = "LONG_VIDEO";
    LoadingPageType[LoadingPageType["INTERACTIVE_VIDEO"] = 1] = "INTERACTIVE_VIDEO";
    LoadingPageType[LoadingPageType["COVER_VIEW"] = 2] = "COVER_VIEW";
    LoadingPageType[LoadingPageType["LaunchOpera"] = 10] = "LaunchOpera";
})(LoadingPageType || (exports.LoadingPageType = LoadingPageType = {}));
var AssetsLoadType = {
    AllCached: 0,
    DownloadAll: 1,
    DownloadDataPackage: 2,
    DownloadWasmCode: 3,
};
exports.AssetsLoadType = AssetsLoadType;
var AssetsLoadTypeText = {
    0: "资源有缓存",
    1: "资源无缓存",
    2: "仅下载首资源包",
    3: "仅下载wasm包",
};
exports.AssetsLoadTypeText = AssetsLoadTypeText;
var GameLaunchStatus = {
    GAME_LAUNCH: 0,
    LOAD_SUBPACKAGE: 1,
    COMPILE_WASM: 2,
    LOAD_ASSETS: 3,
    UNZIP_ASSETS: 4,
    READ_ASSETS: 5,
    PREPARE_GAME: 6,
    GAME_START: 7,
    LOAD_ASSET_BUNDLE: 8,
    FILE_SYSTEM_INIT: 9,
    GET_CONTEXT: 10,
    LOAD_BACKGROUND_IMAGE: 11,
    COVER_VIEW_INIT: 12,
    LAUNCH_OPERA_FRAME_START: 13,
    LAUNCH_OPERA_FRAME_END: 14,
    LAUNCH_OPERA_FRAME_CHECKPOINT: 15,
    LAUNCH_OPERA_FRAME_CHECKPOINT_COUNT: 16,
};
exports.GameLaunchStatus = GameLaunchStatus;
var ReportType = {
    WAIT_SUB_WASM_END: 30,
    BEFORE_LOAD_SUB_WASM: 31,
    LOAD_SUB_WASM_VERY_EARLY: 32,
    SUB_WASM_LOAD: 33,
    SUB_WASM_COMPILED: 34,
    FETCH_JS: 35,
    WRITE_PATCH: 36,
    COMPILE_PATCH: 37,
    DOWNLOAD_PATCH: 38,
    MISS_PATCH_FUNC: 39,
    DEFAULT: 50,
    UNZIP: 51,
    WRITEFILE: 52,
    RELEASE_ERROR: 53,
    DELETE_FILE: 54,
    EXCEED_MAX: 55,
    QUOTA_CONTROL: 56,
    STAT_SIZE_EXCEED: 57,
    STAT_SIZE_NORMAL: 58,
    OUT_OF_RANGE: 59,
    BASE_INFO: 70,
    ASSETS_INFO: 71,
    FRAME_INFO: 72,
    FONT: 80,
    ON_ABORT: 100,
    WaitingRemoveDependencies: 101,
    KsABReadEmptyContent: 102,
    Malloc: 110,
};
exports.ReportType = ReportType;
var CodeType = {
    normal: 0,
    codeSplit: 1,
};
exports.CodeType = CodeType;
var RuntimeType = {
    Normal: 0,
    WK: 1,
};
exports.RuntimeType = RuntimeType;
var GLContextType = {
    1: "webgl",
    2: "webgl2",
};
exports.GLContextType = GLContextType;
var Ads = {
    AdSpaceType: "adSpaceType",
    AdType: "adType",
    MaterialType: "materialType"
};
exports.Ads = Ads;
var Threshold = {
    Default: 0,
    Min: 1,
    Max: 200,
};
exports.Threshold = Threshold;
var PackageLoadType = {
    Subpackage: 0,
    Cdn: 1,
};
exports.PackageLoadType = PackageLoadType;
var ResourceDownloadError = {
    Wasm: "长时间未完成wasm代码下载",
    DataPackage: "长时间未完成资源包下载",
};
exports.ResourceDownloadError = ResourceDownloadError;
var TransferStatus = {
    close: "0",
    open: "1",
};
exports.TransferStatus = TransferStatus;
var GameLaunchStatusDetail = {
    launchPlugin: "launchPlugin",
    loadWasm: "loadWasm",
    compileWasm: "compileWasm",
    loadAssets: "loadAssets",
    readAssets: "readAssets",
    prepareGame: "prepareGame",
    launchOperaInit: "launchOperaInit",
    launchOperaMsgBridgeFromWasm: "launchOperaMsgBridgeFromWasm",
    launchOperaPushMsgToWasm: "launchOperaPushMsgToWasm",
    CreateWorker: "createWorker",
};
exports.GameLaunchStatusDetail = GameLaunchStatusDetail;
var GameEvents = {
    PluginLaunch: "onPluginLaunch",
    LoadingPageReady: "onLoadingPageReady",
    ParallelLoading: "onParallelLoading",
    ParallelLoaded: "onParallelLoaded",
    WasmLoading: "onWasmLoading",
    WasmLoaded: "onWasmLoaded",
    AssetLoading: "onAssetLoading",
    AssetLoaded: "onAssetLoaded",
    AssetProcessed: "onAssetProcessed",
    WasmInstantiated: "onWasmInstantiated",
    CalledMain: "onCalledMain",
    FileSystemReady: "onFileSystemReady",
    FeatureFlagReady: "onFeatureFlagReady",
    ReporterReady: "onReporterReady",
    InstanceReady: "onInstanceReady",
    ModulePrepared: "onModulePrepared",
    LaunchProgress: "onLaunchProgress",
};
exports.GameEvents = GameEvents;
var GameLaunchStatusMap = (_a = {},
    _a[GameLaunchStatus.GAME_LAUNCH] = GameLaunchStatusDetail.launchPlugin,
    _a[GameLaunchStatus.LOAD_SUBPACKAGE] = GameLaunchStatusDetail.loadWasm,
    _a[GameLaunchStatus.COMPILE_WASM] = GameLaunchStatusDetail.compileWasm,
    _a[GameLaunchStatus.LOAD_ASSETS] = GameLaunchStatusDetail.loadAssets,
    _a[GameLaunchStatus.READ_ASSETS] = GameLaunchStatusDetail.readAssets,
    _a[GameLaunchStatus.PREPARE_GAME] = GameLaunchStatusDetail.prepareGame,
    _a);
exports.GameLaunchStatusMap = GameLaunchStatusMap;
var NetworkTypes = {
    wifi: "wifi",
    unknown: "unknown",
    none: "none",
    "2g": "2g",
    "3g": "3g",
    "4g": "4g",
    "5g": "5g",
};
exports.NetworkTypes = NetworkTypes;
var ReleaseMemoryResultTypes;
(function (ReleaseMemoryResultTypes) {
    ReleaseMemoryResultTypes[ReleaseMemoryResultTypes["NO_NEED_RELEASE_MEMORY"] = 1] = "NO_NEED_RELEASE_MEMORY";
    ReleaseMemoryResultTypes[ReleaseMemoryResultTypes["EXCEED_MEMORY"] = 2] = "EXCEED_MEMORY";
    ReleaseMemoryResultTypes[ReleaseMemoryResultTypes["RELEASED_MEMORY"] = 3] = "RELEASED_MEMORY";
    ReleaseMemoryResultTypes[ReleaseMemoryResultTypes["CANNOT_RELEASE"] = 4] = "CANNOT_RELEASE";
})(ReleaseMemoryResultTypes || (exports.ReleaseMemoryResultTypes = ReleaseMemoryResultTypes = {}));
var WorkerTypes;
(function (WorkerTypes) {
    WorkerTypes[WorkerTypes["config"] = 0] = "config";
    WorkerTypes[WorkerTypes["writeFile"] = 1] = "writeFile";
})(WorkerTypes || (exports.WorkerTypes = WorkerTypes = {}));
var ErrorMessages = {
    InvalidCachePath: "invalid cache path",
    EmptyPath: "empty path",
    EmptyContent: "empty content",
    ExceedMemory: "exceed memory",
    FrequentWrite: "frequent writes in a short time",
    OutOfRange: "out of range",
};
exports.ErrorMessages = ErrorMessages;
var ExternInfoTypes = {
    QuotaControlError: "quota_control_error",
    WriteFile: "writeFile",
    ExceedMaxStorage: "exceed_max_storage",
};
exports.ExternInfoTypes = ExternInfoTypes;
var LaunchStageStatus = {
    DEFAULT: "DEFAULT",
    PENDING: "PENDING",
    FULFILLED: "FULFILLED",
    REJECTED: "REJECTED",
};
exports.LaunchStageStatus = LaunchStageStatus;
var ExceptionType;
(function (ExceptionType) {
    ExceptionType[ExceptionType["Unknown"] = 0] = "Unknown";
    ExceptionType[ExceptionType["Viewer"] = 1] = "Viewer";
    ExceptionType[ExceptionType["Director"] = 2] = "Director";
    ExceptionType[ExceptionType["Video"] = 3] = "Video";
    ExceptionType[ExceptionType["Image"] = 4] = "Image";
    ExceptionType[ExceptionType["Frame"] = 5] = "Frame";
    ExceptionType[ExceptionType["Report"] = 6] = "Report";
    ExceptionType[ExceptionType["Audio"] = 7] = "Audio";
})(ExceptionType || (exports.ExceptionType = ExceptionType = {}));
var ReportStatusType;
(function (ReportStatusType) {
    ReportStatusType[ReportStatusType["start"] = 0] = "start";
    ReportStatusType[ReportStatusType["end"] = 1] = "end";
    ReportStatusType[ReportStatusType["checkPoint"] = 2] = "checkPoint";
    ReportStatusType[ReportStatusType["checkPointCount"] = 3] = "checkPointCount";
})(ReportStatusType || (exports.ReportStatusType = ReportStatusType = {}));
var SnapshotType;
(function (SnapshotType) {
    SnapshotType[SnapshotType["FETCH_SNAPSHOT"] = 70] = "FETCH_SNAPSHOT";
    SnapshotType[SnapshotType["RESTORE_SNAPSHOT"] = 71] = "RESTORE_SNAPSHOT";
})(SnapshotType || (exports.SnapshotType = SnapshotType = {}));
var ScaleMode;
(function (ScaleMode) {
    ScaleMode["NO_BORDER"] = "NO_BORDER";
    ScaleMode["EXACT_FIT"] = "EXACT_FIT";
    ScaleMode["FIXED_HEIGHT"] = "FIXED_HEIGHT";
    ScaleMode["FIXED_WIDTH"] = "FIXED_WIDTH";
    ScaleMode["SHOW_ALL"] = "SHOW_ALL";
    ScaleMode["FIXED_NARROW"] = "FIXED_NARROW";
    ScaleMode["FIXED_WIDE"] = "FIXED_WIDE";
})(ScaleMode || (exports.ScaleMode = ScaleMode = {}));
var GamePluginStage;
(function (GamePluginStage) {
    GamePluginStage[GamePluginStage["Downloading"] = 0] = "Downloading";
    GamePluginStage[GamePluginStage["CompileWasm"] = 1] = "CompileWasm";
    GamePluginStage[GamePluginStage["PrepareGame"] = 2] = "PrepareGame";
})(GamePluginStage || (exports.GamePluginStage = GamePluginStage = {}));
var ReportGameAction = (_b = {},
    _b[ReportStatusType.start] = GameLaunchStatus.LAUNCH_OPERA_FRAME_START,
    _b[ReportStatusType.end] = GameLaunchStatus.LAUNCH_OPERA_FRAME_END,
    _b[ReportStatusType.checkPoint] = GameLaunchStatus.LAUNCH_OPERA_FRAME_CHECKPOINT,
    _b[ReportStatusType.checkPointCount] = GameLaunchStatus.LAUNCH_OPERA_FRAME_CHECKPOINT_COUNT,
    _b);
var TaskStatus = {
    LOADED: "loaded",
    ERROR: "error",
    COMPLETE: "complete",
};
exports.TaskStatus = TaskStatus;
var FrontBackground;
(function (FrontBackground) {
    FrontBackground[FrontBackground["Front"] = 1] = "Front";
    FrontBackground[FrontBackground["Background"] = 2] = "Background";
})(FrontBackground || (exports.FrontBackground = FrontBackground = {}));
var SystemInfo;
(function (SystemInfo) {
    SystemInfo[SystemInfo["Default"] = 0] = "Default";
    SystemInfo[SystemInfo["GameTransfer"] = 1] = "GameTransfer";
    SystemInfo[SystemInfo["Request"] = 2] = "Request";
    SystemInfo[SystemInfo["DownloadFile"] = 3] = "DownloadFile";
    SystemInfo[SystemInfo["CgiSpeedMeasure"] = 4] = "CgiSpeedMeasure";
    SystemInfo[SystemInfo["BadJs"] = 5] = "BadJs";
    SystemInfo[SystemInfo["Init"] = 6] = "Init";
    SystemInfo[SystemInfo["CostTime"] = 7] = "CostTime";
    SystemInfo[SystemInfo["Error"] = 8] = "Error";
    SystemInfo[SystemInfo["UploadFile"] = 9] = "UploadFile";
    SystemInfo[SystemInfo["Login"] = 10] = "Login";
    SystemInfo[SystemInfo["WebTransfer"] = 11] = "WebTransfer";
})(SystemInfo || (exports.SystemInfo = SystemInfo = {}));
var BackgroundModeEvent;
(function (BackgroundModeEvent) {
    BackgroundModeEvent[BackgroundModeEvent["Info"] = 101] = "Info";
    BackgroundModeEvent[BackgroundModeEvent["Warn"] = 102] = "Warn";
    BackgroundModeEvent[BackgroundModeEvent["Error"] = 103] = "Error";
})(BackgroundModeEvent || (exports.BackgroundModeEvent = BackgroundModeEvent = {}));
var QualityReportType;
(function (QualityReportType) {
    QualityReportType["GameTransferReport"] = "GameTransferReport";
    QualityReportType["KeyValueReport"] = "KeyValueReport";
    QualityReportType["KsRequestReport"] = "KsRequestReport";
})(QualityReportType || (exports.QualityReportType = QualityReportType = {}));
var LoggerType;
(function (LoggerType) {
    LoggerType[LoggerType["BaseInfo"] = 0] = "BaseInfo";
    LoggerType[LoggerType["ViewAction"] = 2] = "ViewAction";
    LoggerType[LoggerType["GlobalVarAction"] = 3] = "GlobalVarAction";
})(LoggerType || (exports.LoggerType = LoggerType = {}));
var RunningType;
(function (RunningType) {
    RunningType[RunningType["Record"] = 0] = "Record";
    RunningType[RunningType["Execute"] = 1] = "Execute";
})(RunningType || (exports.RunningType = RunningType = {}));
var FrameType;
(function (FrameType) {
    FrameType[FrameType["media"] = 0] = "media";
    FrameType[FrameType["createVideo"] = 13] = "createVideo";
    FrameType[FrameType["pauseVide"] = 5] = "pauseVide";
    FrameType[FrameType["playVideo"] = 1] = "playVideo";
    FrameType[FrameType["createAudio"] = 20] = "createAudio";
    FrameType[FrameType["pauseAudio"] = 21] = "pauseAudio";
    FrameType[FrameType["playAudio"] = 22] = "playAudio";
    FrameType[FrameType["createImage"] = 2] = "createImage";
    FrameType[FrameType["createRect"] = 6] = "createRect";
    FrameType[FrameType["end"] = 7] = "end";
    FrameType[FrameType["var"] = 8] = "var";
    FrameType[FrameType["setParam"] = 16] = "setParam";
    FrameType[FrameType["setTimeout"] = 19] = "setTimeout";
    FrameType[FrameType["setParamSize"] = 9] = "setParamSize";
    FrameType[FrameType["setParamPosition"] = 10] = "setParamPosition";
    FrameType[FrameType["setParamSizeAndPosition"] = 11] = "setParamSizeAndPosition";
    FrameType[FrameType["createAnimationFunction"] = 12] = "createAnimationFunction";
    FrameType[FrameType["exception"] = 14] = "exception";
    FrameType[FrameType["if"] = 15] = "if";
    FrameType[FrameType["report"] = 17] = "report";
    FrameType[FrameType["checkPoint"] = 18] = "checkPoint";
    FrameType[FrameType["reportCheckPointCount"] = 23] = "reportCheckPointCount";
})(FrameType || (exports.FrameType = FrameType = {}));
var SysFrameType = __assign({}, FrameType);
exports.SysFrameType = SysFrameType;
var Position;
(function (Position) {
    Position[Position["top"] = 0] = "top";
    Position[Position["bottom"] = 1] = "bottom";
})(Position || (exports.Position = Position = {}));
var OperaDataType;
(function (OperaDataType) {
    OperaDataType[OperaDataType["Frame"] = 0] = "Frame";
    OperaDataType[OperaDataType["StoryLine"] = 1] = "StoryLine";
})(OperaDataType || (exports.OperaDataType = OperaDataType = {}));
var ParamInputType;
(function (ParamInputType) {
    ParamInputType["String"] = "String";
    ParamInputType["Selecet"] = "Selecet";
    ParamInputType["Boolean"] = "Boolean";
    ParamInputType["Number"] = "Number";
    ParamInputType["None"] = "None";
    ParamInputType["Percent"] = "Percent";
    ParamInputType["Frame"] = "Frame";
})(ParamInputType || (exports.ParamInputType = ParamInputType = {}));
var WeakNetworkLevel;
(function (WeakNetworkLevel) {
    WeakNetworkLevel[WeakNetworkLevel["normal"] = 0] = "normal";
    WeakNetworkLevel[WeakNetworkLevel["slight"] = 1] = "slight";
    WeakNetworkLevel[WeakNetworkLevel["serious"] = 2] = "serious";
})(WeakNetworkLevel || (exports.WeakNetworkLevel = WeakNetworkLevel = {}));
var DOMElementType;
(function (DOMElementType) {
    DOMElementType[DOMElementType["video"] = 0] = "video";
    DOMElementType[DOMElementType["image"] = 1] = "image";
    DOMElementType[DOMElementType["view"] = 2] = "view";
})(DOMElementType || (exports.DOMElementType = DOMElementType = {}));
var moduleVersion = {
    Android: 0,
    IOSJscore: 1,
    IOSWK: 2,
    UnKnow: 3,
    PC: 4,
    Devtools: 5,
    IPadJscore: 6,
    IPadWK: 7,
    IOSWKPlus: 8,
    IPadWKPlus: 9,
};
exports.moduleVersion = moduleVersion;
var deviceConfig = {
    devtools: "devtools",
    android: "android",
    ios: "ios",
    windows: "windows",
    mac: "mac",
};
exports.deviceConfig = deviceConfig;


/***/ }),

/***/ "./src/lib/UnityManager.ts":
/*!*********************************!*\
  !*** ./src/lib/UnityManager.ts ***!
  \*********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var FileSystemManager_1 = __importDefault(__webpack_require__(/*! ./FileSystemManager */ "./src/lib/FileSystemManager.ts"));
var WorkerManager_1 = __importDefault(__webpack_require__(/*! ./WorkerManager */ "./src/lib/WorkerManager.ts"));
var LaunchStage_1 = __importDefault(__webpack_require__(/*! ./LaunchStage */ "./src/lib/LaunchStage.ts"));
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var GameWasmLoadReporter_1 = __webpack_require__(/*! ./GameWasmLoadReporter */ "./src/lib/GameWasmLoadReporter.ts");
var GameLogic_1 = __webpack_require__(/*! ./GameLogic */ "./src/lib/GameLogic.ts");
var Constants_1 = __webpack_require__(/*! ./Constants */ "./src/lib/Constants.ts");
var Events_1 = __webpack_require__(/*! ./Events */ "./src/lib/Events.ts");
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var GameWasmLoader_1 = __importDefault(__webpack_require__(/*! ./GameWasmLoader */ "./src/lib/GameWasmLoader.ts"));
var LoadingViewerController_1 = __importDefault(__webpack_require__(/*! ./LoadingViewerController */ "./src/lib/LoadingViewerController.ts"));
var GameVideoManager_1 = __importDefault(__webpack_require__(/*! ./GameVideoManager */ "./src/lib/GameVideoManager.ts"));
var ReportActionHandler_1 = __importDefault(__webpack_require__(/*! ./ReportActionHandler */ "./src/lib/ReportActionHandler.ts"));
var InitializeUnityPlugin_1 = __importDefault(__webpack_require__(/*! ./InitializeUnityPlugin */ "./src/lib/InitializeUnityPlugin.ts"));
var AssetsLoader_1 = __importDefault(__webpack_require__(/*! ./AssetsLoader */ "./src/lib/AssetsLoader.ts"));
var LoadingPageLongVideo_1 = __importDefault(__webpack_require__(/*! ./LoadingPageLongVideo */ "./src/lib/LoadingPageLongVideo.ts"));
var FunctionBinder_1 = __webpack_require__(/*! ./FunctionBinder */ "./src/lib/FunctionBinder.ts");
var AuthToken_1 = __importDefault(__webpack_require__(/*! ./AuthToken */ "./src/lib/AuthToken.ts"));
var PreloadTaskManager_1 = __importDefault(__webpack_require__(/*! ./PreloadTaskManager */ "./src/lib/PreloadTaskManager.ts"));
var FontManager_1 = __importDefault(__webpack_require__(/*! ./FontManager */ "./src/lib/FontManager.ts"));
var PatchManager_1 = __webpack_require__(/*! ./PatchManager */ "./src/lib/PatchManager.ts");
var CacheableXMLHttpRequest_1 = __importDefault(__webpack_require__(/*! ./CacheableXMLHttpRequest */ "./src/lib/CacheableXMLHttpRequest.ts"));
var ErrorProp_1 = __importDefault(__webpack_require__(/*! ./ErrorProp */ "./src/lib/ErrorProp.ts"));
var LoadingPageView_1 = __importDefault(__webpack_require__(/*! ./LoadingPageView */ "./src/lib/LoadingPageView.ts"));
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var ReportInitializer_1 = __importDefault(__webpack_require__(/*! ./ReportInitializer */ "./src/lib/ReportInitializer.ts"));
var DataPackageLoader_1 = __importDefault(__webpack_require__(/*! ./DataPackageLoader */ "./src/lib/DataPackageLoader.ts"));
var GameCanvas_1 = __importDefault(__webpack_require__(/*! ./GameCanvas */ "./src/lib/GameCanvas.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var UnityManager = /** @class */ (function () {
    function UnityManager(options) {
        var _this = this;
        this.contextType = 0;
        this.initReporterDone = false;
        this.onLogError = function (errorMessage) {
            if (errorMessage) {
                _this.writeLog(errorMessage);
            }
            else {
                _this.writeLog("unknown error");
            }
        };
        this.initReporter = function () { return __awaiter(_this, void 0, void 0, function () {
            var launchOptions, sceneId, launchQueryParams, getLaunchOptions, _launchData, __launchData, ___launchData, calculateOffsetsAndStyles, offsetCalculator, performanceMetrics, offsetValue, offsetCalculationResult, tempVariable, offsetCalculationFunction, loadingCalculation, loadingCalculationIndex, fileInitializationPromise, fileSystemInitializationMetrics, _loadingCalculationIndex, fileSystemInitializationPromise, loadingFileSystemInitialization, _fileSystemInitializationPromise, canUseCommonPackage, eventTrigger, error_1;
            var _a, _b;
            return __generator(this, function (_c) {
                switch (_c.label) {
                    case 0:
                        if (this.initReporterDone) {
                            return [2 /*return*/];
                        }
                        _c.label = 1;
                    case 1:
                        _c.trys.push([1, 4, , 5]);
                        TimeLogManager_1.TimeLogManager.timeStart("fileSystemInit");
                        return [4 /*yield*/, FileSystemManager_1.default.fileSystem.init()];
                    case 2:
                        _c.sent();
                        TimeLogManager_1.TimeLogManager.storeTime("fileSystemInit");
                        return [4 /*yield*/, this.getFeatureFlags];
                    case 3:
                        _c.sent();
                        launchOptions = SystemEnvironmentVariables_1.default.tjInstance.getLaunchOptionsSync();
                        sceneId = launchOptions.scene;
                        launchQueryParams = launchOptions.query;
                        PluginLogger_1.default.eventLog("".concat(AssetsLoader_1.default.getAssetsLoadText()));
                        getLaunchOptions = (function (emptyObject) {
                            if (emptyObject === void 0) { emptyObject = {}; }
                            return {
                                adSpaceType: (0, Utils_1.getProgressValue)(emptyObject[Types_1.Ads.AdSpaceType]),
                                adType: (0, Utils_1.getProgressValue)(emptyObject[Types_1.Ads.AdType]),
                                materialType: (0, Utils_1.getProgressValue)(emptyObject[Types_1.Ads.MaterialType]),
                            };
                        })(launchQueryParams);
                        _launchData = getLaunchOptions.adSpaceType;
                        __launchData = getLaunchOptions.adType;
                        ___launchData = getLaunchOptions.materialType;
                        calculateOffsetsAndStyles = GameFeatures_1.gameFeatures.getFeatureString();
                        offsetCalculator = GameGlobalVars_1.default.unityNamespace;
                        performanceMetrics = offsetCalculator.CODE_FILE_MD5;
                        offsetValue = offsetCalculator.DATA_FILE_MD5;
                        offsetCalculationResult = offsetCalculator.WASM_SPLIT_SUB_VERSION;
                        tempVariable = offsetCalculator.WASM_SPLIT_API_VERSION;
                        offsetCalculationFunction = offsetCalculator.unityVersion;
                        loadingCalculation = offsetCalculator.usedTextureCompression;
                        loadingCalculationIndex = offsetCalculator.usedAutoStreaming;
                        canUseCommonPackage = !!GameGlobalVars_1.default.unityNamespace.instantiateWasm;
                        fileInitializationPromise = {
                            canUseCommonPackage: canUseCommonPackage,
                            wasmSplitPluginVersion: offsetCalculator.WASM_SPLIT_PLUGIN_VERSION,
                            codeMd5: performanceMetrics,
                            wasmSplitSubVersion: offsetCalculationResult,
                            wasmSplitApiVersion: tempVariable,
                            usedTextureCompression: loadingCalculation,
                            usedAutoStreaming: loadingCalculationIndex,
                            dataMd5: offsetValue,
                        };
                        PluginLogger_1.default.eventLog("插件信息: ", Object.assign({
                            pluginVersion: Constants_1.PluginVersion,
                            unityVersion: offsetCalculationFunction,
                            loadDataPackageFromSubpackage: DataPackageLoader_1.default.loadDataPackageFromSubpackage,
                            adSpaceType: _launchData,
                            adType: __launchData,
                            materialType: ___launchData,
                            abTest: calculateOffsetsAndStyles,
                            maxAllowSize: (0, SystemUtils_1.maxAllowSize)(),
                            useWasmSplit: this.codeType === Types_1.CodeType.codeSplit,
                            canUseHighPerformance: GameGlobalVars_1.default.isWkAndNewSDK,
                            assetsLoadType: AssetsLoader_1.default.assetsLoadType,
                            instanceId: GameGlobalVars_1.default.instanceId,
                        }, fileInitializationPromise));
                        if (!GameGlobalVars_1.default.isRelease) {
                            if (GameGlobalVars_1.default.isWkAndNewSDK && this.codeType !== Types_1.CodeType.codeSplit) {
                                PluginLogger_1.default.pluginError("[开发阶段提示 不影响线上版本]高性能模式下不使用代码分包会严重影响性能。");
                            }
                        }
                        _loadingCalculationIndex = new Utils_1.ObjectClassWrapper({
                            IsDownloadCode: AssetsLoader_1.default.assetsLoadType,
                            LoadingPageType: Number((_a = this.loadingPageType) !== null && _a !== void 0 ? _a : Types_1.LoadingPageType.COVER_VIEW) +
                                Number(((_b = (this == null ? undefined : this.launchOpera)) === null || _b === void 0 ? void 0 : _b.used)
                                    ? Types_1.LoadingPageType.LaunchOpera
                                    : Types_1.LoadingPageType.LONG_VIDEO),
                            Scene: sceneId,
                            BenchmarkLevel: SystemEnvironmentVariables_1.default.systemInfo.benchmarkLevel,
                            CodeType: this.codeType,
                            DataPackageLoadType: DataPackageLoader_1.default.loadDataPackageFromSubpackage
                                ? Types_1.PackageLoadType.Subpackage
                                : Types_1.PackageLoadType.Cdn,
                            AdSpaceType: _launchData,
                            AdType: __launchData,
                            MaterialType: ___launchData,
                            ABTest: calculateOffsetsAndStyles,
                        });
                        ReportInitializer_1.default.gameReporter.setBase(_loadingCalculationIndex);
                        ReportInitializer_1.default.remoteReporter.setBase(_loadingCalculationIndex);
                        ReportInitializer_1.default.reportActionHandler.setBase(_loadingCalculationIndex);
                        eventTrigger = Events_1.EventTrigger.getInstance();
                        eventTrigger.triggerEvent(Types_1.GameEvents.PluginLaunch, new Events_1.GameEventDetail(this));
                        this.triggerLaunchProgress(Types_1.GameLaunchStatus.GAME_LAUNCH, 0);
                        // File system initialization reporting
                        fileSystemInitializationMetrics = [
                            new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.GAME_LAUNCH,
                                CostTimeMs: 0,
                                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                                ExternInfo: JSON.stringify(fileInitializationPromise),
                            }),
                        ];
                        loadingFileSystemInitialization = TimeLogManager_1.TimeLogManager.popTime("fileSystemInit");
                        _fileSystemInitializationPromise = TimeLogManager_1.TimeLogManager.popTime("getContext");
                        if (loadingFileSystemInitialization) {
                            fileSystemInitializationMetrics.push(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.FILE_SYSTEM_INIT,
                                CostTimeMs: loadingFileSystemInitialization.CostTimeMs,
                                RunTimeMs: loadingFileSystemInitialization.RunTimeMs,
                            }));
                        }
                        if (_fileSystemInitializationPromise) {
                            fileSystemInitializationMetrics.push(new Utils_1.ObjectClassWrapper({
                                ReportType: Types_1.GameLaunchStatus.GET_CONTEXT,
                                CostTimeMs: _fileSystemInitializationPromise.CostTimeMs,
                                RunTimeMs: _fileSystemInitializationPromise.RunTimeMs,
                            }));
                        }
                        FileSystemManager_1.default.fileSystem.checkNeedReportStat();
                        ReportInitializer_1.default.gameReporter.send(fileSystemInitializationMetrics);
                        SystemEnvironmentVariables_1.default.tjInstance.onHide(this.onHide);
                        SystemEnvironmentVariables_1.default.tjInstance.onShow(this.onShow);
                        this.initReporterDone = true;
                        return [3 /*break*/, 5];
                    case 4:
                        error_1 = _c.sent();
                        console.error(error_1, "initReporter");
                        return [3 /*break*/, 5];
                    case 5: return [2 /*return*/];
                }
            });
        }); };
        this.initialize(options);
    }
    Object.defineProperty(UnityManager.prototype, "isAssetsLoading", {
        get: function () {
            if (!this.loadingCount) {
                return false;
            }
            return this.loadingCount > 0;
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(UnityManager.prototype, "isVisible", {
        get: function () {
            return GameLogic_1.GameVisible.GetVisible();
        },
        enumerable: false,
        configurable: true
    });
    Object.defineProperty(UnityManager.prototype, "worker", {
        get: function () {
            var workerManager = WorkerManager_1.default.getInstance();
            return workerManager.worker;
        },
        enumerable: false,
        configurable: true
    });
    UnityManager.prototype.initialize = function (options) {
        var _this = this;
        var preloadTaskManager = PreloadTaskManager_1.default.getInstance();
        this.font = {};
        this.wasmsplit = {};
        this.reporter = {};
        this.useCoverView = true;
        this.PLUGIN_CACHE_PATH = GameGlobalVars_1.default.gameFileCache;
        this.hideAfterCallmain = false;
        this.contextType = 1;
        this.TimeLogger = TimeLogManager_1.TimeLogManager;
        this.Logger = PluginLogger_1.default;
        this.launchData = [];
        this.getFeatureFlags = this.invokeGetFeatureFlags();
        this.loadingPage = null;
        this.launchOpera = null;
        this.launchStage = null;
        this.setPreloadList = preloadTaskManager.setPreloadList.bind(preloadTaskManager);
        this.codeType = 0;
        this.mainCalled = false;
        this.loadingCount = 2;
        this.gameStarted = false;
        this.loadingPageType = null;
        this.parallelFetchSubWasmTask = null;
        var eventTrigger = Events_1.EventTrigger.getInstance();
        eventTrigger.init(this);
        FunctionBinder_1.snapshotManager.init(this);
        FunctionBinder_1.functionBinderMalloc.init(this);
        PluginMonitor_1.default.getInstance().init(this);
        var gameWasmLoadReporter = GameWasmLoadReporter_1.GameWasmLoadReporter.getInstance();
        gameWasmLoadReporter.init(this);
        var reportActionHandler = ReportActionHandler_1.default.getInstance();
        reportActionHandler.init(this);
        FontManager_1.default.init(this);
        UnityManager.createWKVideo = function (gameActionResponse, filePath) {
            return new GameVideoManager_1.default(gameActionResponse, filePath);
        };
        this.globalArguments = (0, Utils_1.excludeProperties)(options, [
            "videoManager",
            "finalPageVideoUrl",
            "pageManager",
            "loadingPageConfig",
            "useCoverView",
            "hideAfterCallmain",
            "preloadDataList",
            "loadDataPackageFromSubpackage",
            "compressDataPackage",
            "contextConfig",
        ]);
        this.init(options);
        AuthToken_1.default.init(this);
        this.getFeatureFlags.then(function () {
            var eventTrigger = Events_1.EventTrigger.getInstance();
            eventTrigger.triggerEvent(Types_1.GameEvents.FeatureFlagReady, new Events_1.GameEventDetail(_this));
            // const workerManager = <WorkerManager>WorkerManager.getInstance();
            // workerManager.init();
        });
    };
    UnityManager.prototype.init = function (_options) {
        var _this = this;
        var videoManager = _options.videoManager, finalPageVideoUrl = _options.finalPageVideoUrl, pageManager = _options.pageManager, loadingPageConfig = _options.loadingPageConfig, useCoverView = _options.useCoverView, hideAfterCallmain = _options.hideAfterCallmain, preloadDataList = _options.preloadDataList, loadDataPackageFromSubpackage = _options.loadDataPackageFromSubpackage, compressDataPackage = _options.compressDataPackage, _a = _options.contextConfig, contextConfig = _a === void 0 ? {} : _a;
        var isLoadingDataFromSubpackage = loadDataPackageFromSubpackage !== undefined && loadDataPackageFromSubpackage;
        var isCompressDataPackageEnabled = compressDataPackage !== undefined && compressDataPackage;
        if (UnityManager.instance) {
            return;
        }
        this.gameInstance = null;
        this.mainCalled = false;
        this.gameStarted = false;
        this.useCoverView = SystemEnvironmentVariables_1.default.pluginEnv.coverview;
        this.hideAfterCallmain = !!hideAfterCallmain;
        this.contextType = contextConfig.contextType || 1;
        if (GameGlobalVars_1.default.unityNamespace.useHostWasmCodeSplit) {
            this.codeType = Types_1.CodeType.codeSplit;
        }
        else {
            this.codeType = Types_1.CodeType.normal;
        }
        this.useHostCodeSplit = GameGlobalVars_1.default.unityNamespace.useHostWasmCodeSplit;
        TimeLogManager_1.TimeLogManager.timeStart("getContext");
        var glContextOptions = {
            alpha: true,
            stencil: true,
            antialias: false,
            powerPreference: "high-performance",
        };
        var gameCanvas = GameCanvas_1.default.getInstance();
        GameGlobalVars_1.default.unityNamespace.globalGL = gameCanvas.canvas.getContext(Types_1.GLContextType[this.contextType], glContextOptions);
        TimeLogManager_1.TimeLogManager.storeTime("getContext");
        if (!GameGlobalVars_1.default.unityNamespace.globalGL) {
            var pluginErrorMessage_1 = "".concat(DefaultLanguageMap_1.default.webGLContext_notSupport).concat(Types_1.GLContextType[this.contextType], ", ").concat(DefaultLanguageMap_1.default.webGLContext_upgradeTip).concat(SystemEnvironmentVariables_1.default.isIOS ? DefaultLanguageMap_1.default.webglContext_sysTag : "");
            PluginLogger_1.default.pluginError(pluginErrorMessage_1);
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: DefaultLanguageMap_1.default.reminder,
                content: pluginErrorMessage_1,
                showCancel: false,
                success: function () {
                },
            });
            this.initReporter().then(function () {
                ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                    ReportType: Types_1.GameLaunchStatus.GET_CONTEXT,
                    ExternInfo: JSON.stringify({
                        contextType: Types_1.GLContextType[_this.contextType],
                        contextNum: _this.contextType,
                        contextAttributes: glContextOptions,
                    }),
                }));
            });
            setTimeout(function () {
                throw new Error(pluginErrorMessage_1);
            }, 0);
        }
        this.initGameGlobal(this.globalArguments);
        var initializeUnityPlugin = InitializeUnityPlugin_1.default.getInstance();
        initializeUnityPlugin.init(this);
        DataPackageLoader_1.default.init(this, {
            loadDataPackageFromSubpackage: isLoadingDataFromSubpackage,
            compressDataPackage: isCompressDataPackageEnabled,
        });
        var gameWasmLoader = GameWasmLoader_1.default.getInstance();
        gameWasmLoader.init(this);
        AssetsLoader_1.default.init(this);
        GameGlobalVars_1.default.unityNamespace.needDownloadDataPackage = AssetsLoader_1.default.needDownload;
        if (preloadDataList) {
            PreloadTaskManager_1.default.getInstance().init({ preloadList: preloadDataList });
        }
        this.initLoadingPage({
            videoManager: videoManager,
            pageManager: pageManager,
            loadingPageConfig: loadingPageConfig,
            finalPageVideoUrl: finalPageVideoUrl,
        });
        this.launchStage = new LaunchStage_1.default(this.useCoverView);
        UnityManager.instance = this;
    };
    UnityManager.prototype.invokeGetFeatureFlags = function () {
        var context = this;
        return new Promise(function (resolve) {
            if (!SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
                PluginLogger_1.default.pluginLog("非插件模式跳过特性开关逻辑");
                return resolve(null);
            }
            var launchScene = SystemEnvironmentVariables_1.default.tjInstance.getLaunchOptionsSync().scene;
            var isResolved = false;
            setTimeout(function () {
                if (!isResolved) {
                    PluginLogger_1.default.eventLog("特性开关拉取超时，使用默认值");
                    isResolved = true;
                    resolve(null);
                }
            }, 100);
            // TODO Hao Feng 10/23/2024 delete call gametransfer
        });
    };
    UnityManager.prototype.getCachePath = function (cachePath) {
        return FileSystemManager_1.default.getCachePath(cachePath);
    };
    UnityManager.prototype.cleanAllCache = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0: return [4 /*yield*/, FileSystemManager_1.default.cleanAllCache()];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    UnityManager.prototype.cleanCache = function (memoryUsage) {
        FileSystemManager_1.default.fileSystem.releaseMemory(memoryUsage, 0);
    };
    UnityManager.prototype.removeFile = function (fileToRemove) {
        FileSystemManager_1.default.fileSystem.removeFile(fileToRemove, true);
    };
    UnityManager.prototype.writeFile = function (fileData, fileWriteCallback) {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                return [2 /*return*/, FileSystemManager_1.default.writeFile(fileData, fileWriteCallback)];
            });
        });
    };
    UnityManager.prototype.writeLog = function (event) {
        if (event) {
            PluginLogger_1.default.eventLog("writeLog: ", event);
            GameGlobalVars_1.default.logManager.log(event);
        }
    };
    UnityManager.prototype.writeWarn = function (error) {
        if (error) {
            PluginLogger_1.default.pluginWarn("writeWarn: ", error);
            GameGlobalVars_1.default.logManager.warn(error);
        }
    };
    UnityManager.prototype.reportJump = function () {
        if (this.loadingPageType === Types_1.LoadingPageType.INTERACTIVE_VIDEO) {
            ReportInitializer_1.default.reportActionHandler.send(new Utils_1.ObjectClassWrapper({
                ActionType: 1,
                PositionID: 1,
                ActionID: 2,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            }));
        }
    };
    UnityManager.prototype.setConcurrent = function (event) {
        var preloadTaskManager = PreloadTaskManager_1.default.getInstance();
        var setConcurrentFunction = preloadTaskManager.setConcurrent;
        if (setConcurrentFunction) {
            setConcurrentFunction.call(preloadTaskManager, event);
        }
    };
    UnityManager.prototype.initLoadingPage = function (options) {
        var _a;
        var loadingPageConfig = options.loadingPageConfig;
        this.loadingPageType = Types_1.LoadingPageType.LONG_VIDEO;
        if (this.useCoverView && loadingPageConfig) {
            if (SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
                this.loadingPageType = Types_1.LoadingPageType.COVER_VIEW;
            }
            GameGlobalVars_1.default.unityNamespace.isLoopRunnerEnable = true;
        }
        if (this.loadingPageType === Types_1.LoadingPageType.LONG_VIDEO) {
            this.loadingPage = new LoadingPageLongVideo_1.default({
                src: (_a = (loadingPageConfig === null || loadingPageConfig === void 0 ? void 0 : loadingPageConfig.materialConfig)) === null || _a === void 0 ? void 0 : _a.backgroundVideo,
            });
            GameGlobalVars_1.default.unityNamespace.isLoopRunnerEnable = true;
        }
        if (this.loadingPageType === Types_1.LoadingPageType.COVER_VIEW) {
            var loadingPageConfig_1 = options.loadingPageConfig || {};
            var totalLaunchTime = loadingPageConfig_1.totalLaunchTime;
            var scaleMode = loadingPageConfig_1.scaleMode;
            var designWidth = loadingPageConfig_1.designWidth;
            var designHeight = loadingPageConfig_1.designHeight;
            var textConfiguration = loadingPageConfig_1.textConfig;
            var loadingBarConfig = loadingPageConfig_1.barConfig;
            var materialConfiguration = loadingPageConfig_1.materialConfig;
            var iconConfiguration = loadingPageConfig_1.iconConfig;
            var extensionButtonConfig = loadingPageConfig_1.extensionButton;
            var isLoadingPageVisible = loadingPageConfig_1.visible;
            this.loadingPage = new LoadingPageView_1.default({
                totalLaunchTime: totalLaunchTime,
                designWidth: designWidth,
                designHeight: designHeight,
                needDownload: AssetsLoader_1.default.needDownload,
                hideAfterCallmain: this.hideAfterCallmain,
                textConfig: textConfiguration,
                barConfig: loadingBarConfig,
                materialConfig: materialConfiguration,
                scaleMode: scaleMode,
                iconConfig: iconConfiguration,
                extensionButton: extensionButtonConfig,
                visible: isLoadingPageVisible,
            });
        }
        this.launchOpera = new LoadingViewerController_1.default();
    };
    UnityManager.prototype.initGameGlobal = function (inputParam) {
        var _this = this;
        if (inputParam === void 0) { inputParam = {}; }
        Object.entries(inputParam).forEach(function (_a) {
            var eventType = _a[0], value = _a[1];
            var url = value;
            if (["STREAMING_CDN", "DATA_CDN"].includes(eventType) && url.includes("http")) {
                GameGlobalVars_1.default.unityNamespace[eventType] = url.endsWith("/") ? value : "".concat(value, "/");
            }
            else {
                GameGlobalVars_1.default.unityNamespace[eventType] = value;
            }
        });
        GameGlobalVars_1.default.unityNamespace.launchOpera = this.launchOpera;
        GameGlobalVars_1.default.unityNamespace.UnityLoader = {
            SystemInfo: {
                width: SystemEnvironmentVariables_1.default.systemInfo.screenWidth,
                height: SystemEnvironmentVariables_1.default.systemInfo.screenHeight,
                gpu: (function () {
                    var gameCanvas = GameCanvas_1.default.getInstance();
                    var webGLContext = gameCanvas.canvas.getContext(Types_1.GLContextType[_this.contextType]);
                    if (webGLContext) {
                        var webGLDebugRendererInfo = webGLContext.getExtension("WEBGL_debug_renderer_info");
                        if (webGLDebugRendererInfo) {
                            return webGLContext.getParameter(webGLDebugRendererInfo.UNMASKED_RENDERER_WEBGL);
                        }
                    }
                    return "unknown";
                })(),
                browser: "ks",
                browserVersion: "0.0",
                language: GameGlobalVars_1.default.unityNamespace.navigator.userLanguage || GameGlobalVars_1.default.unityNamespace.navigator.language,
                hasWebGL: this.contextType,
            },
            UnityCache: {
                XMLHttpRequest: CacheableXMLHttpRequest_1.default,
            },
        };
    };
    UnityManager.prototype.startGame = function () {
        var _this = this;
        if (this.mainCalled) {
            return;
        }
        this.clearViewPort();
        this.showLoadingPage()
            .then(function () { return __awaiter(_this, void 0, void 0, function () {
            var eventTrigger, patchManager, gameWasmLoader, pluginLoadingTasks;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        eventTrigger = Events_1.EventTrigger.getInstance();
                        eventTrigger.triggerEvent(Types_1.GameEvents.LoadingPageReady, new Events_1.GameEventDetail(this));
                        return [4 /*yield*/, this.initReporter()];
                    case 1:
                        _a.sent();
                        this.prepareModule();
                        this.startCheckIs32Kuaishou();
                        patchManager = PatchManager_1.PatchManager.getInstance();
                        patchManager.updateCodeType(this.codeType === Types_1.CodeType.codeSplit);
                        gameWasmLoader = GameWasmLoader_1.default.getInstance();
                        pluginLoadingTasks = [
                            gameWasmLoader.loadWasmCode(),
                            DataPackageLoader_1.default.loadDataPackage(),
                        ];
                        if (this.codeType == Types_1.CodeType.codeSplit &&
                            (GameGlobalVars_1.default.isAndroidNewVersion ||
                                GameFeatures_1.gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.WasmSplit) !== Types_1.TransferStatus.open)) {
                            PluginLogger_1.default.eventLog("禁用代码分包功能");
                            this.parallelFetchSubWasmTask = gameWasmLoader.parallelFetchSubWasm();
                            pluginLoadingTasks.push(this.parallelFetchSubWasmTask);
                            eventTrigger.triggerEvent(Types_1.GameEvents.ParallelLoading, new Events_1.GameEventDetail(this));
                        }
                        return [4 /*yield*/, Promise.all(pluginLoadingTasks)];
                    case 2:
                        _a.sent();
                        eventTrigger.triggerEvent(Types_1.GameEvents.ParallelLoaded, new Events_1.GameEventDetail(this));
                        return [4 /*yield*/, PreloadTaskManager_1.default.getInstance().load()];
                    case 3:
                        _a.sent();
                        if (!(this.loadingPageType === Types_1.LoadingPageType.COVER_VIEW)) return [3 /*break*/, 5];
                        return [4 /*yield*/, this.loadingPage.completeDownloadAnimation()];
                    case 4:
                        _a.sent();
                        _a.label = 5;
                    case 5:
                        if (!AssetsLoader_1.default.needDownload) return [3 /*break*/, 7];
                        return [4 /*yield*/, this.start()];
                    case 6:
                        _a.sent();
                        return [3 /*break*/, 8];
                    case 7:
                        setTimeout(function () {
                            _this.start();
                        }, 100);
                        _a.label = 8;
                    case 8: return [2 /*return*/];
                }
            });
        }); })
            .catch(function (error) {
            console.error('Error in startGame:', error);
        });
    };
    UnityManager.prototype.startCheckIs32Kuaishou = function () {
        var _this = this;
        if (SystemEnvironmentVariables_1.default.systemInfo.abi && !SystemEnvironmentVariables_1.default.systemInfo.abi.includes("64")) {
            setTimeout(function () {
                if (!_this.mainCalled) {
                    PluginLogger_1.default.pluginError(DefaultLanguageMap_1.default.startCheckIs32Kuaishou_content);
                    SystemEnvironmentVariables_1.default.tjInstance.showModal({
                        title: DefaultLanguageMap_1.default.reminder,
                        content: DefaultLanguageMap_1.default.startCheckIs32Kuaishou_content,
                        showCancel: false,
                        confirmText: DefaultLanguageMap_1.default.startCheckIs32Kuaishou_confirm,
                        success: function () {
                            SystemEnvironmentVariables_1.default.tjInstance.updateKuaishouApp();
                        },
                    });
                }
            }, 30000);
        }
    };
    UnityManager.prototype.clearViewPort = function () {
        var globalGraphicsContext = GameGlobalVars_1.default.unityNamespace.globalGL;
        if (globalGraphicsContext) {
            globalGraphicsContext.clearColor(0, 0, 0, 0);
            globalGraphicsContext.clear(globalGraphicsContext.COLOR_BUFFER_BIT);
        }
    };
    UnityManager.prototype.showLoadingPage = function () {
        return __awaiter(this, void 0, void 0, function () {
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        if (!(this.loadingPageType === Types_1.LoadingPageType.COVER_VIEW)) return [3 /*break*/, 2];
                        return [4 /*yield*/, this.loadingPage.startDownloadAnimation()];
                    case 1:
                        _a.sent();
                        return [3 /*break*/, 4];
                    case 2: return [4 /*yield*/, this.loadingPage.showLoadingPage()];
                    case 3:
                        _a.sent();
                        _a.label = 4;
                    case 4: return [2 /*return*/];
                }
            });
        });
    };
    UnityManager.prototype.resumeLoadingPage = function () {
        this.loadingPage.isVisible = true;
    };
    UnityManager.prototype.showFinalPage = function () {
        if (this.loadingPageType === Types_1.LoadingPageType.INTERACTIVE_VIDEO) {
            this.loadingPage.showFinalPage(this.mainCalled);
        }
    };
    UnityManager.prototype.hideFinalPage = function () {
        if (this.loadingPageType === Types_1.LoadingPageType.INTERACTIVE_VIDEO) {
            this.loadingPage.hideFinalPage();
        }
    };
    UnityManager.prototype.hideLoadingPage = function () {
        var _this = this;
        setTimeout(function () {
            if (_this.loadingPageType === Types_1.LoadingPageType.LONG_VIDEO) {
                _this.launchStage.hideProgress();
                _this.loadingPage.hideLoadingPage();
            }
            if (_this.loadingPageType === Types_1.LoadingPageType.COVER_VIEW) {
                _this.loadingPage.complete();
            }
        }, 0);
    };
    UnityManager.prototype.prepareModule = function () {
        var _this = this;
        this.gameInstance.Module.gameInstance = this.gameInstance;
        this.gameInstance.popup = function (loggerMessage, sendLoggerMessage) {
            return GameGlobalVars_1.default.unityNamespace.UnityLoader.Error.popup(_this.gameInstance, loggerMessage, sendLoggerMessage);
        };
        GameGlobalVars_1.default.unityNamespace.Module = this.gameInstance.Module;
    };
    UnityManager.prototype.start = function () {
        return __awaiter(this, void 0, void 0, function () {
            var startCompileAnimation, startGamePlugin;
            var _this = this;
            return __generator(this, function (_a) {
                switch (_a.label) {
                    case 0:
                        startCompileAnimation = function () { return __awaiter(_this, void 0, void 0, function () {
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0: return [4 /*yield*/, this.loadingPage.startCompileAnimation()];
                                    case 1: return [2 /*return*/, _a.sent()];
                                }
                            });
                        }); };
                        startGamePlugin = function () { return __awaiter(_this, void 0, void 0, function () {
                            var isCoverView;
                            return __generator(this, function (_a) {
                                switch (_a.label) {
                                    case 0:
                                        isCoverView = this.loadingPageType === Types_1.LoadingPageType.COVER_VIEW;
                                        if (!isCoverView) return [3 /*break*/, 2];
                                        PluginLogger_1.default.eventLog("[coverview] start compile animation");
                                        return [4 /*yield*/, startCompileAnimation()];
                                    case 1:
                                        _a.sent();
                                        _a.label = 2;
                                    case 2:
                                        this.doStart();
                                        return [2 /*return*/];
                                }
                            });
                        }); };
                        return [4 /*yield*/, startGamePlugin()];
                    case 1: return [2 /*return*/, _a.sent()];
                }
            });
        });
    };
    UnityManager.prototype.triggerLaunchProgress = function (actionEvent, context) {
        var _a;
        var eventDetail = new Events_1.GameLaunchEventDetail(this, actionEvent, context);
        this.reportPluginLaunchScene(actionEvent, context);
        (_a = this.launchData) === null || _a === void 0 ? void 0 : _a.push(eventDetail);
        var eventTrigger = Events_1.EventTrigger.getInstance();
        eventTrigger.triggerEvent(Types_1.GameEvents.LaunchProgress, eventDetail);
    };
    UnityManager.prototype.doStart = function () {
        // 这个方法在原代码中是空的，具体实现根据实际情况添加
    };
    UnityManager.prototype.reportScene = function (wasmCompilationFunction) {
        if ((0, Utils_1.isValid)(wasmCompilationFunction.sceneId) && wasmCompilationFunction.sceneId < 1000) {
            PluginLogger_1.default.pluginError("[reportScene]请检查sceneId");
        }
        this.baseReportScene(wasmCompilationFunction);
    };
    UnityManager.prototype.baseReportScene = function (compiledSubWasmFunction) {
        if (SystemEnvironmentVariables_1.default.tjInstance.reportScene) {
            SystemEnvironmentVariables_1.default.tjInstance.reportScene(compiledSubWasmFunction);
        }
    };
    UnityManager.prototype.reportPluginLaunchScene = function (subWasmCompiler, matchExpression) {
        var sceneInformation = {
            sceneId: subWasmCompiler,
            costTime: matchExpression,
            dimension: {
                useCodeSplit: this.codeType ? "1" : "0",
                needDownloadDataPackage: AssetsLoader_1.default.assetsLoadType !== Types_1.AssetsLoadType.AllCached ? "1" : "0",
            },
            metric: {}
        };
        if (subWasmCompiler === Types_1.GameLaunchStatus.PREPARE_GAME) {
            sceneInformation.metric = {
                preloadedSize: String(PreloadTaskManager_1.default.getInstance().loadedSize),
            };
        }
        this.baseReportScene(sceneInformation);
    };
    UnityManager.prototype.reportCustomLaunchInfo = function () {
        var _a;
        if (!this.gameStarted) {
            PluginMonitor_1.default.getInstance().showResult(true);
            this.gameStarted = true;
            var timeTakenToInitializeGame = TimeLogManager_1.TimeLogManager.timeEnd("游戏主场景耗时");
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: Types_1.GameLaunchStatus.GAME_START,
                CostTimeMs: timeTakenToInitializeGame,
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
            }));
            this.reportPluginLaunchScene(Types_1.GameLaunchStatus.GAME_START, timeTakenToInitializeGame);
            PluginLogger_1.default.eventLog("\u6E38\u620F\u53EF\u4EA4\u4E92cost=".concat(timeTakenToInitializeGame, "ms,runtime=").concat(TimeLogManager_1.TimeLogManager.getRuntime()));
            if (!SystemEnvironmentVariables_1.default.isWK && ((_a = GameGlobalVars_1.default.unityNamespace) === null || _a === void 0 ? void 0 : _a.compileSubWasm)) {
                GameGlobalVars_1.default.unityNamespace.compileSubWasm.call(GameGlobalVars_1.default.unityNamespace);
            }
        }
    };
    UnityManager.prototype.setGameStage = function (_unityInstance) {
        GameLogic_1.GameStage.Validate(_unityInstance);
    };
    UnityManager.prototype.reportGameStageCostTime = function (errorCount, emptyString) {
        if (errorCount === void 0) { errorCount = 0; }
        if (emptyString === void 0) { emptyString = ""; }
        if (GameLogic_1.GameStage.GetStage()) {
            ReportInitializer_1.default.gameReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: GameLogic_1.GameStage.GetStage(),
                CostTimeMs: Number(errorCount),
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: emptyString,
            }));
        }
    };
    UnityManager.prototype.reportGameStageError = function (counter, emptyString, userInput) {
        if (counter === void 0) { counter = 0; }
        if (emptyString === void 0) { emptyString = ""; }
        if (userInput === void 0) { userInput = ""; }
        if (GameLogic_1.GameStage.GetStage() && (0, Utils_1.isValidErrorType)(Number(counter))) {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: GameLogic_1.GameStage.GetStage(),
                ErrorMsg: String(emptyString).slice(0, 1024),
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: userInput,
                ErrorType: Number(counter),
            }));
        }
    };
    UnityManager.prototype.reportGameSceneError = function (dependencyMonitor, initialValue, emptyString, inputString) {
        if (initialValue === void 0) { initialValue = 0; }
        if (emptyString === void 0) { emptyString = ""; }
        if (inputString === void 0) { inputString = ""; }
        if ((0, Utils_1.isValidErrorType)(Number(initialValue))) {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: dependencyMonitor,
                ErrorMsg: String(emptyString).slice(0, 1024),
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: inputString,
                ErrorType: Number(initialValue),
            }));
        }
    };
    UnityManager.prototype.onHide = function () {
        var logMessage = "\u6E38\u620F\u5207\u540E\u53F0 showTimes:".concat(UnityManager.showTimes);
        PluginLogger_1.default.pluginLog(logMessage);
        GameGlobalVars_1.default.realtimeLogManager.info(logMessage);
        var currentStage = GameLogic_1.GameStage.GetStage() || UnityManager.getCurrentStage();
        if (currentStage) {
            ReportInitializer_1.default.reportActionHandler.send(new Utils_1.ObjectClassWrapper({
                StageType: String(currentStage),
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify({
                    showTimes: UnityManager.showTimes,
                }),
            }));
        }
        GameLogic_1.GameVisible.SetVisible(false);
    };
    UnityManager.prototype.onShow = function () {
        UnityManager.showTimes += 1;
        var showTimesLogMessage = "\u6E38\u620F\u5207\u524D\u53F0 showTimes:".concat(UnityManager.showTimes);
        PluginLogger_1.default.pluginLog(showTimesLogMessage);
        GameGlobalVars_1.default.realtimeLogManager.info(showTimesLogMessage);
        GameLogic_1.GameVisible.SetVisible(true);
    };
    UnityManager.prototype.setDataCDN = function (__unityInstance) {
        if ((0, Utils_1.isValidURL)(__unityInstance)) {
            GameGlobalVars_1.default.unityNamespace.DATA_CDN = __unityInstance.endsWith("/") ? __unityInstance : "".concat(__unityInstance, "/");
            var eventTrigger = Events_1.EventTrigger.getInstance();
            eventTrigger.triggerEvent(Types_1.GameEvents.ModulePrepared);
        }
    };
    UnityManager.prototype.showAbort = function () {
        if (SystemEnvironmentVariables_1.default.pluginEnv.coverview) {
            ErrorProp_1.default.getInstance();
        }
        else {
            SystemEnvironmentVariables_1.default.tjInstance.showModal({
                title: DefaultLanguageMap_1.default.showAbort_title,
                content: DefaultLanguageMap_1.default.showAbort_content,
                showCancel: false,
                confirmText: SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram ? DefaultLanguageMap_1.default.restartGame : DefaultLanguageMap_1.default.confirm,
                success: function () {
                    if (SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram) {
                        SystemEnvironmentVariables_1.default.tjInstance.restartMiniProgram({});
                    }
                },
            });
        }
    };
    UnityManager.prototype.needPluginReport = function () {
        var _a;
        var runtimeTimestamp = TimeLogManager_1.TimeLogManager.getRuntime();
        // 查找游戏准备数据
        var gamePreparationData = (((_a = this.launchData) === null || _a === void 0 ? void 0 : _a.find(function (callMainCompletionDetails) {
            return callMainCompletionDetails.type === Types_1.GameLaunchStatus.PREPARE_GAME;
        })) || {}).data;
        // 获取游戏准备数据中的运行时间，若没有则默认为 0
        var runTimeMsValue = (gamePreparationData === null || gamePreparationData === void 0 ? void 0 : gamePreparationData.runTimeMs) || 0;
        var a = this.gameStarted &&
            runtimeTimestamp - runTimeMsValue < 500 &&
            runtimeTimestamp < 60000;
        // 判断条件：游戏未开始且运行时间小于 60s
        var r = !this.gameStarted && runtimeTimestamp < 60000;
        // 返回最终判断结果
        return a || r;
    };
    UnityManager.prototype.printErr = function (callbackHandler) {
        if (this.needPluginReport() && !(0, Utils_1.IsStillWaitingOnDependencies)(callbackHandler)) {
            ReportInitializer_1.default.remoteReporter.send(new Utils_1.ObjectClassWrapper({
                ReportType: GameLogic_1.GameStage.GetStage() || UnityManager.getCurrentStage(true),
                ErrorMsg: "".concat(callbackHandler).slice(0, 1024),
                RunTimeMs: TimeLogManager_1.TimeLogManager.getRuntime(),
                ExternInfo: JSON.stringify({
                    mainCalled: this.mainCalled,
                }),
            }));
            var callbackHandlerMessage = typeof callbackHandler == "string" ? callbackHandler : callbackHandler.message;
            GameGlobalVars_1.default.logManager.error(callbackHandlerMessage);
            GameGlobalVars_1.default.realtimeLogManager.error(callbackHandlerMessage);
        }
        if (this === null || this === void 0 ? void 0 : this.onLogError) {
            var errorMsg = typeof callbackHandler === "string"
                ? callbackHandler
                : callbackHandler.message;
            this.onLogError(errorMsg);
        }
        // 控制台打印错误
        console.error(callbackHandler);
    };
    UnityManager.getCurrentStage = function (shouldReturnEventStages) {
        var _a;
        if (shouldReturnEventStages === void 0) { shouldReturnEventStages = false; }
        // 筛选出 PENDING 状态的进度信息
        var eventStage = Object.values(LaunchStage_1.default.launchProgress)
            .filter(function (configUpdate) { return configUpdate.status === Types_1.LaunchStageStatus.PENDING; })
            .map(function (eventData) { return ({
            stage: eventData.stage,
            priority: eventData.priority,
        }); });
        // 如果当前实例正在运行 launchOpera，则添加该阶段
        if ((_a = UnityManager.getInstance().launchOpera) === null || _a === void 0 ? void 0 : _a.running) {
            eventStage.push({
                stage: "LAUNCH_OPERA",
                priority: 0,
            });
        }
        // 如果不需要返回事件阶段，只返回阶段名称拼接
        if (!shouldReturnEventStages) {
            return eventStage
                .map(function (event) { return event.stage; })
                .join("&");
        }
        // 如果没有 PENDING 状态的阶段，返回默认状态
        if (!eventStage.length) {
            return Types_1.GameLaunchStatus.GAME_START;
        }
        // 根据优先级对事件阶段进行排序
        var sortedEventStages = eventStage.sort(function (event, anotherEvent) {
            return anotherEvent.priority - event.priority;
        });
        // 截取排序后的第一个阶段
        var firstSortedEventStage = sortedEventStages.slice(0, 1);
        // 返回排序后的阶段对应的游戏启动状态
        var stage = firstSortedEventStage[0].stage;
        return Types_1.GameLaunchStatus[stage];
    };
    UnityManager.showTimes = 0;
    UnityManager.getInstance = function () { return UnityManager.instance; };
    return UnityManager;
}());
exports["default"] = UnityManager;


/***/ }),

/***/ "./src/lib/UserEventHandler.ts":
/*!*************************************!*\
  !*** ./src/lib/UserEventHandler.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
//module 48
var UserEventHandler = /** @class */ (function () {
    function UserEventHandler(director) {
        this.director = director;
    }
    Object.defineProperty(UserEventHandler.prototype, "handler", {
        get: function () {
            return this.userHandler;
        },
        enumerable: false,
        configurable: true
    });
    UserEventHandler.prototype.created = function (valueEvent) { };
    UserEventHandler.prototype.$update = function () {
        UserEventHandler.eventEmitter.emit(this.director, CaseType_1.DirctorCaseType.UpdateParams);
    };
    UserEventHandler.componentName = "";
    UserEventHandler.eventEmitter = new EventManager_1.default();
    return UserEventHandler;
}());
exports["default"] = UserEventHandler;


/***/ }),

/***/ "./src/lib/Utils.ts":
/*!**************************!*\
  !*** ./src/lib/Utils.ts ***!
  \**************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.releaseStages = exports.releaseStatus = exports.screenOrientation = exports.WeakTimeoutMap = exports.getBackgroundMode = exports.BooleanString = exports.ObjectClassWrapper = void 0;
exports.handlePromise = handlePromise;
exports.IsStillWaitingOnDependencies = IsStillWaitingOnDependencies;
exports.isNumber = isNumber;
exports.isInteger = isInteger;
exports.getResponseHeaderValue = getResponseHeaderValue;
exports.getHeaderValue = getHeaderValue;
exports.isSuccessfulHttpStatus = isSuccessfulHttpStatus;
exports.isValidErrorType = isValidErrorType;
exports.resolveURL = resolveURL;
exports.resolvePath = resolvePath;
exports.resolveFilename = resolveFilename;
exports.resolveFilenameFromPath = resolveFilenameFromPath;
exports.resolveDirname = resolveDirname;
exports.resolveShortFilename = resolveShortFilename;
exports.getFileHash = getFileHash;
exports.isValidURL = isValidURL;
exports.isCacheableURL = isCacheableURL;
exports.isTextureURL = isTextureURL;
exports.resolveStreamingURL = resolveStreamingURL;
exports.isUnityCloud = isUnityCloud;
exports.isValid = isValid;
exports.excludeProperties = excludeProperties;
exports.eventLog = eventLog;
exports.timeLog = timeLog;
exports.getProgressValue = getProgressValue;
exports.generateRandomString = generateRandomString;
exports.compareVersions = compareVersions;
exports.isFiniteNumber = isFiniteNumber;
exports.isEmpty = isEmpty;
exports.isString = isString;
exports.isObject = isObject;
exports.isFunction = isFunction;
exports.extractErrorMessage = extractErrorMessage;
exports.updateQueryParam = updateQueryParam;
exports.executePromiseWithRetry = executePromiseWithRetry;
exports.formatTimestamp = formatTimestamp;
exports.checkParamType = checkParamType;
exports.checkParamInTypes = checkParamInTypes;
exports.mergeParamsStructA2B = mergeParamsStructA2B;
exports.checkParams = checkParams;
exports.mergeEventsStructA2B = mergeEventsStructA2B;
exports.getPlatformVM = getPlatformVM;
exports.isValidClick = isValidClick;
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var Constants_1 = __webpack_require__(/*! ./Constants */ "./src/lib/Constants.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var PluginMonitor_1 = __importDefault(__webpack_require__(/*! ./PluginMonitor */ "./src/lib/PluginMonitor.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
function handlePromise(promise) {
    return __awaiter(this, void 0, void 0, function () {
        var result, error_1;
        return __generator(this, function (_a) {
            switch (_a.label) {
                case 0:
                    _a.trys.push([0, 2, , 3]);
                    return [4 /*yield*/, promise];
                case 1:
                    result = _a.sent();
                    return [2 /*return*/, [null, result]];
                case 2:
                    error_1 = _a.sent();
                    return [2 /*return*/, [error_1, null]];
                case 3: return [2 /*return*/];
            }
        });
    });
}
function IsStillWaitingOnDependencies(msg) {
    var dependencyList = new Set();
    if (typeof msg === "string") {
        var isWaiting = msg.includes("end of list") || msg.includes("still waiting on run dependencies") || msg.includes("dependency");
        if (isWaiting) {
            if (dependencyList.has(msg)) {
                return true;
            }
            else {
                dependencyList.add(msg);
                return false;
            }
        }
    }
    return false;
}
function isNumber(obj) {
    return !isNaN(obj);
}
function isInteger(obj) {
    return isNumber(obj) && Number.isInteger(obj);
}
function getResponseHeaderValue(request, headerKey) {
    return request ? (request.getResponseHeader(headerKey) || request.getResponseHeader(headerKey.toLowerCase())) : "";
}
function getHeaderValue(header, headerKey) {
    return header ? (header[headerKey] || header[headerKey.toLowerCase()]) : "";
}
function isSuccessfulHttpStatus(status) {
    return (status >= 200 && status < 300) || status === 304;
}
function isValidErrorType(errorType) {
    return isInteger(errorType) && (errorType >= 0) && (errorType <= 10000);
}
var ObjectClassWrapper = /** @class */ (function () {
    function ObjectClassWrapper(props) {
        var _this = this;
        Object.keys(props).forEach(function (propKey) {
            _this[propKey] = props[propKey];
        });
    }
    return ObjectClassWrapper;
}());
exports.ObjectClassWrapper = ObjectClassWrapper;
function resolvePath() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    if (args.length) {
        return resolveURL(args.filter(function (str) { return str && str.trim(); }).join(Constants_1.PathSplit));
    }
    else {
        return "";
    }
}
function resolveURL(path) {
    if (path && path.trim()) {
        return path.replace(Constants_1.PathRegex2, "")
            .replace(Constants_1.PathRegex3, "")
            .replace(Constants_1.PathRegex1, function (response) { return response.replace(/\/+/g, Constants_1.PathSplit); });
    }
    else {
        return "";
    }
}
function resolveFilename(path, fileExtension) {
    if (fileExtension === void 0) { fileExtension = ""; }
    if (!(path === null || path === void 0 ? void 0 : path.trim()) || path.endsWith(Constants_1.PathSplit)) {
        return "";
    }
    var extension = fileExtension;
    if (extension.startsWith(".")) {
        extension && (extension = extension);
    }
    else {
        extension && (extension = ".".concat(extension));
    }
    var filename = path.substring(path.lastIndexOf(Constants_1.PathSplit) + 1);
    if (filename.includes("?")) {
        filename = filename.substring(0, filename.indexOf("?"));
    }
    if (filename.includes("#")) {
        filename = filename.substring(0, filename.indexOf("#"));
    }
    return filename
        .replace(extension === null || extension === void 0 ? void 0 : extension.toLowerCase(), "")
        .replace(extension === null || extension === void 0 ? void 0 : extension.toUpperCase(), "");
}
function resolveFilenameFromPath(path) {
    return path.substring(path.lastIndexOf(Constants_1.PathSplit) + 1);
}
function resolveDirname(path, isCache) {
    if (isCache === void 0) { isCache = true; }
    var trimmedPath = path === null || path === void 0 ? void 0 : path.trim();
    if (!trimmedPath) {
        return "";
    }
    var cdnBaseUrl = GameGlobalVars_1.default.unityNamespace.STREAMING_CDN || GameGlobalVars_1.default.unityNamespace.DATA_CDN;
    var formatedPath = path === null || path === void 0 ? void 0 : path.replace(cdnBaseUrl, "").replace(GameGlobalVars_1.default.gameFileCache, "").replace(GameGlobalVars_1.default.userDataPath, "").replace(GameGlobalVars_1.default.privateFolder, "");
    if (isCache) {
        formatedPath = formatedPath === null || formatedPath === void 0 ? void 0 : formatedPath.replace(Constants_1.GameFileCacheRegex, "");
    }
    formatedPath = formatedPath === null || formatedPath === void 0 ? void 0 : formatedPath.substring(0, formatedPath === null || formatedPath === void 0 ? void 0 : formatedPath.lastIndexOf(Constants_1.PathSplit));
    if (formatedPath) {
        return (formatedPath === null || formatedPath === void 0 ? void 0 : formatedPath.startsWith(Constants_1.PathSplit)) ? formatedPath : "/".concat(formatedPath);
    }
    return formatedPath || "";
}
function resolveShortFilename(path) {
    var filename = resolveFilename(path);
    if (!filename) {
        return "";
    }
    var isDataOrWasm = filename.includes(Constants_1.GameDataSuffix) || filename.includes(Constants_1.GameWasmCodeSuffix);
    var isTexturesPath = path.includes(GameGlobalVars_1.default.texturesPath);
    var regex;
    if (isDataOrWasm) {
        regex = /([a-zA-Z0-9]{16}\.)/gi;
    }
    else if (isTexturesPath) {
        regex = new RegExp("(.[a-zA-Z0-9]{".concat(GameGlobalVars_1.default.texturesHashLength, "})"));
    }
    else {
        regex = new RegExp("([_-][a-zA-Z0-9]{".concat(GameGlobalVars_1.default.bundleHashLength, "})(\\.\\w+)*$"));
    }
    var match = regex.exec(filename);
    if (match && match[1]) {
        return filename.replace(match[1], "");
    }
    else {
        return filename;
    }
}
function getFileHash(filename) {
    var resolvedFilename = resolveFilename(filename);
    if (!resolvedFilename) {
        return "";
    }
    var isDataOrWasm = resolvedFilename.includes(Constants_1.GameDataSuffix) || resolvedFilename.includes(Constants_1.GameWasmCodeSuffix);
    var isTexturesPath = filename.includes(GameGlobalVars_1.default.texturesPath);
    var regex;
    if (isDataOrWasm) {
        regex = /([a-zA-Z0-9]{16})\./gi;
    }
    else if (isTexturesPath) {
        regex = new RegExp("\\.([a-zA-Z0-9]{".concat(GameGlobalVars_1.default.texturesHashLength, "})"));
    }
    else {
        regex = new RegExp("[_-]([a-zA-Z0-9]{".concat(GameGlobalVars_1.default.bundleHashLength, "})(\\.\\w+)*$"));
    }
    var match = regex.exec(resolvedFilename);
    var hash = "";
    if (match && match.length >= 2) {
        hash = match[1];
    }
    return hash || "";
}
function isValidURL(url) {
    var trimmedURL = url === null || url === void 0 ? void 0 : url.trim();
    return !!trimmedURL && typeof url === "string" && url.includes("http");
}
function isCacheableURL(url) {
    var needCacheTextures = GameGlobalVars_1.default.unityNamespace.needCacheTextures;
    return isValidURL(url) && (needCacheTextures && isTextureURL(url) || GameGlobalVars_1.default.unityNamespace.isCacheableFile(url));
}
function isTextureURL(url) {
    return isValidURL(url) && url.includes(GameGlobalVars_1.default.texturesPath);
}
function resolveStreamingURL(folder) {
    var preferredCdn = GameGlobalVars_1.default.unityNamespace.STREAMING_CDN || GameGlobalVars_1.default.unityNamespace.DATA_CDN;
    var streamingUrlPrefixPath = GameGlobalVars_1.default.unityNamespace.streamingUrlPrefixPath || "";
    var protocolMatch = folder.match(/(http|https|ftp|file):\/\//);
    var url = folder;
    if (!protocolMatch) {
        url = resolvePath(preferredCdn, streamingUrlPrefixPath, folder);
    }
    return url;
}
function isUnityCloud(networkEvent) {
    return networkEvent.includes("cloud.unity3d.com");
}
function isValid(obj) {
    return !isNaN(obj);
}
function excludeProperties(obj, excludeKeys) {
    var result = __assign({}, obj);
    excludeKeys.forEach(function (key) {
        delete result[key];
    });
    return result;
}
var BooleanString = {
    True: "1",
    False: "0",
};
exports.BooleanString = BooleanString;
function eventLog() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    var logBegin = args[0] || "";
    GameGlobalVars_1.default.logManager.log.apply(GameGlobalVars_1.default.logManager, __spreadArray(["[PLUGIN LOG] "], args, true));
    if (logBegin.includes("fetch js:") && args.length > 1) {
        PluginMonitor_1.default.getInstance().wasmSplitMonitor.recordSyncFetchTime();
    }
    if (GameGlobalVars_1.default.enableTraceLog) {
        console.log.apply(console, __spreadArray(["[PLUGIN LOG]"], args, false));
    }
}
function timeLog() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    GameGlobalVars_1.default.logManager.log.apply(GameGlobalVars_1.default.logManager, ["[PLUGIN TIME LOG] "].concat(args));
    console.log.apply(console, ["[PLUGIN TIME LOG] "].concat(args));
}
function getProgressValue(progressValue) {
    var parsedProgressValue = Number(progressValue);
    if (!isNaN(parsedProgressValue)) {
        if (parsedProgressValue < Types_1.Threshold.Min || parsedProgressValue > Types_1.Threshold.Max) {
            return Types_1.Threshold.Default;
        }
        else {
            return parsedProgressValue;
        }
    }
    else {
        return Types_1.Threshold.Default;
    }
}
function generateRandomString(length, word) {
    if (length === void 0) { length = 20; }
    var characterPool = (word ? "" : "!#%()*+,-./:;=?@[]^_`{|}~") + "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
    var characterPoolLength = characterPool.length;
    var resultArray = [];
    for (var r = 0; r < length; r++) {
        resultArray[r] = characterPool.charAt(Math.floor(Math.random() * characterPoolLength));
    }
    return resultArray.join("");
}
function compareVersions(versionString, toComparedVersion) {
    if (versionString === void 0) { versionString = "0.0.0"; }
    if (typeof versionString !== "string" || typeof toComparedVersion !== "string") {
        if (typeof versionString !== "string" && typeof toComparedVersion !== "string") {
            return 0;
        }
        else if (typeof versionString !== "string") {
            return 1;
        }
        else {
            return -1;
        }
    }
    var versionParts = versionString.split(".");
    var toComparedVersionParts = toComparedVersion.split(".");
    var maxLength = Math.max(versionParts.length, toComparedVersionParts.length);
    while (versionParts.length < maxLength) {
        versionParts.push("0");
    }
    while (toComparedVersionParts.length < maxLength) {
        toComparedVersionParts.push("0");
    }
    for (var i = 0; i < maxLength; i++) {
        var currentVersion = parseInt(versionParts[i], 10);
        var compareVersion = parseInt(toComparedVersionParts[i], 10);
        if (currentVersion > compareVersion) {
            return 1;
        }
        if (currentVersion < compareVersion) {
            return -1;
        }
    }
    return 0;
}
function isFiniteNumber(val) {
    return typeof val == "number" && isFinite(val);
}
function isEmpty(val) {
    if (val == null) {
        return true;
    }
    if (typeof val == "boolean") {
        return false;
    }
    if (typeof val == "number") {
        return !val;
    }
    if (val instanceof Error) {
        return val.message === "";
    }
    switch (Object.prototype.toString.call(val)) {
        case "[object String]":
        case "[object Array]":
            return !val.length;
        case "[object File]":
        case "[object Map]":
        case "[object Set]":
            return !val.size;
        case "[object Object]":
            return !Object.keys(val).length;
    }
    return false;
}
function isString(val) {
    return Object.prototype.toString.call(val) === "[object String]";
}
function isObject(val) {
    return Object.prototype.toString.call(val) === "[object Object]";
}
function isFunction(val) {
    return val && Object.prototype.toString.call(val) === "[object Function]";
}
function extractErrorMessage(error) {
    var errorMessage = error;
    try {
        if (typeof error == "object") {
            if (typeof error.errMsg == "string") {
                errorMessage = error.errMsg;
            }
            else if (typeof error.errmsg == "string") {
                errorMessage = error.errmsg;
            }
            else if (typeof error.message == "string") {
                errorMessage = error.message;
            }
            else {
                errorMessage = JSON.stringify(error);
            }
        }
    }
    catch (errorNew) {
        console.error(errorNew);
    }
    return errorMessage;
}
function updateQueryParam(url, key, val) {
    if (!val) {
        return url;
    }
    var currentUrl = url;
    var regex = new RegExp("([?&])".concat(key, "=.*?(&|$)"), "i");
    if (currentUrl.match(regex)) {
        return currentUrl.replace(regex, "$1".concat(key, "=").concat(val, "$2"));
    }
    var separator = currentUrl.indexOf("?") !== -1 ? "&" : "?";
    var urlParts = currentUrl.split("#");
    currentUrl = "".concat(urlParts[0]).concat(separator).concat(key, "=").concat(val);
    if (urlParts[1]) {
        currentUrl += "#".concat(urlParts[1]);
    }
    return currentUrl;
}
function executePromiseWithRetry(func, count, initialValue) {
    if (count === void 0) { count = 0; }
    if (initialValue === void 0) { initialValue = 0; }
    var args = [];
    for (var _i = 3; _i < arguments.length; _i++) {
        args[_i - 3] = arguments[_i];
    }
    return new Promise(function (resolve, reject) {
        var attempt = function (retries) {
            if (retries === void 0) { retries = 0; }
            func.apply(null, __spreadArray(__spreadArray([], args, true), [retries], false))
                .then(resolve)
                .catch(function (error) {
                if (retries > 0) {
                    PluginLogger_1.default.pluginWarn('promise failed with error:', error);
                    setTimeout(function () {
                        attempt(retries - 1);
                    }, initialValue);
                }
                else {
                    reject(error);
                }
            });
        };
        attempt(count);
    });
}
function formatTimestamp(time, dateFormatString) {
    if (dateFormatString === void 0) { dateFormatString = "yyyy-MM-dd"; }
    if (!time) {
        return "";
    }
    var timestampFormat = dateFormatString;
    var date = String(time).length === 10 ? new Date(time * 1000) : new Date(time);
    var timeFormatComponents = {
        "y+": date.getFullYear(),
        "M+": date.getMonth() + 1,
        "d+": date.getDate(),
        "h+": date.getHours(),
        "m+": date.getMinutes(),
        "s+": date.getSeconds(),
        "q+": Math.floor((date.getMonth() + 3) / 3),
        "S+": date.getMilliseconds(),
    };
    var replaceFormatComponents = function () {
        var _loop_1 = function (key, value) {
            var regex = new RegExp("(".concat(key, ")"));
            if (regex.test(timestampFormat)) {
                // @ts-ignore
                var matchedSegment_1 = timestampFormat.match(regex)[0];
                timestampFormat = timestampFormat.replace(regex, function () { return "00".concat(value).slice(-matchedSegment_1.length); });
            }
        };
        for (var _i = 0, _a = Object.entries(timeFormatComponents); _i < _a.length; _i++) {
            var _b = _a[_i], key = _b[0], value = _b[1];
            _loop_1(key, value);
        }
    };
    replaceFormatComponents();
    return timestampFormat;
}
var getBackgroundMode = Object.values(Types_1.SystemInfo).filter(isFiniteNumber);
exports.getBackgroundMode = getBackgroundMode;
function checkParamType(eventHandler, eventEnum) {
    var eventType = typeof eventHandler;
    switch (eventEnum) {
        case Types_1.ParamInputType.Boolean:
            if (eventType === 'boolean') {
                return { type: Types_1.ParamInputType.Boolean };
            }
            break;
        case Types_1.ParamInputType.Number:
            if (eventType === 'number' || Number(eventHandler) == eventHandler) {
                return { type: Types_1.ParamInputType.Number };
            }
            break;
        case Types_1.ParamInputType.Percent:
            if (eventType === 'string' &&
                (/(^100|[1-9]?\d)%$/.test(eventHandler) || /^calc\([\s\S]*?\)$/.test(eventHandler))) {
                return { type: Types_1.ParamInputType.Percent };
            }
            break;
        case Types_1.ParamInputType.String:
            if (eventType === 'string' || eventType === 'number') {
                return { type: Types_1.ParamInputType.String };
            }
            break;
        case Types_1.ParamInputType.Selecet:
            return { type: Types_1.ParamInputType.Selecet };
    }
    if (eventType === 'object') {
        var frameType = eventHandler.getFrameType ? eventHandler.getFrameType() : null;
        if (frameType === null || !(frameType in Types_1.FrameType)) {
            return null;
        }
        if (eventEnum === Types_1.ParamInputType.Frame || eventEnum === frameType) {
            return { type: Types_1.ParamInputType.Frame, frameType: frameType };
        }
    }
    return null;
}
function checkParamInTypes(eventRegistry, typeEnums) {
    if (!Array.isArray(typeEnums)) {
        return checkParamType(eventRegistry, typeEnums);
    }
    for (var _i = 0, typeEnums_1 = typeEnums; _i < typeEnums_1.length; _i++) {
        var typeEnum = typeEnums_1[_i];
        var result = checkParamType(eventRegistry, typeEnum);
        if (result !== null) {
            return result;
        }
    }
    return null;
}
function mergeParamsStructA2B(eventTypeA, eventTypeB) {
    var keysA = Object.keys(eventTypeA);
    Object.keys(eventTypeB).forEach(function (key) {
        if (!keysA.includes(key)) {
            eventTypeA[key] = eventTypeB[key];
        }
    });
}
function mergeEventsStructA2B(eventHandlerA, eventHandlerB) {
    var eventKeysA = Object.keys(eventHandlerA);
    Object.keys(eventHandlerB).forEach(function (key) {
        if (eventKeysA.indexOf(key) < 0) {
            eventHandlerA[key] = eventHandlerB[key];
        }
    });
}
function checkParams(caseType, eventRegistry) {
    if (caseType && eventRegistry) {
        var result_1 = {};
        Object.keys(eventRegistry).forEach(function (key) {
            var typeDef = caseType[key];
            if (typeDef) {
                if (typeDef.type !== null) {
                    var registeredEvent = eventRegistry[key];
                    if (registeredEvent !== null) {
                        var eventType = checkParamInTypes(registeredEvent, typeDef.type);
                        if (eventType === null) {
                            console.error("\u8F93\u5165\u9879 ".concat(JSON.stringify(eventRegistry), " \u4E2D\u5B57\u6BB5 ").concat(key, " \u503C ").concat(registeredEvent, " \u6CA1\u6709\u901A\u8FC7\u7C7B\u578B\u68C0\u67E5\u3002"));
                        }
                        else {
                            result_1[key] = {
                                value: registeredEvent,
                                type: eventType.type,
                                frameType: eventType.frameType,
                            };
                        }
                    }
                    else {
                        result_1[key] = null;
                    }
                }
                else {
                    console.error("\u7528\u4E8E\u7EA6\u675F\u8F93\u5165\u9879\u7684 ".concat(JSON.stringify(typeDef), " Struct \u6CA1\u6709\u5B9A\u4E49 type \u5B57\u6BB5\u3002"));
                }
            }
        });
        return result_1;
    }
}
var WeakTimeoutMap = (_a = {},
    _a[Types_1.WeakNetworkLevel.normal] = 0,
    _a[Types_1.WeakNetworkLevel.slight] = 2500,
    _a[Types_1.WeakNetworkLevel.serious] = 6000,
    _a);
exports.WeakTimeoutMap = WeakTimeoutMap;
var screenOrientation = {
    portrait: "portrait",
    landscape: "landscape",
    landscapeLeft: "landscapeLeft",
    landscapeRight: "landscapeRight",
};
exports.screenOrientation = screenOrientation;
var releaseStatus = {
    DEVELOP: "develop",
    TRIAL: "trial",
    RELEASE: "release",
};
exports.releaseStatus = releaseStatus;
var releaseStages = {
    release: 1,
    develop: 2,
    trial: 3,
};
exports.releaseStages = releaseStages;
function getPlatformVM(platformHandler) {
    var _a, _b;
    var platformName = (_a = platformHandler.platform) === null || _a === void 0 ? void 0 : _a.toLowerCase();
    if (platformName === Types_1.deviceConfig.devtools)
        return Types_1.moduleVersion.Devtools;
    if (platformName === Types_1.deviceConfig.ios) {
        if ((_b = platformHandler.model) === null || _b === void 0 ? void 0 : _b.includes('iPad')) {
            if (window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceModePlus)
                return Types_1.moduleVersion.IPadWKPlus;
            if (window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceMode)
                return Types_1.moduleVersion.IPadWK;
            return Types_1.moduleVersion.IPadJscore;
        }
        if (window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceModePlus)
            return Types_1.moduleVersion.IOSWKPlus;
        if (window === null || window === void 0 ? void 0 : window.isIOSHighPerformanceMode)
            return Types_1.moduleVersion.IOSWK;
        return Types_1.moduleVersion.IOSJscore;
    }
    if (platformName === Types_1.deviceConfig.android)
        return Types_1.moduleVersion.Android;
    if ([Types_1.deviceConfig.windows, Types_1.deviceConfig.mac].includes(platformName))
        return Types_1.moduleVersion.PC;
    return Types_1.moduleVersion.UnKnow;
}
function isValidClick(paramOrEventName) {
    var absoluteXCoordinate = paramOrEventName.absoluteX;
    var absoluteYCoordinate = paramOrEventName.absoluteY;
    var endXCoordinate = paramOrEventName.absoluteEndX;
    var a = paramOrEventName.absoluteEndY;
    var r = paramOrEventName.pressInterval;
    var isWithinThreshold = false;
    if (Math.abs(a - absoluteYCoordinate) < 30 &&
        Math.abs(endXCoordinate - absoluteXCoordinate) < 30 &&
        r < 300) {
        isWithinThreshold = true;
    }
    return isWithinThreshold;
}


/***/ }),

/***/ "./src/lib/Validation.ts":
/*!*******************************!*\
  !*** ./src/lib/Validation.ts ***!
  \*******************************/
/***/ (function(__unused_webpack_module, exports) {


var __assign = (this && this.__assign) || function () {
    __assign = Object.assign || function(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))
                t[p] = s[p];
        }
        return t;
    };
    return __assign.apply(this, arguments);
};
var _a;
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.Validate = exports.ValidationTypes = exports.ValidationCheck = exports.ValidationConstants = void 0;
var ValidationConstants = {
    STRING: "STRING",
    LONGLONG: "LONGLONG",
    UINT: "UINT",
    INT: "INT",
};
exports.ValidationConstants = ValidationConstants;
var ValidationTypes = {
    SvrReport: "SvrReport",
    KvStat: "KvStat",
};
exports.ValidationTypes = ValidationTypes;
var ValidationCheck = (_a = {},
    _a[ValidationConstants.STRING] = function (val) { return typeof val === 'string' && val.length <= 1024; },
    _a[ValidationConstants.LONGLONG] = function (val) { return typeof val === 'number' && Math.floor(val) === val; },
    _a[ValidationConstants.UINT] = function (val) { return typeof val === 'number' && Math.floor(val) === val && val >= 0; },
    _a[ValidationConstants.INT] = function (val) { return typeof val === 'number' && Math.floor(val) === val; },
    _a);
exports.ValidationCheck = ValidationCheck;
var Validate = /** @class */ (function () {
    function Validate(config) {
        var logid = config.logid, _a = config.schemas, schemas = _a === void 0 ? {} : _a, base = config.base, _b = config.debug, debug = _b === void 0 ? false : _b, _c = config.namespace, namespace = _c === void 0 ? ' ' : _c, _d = config.skipValidateInProdEnv, skipValidateInProdEnv = _d === void 0 ? true : _d;
        this.logid = logid;
        this.schemas = schemas;
        this.debug = debug;
        this.skipValidateInProdEnv = skipValidateInProdEnv;
        this.namespace = namespace ? " ".concat(namespace, " ") : ' ';
        this.base = base ? __assign({}, base) : {};
        if (base) {
            this.setBase(base);
        }
    }
    Validate.prototype.setBase = function (base) {
        this.validate(base);
        this.base = __assign(__assign({}, this.base), base);
    };
    Validate.prototype.validate = function (base) {
        var _this = this;
        if ((this.debug || !this.skipValidateInProdEnv) && Object.keys(this.schemas).length) {
            Object.entries(base).forEach(function (_a) {
                var columnName = _a[0], columnValue = _a[1];
                if (columnValue === undefined)
                    return;
                var validationType = _this.schemas[columnName];
                if (!validationType) {
                    console.warn("[minigamefe".concat(_this.namespace, "SchemaValidator]: logid").concat(_this.logid, ": ").concat(columnName, " \u7F3A\u5C11\u7C7B\u578B\u5B9A\u4E49"));
                    return;
                }
                if (!_this.validateColumn(validationType, columnValue)) {
                    console.error("[minigamefe".concat(_this.namespace, "SchemaValidator]: logid ").concat(_this.logid, ": ").concat(columnName, " should be ").concat(validationType, ", but now ").concat(columnValue));
                }
            });
        }
    };
    Validate.prototype.validateColumn = function (validationType, value) {
        return ValidationCheck[validationType](value);
    };
    return Validate;
}());
exports.Validate = Validate;


/***/ }),

/***/ "./src/lib/VideoElementManager.ts":
/*!****************************************!*\
  !*** ./src/lib/VideoElementManager.ts ***!
  \****************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var videoElementPrefix = "ks_lac_opera_";
var VideoElementManager = /** @class */ (function () {
    function VideoElementManager() {
        var _a;
        this.DOMElements = [];
        this.style = {};
        this.idBody = "".concat(videoElementPrefix, "body");
        var elementStyles = (_a = {},
            _a[this.idBody] = {
                width: "".concat(SystemEnvironmentVariables_1.default.systemInfo.screenWidth, "px"),
                height: "".concat(SystemEnvironmentVariables_1.default.systemInfo.screenHeight, "px"),
                zIndex: 100,
                position: "absolute",
                top: "0",
                left: "0",
                hidden: true,
                backgroundColor: "#ffffff",
                opacity: 1,
            },
            _a);
        Object.assign(this.style, elementStyles);
    }
    VideoElementManager.prototype.addVideo = function () {
        var videoElementId = "".concat(videoElementPrefix).concat(VideoElementManager.uidInc++);
        this.DOMElements.push({
            type: Types_1.DOMElementType.video,
            uid: videoElementId,
        });
        this.style[videoElementId] = {
            position: "absolute",
        };
        return videoElementId;
    };
    VideoElementManager.prototype.addImage = function (imageSource) {
        var imageElementUid = "".concat(videoElementPrefix).concat(VideoElementManager.uidInc++);
        this.DOMElements.push({
            type: Types_1.DOMElementType.image,
            uid: imageElementUid,
            src: imageSource,
        });
        this.style[imageElementUid] = {
            position: "absolute",
        };
        return imageElementUid;
    };
    VideoElementManager.prototype.addClickRect = function () {
        var uniqueVideoElementId = "".concat(videoElementPrefix).concat(VideoElementManager.uidInc++);
        this.DOMElements.push({
            type: Types_1.DOMElementType.view,
            uid: uniqueVideoElementId,
        });
        this.style[uniqueVideoElementId] = {
            position: "absolute",
        };
        return uniqueVideoElementId;
    };
    VideoElementManager.prototype.getXml = function () {
        var htmlContent = "";
        this.DOMElements.forEach(function (element) {
            switch (element.type) {
                case Types_1.DOMElementType.video:
                    htmlContent += "\n            <video\n              id=\"".concat(element.uid, "\"\n              controls=\"false\"\n              obeyMuteSwitch=\"true\"\n              pageGesture=\"false\"\n              loop=\"true\"\n              muted=\"true\"\n              autoplay=\"false\"\n              object-fit=\"cover\"\n              enable-progress-gesture=\"false\"\n              enable-play-gesture=\"false\"\n              show-center-play-btn=\"false\"\n              auto-insert=\"false\"\n            ></video>\n          ");
                    break;
                case Types_1.DOMElementType.image:
                    htmlContent += "\n            <image\n              id=\"".concat(element.uid, "\"\n              src=\"").concat(element.src, "\"\n            ></image>\n          ");
                    break;
                case Types_1.DOMElementType.view:
                    htmlContent += "\n            <view\n              id=\"".concat(element.uid, "\"\n            ></view>\n          ");
                    break;
            }
        });
        return "\n      <view id=\"".concat(this.idBody, "\">\n        ").concat(htmlContent, "\n      </view>\n    ");
    };
    VideoElementManager.prototype.getStyle = function () {
        return this.style;
    };
    VideoElementManager.uidInc = 1;
    return VideoElementManager;
}());
var videoElementManager = new VideoElementManager();
exports["default"] = videoElementManager;


/***/ }),

/***/ "./src/lib/VideoPlayerInitializer.ts":
/*!*******************************************!*\
  !*** ./src/lib/VideoPlayerInitializer.ts ***!
  \*******************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.CreateEventInstance = exports.VideoPlayerInitializer = void 0;
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var OperaPlayer_1 = __importDefault(__webpack_require__(/*! ./OperaPlayer */ "./src/lib/OperaPlayer.ts"));
// module 1433
var VideoPlayerInitializer = /** @class */ (function () {
    function VideoPlayerInitializer(videoPlayerConfig, VideoPlaybackHandler) {
        var _this = this;
        this.TYPE = Types_1.OperaDataType.StoryLine;
        this.operaData = videoPlayerConfig;
        this.datas = [];
        if (VideoPlaybackHandler) {
            var uid = Number(VideoPlaybackHandler.uid);
            if (VideoPlayerInitializer.UidIncIndex <= uid) {
                VideoPlayerInitializer.UidIncIndex = uid + 1;
            }
            this.uid = VideoPlaybackHandler.uid;
            VideoPlaybackHandler.datas.forEach(function (handleFrameParameters) {
                if (handleFrameParameters.type === Types_1.OperaDataType.Frame) {
                    _this.datas.push(_this.operaData.getFrameById(handleFrameParameters.uid));
                }
                else if (handleFrameParameters.type === Types_1.OperaDataType.StoryLine) {
                    _this.datas.push(null);
                    _this.operaData.delegateUid2Ob(Types_1.OperaDataType.StoryLine, handleFrameParameters.uid, _this.datas, _this.datas.length - 1);
                }
            });
        }
        else {
            this.uid = String(VideoPlayerInitializer.UidIncIndex++);
        }
    }
    VideoPlayerInitializer.prototype.add = function () {
        var _a;
        var data = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            data[_i] = arguments[_i];
        }
        (_a = this.datas).push.apply(_a, data);
    };
    VideoPlayerInitializer.prototype.getUid = function () {
        return this.uid;
    };
    VideoPlayerInitializer.prototype.getRelatedEvent = function () {
        return this.relatedEvent;
    };
    VideoPlayerInitializer.prototype.nextFrame = function () {
        this.currentData = this.datas.shift();
        if (this.currentData) {
            this.currentData.play();
            return this.currentData;
        }
        else {
            OperaPlayer_1.default.eventEmitter.emit(this.operaData, CaseType_1.OperaPlayerCaseType.ReportStoryEnd, this);
            return null;
        }
    };
    VideoPlayerInitializer.prototype.play = function () {
        OperaPlayer_1.default.eventEmitter.emit(this.operaData, CaseType_1.OperaPlayerCaseType.PlayStoryLine, this);
    };
    VideoPlayerInitializer.prototype.exportData = function () {
        return {
            uid: this.getUid(),
            datas: this.datas.map(function (handlerEvent) { return ({
                type: handlerEvent.TYPE,
                uid: handlerEvent.getUid(),
            }); }),
        };
    };
    VideoPlayerInitializer.UidIncIndex = 1;
    return VideoPlayerInitializer;
}());
exports.VideoPlayerInitializer = VideoPlayerInitializer;
var CreateEventInstance = /** @class */ (function (_super) {
    __extends(CreateEventInstance, _super);
    function CreateEventInstance(videoPlayerConfig, eventIndex) {
        var _this = _super.call(this, videoPlayerConfig) || this;
        _this.relatedEvent = eventIndex;
        return _this;
    }
    return CreateEventInstance;
}(VideoPlayerInitializer));
exports.CreateEventInstance = CreateEventInstance;


/***/ }),

/***/ "./src/lib/ViewContext.ts":
/*!********************************!*\
  !*** ./src/lib/ViewContext.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.initViewContext = initViewContext;
var Common_1 = __webpack_require__(/*! ./Common */ "./src/lib/Common.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
function initViewContext() {
    var viewContext = {};
    var ks;
    var coverview;
    viewContext.env = SystemEnvironmentVariables_1.default;
    if (SystemEnvironmentVariables_1.default.isMiniGamePlugin) {
        var pluginEnvironment = SystemEnvironmentVariables_1.default.pluginEnv;
        var customEnvironment = pluginEnvironment.customEnv;
        viewContext.ks = ks = SystemEnvironmentVariables_1.default.ks;
        viewContext.canvas = customEnvironment.canvas;
        viewContext.document = customEnvironment.document;
        viewContext.instanceId = pluginEnvironment.instanceId || "";
        viewContext.setFileSpaceStatistics = pluginEnvironment.setFileSpaceStatistics;
        viewContext.getPrivateFileSystemManager = pluginEnvironment.getPrivateFileSystemManager;
        viewContext.coverview = coverview = pluginEnvironment.coverview;
        viewContext.getKsCommonFont = pluginEnvironment.getKsCommonFont;
        if (coverview) {
            viewContext.Component = coverview.Component;
            viewContext.getPrivateThis = coverview.getPrivateThis;
            viewContext.removePrivateThis = coverview.removePrivateThis;
            viewContext.create = coverview.create;
            viewContext.init = coverview.init;
            viewContext.webviewLayout = coverview.webviewLayout;
            viewContext.xmlParser = coverview.xmlParser;
        }
        else {
            viewContext.Component = /** @class */ (function () {
                function Component() {
                }
                return Component;
            }());
        }
    }
    else {
        viewContext.reportKeyValue = function () {
        };
        viewContext.gameTransfer = function () {
        };
        viewContext.Component = function () {
        };
        viewContext.getPrivateThis = function (self) { return self; };
        viewContext.instanceId = "";
    }
    (0, Common_1.setKs)(ks);
    return viewContext;
}


/***/ }),

/***/ "./src/lib/ViewElement.ts":
/*!********************************!*\
  !*** ./src/lib/ViewElement.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.createViewElementWithContext = createViewElementWithContext;
var ViewContext_1 = __webpack_require__(/*! ./ViewContext */ "./src/lib/ViewContext.ts");
var VideoElementManager_1 = __importDefault(__webpack_require__(/*! ./VideoElementManager */ "./src/lib/VideoElementManager.ts"));
function createViewElementWithContext() {
    var viewContext = (0, ViewContext_1.initViewContext)();
    var ViewElement = /** @class */ (function (_super) {
        __extends(ViewElement, _super);
        function ViewElement() {
            var _this = _super.call(this) || this;
            _this.destoryed = false;
            _this.globalPrivate = viewContext.getPrivateThis(_this);
            _this.globalPrivate.xom = '';
            _this.globalPrivate.style = '';
            _this.supportAnimation = !viewContext.env.isDevtools;
            return _this;
        }
        ViewElement.prototype.loadXML = function () {
            var xmlData = VideoElementManager_1.default.getXml();
            var styleData = VideoElementManager_1.default.getStyle();
            var parsedXmlRoot = viewContext.xmlParser(xmlData).root;
            var currentBodyId = VideoElementManager_1.default.idBody;
            viewContext.init.call(this, parsedXmlRoot, styleData);
            viewContext.webviewLayout.add(this.globalPrivate[currentBodyId]);
            return this.globalPrivate[currentBodyId].ready();
        };
        ViewElement.prototype.showBody = function () {
            this.globalPrivate[VideoElementManager_1.default.idBody].style.hidden = false;
        };
        ViewElement.prototype.getHandler = function (key) {
            return this.globalPrivate[key];
        };
        ViewElement.prototype.destory = function () {
            var _this = this;
            if (!this.destoryed) {
                this.destoryed = true;
                if (this.globalPrivate[VideoElementManager_1.default.idBody]) {
                    this.globalPrivate[VideoElementManager_1.default.idBody].animate({
                        opacity: 0,
                        duration: 300,
                    }).then(function () {
                        viewContext.webviewLayout.remove(_this.globalPrivate[VideoElementManager_1.default.idBody]);
                        viewContext.removePrivateThis(_this);
                    });
                }
            }
        };
        ViewElement.getInstance = function () {
            return this.instance || (this.instance = new ViewElement());
        };
        return ViewElement;
    }(viewContext.Component));
    return ViewElement.getInstance();
}


/***/ }),

/***/ "./src/lib/ViewElementCreator.ts":
/*!***************************************!*\
  !*** ./src/lib/ViewElementCreator.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ViewerElementsCreator = exports.VarFrame = exports.ReportCheckPointCount = exports.ReportEvent = exports.SetTimeout = exports.CheckPoint = exports.ViewElementCreator = exports.Rect = exports.WatchableImage = exports.VideoPlayer = exports.AudioPlayer = void 0;
var ViewEventManager_1 = __webpack_require__(/*! ./ViewEventManager */ "./src/lib/ViewEventManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var StyleUtils_1 = __importDefault(__webpack_require__(/*! ./StyleUtils */ "./src/lib/StyleUtils.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var ViewElementManager_1 = __webpack_require__(/*! ./ViewElementManager */ "./src/lib/ViewElementManager.ts");
var Utils_1 = __webpack_require__(/*! ./Utils */ "./src/lib/Utils.ts");
var VideoElementManager_1 = __importDefault(__webpack_require__(/*! ./VideoElementManager */ "./src/lib/VideoElementManager.ts"));
var ViewContext_1 = __webpack_require__(/*! ./ViewContext */ "./src/lib/ViewContext.ts");
var ViewElement_1 = __webpack_require__(/*! ./ViewElement */ "./src/lib/ViewElement.ts");
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
var EnvironmentEnum;
(function (EnvironmentEnum) {
    EnvironmentEnum[EnvironmentEnum["env"] = 0] = "env";
    EnvironmentEnum[EnvironmentEnum["user"] = 1] = "user";
    EnvironmentEnum[EnvironmentEnum["record"] = 2] = "record";
})(EnvironmentEnum || (EnvironmentEnum = {}));
var AudioPlayer = /** @class */ (function (_super) {
    __extends(AudioPlayer, _super);
    function AudioPlayer() {
        var _this = _super.call(this) || this;
        _this.progressTime = 0;
        _this.onProgressToPlay = false;
        _this.onWating = false;
        _this.playAtTimes = [];
        _this.nextPlayPosition = -1;
        _this.audio = null;
        return _this;
    }
    AudioPlayer.prototype.created = function () {
        var _this = this;
        var viewContext = (0, ViewContext_1.initViewContext)();
        var innerAudioContext = viewContext.ks.createInnerAudioContext();
        if (innerAudioContext) {
            this.audio = innerAudioContext;
            this.audio.onPlay(function () {
                _this.getEvents("onPlay").forEach(function (event) {
                    _this.$emit(event);
                });
                _this.onWating = false;
            });
            this.audio.onEnded(function () {
                _this.getEvents("onEnded").forEach(function (event) {
                    _this.$emit(event);
                });
            });
            this.audio.onError(function () {
                _this.onError();
            });
            this.audio.onWaiting(function () {
                _this.onWating = true;
            });
            this.audio.onTimeUpdate(function () {
                _this.checkPlayAtTimes();
            });
            this.audio.onCanplay(function () {
                if (_this.onProgressToPlay) {
                    _this.audio.play();
                }
            });
        }
        else {
            var audioExceptionInfo = {
                type: Types_1.ExceptionType.Audio,
                errmsg: "音频组件创建失败",
            };
            ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.Exception, audioExceptionInfo);
        }
    };
    AudioPlayer.prototype.onError = function () {
        this.$logger("onError");
        var audioUrl = this.getParams(["url"]).url;
        var audioError = {
            type: Types_1.ExceptionType.Audio,
            errmsg: "\u97F3\u9891URL:[".concat(audioUrl.value.toString(), "] \u64AD\u653E\u5931\u8D25"),
        };
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.Exception, audioError);
    };
    AudioPlayer.prototype.onLoggerEvent = function (eventType) {
        if (eventType === "onError") {
            this.onError();
        }
    };
    AudioPlayer.prototype.actived = function () {
        var _this = this;
        var params = this.getParams(["autoPlay", "url", "volume", "loop"]);
        var autoPlayValue = params.autoPlay;
        var urlValue = params.url;
        var volumeValue = params.volume;
        var loopValue = params.loop;
        this.getEvents("onPlayTimeAt").forEach(function (elementUID) {
            _this.playAtTimes.push({
                eventHander: elementUID,
                sec: elementUID.params.sec.value,
            });
        });
        this.audio.src = urlValue.value.toString();
        this.onProgressToPlay = autoPlayValue.value;
        this.audio.volume = volumeValue.value;
        this.progress = 0;
        this.audio.loop = loopValue.value;
    };
    AudioPlayer.prototype.destory = function () {
        if (this.audio) {
            this.audio.destroy();
        }
    };
    Object.defineProperty(AudioPlayer.prototype, "progress", {
        get: function () {
            return this.progressTime;
        },
        set: function (progressTime) {
            this.progressTime = progressTime;
            if (this.progressTime > 0 && this.onProgressToPlay) {
                this.onProgressToPlay = false;
                this.nextPlayPosition = -1;
                this.audio.play();
            }
        },
        enumerable: false,
        configurable: true
    });
    AudioPlayer.prototype.checkPlayAtTimes = function () {
        var _this = this;
        var currentAudioTime = this.audio.currentTime;
        this.playAtTimes.forEach(function (item, index) {
            var sec = item.sec;
            if (sec >= _this.nextPlayPosition && sec < currentAudioTime) {
                _this.playAtTimes.splice(index, 1);
                _this.$emit(item.eventHander);
            }
        });
        this.nextPlayPosition = currentAudioTime;
    };
    AudioPlayer.ListenerFrameType = Types_1.FrameType.createAudio;
    return AudioPlayer;
}(ViewEventManager_1.ViewEventManager));
exports.AudioPlayer = AudioPlayer;
var VideoPlayer = /** @class */ (function (_super) {
    __extends(VideoPlayer, _super);
    function VideoPlayer() {
        var _this = _super.call(this) || this;
        _this.uid = '';
        _this.playStatus = false;
        _this.actualPlayStatus = false;
        _this.lastSeriousTimePosition = -1;
        _this.autoPlay = false;
        _this.loggerMode = false;
        _this.playAtTimes = [];
        _this.weakNetworkHandlerLevel1 = null;
        _this.weakNetworkHandlerLevel2 = null;
        _this.actualPlayTimeoutHandler = null;
        _this.nextPlayPosition = -1;
        _this.video = null;
        return _this;
    }
    VideoPlayer.prototype.created = function () {
        this.uid = VideoElementManager_1.default.addVideo();
        this.$logger({
            t: EnvironmentEnum.record,
        });
    };
    VideoPlayer.prototype.domMounted = function () {
        var _this = this;
        var viewElement = (0, ViewElement_1.createViewElementWithContext)();
        this.video = viewElement.getHandler(this.uid);
        this.video.muted = false;
        this.updatePositionAndSize();
        this.video.style.hidden = true;
        this.video.onEnded(function () {
            if (!_this.getParams(['loop']).loop.value) {
                _this.playStatus = false;
            }
            _this.getEvents('onEnded').forEach(function (event) {
                _this.$emit(event);
            });
        });
        this.video.onError(function () {
            var videoUrl = _this.getParams(['url']).url;
            var errorDetails = {
                type: Types_1.ExceptionType.Video,
                errmsg: "\u89C6\u9891URL:[".concat(videoUrl.value.toString(), "] \u64AD\u653E\u5931\u8D25"),
            };
            ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(_this.viewer, CaseType_1.ViewerBaseCaseType.Exception, errorDetails);
        });
        this.video.onProgress(function () {
            if (!_this.weakNetworkHandlerLevel2) {
                _this.weakNetworkHandlerLevel2 = setTimeout(function () {
                    _this.weakNetworkHandlerLevel2 = null;
                    if (_this.nextPlayPosition !== _this.lastSeriousTimePosition) {
                        _this.lastSeriousTimePosition = _this.nextPlayPosition;
                        _this.pushWeakNetworkMsg(Types_1.WeakNetworkLevel.serious);
                    }
                }, Utils_1.WeakTimeoutMap[Types_1.WeakNetworkLevel.serious]);
            }
        });
        this.video.onPlay(function () {
            _this.$logger({
                t: EnvironmentEnum.env,
                a: 'onPlay',
            });
            _this.getEvents('onPlay').forEach(function (event) {
                _this.$emit(event);
            });
            _this.playStatus = true;
            _this.onTimeUpdate({ position: 0 });
        });
        this.video.onWaiting(function () {
            if (!_this.weakNetworkHandlerLevel1) {
                _this.weakNetworkHandlerLevel1 = setTimeout(function () {
                    _this.weakNetworkHandlerLevel1 = null;
                    _this.pushWeakNetworkMsg(Types_1.WeakNetworkLevel.slight);
                }, Utils_1.WeakTimeoutMap[Types_1.WeakNetworkLevel.slight]);
            }
        });
        this.video.onTimeUpdate(this.onTimeUpdate.bind(this));
    };
    VideoPlayer.prototype.onTimeUpdate = function (event) {
        this.actualPlaySetting();
        this.checkPlayAtTimes(event);
        this.clearWeakNetworkCheck();
    };
    VideoPlayer.prototype.actualPlaySetting = function () {
        var _this = this;
        if (!this.actualPlayStatus) {
            this.$logger({
                t: EnvironmentEnum.env,
                a: 'play',
            });
        }
        this.actualPlayStatus = true;
        if (this.actualPlayTimeoutHandler) {
            clearTimeout(this.actualPlayTimeoutHandler);
        }
        if (this.playStatus) {
            this.actualPlayTimeoutHandler = setTimeout(function () {
                _this.actualPlayStatus = false;
                _this.actualPlayTimeoutHandler = null;
                _this.$logger({
                    t: EnvironmentEnum.env,
                    a: 'pause',
                });
            }, 1000);
        }
    };
    VideoPlayer.prototype.actived = function () {
        var _this = this;
        this.updatePositionAndSize();
        var _a = this.getParams(['autoPlay', 'url', 'objectFit', 'loop']), autoPlay = _a.autoPlay, url = _a.url, objectFit = _a.objectFit, loop = _a.loop;
        this.getEvents('onPlayTimeAt').forEach(function (event) {
            _this.playAtTimes.push({
                eventHander: event,
                sec: event.params.sec.value,
            });
        });
        this.video.loop = !!loop.value;
        this.video.style.hidden = false;
        this.video.objectFit = objectFit.value;
        this.autoPlay = !!autoPlay.value;
        this.video.autoplay = !this.loggerMode && this.autoPlay;
        this.video.src = url.value.toString();
    };
    VideoPlayer.prototype.updated = function (event) {
        if (StyleUtils_1.default.isPositionAndSizeChange(event)) {
            this.updatePositionAndSize();
        }
    };
    VideoPlayer.prototype.onLoggerEvent = function (environmentEvent) {
        switch (environmentEvent.t) {
            case EnvironmentEnum.record:
                this.loggerMode = true;
                break;
            case EnvironmentEnum.env:
                switch (environmentEvent.a) {
                    case 'weak':
                        this.pushWeakNetworkMsg(environmentEvent.p);
                        break;
                    case 'onPlay':
                        if (this.autoPlay && this.video) {
                            this.video.autoplay = true;
                            this.video.play();
                            this.playStatus = true;
                        }
                        break;
                    case 'pause':
                        if (this.video) {
                            this.video.pause();
                        }
                        break;
                    case 'play':
                        if (this.video) {
                            this.video.play();
                        }
                }
        }
    };
    VideoPlayer.prototype.destory = function () {
        this.playStatus = false;
        this.clearWeakNetworkCheck();
        if (this.actualPlayTimeoutHandler) {
            clearTimeout(this.actualPlayTimeoutHandler);
        }
    };
    VideoPlayer.prototype.updatePositionAndSize = function () {
        var _this = this;
        var calculatedPositionAndSize = StyleUtils_1.default.calPositionAndSizeByParams(this.getParams(StyleUtils_1.default.PositionAndSizeKeys));
        Object.keys(calculatedPositionAndSize).forEach(function (key) {
            _this.video.style[key] = calculatedPositionAndSize[key];
        });
        var isVisible = this.getParams(['visible']).visible;
        this.video.style.hidden = !isVisible.value;
    };
    VideoPlayer.prototype.checkPlayAtTimes = function (event) {
        var _this = this;
        this.playAtTimes.forEach(function (item, index) {
            var sec = item.sec;
            if (_this.nextPlayPosition <= event.position) {
                if (sec >= _this.nextPlayPosition && sec < event.position) {
                    _this.playAtTimes.splice(index, 1);
                    _this.$emit(item.eventHander);
                }
            }
            else if (sec >= _this.nextPlayPosition || sec < event.position) {
                _this.playAtTimes.splice(index, 1);
                _this.$emit(item.eventHander);
            }
        });
        this.nextPlayPosition = event.position;
    };
    VideoPlayer.prototype.clearWeakNetworkCheck = function () {
        if (this.weakNetworkHandlerLevel1) {
            clearTimeout(this.weakNetworkHandlerLevel1);
            this.weakNetworkHandlerLevel1 = null;
        }
        if (this.weakNetworkHandlerLevel2) {
            clearTimeout(this.weakNetworkHandlerLevel2);
            this.weakNetworkHandlerLevel2 = null;
        }
    };
    VideoPlayer.prototype.pushWeakNetworkMsg = function (networkLevel) {
        if (this.playStatus) {
            this.$logger({
                t: EnvironmentEnum.env,
                a: 'weak',
                p: networkLevel,
            });
            var networkRequestParams = {
                url: this.getParams(['url']).url.value.toString(),
                level: networkLevel,
            };
            ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.WeakNetWork, networkRequestParams);
        }
    };
    VideoPlayer.ListenerFrameType = Types_1.FrameType.createVideo;
    return VideoPlayer;
}(ViewEventManager_1.ViewEventManager));
exports.VideoPlayer = VideoPlayer;
var WatchableImage = /** @class */ (function (_super) {
    __extends(WatchableImage, _super);
    function WatchableImage() {
        var _this = _super.call(this) || this;
        _this.image = null;
        _this.uid = '';
        return _this;
    }
    WatchableImage.prototype.created = function () {
        var urlParams = this.getParams(['url']).url;
        this.uid = VideoElementManager_1.default.addImage(urlParams.value.toString());
    };
    WatchableImage.prototype.domMounted = function () {
        var _this = this;
        var viewElement = (0, ViewElement_1.createViewElementWithContext)();
        this.image = viewElement.getHandler(this.uid);
        this.updatePositionAndSize();
        this.image.style.hidden = true;
        this.image.on('click', function (domElement) {
            if ((0, Utils_1.isValidClick)(domElement)) {
                _this.click();
            }
        });
    };
    WatchableImage.prototype.click = function () {
        var _this = this;
        this.$logger('click');
        this.getEvents('onClick').forEach(function (mediaElement) {
            _this.$emit(mediaElement);
        });
    };
    WatchableImage.prototype.onLoggerEvent = function (eventType) {
        if (eventType === 'click') {
            this.click();
        }
    };
    WatchableImage.prototype.actived = function () {
        this.updatePositionAndSize();
    };
    WatchableImage.prototype.updated = function (event) {
        if (StyleUtils_1.default.isPositionAndSizeChange(event)) {
            this.updatePositionAndSize();
        }
    };
    WatchableImage.prototype.animation = function (durationPromiseCallback, durationValue) {
        var _this = this;
        return new Promise(function (resolve, reject) {
            var _a, _b, _c, _d;
            if (_this.getParams(['visible']).visible.value) {
                var positionAndSizeParams = _this.getParams(StyleUtils_1.default.PositionAndSizeKeys);
                var calculatedPositionAndSize_1 = StyleUtils_1.default.calPositionAndSizeByParams(positionAndSizeParams);
                var adjustedPositionAndSize_1 = StyleUtils_1.default.calPositionAndSizeByParams(positionAndSizeParams, durationPromiseCallback);
                var changedPositionAndSize_1 = {};
                Object.keys(adjustedPositionAndSize_1).forEach(function (key) {
                    if (adjustedPositionAndSize_1[key] !== calculatedPositionAndSize_1[key]) {
                        changedPositionAndSize_1[key] = adjustedPositionAndSize_1[key];
                    }
                });
                var durationValueNumeric_1 = Number((_b = (_a = durationValue === null || durationValue === void 0 ? void 0 : durationValue.duration) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.toString());
                var easingValue_1 = (_d = (_c = durationValue === null || durationValue === void 0 ? void 0 : durationValue.easing) === null || _c === void 0 ? void 0 : _c.value) === null || _d === void 0 ? void 0 : _d.toString();
                var viewContext = (0, ViewContext_1.initViewContext)();
                if (viewContext.env.isDevtools) {
                    setTimeout(function () {
                        _this.frame.setParams(adjustedPositionAndSize_1);
                        _this.updatePositionAndSize();
                        resolve(true);
                    }, durationValueNumeric_1);
                }
                else {
                    setTimeout(function () {
                        var animationOptions = Object.assign({
                            easing: easingValue_1,
                            duration: durationValueNumeric_1,
                        }, changedPositionAndSize_1);
                        _this.image.animate(animationOptions).then(function () {
                            _this.frame.setParams(adjustedPositionAndSize_1);
                            _this.updatePositionAndSize();
                            resolve(true);
                        });
                    }, viewContext.env.isIOS ? 30 : 1);
                }
            }
            else {
                reject();
            }
        });
    };
    WatchableImage.prototype.updatePositionAndSize = function () {
        var _this = this;
        var positionAndSize = StyleUtils_1.default.calPositionAndSizeByParams(this.getParams(StyleUtils_1.default.PositionAndSizeKeys));
        Object.keys(positionAndSize).forEach(function (key) {
            _this.image.style[key] = positionAndSize[key];
        });
        var isVisible = this.getParams(['visible']).visible;
        this.image.style.hidden = !(isVisible === null || isVisible === void 0 ? void 0 : isVisible.value);
    };
    WatchableImage.ListenerFrameType = Types_1.FrameType.createImage;
    return WatchableImage;
}(ViewEventManager_1.ViewEventManager));
exports.WatchableImage = WatchableImage;
var Rect = /** @class */ (function (_super) {
    __extends(Rect, _super);
    function Rect() {
        var _this = _super.call(this) || this;
        _this.view = null;
        _this.uid = '';
        return _this;
    }
    Rect.prototype.created = function () {
        this.uid = VideoElementManager_1.default.addClickRect();
    };
    Rect.prototype.domMounted = function () {
        var _this = this;
        var viewElement = (0, ViewElement_1.createViewElementWithContext)();
        this.view = viewElement.getHandler(this.uid);
        this.view.style.hidden = true;
        this.view.style.backgroundColor = "#00000000";
        this.view.on("click", function (event) {
            if ((0, Utils_1.isValidClick)(event)) {
                _this.click();
            }
        });
    };
    Rect.prototype.click = function () {
        var _this = this;
        this.$logger("click");
        var clickEventHandlers = this.getEvents("onClick");
        var hasActiveEventHandlers = false;
        clickEventHandlers.forEach(function (handler) {
            _this.$emit(handler);
            if (handler.keep) {
                hasActiveEventHandlers = true;
            }
        });
        if (!hasActiveEventHandlers) {
            this.view.style.hidden = true;
        }
    };
    Rect.prototype.onLoggerEvent = function (eventType) {
        if (eventType === "click") {
            this.click();
        }
    };
    Rect.prototype.updated = function (event) {
        if (StyleUtils_1.default.isPositionAndSizeChange(event)) {
            this.updatePositionAndSize();
        }
    };
    Rect.prototype.actived = function () {
        this.updatePositionAndSize();
    };
    Rect.prototype.updatePositionAndSize = function () {
        var _this = this;
        var calculatedPositionAndSize = StyleUtils_1.default.calPositionAndSizeByParams(this.getParams(StyleUtils_1.default.PositionAndSizeKeys));
        Object.keys(calculatedPositionAndSize).forEach(function (key) {
            _this.view.style[key] = calculatedPositionAndSize[key];
        });
        var _a = this.getParams(["visible", "color"]), visible = _a.visible, color = _a.color;
        this.view.style.hidden = !(visible === null || visible === void 0 ? void 0 : visible.value);
        if (color === null || color === void 0 ? void 0 : color.value) {
            this.view.style.backgroundColor = color.value;
        }
    };
    Rect.ListenerFrameType = Types_1.FrameType.createRect;
    return Rect;
}(ViewEventManager_1.ViewEventManager));
exports.Rect = Rect;
var ViewElementCreator = /** @class */ (function (_super) {
    __extends(ViewElementCreator, _super);
    function ViewElementCreator() {
        var _this = _super.call(this) || this;
        _this.isDestory = false;
        return _this;
    }
    ViewElementCreator.prototype.actived = function () {
        var _this = this;
        var context = this;
        var frameParams = this.getParams('frame').frame;
        if (frameParams.type === Types_1.ParamInputType.Frame) {
            var viewerElement = this.viewer.getViewerElementByFrameBase(frameParams.value);
            if (viewerElement) {
                var positionAndSizeParams_1 = this.getParams(StyleUtils_1.default.PositionAndSizeKeys);
                var animationParams_1 = {};
                Object.keys(positionAndSizeParams_1).forEach(function (param) {
                    if (positionAndSizeParams_1[param] !== null) {
                        animationParams_1[param] = positionAndSizeParams_1[param];
                    }
                });
                viewerElement.animation(animationParams_1, this.getParams(['duration', 'easing']))
                    .then(function () {
                    if (!context.isDestory) {
                        _this.getEvents('onEnded').forEach(function (event) {
                            _this.$emit(event);
                        });
                    }
                });
            }
        }
    };
    ViewElementCreator.prototype.destory = function () {
        this.isDestory = true;
    };
    ViewElementCreator.ListenerFrameType = Types_1.FrameType.createAnimationFunction;
    return ViewElementCreator;
}(ViewEventManager_1.ViewEventManager));
exports.ViewElementCreator = ViewElementCreator;
var CheckPoint = /** @class */ (function (_super) {
    __extends(CheckPoint, _super);
    function CheckPoint() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    CheckPoint.prototype.actived = function () {
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.CheckPoint);
    };
    CheckPoint.ListenerFrameType = Types_1.FrameType.checkPoint;
    return CheckPoint;
}(ViewEventManager_1.ViewEventManager));
exports.CheckPoint = CheckPoint;
var SetTimeout = /** @class */ (function (_super) {
    __extends(SetTimeout, _super);
    function SetTimeout() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.timeoutHandler = null;
        return _this;
    }
    SetTimeout.prototype.actived = function () {
        var _this = this;
        var _a = this.getParams(['timeout', 'cancel']), timeout = _a.timeout, cancel = _a.cancel;
        if (!cancel.value) {
            var timeoutDuration = Math.max(Number(timeout.value.toString()) || 0, 1);
            this.timeoutHandler = setTimeout(function () {
                _this.timeoutHandler = null;
                _this.getEvents('onEnded').forEach(function (event) {
                    _this.$emit(event);
                });
            }, timeoutDuration);
        }
    };
    Object.defineProperty(SetTimeout.prototype, "watch", {
        get: function () {
            var _this = this;
            return {
                cancel: function (_timeoutValue, timeoutCallbackIndex) {
                    if (_this.timeoutHandler && _timeoutValue.value) {
                        clearTimeout(_this.timeoutHandler);
                        _this.timeoutHandler = null;
                        _this.getEvents('onCancel').forEach(function (callbackIndex) {
                            _this.$emit(callbackIndex);
                        });
                    }
                },
            };
        },
        enumerable: false,
        configurable: true
    });
    SetTimeout.ListenerFrameType = Types_1.FrameType.setTimeout;
    return SetTimeout;
}(ViewEventManager_1.ViewEventManager));
exports.SetTimeout = SetTimeout;
var ReportEvent = /** @class */ (function (_super) {
    __extends(ReportEvent, _super);
    function ReportEvent() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ReportEvent.prototype.actived = function () {
        var _a, _b, _c;
        var _d = this.getParams(['sceneId', 'dimension', 'metric']), sceneId = _d.sceneId, dimension = _d.dimension, metric = _d.metric;
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.Report, {
            sceneId: Number((_a = sceneId === null || sceneId === void 0 ? void 0 : sceneId.value) === null || _a === void 0 ? void 0 : _a.toString()),
            dimension: (_b = dimension === null || dimension === void 0 ? void 0 : dimension.value) === null || _b === void 0 ? void 0 : _b.toString(),
            metric: (_c = metric === null || metric === void 0 ? void 0 : metric.value) === null || _c === void 0 ? void 0 : _c.toString(),
        });
    };
    ReportEvent.ListenerFrameType = Types_1.FrameType.report;
    return ReportEvent;
}(ViewEventManager_1.ViewEventManager));
exports.ReportEvent = ReportEvent;
var ReportCheckPointCount = /** @class */ (function (_super) {
    __extends(ReportCheckPointCount, _super);
    function ReportCheckPointCount() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    ReportCheckPointCount.prototype.actived = function () {
        var _a, _b;
        var numParam = this.getParams('num');
        var countValue = ((_b = (_a = numParam === null || numParam === void 0 ? void 0 : numParam.num) === null || _a === void 0 ? void 0 : _a.value) === null || _b === void 0 ? void 0 : _b.toString()) || '0';
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.ReportCheckPointCount, countValue);
    };
    ReportCheckPointCount.ListenerFrameType = Types_1.FrameType.reportCheckPointCount;
    return ReportCheckPointCount;
}(ViewEventManager_1.ViewEventManager));
exports.ReportCheckPointCount = ReportCheckPointCount;
var VarFrame = /** @class */ (function (_super) {
    __extends(VarFrame, _super);
    function VarFrame() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    Object.defineProperty(VarFrame.prototype, "watch", {
        get: function () {
            var _this = this;
            return {
                value: function (eventItem, newEventValue) {
                    if (eventItem.value !== newEventValue.value) {
                        _this.getEvents('onChanged').forEach(function (eventArgs) {
                            _this.$emit(eventArgs);
                        });
                    }
                    _this.getEvents('onChange').forEach(function (eventHandler) {
                        _this.$emit(eventHandler);
                    });
                },
            };
        },
        enumerable: false,
        configurable: true
    });
    ;
    VarFrame.ListenerFrameType = Types_1.FrameType.var;
    return VarFrame;
}(ViewEventManager_1.ViewEventManager));
exports.VarFrame = VarFrame;
var ViewerElementsCreator = /** @class */ (function (_super) {
    __extends(ViewerElementsCreator, _super);
    function ViewerElementsCreator() {
        var _this = _super.call(this, ViewerElementsCreator.ViewerElementsClass) || this;
        _this.destoryed = false;
        _this.elements = [];
        return _this;
    }
    ViewerElementsCreator.prototype.mounted = function () {
        var _this = this;
        console.log("[Launch Opera] Opera loaded all assets.");
        console.log("[Launch Opera] Init cover view documents.");
        var viewElement = (0, ViewElement_1.createViewElementWithContext)();
        viewElement.loadXML().then(function () {
            OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(_this.dirctor, CaseType_1.DirctorCaseType.ViewerReady);
            _this.elements.forEach(function (component) {
                ViewEventManager_1.ViewEventManager.eventEmitter.emit(component, CaseType_1.ViewerElementBaseCaseType.DomReady);
            });
            viewElement.showBody();
        });
    };
    ViewerElementsCreator.prototype.destory = function () {
        if (!this.destoryed) {
            this.destoryed = true;
            this.elements.forEach(function (component) {
                component.destory();
            });
            console.log("[Launch Opera] Opera viewer-coverview destory.");
            var viewElement = (0, ViewElement_1.createViewElementWithContext)();
            viewElement.destory();
        }
    };
    ViewerElementsCreator.ViewerElementsClass = [
        AudioPlayer,
        VideoPlayer,
        WatchableImage,
        Rect,
        ViewElementCreator,
        ReportEvent,
        CheckPoint,
        SetTimeout,
        ReportCheckPointCount,
        VarFrame,
    ];
    return ViewerElementsCreator;
}(ViewElementManager_1.ViewerElementHandler));
exports.ViewerElementsCreator = ViewerElementsCreator;


/***/ }),

/***/ "./src/lib/ViewElementManager.ts":
/*!***************************************!*\
  !*** ./src/lib/ViewElementManager.ts ***!
  \***************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {
    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {
        if (ar || !(i in from)) {
            if (!ar) ar = Array.prototype.slice.call(from, 0, i);
            ar[i] = from[i];
        }
    }
    return to.concat(ar || Array.prototype.slice.call(from));
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ViewerElementHandler = void 0;
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
var ViewEventManager_1 = __webpack_require__(/*! ./ViewEventManager */ "./src/lib/ViewEventManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var OperaPlayerHandler_1 = __webpack_require__(/*! ./OperaPlayerHandler */ "./src/lib/OperaPlayerHandler.ts");
// module 4767
var ViewerElementHandler = /** @class */ (function () {
    function ViewerElementHandler(viewerElementsClass) {
        this.elements = [];
        this.frameMap = new WeakMap();
        this.viewerElementsClass = [];
        this.viewerElementsClass = viewerElementsClass;
    }
    ViewerElementHandler.prototype.setDirctor = function (_director) {
        this.dirctor = _director;
        this.registerDirctorEventListener();
    };
    ViewerElementHandler.prototype.getViewerElementByFrameBase = function (frameIdentifier) {
        if (this.frameMap.has(frameIdentifier)) {
            return this.frameMap.get(frameIdentifier);
        }
        else {
            return null;
        }
    };
    ViewerElementHandler.prototype.emitterTodoFrameCreate = function (frame) {
        var _this = this;
        this.viewerElementsClass.forEach(function (elementClass) {
            if (elementClass.ListenerFrameType === frame.getFrameType()) {
                _this.createViewer(elementClass, frame);
            }
        });
    };
    ViewerElementHandler.prototype.createViewer = function (ElementConstructor, elementConstructorArg) {
        var elementInstance = new ElementConstructor(this, elementConstructorArg);
        this.elements.push(elementInstance);
        this.frameMap.set(elementConstructorArg, elementInstance);
        ElementConstructor.eventEmitter.emit(elementInstance, CaseType_1.ViewerElementBaseCaseType.Created);
    };
    ViewerElementHandler.prototype.mounted = function () {
    };
    ViewerElementHandler.prototype.destory = function () {
    };
    ViewerElementHandler.prototype.registerDirctorEventListener = function () {
        var self = this;
        ViewerElementHandler.eventEmitter.registerEvent(this, function (reportContext) {
            var _a, _b, _c, _d, _e, _f, _g;
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (reportContext) {
                case CaseType_1.ViewerBaseCaseType.FrameCreate:
                    self.emitterTodoFrameCreate(args[0]);
                    break;
                case CaseType_1.ViewerBaseCaseType.PlayFrame:
                    if (self.frameMap.has(args[0])) {
                        ViewEventManager_1.ViewEventManager.eventEmitter.emit(self.frameMap.get(args[0]), CaseType_1.ViewerElementBaseCaseType.Actived);
                    }
                    break;
                case CaseType_1.ViewerBaseCaseType.OperaDataMounted:
                    self.mounted();
                    break;
                case CaseType_1.ViewerBaseCaseType.FrameElementParamChange:
                    if (self.frameMap.has(args[0])) {
                        (_a = ViewEventManager_1.ViewEventManager.eventEmitter).emit.apply(_a, __spreadArray([self.frameMap.get(args[0]),
                            CaseType_1.ViewerElementBaseCaseType.ParamChange], args, false));
                    }
                    break;
                case CaseType_1.ViewerBaseCaseType.Exception:
                    (_b = OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter).emit.apply(_b, __spreadArray([self.dirctor,
                        CaseType_1.DirctorCaseType.Exception], args, false));
                    break;
                case CaseType_1.ViewerBaseCaseType.End:
                    self.destory();
                    break;
                case CaseType_1.ViewerBaseCaseType.FrameElementParamChangeUpdate:
                    if (self.frameMap.has(args[0])) {
                        (_c = ViewEventManager_1.ViewEventManager.eventEmitter).emit.apply(_c, __spreadArray([self.frameMap.get(args[0]),
                            CaseType_1.ViewerElementBaseCaseType.ParamsUpdate], args, false));
                    }
                    break;
                case CaseType_1.ViewerBaseCaseType.UpdateParams:
                    OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(self.dirctor, CaseType_1.DirctorCaseType.UpdateParams);
                    break;
                case CaseType_1.ViewerBaseCaseType.Report:
                    (_d = OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter).emit.apply(_d, __spreadArray([self.dirctor,
                        CaseType_1.DirctorCaseType.Report], args, false));
                    break;
                case CaseType_1.ViewerBaseCaseType.CheckPoint:
                    (_e = OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter).emit.apply(_e, __spreadArray([self.dirctor,
                        CaseType_1.DirctorCaseType.CheckPoint], args, false));
                    break;
                case CaseType_1.ViewerBaseCaseType.ReportCheckPointCount:
                    (_f = OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter).emit.apply(_f, __spreadArray([self.dirctor,
                        CaseType_1.DirctorCaseType.ReportCheckPointCount], args, false));
                    break;
                case CaseType_1.ViewerBaseCaseType.LoggerPush:
                    self.loggerPush(args[0], args[1]);
                    break;
                case CaseType_1.ViewerBaseCaseType.LoggerEmitEvent:
                    self.loggerEmitEvent(args[0]);
                    break;
                case CaseType_1.ViewerBaseCaseType.WeakNetWork:
                    (_g = OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter).emit.apply(_g, __spreadArray([self.dirctor,
                        CaseType_1.DirctorCaseType.WeakNetwork], args, false));
                    break;
            }
        });
    };
    ViewerElementHandler.prototype.loggerEmitEvent = function (eventData) {
        for (var _i = 0, _a = this.elements; _i < _a.length; _i++) {
            var element = _a[_i];
            if (element.getFrameBase().getUid() === eventData.u) {
                ViewEventManager_1.ViewEventManager.eventEmitter.emit(element, CaseType_1.ViewerElementBaseCaseType.LoggerEmitEvent, eventData.a);
                break;
            }
        }
    };
    ViewerElementHandler.prototype.loggerPush = function (userEvent, actionType) {
        OperaPlayerHandler_1.OperaPlayerHandler.eventEmitter.emit(this.dirctor, CaseType_1.DirctorCaseType.LoggerPush, {
            t: Types_1.LoggerType.ViewAction,
            l: {
                u: userEvent,
                a: actionType,
            },
        });
    };
    ViewerElementHandler.eventEmitter = new EventManager_1.default();
    return ViewerElementHandler;
}());
exports.ViewerElementHandler = ViewerElementHandler;


/***/ }),

/***/ "./src/lib/ViewEventManager.ts":
/*!*************************************!*\
  !*** ./src/lib/ViewEventManager.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.ViewEventManager = void 0;
var EventManager_1 = __importDefault(__webpack_require__(/*! ./EventManager */ "./src/lib/EventManager.ts"));
var ViewElementManager_1 = __webpack_require__(/*! ./ViewElementManager */ "./src/lib/ViewElementManager.ts");
var CaseType_1 = __webpack_require__(/*! ./CaseType */ "./src/lib/CaseType.ts");
// module 6492
var ViewEventManager = /** @class */ (function () {
    function ViewEventManager(viewer, frame) {
        this._watch = {};
        this.viewer = viewer;
        this.frame = frame;
        this.registerViewerEventListener();
    }
    Object.defineProperty(ViewEventManager.prototype, "watch", {
        get: function () {
            return this._watch;
        },
        set: function (value) {
            this._watch = value;
        },
        enumerable: false,
        configurable: true
    });
    ViewEventManager.prototype.getFrameBase = function () {
        return this.frame;
    };
    ViewEventManager.prototype.$emit = function (event) {
        this.frame.element.$emitEvent(event);
    };
    ViewEventManager.prototype.$logger = function (eventData) {
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.LoggerPush, this.frame.getUid(), eventData);
    };
    ViewEventManager.prototype.$update = function () {
        ViewElementManager_1.ViewerElementHandler.eventEmitter.emit(this.viewer, CaseType_1.ViewerBaseCaseType.UpdateParams);
    };
    ViewEventManager.prototype.created = function () {
    };
    ViewEventManager.prototype.updated = function (calculateValue) {
    };
    ViewEventManager.prototype.actived = function () {
    };
    ViewEventManager.prototype.destory = function () {
    };
    ViewEventManager.prototype.domMounted = function () {
    };
    ViewEventManager.prototype.onLoggerEvent = function (value) {
    };
    ViewEventManager.prototype.animation = function (resolvePromise, resolveCallback) {
        return new Promise(function (resolve) {
            resolve(true);
        });
    };
    ViewEventManager.prototype.getEvents = function (eventType) {
        return this.frame.element.getEvents(eventType);
    };
    ViewEventManager.prototype.getParams = function (paramArray) {
        var _this = this;
        if (!Array.isArray(paramArray)) {
            paramArray = [paramArray];
        }
        var parametersObject = {};
        paramArray.forEach(function (param) {
            var paramValue = _this.frame.element.getParam(param);
            if (paramValue) {
                parametersObject[param] = paramValue;
            }
        });
        return parametersObject;
    };
    ViewEventManager.prototype.registerViewerEventListener = function () {
        var self = this;
        ViewEventManager.eventEmitter.registerEvent(this, function (eventHandlerGlobalName) {
            var args = [];
            for (var _i = 1; _i < arguments.length; _i++) {
                args[_i - 1] = arguments[_i];
            }
            switch (eventHandlerGlobalName) {
                case CaseType_1.ViewerElementBaseCaseType.Created:
                    self.created();
                    break;
                case CaseType_1.ViewerElementBaseCaseType.Actived:
                    self.actived();
                    break;
                case CaseType_1.ViewerElementBaseCaseType.DomReady:
                    self.domMounted();
                    break;
                case CaseType_1.ViewerElementBaseCaseType.ParamChange:
                    var paramChangeIndex = args[2];
                    var responseValue = args[3];
                    var updatedParameter = args[4];
                    if (self.watch[paramChangeIndex]) {
                        self.watch[paramChangeIndex](updatedParameter, responseValue);
                    }
                    break;
                case CaseType_1.ViewerElementBaseCaseType.DestoryView:
                    self.destory();
                    break;
                case CaseType_1.ViewerElementBaseCaseType.ParamsUpdate:
                    self.updated(args[2]);
                    break;
                case CaseType_1.ViewerElementBaseCaseType.LoggerEmitEvent:
                    self.onLoggerEvent(args[1]);
                    break;
            }
        });
    };
    ViewEventManager.eventEmitter = new EventManager_1.default();
    return ViewEventManager;
}());
exports.ViewEventManager = ViewEventManager;


/***/ }),

/***/ "./src/lib/WasmSplitMonitor.ts":
/*!*************************************!*\
  !*** ./src/lib/WasmSplitMonitor.ts ***!
  \*************************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var TimeLogManager_1 = __webpack_require__(/*! ./TimeLogManager */ "./src/lib/TimeLogManager.ts");
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var DefaultLanguageMap_1 = __importDefault(__webpack_require__(/*! ./DefaultLanguageMap */ "./src/lib/DefaultLanguageMap.ts"));
var WasmSplitMonitor = /** @class */ (function () {
    function WasmSplitMonitor(unityManager, monitor) {
        this.loadSubWasmPackageStartTime = 0;
        this.loadSubWasmPackageCostTime = 0;
        this.timeAfterCallmain = 0;
        this.loadDurationCallmain = false;
        this.maxFetchPendingTime = 0;
        this.isFetching = false;
        this.suggestions = {
            loadDurationCallmain: DefaultLanguageMap_1.default.wasmSplitMonitor_loadDurationCallmain,
            loadSubwasmEarly: DefaultLanguageMap_1.default.wasmSplitMonitor_loadSubwasmEarly,
            longFetchPending: DefaultLanguageMap_1.default.wasmSplitMonitor_longFetchPending,
        };
        this.unityManager = unityManager;
        this.monitor = monitor;
        this.result = {};
    }
    WasmSplitMonitor.prototype.init = function () {
    };
    WasmSplitMonitor.prototype.startLoadSubWasm = function () {
        this.loadSubWasmPackageStartTime = Date.now();
        if (this.unityManager.mainCalled) {
            var elapsedTime = TimeLogManager_1.TimeLogManager.getRuntime();
            var launchData = this.unityManager.launchData.find(function (data) { return data.type === Types_1.GameLaunchStatus.PREPARE_GAME; });
            if (launchData) {
                this.timeAfterCallmain = elapsedTime - launchData.data.runTimeMs;
            }
        }
        else {
            this.loadDurationCallmain = true;
        }
    };
    WasmSplitMonitor.prototype.finishLoadSubWasm = function () {
        this.loadSubWasmPackageCostTime = Date.now() - this.loadSubWasmPackageStartTime;
    };
    WasmSplitMonitor.prototype.recordSyncFetchTime = function () {
        var _this = this;
        if (!this.isFetching && !this.monitor.endMonitor) {
            this.isFetching = true;
            var loadStartTime_1 = Date.now();
            if (!this.loadSubWasmPackageStartTime) {
                this.loadSubWasmPackageStartTime = loadStartTime_1;
                this.startLoadSubWasm();
            }
            setTimeout(function () {
                if (!_this.monitor.enableMonitor) {
                    var fetchDuration = Date.now() - loadStartTime_1;
                    if (fetchDuration > _this.maxFetchPendingTime) {
                        _this.maxFetchPendingTime = fetchDuration;
                    }
                    if (fetchDuration > 500) {
                        PluginLogger_1.default.monitorWarn("fetchjs等待耗时: ", fetchDuration);
                    }
                    _this.isFetching = false;
                }
            }, 0);
        }
    };
    WasmSplitMonitor.prototype.reset = function () {
        this.loadSubWasmPackageStartTime = 0;
        this.loadSubWasmPackageCostTime = 0;
        this.timeAfterCallmain = 0;
        this.loadDurationCallmain = false;
        this.maxFetchPendingTime = 0;
        this.result = {};
        this.suggestions = {};
    };
    WasmSplitMonitor.prototype.showResult = function () {
        this.result = this.getResultInfo();
        return this.checkResult();
    };
    WasmSplitMonitor.prototype.checkResult = function () {
        PluginLogger_1.default.monitorLog("----wasm分包监控 start----");
        PluginLogger_1.default.monitorLog("wasm分包基本信息: ", this.result);
        var result = this.result;
        var optimizationSuggestions = [];
        if (result.loadDurationCallmain) {
            optimizationSuggestions.push(this.suggestions.loadDurationCallmain);
        }
        if (result.costTimeAfterCallmain && +result.costTimeAfterCallmain < 30000) {
            optimizationSuggestions.push(this.suggestions.loadSubwasmEarly);
        }
        if (+result.maxFetchPendingTime > 2000) {
            optimizationSuggestions.push(this.suggestions.longFetchPending);
        }
        if (optimizationSuggestions.length) {
            PluginLogger_1.default.monitorWarn("".concat(DefaultLanguageMap_1.default.showResult_wasmOptAdvice, ":"));
            PluginLogger_1.default.monitorWarn(optimizationSuggestions.join("\n"));
        }
        PluginLogger_1.default.monitorLog("----wasm分包监控 end----");
        return optimizationSuggestions;
    };
    WasmSplitMonitor.prototype.getResultInfo = function () {
        return {
            loadSubWasmPackageStartTime: this.loadSubWasmPackageStartTime,
            loadSubWasmPackageCostTime: this.loadSubWasmPackageCostTime,
            loadDurationCallmain: this.loadDurationCallmain,
            maxFetchPendingTime: this.maxFetchPendingTime,
            costTimeAfterCallmain: this.timeAfterCallmain,
        };
    };
    return WasmSplitMonitor;
}());
exports["default"] = WasmSplitMonitor;


/***/ }),

/***/ "./src/lib/WebglRender.ts":
/*!********************************!*\
  !*** ./src/lib/WebglRender.ts ***!
  \********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
exports.WebglRenderManager = exports.WebglRenderManagerBase = void 0;
exports.compileShaderFromBuffer = compileShaderFromBuffer;
exports.initializeWebglRendering = initializeWebglRendering;
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var SystemUtils_1 = __webpack_require__(/*! ./SystemUtils */ "./src/lib/SystemUtils.ts");
var GameCanvas_1 = __importDefault(__webpack_require__(/*! ./GameCanvas */ "./src/lib/GameCanvas.ts"));
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
function compileShaderFromBuffer(webglContext, shaderFragment, type) {
    var shader = webglContext.createShader(type);
    if (!shader) {
        throw new Error("Error createShader: type ".concat(type));
    }
    webglContext.shaderSource(shader, shaderFragment);
    webglContext.compileShader(shader);
    if (!webglContext.getShaderParameter(shader, webglContext.COMPILE_STATUS)) {
        console.error("Error compiling shader: ".concat(webglContext.getShaderInfoLog(shader)));
    }
    return shader;
}
var webglStaticDrawU32 = [-1, -1, 0, 1, -1, 0, 1, 1, 0, -1, 1, 0,];
var webglStaticDrawU16 = [0, 1, 2, 0, 2, 3];
var webglStaticDrawUArrayBuffer32 = [0, 0, 1, 0, 1, 1, 0, 1];
function initializeWebglRendering(webglContext, screenWidth, screenHeight) {
    var systemInfo = SystemEnvironmentVariables_1.default.systemInfo;
    if (webglContext) {
        webglContext.canvas.width = screenWidth * systemInfo.pixelRatio;
        webglContext.canvas.height = screenHeight * systemInfo.pixelRatio;
        webglContext.viewport(0, 0, webglContext.drawingBufferWidth, webglContext.drawingBufferHeight);
        webglContext.frontFace(webglContext.CCW);
        var vertexShader = compileShaderFromBuffer(webglContext, "\n  attribute vec3 aPos;\n  attribute vec2 aVertexTextureCoord;\n  varying highp vec2 vTextureCoord;\n\n  void main(void){\n    gl_Position = vec4(aPos, 1);\n    vTextureCoord = aVertexTextureCoord;\n  }\n", webglContext.VERTEX_SHADER);
        var fragmentShader = compileShaderFromBuffer(webglContext, "\n  varying highp vec2 vTextureCoord;\n  uniform sampler2D uSampler;\n\n  void main(void) {\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n  }\n", webglContext.FRAGMENT_SHADER);
        var shaderProgram = webglContext.createProgram();
        webglContext.attachShader(shaderProgram, vertexShader);
        webglContext.attachShader(shaderProgram, fragmentShader);
        webglContext.linkProgram(shaderProgram);
        if (webglContext.getProgramParameter(shaderProgram, webglContext.LINK_STATUS)) {
            webglContext.useProgram(shaderProgram);
            var texture_1 = webglContext.createTexture();
            webglContext.activeTexture(webglContext.TEXTURE0);
            webglContext.bindTexture(webglContext.TEXTURE_2D, texture_1);
            webglContext.texParameteri(webglContext.TEXTURE_2D, webglContext.TEXTURE_MAG_FILTER, webglContext.NEAREST);
            webglContext.texParameteri(webglContext.TEXTURE_2D, webglContext.TEXTURE_MIN_FILTER, webglContext.NEAREST);
            webglContext.texParameteri(webglContext.TEXTURE_2D, webglContext.TEXTURE_WRAP_S, webglContext.CLAMP_TO_EDGE);
            webglContext.texParameteri(webglContext.TEXTURE_2D, webglContext.TEXTURE_WRAP_T, webglContext.CLAMP_TO_EDGE);
            webglContext.bindTexture(webglContext.TEXTURE_2D, null);
            webglContext.bindBuffer(webglContext.ARRAY_BUFFER, webglContext.createBuffer());
            webglContext.bufferData(webglContext.ARRAY_BUFFER, new Float32Array(webglStaticDrawU32), webglContext.STATIC_DRAW);
            webglContext.bindBuffer(webglContext.ELEMENT_ARRAY_BUFFER, webglContext.createBuffer());
            webglContext.bufferData(webglContext.ELEMENT_ARRAY_BUFFER, new Uint16Array(webglStaticDrawU16), webglContext.STATIC_DRAW);
            var aPosLocation = webglContext.getAttribLocation(shaderProgram, "aPos");
            webglContext.vertexAttribPointer(aPosLocation, 3, webglContext.FLOAT, false, 0, 0);
            webglContext.enableVertexAttribArray(aPosLocation);
            webglContext.createBuffer();
            webglContext.bindBuffer(webglContext.ARRAY_BUFFER, webglContext.createBuffer());
            webglContext.bufferData(webglContext.ARRAY_BUFFER, new Float32Array(webglStaticDrawUArrayBuffer32), webglContext.STATIC_DRAW);
            var location_1 = webglContext.getAttribLocation(shaderProgram, "aVertexTextureCoord");
            webglContext.enableVertexAttribArray(location_1);
            webglContext.vertexAttribPointer(location_1, 2, webglContext.FLOAT, false, 0, 0);
            var vertexIndiceBuffer = webglContext.getUniformLocation(shaderProgram, "uSampler");
            webglContext.uniform1i(vertexIndiceBuffer, 0);
            return function (source) {
                webglContext.clearColor(0, 0, 0, 0);
                webglContext.clear(webglContext.COLOR_BUFFER_BIT);
                webglContext.pixelStorei(webglContext.UNPACK_FLIP_Y_WEBGL, true);
                webglContext.bindTexture(webglContext.TEXTURE_2D, texture_1);
                webglContext.texImage2D(webglContext.TEXTURE_2D, 0, webglContext.RGBA, webglContext.RGBA, webglContext.UNSIGNED_BYTE, source);
                webglContext.drawElements(webglContext.TRIANGLES, 6, webglContext.UNSIGNED_SHORT, 0);
                webglContext.pixelStorei(webglContext.UNPACK_FLIP_Y_WEBGL, false);
            };
        }
        console.error("Unable to initialize the shader program.");
    }
    else {
        console.error("Unable to get webgl context.");
    }
}
var WebglRenderManagerBase = /** @class */ (function () {
    function WebglRenderManagerBase(useCoverView) {
        this.useCoverView = useCoverView;
        this.renderer = null;
        this.offscreenCanvas = null;
        if (!this.useCoverView) {
            this.init();
        }
    }
    WebglRenderManagerBase.prototype.refresh = function () {
        var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight;
        if (!this.useCoverView) {
            var gameCanvas = GameCanvas_1.default.getInstance();
            var webglContext = gameCanvas.canvas.getContext("webgl", {
                alpha: 1,
            });
            this.renderer = initializeWebglRendering(webglContext, screenWidth, screenHeight);
        }
    };
    WebglRenderManagerBase.prototype.init = function () {
        var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight, pixelRatio = _a.pixelRatio;
        if (!WebglRenderManagerBase.instance) {
            var unityGlobalGL = GameGlobalVars_1.default.unityNamespace.globalGL;
            var renderer = initializeWebglRendering(unityGlobalGL, screenWidth, screenHeight);
            var canvas = SystemEnvironmentVariables_1.default.tjInstance.createCanvas();
            canvas.width = screenWidth * pixelRatio;
            canvas.height = screenHeight * pixelRatio;
            this.renderer = renderer;
            this.offscreenCanvas = canvas;
            this.offscreenCtx = canvas.getContext("2d");
            WebglRenderManagerBase.instance = this;
        }
    };
    WebglRenderManagerBase.getInstance = function () {
        return WebglRenderManagerBase.instance;
    };
    WebglRenderManagerBase.getRenderer = function () {
        return WebglRenderManagerBase.instance;
    };
    return WebglRenderManagerBase;
}());
exports.WebglRenderManagerBase = WebglRenderManagerBase;
var WebglRenderManager = /** @class */ (function (_super) {
    __extends(WebglRenderManager, _super);
    function WebglRenderManager(useCoverView) {
        var _this = _super.call(this, useCoverView) || this;
        _this.destroyed = false;
        return _this;
    }
    WebglRenderManager.prototype.renderProgress = function (text, progressTracker) {
        if (progressTracker === void 0) { progressTracker = {
            progress: 0,
            originContent: ""
        }; }
        var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight, pixelRatio = _a.pixelRatio, safeArea = _a.safeArea;
        var progressValue = progressTracker.progress;
        var originContent = progressTracker.originContent;
        var renderer = this.renderer;
        var offscreenCanvas = this.offscreenCanvas;
        var offscreenContext = this.offscreenCtx;
        var safeAreaOffset = screenHeight - safeArea.bottom;
        if (offscreenContext) {
            offscreenContext.clearRect(0, 0, (0, SystemUtils_1.convertToRealDevicePixels)(screenWidth), (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight));
            offscreenContext.fillStyle = "rgba(0, 0, 0, 0.3)";
            offscreenContext.fillRect(0, (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight - 48 - safeAreaOffset), (0, SystemUtils_1.convertToRealDevicePixels)(screenWidth), (0, SystemUtils_1.convertToRealDevicePixels)(48 + safeAreaOffset));
            offscreenContext.fillStyle = "rgb(151, 151, 151)";
            offscreenContext.fillRect((0, SystemUtils_1.convertToRealDevicePixels)((screenWidth - 320) / 2), (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight - 36 - safeAreaOffset), (0, SystemUtils_1.convertToRealDevicePixels)(320), (0, SystemUtils_1.convertToRealDevicePixels)(4));
            offscreenContext.fillStyle = "rgba(255, 255, 255, 1)";
            offscreenContext.fillRect((0, SystemUtils_1.convertToRealDevicePixels)((screenWidth - 320) / 2), (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight - 36 - safeAreaOffset), (0, SystemUtils_1.convertToRealDevicePixels)(parseInt(String(progressValue * 320), 10)), (0, SystemUtils_1.convertToRealDevicePixels)(4));
            offscreenContext.font = "".concat((0, SystemUtils_1.convertToRealDevicePixels)(14), "px serif");
            offscreenContext.fillStyle = "#fff";
            var measuredTextWidth = 0;
            if (originContent) {
                measuredTextWidth = offscreenContext.measureText(originContent).width;
                offscreenContext.textAlign = "start";
            }
            else {
                offscreenContext.textAlign = "center";
            }
            offscreenContext.fillText("".concat(text), (0, SystemUtils_1.convertToRealDevicePixels)((screenWidth - measuredTextWidth / pixelRatio) / 2), (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight - 12 - safeAreaOffset));
            renderer(offscreenCanvas);
        }
    };
    WebglRenderManager.prototype.hideProgress = function () {
        var _a = SystemEnvironmentVariables_1.default.systemInfo, screenWidth = _a.screenWidth, screenHeight = _a.screenHeight;
        if (!this.destroyed && !this.useCoverView) {
            this.destroyed = true;
            var globalGraphicsLibrary = GameGlobalVars_1.default.unityNamespace.globalGL;
            this.offscreenCtx.clearRect(0, 0, (0, SystemUtils_1.convertToRealDevicePixels)(screenWidth), (0, SystemUtils_1.convertToRealDevicePixels)(screenHeight));
            this.renderer = null;
            this.offscreenCanvas = null;
            this.offscreenCtx = null;
            globalGraphicsLibrary.clearColor(0, 0, 0, 0);
            globalGraphicsLibrary.clear(globalGraphicsLibrary.COLOR_BUFFER_BIT);
        }
    };
    return WebglRenderManager;
}(WebglRenderManagerBase));
exports.WebglRenderManager = WebglRenderManager;


/***/ }),

/***/ "./src/lib/WorkerManager.ts":
/*!**********************************!*\
  !*** ./src/lib/WorkerManager.ts ***!
  \**********************************/
/***/ (function(__unused_webpack_module, exports, __webpack_require__) {


var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __generator = (this && this.__generator) || function (thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === "function" ? Iterator : Object).prototype);
    return g.next = verb(0), g["throw"] = verb(1), g["return"] = verb(2), typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (g && (g = 0, op[0] && (_ = 0)), _) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", ({ value: true }));
var Instance_1 = __importDefault(__webpack_require__(/*! ./Instance */ "./src/lib/Instance.ts"));
var PluginLogger_1 = __importDefault(__webpack_require__(/*! ./PluginLogger */ "./src/lib/PluginLogger.ts"));
var Types_1 = __webpack_require__(/*! ./Types */ "./src/lib/Types.ts");
var GameFeatures_1 = __webpack_require__(/*! ./GameFeatures */ "./src/lib/GameFeatures.ts");
var SystemEnvironmentVariables_1 = __importDefault(__webpack_require__(/*! ./SystemEnvironmentVariables */ "./src/lib/SystemEnvironmentVariables.ts"));
var EventEmitter_1 = __webpack_require__(/*! ./EventEmitter */ "./src/lib/EventEmitter.ts");
var GameGlobalVars_1 = __importDefault(__webpack_require__(/*! ./GameGlobalVars */ "./src/lib/GameGlobalVars.ts"));
var WorkerManager = /** @class */ (function (_super) {
    __extends(WorkerManager, _super);
    function WorkerManager() {
        var _this = _super.call(this) || this;
        _this.listener = new Set();
        _this.inited = false;
        _this.supportWorkerFs = false;
        _this.supportSharedBuffer = false;
        _this.hasSetQuotaStatus = false;
        return _this;
    }
    WorkerManager.prototype.init = function () {
        var _this = this;
        var setFileSpaceStatistics = SystemEnvironmentVariables_1.default.pluginEnv.setFileSpaceStatistics;
        try {
            this.worker = SystemEnvironmentVariables_1.default.tjInstance.createWorker("workers/response/index.js");
            if (this.worker) {
                this.inited = true;
                this.postSystemInfo();
                this.bindEvent();
                if (GameGlobalVars_1.default.customEvents) {
                    GameGlobalVars_1.default.customEvents.emit(Types_1.GameLaunchStatusDetail.CreateWorker, this.worker);
                }
            }
            if (setFileSpaceStatistics) {
                var enable_1 = GameFeatures_1.gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.FileQuota) === Types_1.TransferStatus.open;
                setFileSpaceStatistics({
                    enable: enable_1,
                    success: function () {
                        _this.hasSetQuotaStatus = true;
                        _this.supportWorkerFs = !enable_1;
                    },
                    fail: function (error) {
                        GameFeatures_1.gameFeatures.set(GameFeatures_1.GameFeatureConfigKeys.FileQuota, Types_1.TransferStatus.close);
                        PluginLogger_1.default.pluginWarn("切换quotacontrol失败: ", error);
                    },
                    complete: function () {
                        _this.printStatus();
                    },
                });
            }
        }
        catch (error) {
            PluginLogger_1.default.pluginError("创建worker失败", error);
            this.printStatus();
        }
    };
    WorkerManager.prototype.postSystemInfo = function () {
        this.worker.postMessage({
            type: Types_1.WorkerTypes.config,
            payload: {
                systemInfo: SystemEnvironmentVariables_1.default.systemInfo,
            },
        });
    };
    WorkerManager.prototype.printStatus = function () {
        if (this.supportWorkerFs) {
            return PluginLogger_1.default.eventLog("使用worker写文件");
        }
        var setFileSpaceStatistics = SystemEnvironmentVariables_1.default.pluginEnv.setFileSpaceStatistics;
        var isFileQuotaOpen = GameFeatures_1.gameFeatures.get(GameFeatures_1.GameFeatureConfigKeys.FileQuota) === Types_1.TransferStatus.open;
        PluginLogger_1.default.eventLog(setFileSpaceStatistics &&
            isFileQuotaOpen &&
            SystemEnvironmentVariables_1.default.isAndroid ? "使用主线程+quotacontrol写文件" : "使用主线程写文件");
    };
    WorkerManager.prototype.bindEvent = function () {
        var _this = this;
        var setFileSpaceStatistics = SystemEnvironmentVariables_1.default.pluginEnv.setFileSpaceStatistics;
        this.worker.onMessage(function (message) {
            var actionType = message.type;
            var actionPayload = message.payload;
            if (actionType === Types_1.WorkerTypes.writeFile) {
                EventEmitter_1.eventEmitter.emit("writeFile:".concat(actionPayload.filePath), actionPayload);
            }
            if (actionType === Types_1.WorkerTypes.config) {
                if (!_this.hasSetQuotaStatus) {
                    _this.supportWorkerFs = actionPayload.supportWorkerFs;
                }
                _this.supportSharedBuffer = actionPayload.supportSharedBuffer;
                if (!setFileSpaceStatistics) {
                    _this.printStatus();
                }
            }
        });
    };
    WorkerManager.prototype.writeFile = function (file) {
        return __awaiter(this, void 0, void 0, function () {
            var _this = this;
            return __generator(this, function (_a) {
                return [2 /*return*/, new Promise(function (resolve, reject) {
                        var filePath = file.filePath;
                        var fileData = file.data;
                        if (!_this.listener.has(filePath)) {
                            _this.listener.add(filePath);
                            var sharedArrayBuffer = fileData;
                            if (_this.supportSharedBuffer) {
                                sharedArrayBuffer = SystemEnvironmentVariables_1.default.tjInstance.createSharedArrayBuffer(fileData.byteLength);
                                new Uint8Array(sharedArrayBuffer.buffer).set(new Uint8Array(fileData));
                            }
                            _this.worker.postMessage({
                                type: Types_1.WorkerTypes.writeFile,
                                payload: {
                                    isSharedBuffer: _this.supportSharedBuffer,
                                    filePath: filePath,
                                    data: sharedArrayBuffer,
                                },
                            });
                            EventEmitter_1.eventEmitter.once("writeFile:".concat(filePath), function (result) {
                                _this.listener.delete(filePath);
                                if (result.isok) {
                                    resolve();
                                }
                                else {
                                    reject(result.err);
                                }
                            });
                        }
                    })];
            });
        });
    };
    return WorkerManager;
}(Instance_1.default));
exports["default"] = WorkerManager;


/***/ }),

/***/ "./src/coverview/pixi.min.js":
/*!***********************************!*\
  !*** ./src/coverview/pixi.min.js ***!
  \***********************************/
/***/ ((module, exports, __webpack_require__) => {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*!
 * pixi.js - v4.8.8
 * Compiled Sun, 02 Jun 2019 22:37:26 UTC
 *
 * pixi.js is licensed under the MIT License.
 * http://www.opensource.org/licenses/mit-license
 */

window.document = GameGlobal.pluginEnv.customEnv.document;
window.unityNamespace = GameGlobal.pluginEnv.customEnv.unityNamespace;
window.canvas = GameGlobal.pluginEnv.customEnv.canvas;
window.events = GameGlobal.pluginEnv.customEnv.events;
window.KSWASMSDK = GameGlobal.pluginEnv.customEnv.KSWASMSDK;
document = window.document;
canvas = window.canvas;
var XMLHttpRequest = window.unityNamespace.XMLHttpRequest;
var ksh = GameGlobal.pluginEnv.customEnv.ksh;
window.Image = function() {
 return ksh.createImage();
};
var platform = ksh.getSystemInfoSync().platform;
var navigator = {
  platform: platform,
  language: 'zh-cn',
  appVersion: '5.0 (iPhone; CPU iPhone OS 9_1 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1',
  userAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/zh_CN',
  onLine: true,
  msPointerEnabled: false
};
window.navigator = navigator;
window.location = {
  origin: "1"
};
window.origin = "2";
window.addEventListener = (e, t) => {
  document.addEventListener(e, t);
};
window.removeEventListener = (e, t) => {
  document.removeEventListener(e, t);
};
function _typeof(o) {
  "@babel/helpers - typeof";
  return _typeof = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function (o) {
    return typeof o;
  } : function (o) {
    return o && "function" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? "symbol" : typeof o;
  }, _typeof(o);
}! function (t) {
  if ("object" == ( false ? 0 : _typeof(exports)) && "undefined" != "object") module.exports = t();
  else if (true) !(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (t),
		__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
		(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
		__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
  else { var e; }
}(function () {
  var t;
  return function () {
    function t(e, r, n) {
      function i(s, a) {
        if (!r[s]) {
          if (!e[s]) {
            var u = undefined;
            if (!a && u) return require(s, !0);
            if (o) return o(s, !0);
            var h = new Error("Cannot find module '" + s + "'");
            throw h.code = "MODULE_NOT_FOUND", h;
          }
          var l = r[s] = {
            exports: {}
          };
          e[s][0].call(l.exports, function (t) {
            var r = e[s][1][t];
            return i(r || t);
          }, l, l.exports, t, e, r, n);
        }
        return r[s].exports;
      }
      for (var o = undefined, s = 0; s < n.length; s++) i(n[s]);
      return i;
    }
    return t;
  }()({
    1: [function (t, e, r) {
      "use strict";
      "use restrict";

      function n(t) {
        var e = 32;
        return t &= -t, t && e--, 65535 & t && (e -= 16), 16711935 & t && (e -= 8), 252645135 & t && (e -= 4), 858993459 & t && (e -= 2), 1431655765 & t && (e -= 1), e;
      }
      r.INT_BITS = 32, r.INT_MAX = 2147483647, r.INT_MIN = -1 << 31, r.sign = function (t) {
        return (t > 0) - (t < 0);
      }, r.abs = function (t) {
        var e = t >> 31;
        return (t ^ e) - e;
      }, r.min = function (t, e) {
        return e ^ (t ^ e) & -(t < e);
      }, r.max = function (t, e) {
        return t ^ (t ^ e) & -(t < e);
      }, r.isPow2 = function (t) {
        return !(t & t - 1 || !t);
      }, r.log2 = function (t) {
        var e, r;
        return e = (t > 65535) << 4, t >>>= e, r = (t > 255) << 3, t >>>= r, e |= r, r = (t > 15) << 2, t >>>= r, e |= r, r = (t > 3) << 1, t >>>= r, (e |= r) | t >> 1;
      }, r.log10 = function (t) {
        return t >= 1e9 ? 9 : t >= 1e8 ? 8 : t >= 1e7 ? 7 : t >= 1e6 ? 6 : t >= 1e5 ? 5 : t >= 1e4 ? 4 : t >= 1e3 ? 3 : t >= 100 ? 2 : t >= 10 ? 1 : 0;
      }, r.popCount = function (t) {
        return t -= t >>> 1 & 1431655765, 16843009 * ((t = (858993459 & t) + (t >>> 2 & 858993459)) + (t >>> 4) & 252645135) >>> 24;
      }, r.countTrailingZeros = n, r.nextPow2 = function (t) {
        return t += 0 === t, --t, t |= t >>> 1, t |= t >>> 2, t |= t >>> 4, t |= t >>> 8, (t |= t >>> 16) + 1;
      }, r.prevPow2 = function (t) {
        return t |= t >>> 1, t |= t >>> 2, t |= t >>> 4, t |= t >>> 8, (t |= t >>> 16) - (t >>> 1);
      }, r.parity = function (t) {
        return t ^= t >>> 16, t ^= t >>> 8, t ^= t >>> 4, 27030 >>> (t &= 15) & 1;
      };
      var i = new Array(256);
      ! function (t) {
        for (var e = 0; e < 256; ++e) {
          var r = e,
            n = e,
            i = 7;
          for (r >>>= 1; r; r >>>= 1) n <<= 1, n |= 1 & r, --i;
          t[e] = n << i & 255;
        }
      }(i), r.reverse = function (t) {
        return i[255 & t] << 24 | i[t >>> 8 & 255] << 16 | i[t >>> 16 & 255] << 8 | i[t >>> 24 & 255];
      }, r.interleave2 = function (t, e) {
        return t &= 65535, t = 16711935 & (t | t << 8), t = 252645135 & (t | t << 4), t = 858993459 & (t | t << 2), t = 1431655765 & (t | t << 1), e &= 65535, e = 16711935 & (e | e << 8), e = 252645135 & (e | e << 4), e = 858993459 & (e | e << 2), e = 1431655765 & (e | e << 1), t | e << 1;
      }, r.deinterleave2 = function (t, e) {
        return t = t >>> e & 1431655765, t = 858993459 & (t | t >>> 1), t = 252645135 & (t | t >>> 2), t = 16711935 & (t | t >>> 4), (t = 65535 & (t | t >>> 16)) << 16 >> 16;
      }, r.interleave3 = function (t, e, r) {
        return t &= 1023, t = 4278190335 & (t | t << 16), t = 251719695 & (t | t << 8), t = 3272356035 & (t | t << 4), t = 1227133513 & (t | t << 2), e &= 1023, e = 4278190335 & (e | e << 16), e = 251719695 & (e | e << 8), e = 3272356035 & (e | e << 4), e = 1227133513 & (e | e << 2), t |= e << 1, r &= 1023, r = 4278190335 & (r | r << 16), r = 251719695 & (r | r << 8), r = 3272356035 & (r | r << 4), r = 1227133513 & (r | r << 2), t | r << 2;
      }, r.deinterleave3 = function (t, e) {
        return t = t >>> e & 1227133513, t = 3272356035 & (t | t >>> 2), t = 251719695 & (t | t >>> 4), t = 4278190335 & (t | t >>> 8), (t = 1023 & (t | t >>> 16)) << 22 >> 22;
      }, r.nextCombination = function (t) {
        var e = t | t - 1;
        return e + 1 | (~e & -~e) - 1 >>> n(t) + 1;
      };
    }, {}],
    2: [function (t, e, r) {
      "use strict";

      function n(t, e, r) {
        r = r || 2;
        var n = e && e.length,
          o = n ? e[0] * r : t.length,
          a = i(t, 0, o, r, !0),
          u = [];
        if (!a || a.next === a.prev) return u;
        var h, l, d, f, p, v, g;
        if (n && (a = c(t, e, a, r)), t.length > 80 * r) {
          h = d = t[0], l = f = t[1];
          for (var y = r; y < o; y += r) p = t[y], v = t[y + 1], p < h && (h = p), v < l && (l = v), p > d && (d = p), v > f && (f = v);
          g = Math.max(d - h, f - l), g = 0 !== g ? 1 / g : 0;
        }
        return s(a, u, r, h, l, g), u;
      }

      function i(t, e, r, n, i) {
        var o, s;
        if (i === A(t, e, r, n) > 0)
          for (o = e; o < r; o += n) s = P(o, t[o], t[o + 1], s);
        else
          for (o = r - n; o >= e; o -= n) s = P(o, t[o], t[o + 1], s);
        return s && T(s, s.next) && (C(s), s = s.next), s;
      }

      function o(t, e) {
        if (!t) return t;
        e || (e = t);
        var r,
          n = t;
        do {
          if (r = !1, n.steiner || !T(n, n.next) && 0 !== x(n.prev, n, n.next)) n = n.next;
          else {
            if (C(n), (n = e = n.prev) === n.next) break;
            r = !0;
          }
        } while (r || n !== e);
        return e;
      }

      function s(t, e, r, n, i, c, d) {
        if (t) {
          !d && c && v(t, n, i, c);
          for (var f, p, g = t; t.prev !== t.next;)
            if (f = t.prev, p = t.next, c ? u(t, n, i, c) : a(t)) e.push(f.i / r), e.push(t.i / r), e.push(p.i / r), C(t), t = p.next, g = p.next;
            else if ((t = p) === g) {
            d ? 1 === d ? (t = h(t, e, r), s(t, e, r, n, i, c, 2)) : 2 === d && l(t, e, r, n, i, c) : s(o(t), e, r, n, i, c, 1);
            break;
          }
        }
      }

      function a(t) {
        var e = t.prev,
          r = t,
          n = t.next;
        if (x(e, r, n) >= 0) return !1;
        for (var i = t.next.next; i !== t.prev;) {
          if (_(e.x, e.y, r.x, r.y, n.x, n.y, i.x, i.y) && x(i.prev, i, i.next) >= 0) return !1;
          i = i.next;
        }
        return !0;
      }

      function u(t, e, r, n) {
        var i = t.prev,
          o = t,
          s = t.next;
        if (x(i, o, s) >= 0) return !1;
        for (var a = i.x < o.x ? i.x < s.x ? i.x : s.x : o.x < s.x ? o.x : s.x, u = i.y < o.y ? i.y < s.y ? i.y : s.y : o.y < s.y ? o.y : s.y, h = i.x > o.x ? i.x > s.x ? i.x : s.x : o.x > s.x ? o.x : s.x, l = i.y > o.y ? i.y > s.y ? i.y : s.y : o.y > s.y ? o.y : s.y, c = y(a, u, e, r, n), d = y(h, l, e, r, n), f = t.prevZ, p = t.nextZ; f && f.z >= c && p && p.z <= d;) {
          if (f !== t.prev && f !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, f.x, f.y) && x(f.prev, f, f.next) >= 0) return !1;
          if (f = f.prevZ, p !== t.prev && p !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, p.x, p.y) && x(p.prev, p, p.next) >= 0) return !1;
          p = p.nextZ;
        }
        for (; f && f.z >= c;) {
          if (f !== t.prev && f !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, f.x, f.y) && x(f.prev, f, f.next) >= 0) return !1;
          f = f.prevZ;
        }
        for (; p && p.z <= d;) {
          if (p !== t.prev && p !== t.next && _(i.x, i.y, o.x, o.y, s.x, s.y, p.x, p.y) && x(p.prev, p, p.next) >= 0) return !1;
          p = p.nextZ;
        }
        return !0;
      }

      function h(t, e, r) {
        var n = t;
        do {
          var i = n.prev,
            o = n.next.next;
          !T(i, o) && w(i, n, n.next, o) && S(i, o) && S(o, i) && (e.push(i.i / r), e.push(n.i / r), e.push(o.i / r), C(n), C(n.next), n = t = o), n = n.next;
        } while (n !== t);
        return n;
      }

      function l(t, e, r, n, i, a) {
        var u = t;
        do {
          for (var h = u.next.next; h !== u.prev;) {
            if (u.i !== h.i && b(u, h)) {
              var l = M(u, h);
              return u = o(u, u.next), l = o(l, l.next), s(u, e, r, n, i, a), void s(l, e, r, n, i, a);
            }
            h = h.next;
          }
          u = u.next;
        } while (u !== t);
      }

      function c(t, e, r, n) {
        var s,
          a,
          u,
          h,
          l,
          c = [];
        for (s = 0, a = e.length; s < a; s++) u = e[s] * n, h = s < a - 1 ? e[s + 1] * n : t.length, l = i(t, u, h, n, !1), l === l.next && (l.steiner = !0), c.push(m(l));
        for (c.sort(d), s = 0; s < c.length; s++) f(c[s], r), r = o(r, r.next);
        return r;
      }

      function d(t, e) {
        return t.x - e.x;
      }

      function f(t, e) {
        if (e = p(t, e)) {
          var r = M(e, t);
          o(r, r.next);
        }
      }

      function p(t, e) {
        var r,
          n = e,
          i = t.x,
          o = t.y,
          s = -1 / 0;
        do {
          if (o <= n.y && o >= n.next.y && n.next.y !== n.y) {
            var a = n.x + (o - n.y) * (n.next.x - n.x) / (n.next.y - n.y);
            if (a <= i && a > s) {
              if (s = a, a === i) {
                if (o === n.y) return n;
                if (o === n.next.y) return n.next;
              }
              r = n.x < n.next.x ? n : n.next;
            }
          }
          n = n.next;
        } while (n !== e);
        if (!r) return null;
        if (i === s) return r.prev;
        var u,
          h = r,
          l = r.x,
          c = r.y,
          d = 1 / 0;
        for (n = r.next; n !== h;) i >= n.x && n.x >= l && i !== n.x && _(o < c ? i : s, o, l, c, o < c ? s : i, o, n.x, n.y) && ((u = Math.abs(o - n.y) / (i - n.x)) < d || u === d && n.x > r.x) && S(n, t) && (r = n, d = u), n = n.next;
        return r;
      }

      function v(t, e, r, n) {
        var i = t;
        do {
          null === i.z && (i.z = y(i.x, i.y, e, r, n)), i.prevZ = i.prev, i.nextZ = i.next, i = i.next;
        } while (i !== t);
        i.prevZ.nextZ = null, i.prevZ = null, g(i);
      }

      function g(t) {
        var e,
          r,
          n,
          i,
          o,
          s,
          a,
          u,
          h = 1;
        do {
          for (r = t, t = null, o = null, s = 0; r;) {
            for (s++, n = r, a = 0, e = 0; e < h && (a++, n = n.nextZ); e++);
            for (u = h; a > 0 || u > 0 && n;) 0 !== a && (0 === u || !n || r.z <= n.z) ? (i = r, r = r.nextZ, a--) : (i = n, n = n.nextZ, u--), o ? o.nextZ = i : t = i, i.prevZ = o, o = i;
            r = n;
          }
          o.nextZ = null, h *= 2;
        } while (s > 1);
        return t;
      }

      function y(t, e, r, n, i) {
        return t = 32767 * (t - r) * i, e = 32767 * (e - n) * i, t = 16711935 & (t | t << 8), t = 252645135 & (t | t << 4), t = 858993459 & (t | t << 2), t = 1431655765 & (t | t << 1), e = 16711935 & (e | e << 8), e = 252645135 & (e | e << 4), e = 858993459 & (e | e << 2), e = 1431655765 & (e | e << 1), t | e << 1;
      }

      function m(t) {
        var e = t,
          r = t;
        do {
          e.x < r.x && (r = e), e = e.next;
        } while (e !== t);
        return r;
      }

      function _(t, e, r, n, i, o, s, a) {
        return (i - s) * (e - a) - (t - s) * (o - a) >= 0 && (t - s) * (n - a) - (r - s) * (e - a) >= 0 && (r - s) * (o - a) - (i - s) * (n - a) >= 0;
      }

      function b(t, e) {
        return t.next.i !== e.i && t.prev.i !== e.i && !E(t, e) && S(t, e) && S(e, t) && O(t, e);
      }

      function x(t, e, r) {
        return (e.y - t.y) * (r.x - e.x) - (e.x - t.x) * (r.y - e.y);
      }

      function T(t, e) {
        return t.x === e.x && t.y === e.y;
      }

      function w(t, e, r, n) {
        return !!(T(t, e) && T(r, n) || T(t, n) && T(r, e)) || x(t, e, r) > 0 != x(t, e, n) > 0 && x(r, n, t) > 0 != x(r, n, e) > 0;
      }

      function E(t, e) {
        var r = t;
        do {
          if (r.i !== t.i && r.next.i !== t.i && r.i !== e.i && r.next.i !== e.i && w(r, r.next, t, e)) return !0;
          r = r.next;
        } while (r !== t);
        return !1;
      }

      function S(t, e) {
        return x(t.prev, t, t.next) < 0 ? x(t, e, t.next) >= 0 && x(t, t.prev, e) >= 0 : x(t, e, t.prev) < 0 || x(t, t.next, e) < 0;
      }

      function O(t, e) {
        var r = t,
          n = !1,
          i = (t.x + e.x) / 2,
          o = (t.y + e.y) / 2;
        do {
          r.y > o != r.next.y > o && r.next.y !== r.y && i < (r.next.x - r.x) * (o - r.y) / (r.next.y - r.y) + r.x && (n = !n), r = r.next;
        } while (r !== t);
        return n;
      }

      function M(t, e) {
        var r = new R(t.i, t.x, t.y),
          n = new R(e.i, e.x, e.y),
          i = t.next,
          o = e.prev;
        return t.next = e, e.prev = t, r.next = i, i.prev = r, n.next = r, r.prev = n, o.next = n, n.prev = o, n;
      }

      function P(t, e, r, n) {
        var i = new R(t, e, r);
        return n ? (i.next = n.next, i.prev = n, n.next.prev = i, n.next = i) : (i.prev = i, i.next = i), i;
      }

      function C(t) {
        t.next.prev = t.prev, t.prev.next = t.next, t.prevZ && (t.prevZ.nextZ = t.nextZ), t.nextZ && (t.nextZ.prevZ = t.prevZ);
      }

      function R(t, e, r) {
        this.i = t, this.x = e, this.y = r, this.prev = null, this.next = null, this.z = null, this.prevZ = null, this.nextZ = null, this.steiner = !1;
      }

      function A(t, e, r, n) {
        for (var i = 0, o = e, s = r - n; o < r; o += n) i += (t[s] - t[o]) * (t[o + 1] + t[s + 1]), s = o;
        return i;
      }
      e.exports = n, e.exports["default"] = n, n.deviation = function (t, e, r, n) {
        var i = e && e.length,
          o = i ? e[0] * r : t.length,
          s = Math.abs(A(t, 0, o, r));
        if (i)
          for (var a = 0, u = e.length; a < u; a++) {
            var h = e[a] * r,
              l = a < u - 1 ? e[a + 1] * r : t.length;
            s -= Math.abs(A(t, h, l, r));
          }
        var c = 0;
        for (a = 0; a < n.length; a += 3) {
          var d = n[a] * r,
            f = n[a + 1] * r,
            p = n[a + 2] * r;
          c += Math.abs((t[d] - t[p]) * (t[f + 1] - t[d + 1]) - (t[d] - t[f]) * (t[p + 1] - t[d + 1]));
        }
        return 0 === s && 0 === c ? 0 : Math.abs((c - s) / s);
      }, n.flatten = function (t) {
        for (var e = t[0][0].length, r = {
            vertices: [],
            holes: [],
            dimensions: e
          }, n = 0, i = 0; i < t.length; i++) {
          for (var o = 0; o < t[i].length; o++)
            for (var s = 0; s < e; s++) r.vertices.push(t[i][o][s]);
          i > 0 && (n += t[i - 1].length, r.holes.push(n));
        }
        return r;
      };
    }, {}],
    3: [function (t, e, r) {
      "use strict";

      function n() {}

      function i(t, e, r) {
        this.fn = t, this.context = e, this.once = r || !1;
      }

      function o() {
        this._events = new n(), this._eventsCount = 0;
      }
      var s = Object.prototype.hasOwnProperty,
        a = "~";
      Object.create && (n.prototype = Object.create(null), new n().__proto__ || (a = !1)), o.prototype.eventNames = function () {
        var t,
          e,
          r = [];
        if (0 === this._eventsCount) return r;
        for (e in t = this._events) s.call(t, e) && r.push(a ? e.slice(1) : e);
        return Object.getOwnPropertySymbols ? r.concat(Object.getOwnPropertySymbols(t)) : r;
      }, o.prototype.listeners = function (t, e) {
        var r = a ? a + t : t,
          n = this._events[r];
        if (e) return !!n;
        if (!n) return [];
        if (n.fn) return [n.fn];
        for (var i = 0, o = n.length, s = new Array(o); i < o; i++) s[i] = n[i].fn;
        return s;
      }, o.prototype.emit = function (t, e, r, n, i, o) {
        var s = a ? a + t : t;
        if (!this._events[s]) return !1;
        var u,
          h,
          l = this._events[s],
          c = arguments.length;
        if (l.fn) {
          switch (l.once && this.removeListener(t, l.fn, void 0, !0), c) {
            case 1:
              return l.fn.call(l.context), !0;
            case 2:
              return l.fn.call(l.context, e), !0;
            case 3:
              return l.fn.call(l.context, e, r), !0;
            case 4:
              return l.fn.call(l.context, e, r, n), !0;
            case 5:
              return l.fn.call(l.context, e, r, n, i), !0;
            case 6:
              return l.fn.call(l.context, e, r, n, i, o), !0;
          }
          for (h = 1, u = new Array(c - 1); h < c; h++) u[h - 1] = arguments[h];
          l.fn.apply(l.context, u);
        } else {
          var d,
            f = l.length;
          for (h = 0; h < f; h++) switch (l[h].once && this.removeListener(t, l[h].fn, void 0, !0), c) {
            case 1:
              l[h].fn.call(l[h].context);
              break;
            case 2:
              l[h].fn.call(l[h].context, e);
              break;
            case 3:
              l[h].fn.call(l[h].context, e, r);
              break;
            case 4:
              l[h].fn.call(l[h].context, e, r, n);
              break;
            default:
              if (!u)
                for (d = 1, u = new Array(c - 1); d < c; d++) u[d - 1] = arguments[d];
              l[h].fn.apply(l[h].context, u);
          }
        }
        return !0;
      }, o.prototype.on = function (t, e, r) {
        var n = new i(e, r || this),
          o = a ? a + t : t;
        return this._events[o] ? this._events[o].fn ? this._events[o] = [this._events[o], n] : this._events[o].push(n) : (this._events[o] = n, this._eventsCount++), this;
      }, o.prototype.once = function (t, e, r) {
        var n = new i(e, r || this, !0),
          o = a ? a + t : t;
        return this._events[o] ? this._events[o].fn ? this._events[o] = [this._events[o], n] : this._events[o].push(n) : (this._events[o] = n, this._eventsCount++), this;
      }, o.prototype.removeListener = function (t, e, r, i) {
        var o = a ? a + t : t;
        if (!this._events[o]) return this;
        if (!e) return 0 == --this._eventsCount ? this._events = new n() : delete this._events[o], this;
        var s = this._events[o];
        if (s.fn) s.fn !== e || i && !s.once || r && s.context !== r || (0 == --this._eventsCount ? this._events = new n() : delete this._events[o]);
        else {
          for (var u = 0, h = [], l = s.length; u < l; u++)(s[u].fn !== e || i && !s[u].once || r && s[u].context !== r) && h.push(s[u]);
          h.length ? this._events[o] = 1 === h.length ? h[0] : h : 0 == --this._eventsCount ? this._events = new n() : delete this._events[o];
        }
        return this;
      }, o.prototype.removeAllListeners = function (t) {
        var e;
        return t ? (e = a ? a + t : t, this._events[e] && (0 == --this._eventsCount ? this._events = new n() : delete this._events[e])) : (this._events = new n(), this._eventsCount = 0), this;
      }, o.prototype.off = o.prototype.removeListener, o.prototype.addListener = o.prototype.on, o.prototype.setMaxListeners = function () {
        return this;
      }, o.prefixed = a, o.EventEmitter = o, void 0 !== e && (e.exports = o);
    }, {}],
    4: [function (e, r, n) {
      ! function (e) {
        function n(t, e) {
          return t.test(e);
        }

        function i(t) {
          var e = t || ("undefined" != typeof navigator ? navigator.userAgent : ""),
            r = e.split("[FBAN");
          void 0 !== r[1] && (e = r[0]), void 0 !== (r = e.split("Twitter"))[1] && (e = r[0]);
          var i = {
            apple: {
              phone: n(o, e) && !n(d, e),
              ipod: n(s, e),
              tablet: !n(o, e) && n(a, e) && !n(d, e),
              device: (n(o, e) || n(s, e) || n(a, e)) && !n(d, e)
            },
            amazon: {
              phone: n(l, e),
              tablet: !n(l, e) && n(c, e),
              device: n(l, e) || n(c, e)
            },
            android: {
              phone: !n(d, e) && n(l, e) || !n(d, e) && n(u, e),
              tablet: !n(d, e) && !n(l, e) && !n(u, e) && (n(c, e) || n(h, e)),
              device: !n(d, e) && (n(l, e) || n(c, e) || n(u, e) || n(h, e))
            },
            windows: {
              phone: n(d, e),
              tablet: n(f, e),
              device: n(d, e) || n(f, e)
            },
            other: {
              blackberry: n(p, e),
              blackberry10: n(v, e),
              opera: n(g, e),
              firefox: n(m, e),
              chrome: n(y, e),
              device: n(p, e) || n(v, e) || n(g, e) || n(m, e) || n(y, e)
            }
          };
          return i.any = i.apple.device || i.android.device || i.windows.device || i.other.device, i.phone = i.apple.phone || i.android.phone || i.windows.phone, i.tablet = i.apple.tablet || i.android.tablet || i.windows.tablet, i;
        }
        var o = /iPhone/i,
          s = /iPod/i,
          a = /iPad/i,
          u = /\bAndroid(?:.+)Mobile\b/i,
          h = /Android/i,
          l = /\bAndroid(?:.+)SD4930UR\b/i,
          c = /\bAndroid(?:.+)(?:KF[A-Z]{2,4})\b/i,
          d = /Windows Phone/i,
          f = /\bWindows(?:.+)ARM\b/i,
          p = /BlackBerry/i,
          v = /BB10/i,
          g = /Opera Mini/i,
          y = /\b(CriOS|Chrome)(?:.+)Mobile/i,
          m = /\Mobile(?:.+)Firefox\b/i;
        void 0 !== r && r.exports && "undefined" == typeof window ? r.exports = i : void 0 !== r && r.exports && "undefined" != typeof window ? r.exports = i() : "function" == typeof t && t.amd ? t([], e.isMobile = i()) : e.isMobile = i();
      }(this);
    }, {}],
    5: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        return t._head ? (t._tail._next = e, e._prev = t._tail, t._tail = e) : (t._head = e, t._tail = e), e._owner = t, e;
      }
      Object.defineProperty(r, "__esModule", {
        value: !0
      });
      var o = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        s = function () {
          function t(e, r, i) {
            void 0 === r && (r = !1), n(this, t), this._fn = e, this._once = r, this._thisArg = i, this._next = this._prev = this._owner = null;
          }
          return o(t, [{
            key: "detach",
            value: function value() {
              return null !== this._owner && (this._owner.detach(this), !0);
            }
          }]), t;
        }(),
        a = function () {
          function t() {
            n(this, t), this._head = this._tail = void 0;
          }
          return o(t, [{
            key: "handlers",
            value: function value() {
              var t = !(arguments.length <= 0 || void 0 === arguments[0]) && arguments[0],
                e = this._head;
              if (t) return !!e;
              for (var r = []; e;) r.push(e), e = e._next;
              return r;
            }
          }, {
            key: "has",
            value: function value(t) {
              if (!(t instanceof s)) throw new Error("MiniSignal#has(): First arg must be a MiniSignalBinding object.");
              return t._owner === this;
            }
          }, {
            key: "dispatch",
            value: function value() {
              var t = this._head;
              if (!t) return !1;
              for (; t;) t._once && this.detach(t), t._fn.apply(t._thisArg, arguments), t = t._next;
              return !0;
            }
          }, {
            key: "add",
            value: function value(t) {
              var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1];
              if ("function" != typeof t) throw new Error("MiniSignal#add(): First arg must be a Function.");
              return i(this, new s(t, !1, e));
            }
          }, {
            key: "once",
            value: function value(t) {
              var e = arguments.length <= 1 || void 0 === arguments[1] ? null : arguments[1];
              if ("function" != typeof t) throw new Error("MiniSignal#once(): First arg must be a Function.");
              return i(this, new s(t, !0, e));
            }
          }, {
            key: "detach",
            value: function value(t) {
              if (!(t instanceof s)) throw new Error("MiniSignal#detach(): First arg must be a MiniSignalBinding object.");
              return t._owner !== this ? this : (t._prev && (t._prev._next = t._next), t._next && (t._next._prev = t._prev), t === this._head ? (this._head = t._next, null === t._next && (this._tail = null)) : t === this._tail && (this._tail = t._prev, this._tail._next = null), t._owner = null, this);
            }
          }, {
            key: "detachAll",
            value: function value() {
              var t = this._head;
              if (!t) return this;
              for (this._head = this._tail = null; t;) t._owner = null, t = t._next;
              return this;
            }
          }]), t;
        }();
      a.MiniSignalBinding = s, r["default"] = a, e.exports = r["default"];
    }, {}],
    6: [function (t, e, r) {
      "use strict";

      function n(t) {
        if (null === t || void 0 === t) throw new TypeError("Object.assign cannot be called with null or undefined");
        return Object(t);
      }
      var i = Object.getOwnPropertySymbols,
        o = Object.prototype.hasOwnProperty,
        s = Object.prototype.propertyIsEnumerable;
      e.exports = function () {
        try {
          if (!Object.assign) return !1;
          var t = new String("abc");
          if (t[5] = "de", "5" === Object.getOwnPropertyNames(t)[0]) return !1;
          for (var e = {}, r = 0; r < 10; r++) e["_" + String.fromCharCode(r)] = r;
          if ("0123456789" !== Object.getOwnPropertyNames(e).map(function (t) {
              return e[t];
            }).join("")) return !1;
          var n = {};
          return "abcdefghijklmnopqrst".split("").forEach(function (t) {
            n[t] = t;
          }), "abcdefghijklmnopqrst" === Object.keys(Object.assign({}, n)).join("");
        } catch (t) {
          return !1;
        }
      }() ? Object.assign : function (t, e) {
        for (var r, a, u = n(t), h = 1; h < arguments.length; h++) {
          r = Object(arguments[h]);
          for (var l in r) o.call(r, l) && (u[l] = r[l]);
          if (i) {
            a = i(r);
            for (var c = 0; c < a.length; c++) s.call(r, a[c]) && (u[a[c]] = r[a[c]]);
          }
        }
        return u;
      };
    }, {}],
    7: [function (t, e, r) {
      "use strict";

      e.exports = function (t, e) {
        e = e || {};
        for (var r = {
            key: ["source", "protocol", "authority", "userInfo", "user", "password", "host", "port", "relative", "path", "directory", "file", "query", "anchor"],
            q: {
              name: "queryKey",
              parser: /(?:^|&)([^&=]*)=?([^&]*)/g
            },
            parser: {
              strict: /^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,
              loose: /^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/
            }
          }, n = r.parser[e.strictMode ? "strict" : "loose"].exec(t), i = {}, o = 14; o--;) i[r.key[o]] = n[o] || "";
        return i[r.q.name] = {}, i[r.key[12]].replace(r.q.parser, function (t, e, n) {
          e && (i[r.q.name][e] = n);
        }), i;
      };
    }, {}],
    8: [function (t, e, r) {
      (function (t) {
        function e(t, e) {
          for (var r = 0, n = t.length - 1; n >= 0; n--) {
            var i = t[n];
            "." === i ? t.splice(n, 1) : ".." === i ? (t.splice(n, 1), r++) : r && (t.splice(n, 1), r--);
          }
          if (e)
            for (; r--; r) t.unshift("..");
          return t;
        }

        function n(t, e) {
          if (t.filter) return t.filter(e);
          for (var r = [], n = 0; n < t.length; n++) e(t[n], n, t) && r.push(t[n]);
          return r;
        }
        var i = /^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,
          o = function o(t) {
            return i.exec(t).slice(1);
          };
        r.resolve = function () {
          for (var r = "", i = !1, o = arguments.length - 1; o >= -1 && !i; o--) {
            var s = o >= 0 ? arguments[o] : t.cwd();
            if ("string" != typeof s) throw new TypeError("Arguments to path.resolve must be strings");
            s && (r = s + "/" + r, i = "/" === s.charAt(0));
          }
          return r = e(n(r.split("/"), function (t) {
            return !!t;
          }), !i).join("/"), (i ? "/" : "") + r || ".";
        }, r.normalize = function (t) {
          var i = r.isAbsolute(t),
            o = "/" === s(t, -1);
          return t = e(n(t.split("/"), function (t) {
            return !!t;
          }), !i).join("/"), t || i || (t = "."), t && o && (t += "/"), (i ? "/" : "") + t;
        }, r.isAbsolute = function (t) {
          return "/" === t.charAt(0);
        }, r.join = function () {
          var t = Array.prototype.slice.call(arguments, 0);
          return r.normalize(n(t, function (t, e) {
            if ("string" != typeof t) throw new TypeError("Arguments to path.join must be strings");
            return t;
          }).join("/"));
        }, r.relative = function (t, e) {
          function n(t) {
            for (var e = 0; e < t.length && "" === t[e]; e++);
            for (var r = t.length - 1; r >= 0 && "" === t[r]; r--);
            return e > r ? [] : t.slice(e, r - e + 1);
          }
          t = r.resolve(t).substr(1), e = r.resolve(e).substr(1);
          for (var i = n(t.split("/")), o = n(e.split("/")), s = Math.min(i.length, o.length), a = s, u = 0; u < s; u++)
            if (i[u] !== o[u]) {
              a = u;
              break;
            }
          for (var h = [], u = a; u < i.length; u++) h.push("..");
          return h = h.concat(o.slice(a)), h.join("/");
        }, r.sep = "/", r.delimiter = ":", r.dirname = function (t) {
          var e = o(t),
            r = e[0],
            n = e[1];
          return r || n ? (n && (n = n.substr(0, n.length - 1)), r + n) : ".";
        }, r.basename = function (t, e) {
          var r = o(t)[2];
          return e && r.substr(-1 * e.length) === e && (r = r.substr(0, r.length - e.length)), r;
        }, r.extname = function (t) {
          return o(t)[3];
        };
        var s =  true ? function (t, e, r) {
          return t.substr(e, r);
        } : 0;
      }).call(this, t("_process"));
    }, {
      _process: 26
    }],
    9: [function (t, e, r) {
      var n = new ArrayBuffer(0),
        i = function i(t, e, r, _i) {
          this.gl = t, this.buffer = t.createBuffer(), this.type = e || t.ARRAY_BUFFER, this.drawType = _i || t.STATIC_DRAW, this.data = n, r && this.upload(r), this._updateID = 0;
        };
      i.prototype.upload = function (t, e, r) {
        r || this.bind();
        var n = this.gl;
        t = t || this.data, e = e || 0, this.data.byteLength >= t.byteLength ? n.bufferSubData(this.type, e, t) : n.bufferData(this.type, t, this.drawType), this.data = t;
      }, i.prototype.bind = function () {
        this.gl.bindBuffer(this.type, this.buffer);
      }, i.createVertexBuffer = function (t, e, r) {
        return new i(t, t.ARRAY_BUFFER, e, r);
      }, i.createIndexBuffer = function (t, e, r) {
        return new i(t, t.ELEMENT_ARRAY_BUFFER, e, r);
      }, i.create = function (t, e, r, n) {
        return new i(t, e, r, n);
      }, i.prototype.destroy = function () {
        this.gl.deleteBuffer(this.buffer);
      }, e.exports = i;
    }, {}],
    10: [function (t, e, r) {
      var n = t("./GLTexture"),
        i = function i(t, e, r) {
          this.gl = t, this.framebuffer = t.createFramebuffer(), this.stencil = null, this.texture = null, this.width = e || 100, this.height = r || 100;
        };
      i.prototype.enableTexture = function (t) {
        var e = this.gl;
        this.texture = t || new n(e), this.texture.bind(), this.bind(), e.framebufferTexture2D(e.FRAMEBUFFER, e.COLOR_ATTACHMENT0, e.TEXTURE_2D, this.texture.texture, 0);
      }, i.prototype.enableStencil = function () {
        if (!this.stencil) {
          var t = this.gl;
          this.stencil = t.createRenderbuffer(), t.bindRenderbuffer(t.RENDERBUFFER, this.stencil), t.framebufferRenderbuffer(t.FRAMEBUFFER, t.DEPTH_STENCIL_ATTACHMENT, t.RENDERBUFFER, this.stencil), t.renderbufferStorage(t.RENDERBUFFER, t.DEPTH_STENCIL, this.width, this.height);
        }
      }, i.prototype.clear = function (t, e, r, n) {
        this.bind();
        var i = this.gl;
        i.clearColor(t, e, r, n), i.clear(i.COLOR_BUFFER_BIT | i.DEPTH_BUFFER_BIT);
      }, i.prototype.bind = function () {
        var t = this.gl;
        t.bindFramebuffer(t.FRAMEBUFFER, this.framebuffer);
      }, i.prototype.unbind = function () {
        var t = this.gl;
        t.bindFramebuffer(t.FRAMEBUFFER, null);
      }, i.prototype.resize = function (t, e) {
        var r = this.gl;
        this.width = t, this.height = e, this.texture && this.texture.uploadData(null, t, e), this.stencil && (r.bindRenderbuffer(r.RENDERBUFFER, this.stencil), r.renderbufferStorage(r.RENDERBUFFER, r.DEPTH_STENCIL, t, e));
      }, i.prototype.destroy = function () {
        var t = this.gl;
        this.texture && this.texture.destroy(), t.deleteFramebuffer(this.framebuffer), this.gl = null, this.stencil = null, this.texture = null;
      }, i.createRGBA = function (t, e, r, o) {
        var s = n.fromData(t, null, e, r);
        s.enableNearestScaling(), s.enableWrapClamp();
        var a = new i(t, e, r);
        return a.enableTexture(s), a.unbind(), a;
      }, i.createFloat32 = function (t, e, r, o) {
        var s = new n.fromData(t, o, e, r);
        s.enableNearestScaling(), s.enableWrapClamp();
        var a = new i(t, e, r);
        return a.enableTexture(s), a.unbind(), a;
      }, e.exports = i;
    }, {
      "./GLTexture": 12
    }],
    11: [function (t, e, r) {
      var n = t("./shader/compileProgram"),
        i = t("./shader/extractAttributes"),
        o = t("./shader/extractUniforms"),
        s = t("./shader/setPrecision"),
        a = t("./shader/generateUniformAccessObject"),
        u = function u(t, e, r, _u, h) {
          this.gl = t, _u && (e = s(e, _u), r = s(r, _u)), this.program = n(t, e, r, h), this.attributes = i(t, this.program), this.uniformData = o(t, this.program), this.uniforms = a(t, this.uniformData);
        };
      u.prototype.bind = function () {
        return this.gl.useProgram(this.program), this;
      }, u.prototype.destroy = function () {
        this.attributes = null, this.uniformData = null, this.uniforms = null, this.gl.deleteProgram(this.program);
      }, e.exports = u;
    }, {
      "./shader/compileProgram": 17,
      "./shader/extractAttributes": 19,
      "./shader/extractUniforms": 20,
      "./shader/generateUniformAccessObject": 21,
      "./shader/setPrecision": 25
    }],
    12: [function (t, e, r) {
      var n = function n(t, e, r, _n, i) {
        this.gl = t, this.texture = t.createTexture(), this.mipmap = !1, this.premultiplyAlpha = !1, this.width = e || -1, this.height = r || -1, this.format = _n || t.RGBA, this.type = i || t.UNSIGNED_BYTE;
      };
      n.prototype.upload = function (t) {
        this.bind();
        var e = this.gl;
        e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha);
        var r = t.videoWidth || t.width,
          n = t.videoHeight || t.height;
        n !== this.height || r !== this.width ? e.texImage2D(e.TEXTURE_2D, 0, this.format, this.format, this.type, t) : e.texSubImage2D(e.TEXTURE_2D, 0, 0, 0, this.format, this.type, t), this.width = r, this.height = n;
      };
      var i = !1;
      n.prototype.uploadData = function (t, e, r) {
        this.bind();
        var n = this.gl;
        if (t instanceof Float32Array) {
          if (!i) {
            if (!n.getExtension("OES_texture_float")) throw new Error("floating point textures not available");
            i = !0;
          }
          this.type = n.FLOAT;
        } else this.type = this.type || n.UNSIGNED_BYTE;
        n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL, this.premultiplyAlpha), e !== this.width || r !== this.height ? n.texImage2D(n.TEXTURE_2D, 0, this.format, e, r, 0, this.format, this.type, t || null) : n.texSubImage2D(n.TEXTURE_2D, 0, 0, 0, e, r, this.format, this.type, t || null), this.width = e, this.height = r;
      }, n.prototype.bind = function (t) {
        var e = this.gl;
        void 0 !== t && e.activeTexture(e.TEXTURE0 + t), e.bindTexture(e.TEXTURE_2D, this.texture);
      }, n.prototype.unbind = function () {
        var t = this.gl;
        t.bindTexture(t.TEXTURE_2D, null);
      }, n.prototype.minFilter = function (t) {
        var e = this.gl;
        this.bind(), this.mipmap ? e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR_MIPMAP_LINEAR : e.NEAREST_MIPMAP_NEAREST) : e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MIN_FILTER, t ? e.LINEAR : e.NEAREST);
      }, n.prototype.magFilter = function (t) {
        var e = this.gl;
        this.bind(), e.texParameteri(e.TEXTURE_2D, e.TEXTURE_MAG_FILTER, t ? e.LINEAR : e.NEAREST);
      }, n.prototype.enableMipmap = function () {
        var t = this.gl;
        this.bind(), this.mipmap = !0, t.generateMipmap(t.TEXTURE_2D);
      }, n.prototype.enableLinearScaling = function () {
        this.minFilter(!0), this.magFilter(!0);
      }, n.prototype.enableNearestScaling = function () {
        this.minFilter(!1), this.magFilter(!1);
      }, n.prototype.enableWrapClamp = function () {
        var t = this.gl;
        this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.CLAMP_TO_EDGE), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.CLAMP_TO_EDGE);
      }, n.prototype.enableWrapRepeat = function () {
        var t = this.gl;
        this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.REPEAT);
      }, n.prototype.enableWrapMirrorRepeat = function () {
        var t = this.gl;
        this.bind(), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_S, t.MIRRORED_REPEAT), t.texParameteri(t.TEXTURE_2D, t.TEXTURE_WRAP_T, t.MIRRORED_REPEAT);
      }, n.prototype.destroy = function () {
        this.gl.deleteTexture(this.texture);
      }, n.fromSource = function (t, e, r) {
        var i = new n(t);
        return i.premultiplyAlpha = r || !1, i.upload(e), i;
      }, n.fromData = function (t, e, r, i) {
        var o = new n(t);
        return o.uploadData(e, r, i), o;
      }, e.exports = n;
    }, {}],
    13: [function (t, e, r) {
      function n(t, e) {
        if (this.nativeVaoExtension = null, n.FORCE_NATIVE || (this.nativeVaoExtension = t.getExtension("OES_vertex_array_object") || t.getExtension("MOZ_OES_vertex_array_object") || t.getExtension("WEBKIT_OES_vertex_array_object")), this.nativeState = e, this.nativeVaoExtension) {
          this.nativeVao = this.nativeVaoExtension.createVertexArrayOES();
          var r = t.getParameter(t.MAX_VERTEX_ATTRIBS);
          this.nativeState = {
            tempAttribState: new Array(r),
            attribState: new Array(r)
          };
        }
        this.gl = t, this.attributes = [], this.indexBuffer = null, this.dirty = !1;
      }
      var i = t("./setVertexAttribArrays");
      n.prototype.constructor = n, e.exports = n, n.FORCE_NATIVE = !1, n.prototype.bind = function () {
        if (this.nativeVao) {
          if (this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.dirty) return this.dirty = !1, this.activate(), this;
          this.indexBuffer && this.indexBuffer.bind();
        } else this.activate();
        return this;
      }, n.prototype.unbind = function () {
        return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(null), this;
      }, n.prototype.activate = function () {
        for (var t = this.gl, e = null, r = 0; r < this.attributes.length; r++) {
          var n = this.attributes[r];
          e !== n.buffer && (n.buffer.bind(), e = n.buffer), t.vertexAttribPointer(n.attribute.location, n.attribute.size, n.type || t.FLOAT, n.normalized || !1, n.stride || 0, n.start || 0);
        }
        return i(t, this.attributes, this.nativeState), this.indexBuffer && this.indexBuffer.bind(), this;
      }, n.prototype.addAttribute = function (t, e, r, n, i, o) {
        return this.attributes.push({
          buffer: t,
          attribute: e,
          location: e.location,
          type: r || this.gl.FLOAT,
          normalized: n || !1,
          stride: i || 0,
          start: o || 0
        }), this.dirty = !0, this;
      }, n.prototype.addIndex = function (t) {
        return this.indexBuffer = t, this.dirty = !0, this;
      }, n.prototype.clear = function () {
        return this.nativeVao && this.nativeVaoExtension.bindVertexArrayOES(this.nativeVao), this.attributes.length = 0, this.indexBuffer = null, this;
      }, n.prototype.draw = function (t, e, r) {
        var n = this.gl;
        return this.indexBuffer ? n.drawElements(t, e || this.indexBuffer.data.length, n.UNSIGNED_SHORT, 2 * (r || 0)) : n.drawArrays(t, r, e || this.getSize()), this;
      }, n.prototype.destroy = function () {
        this.gl = null, this.indexBuffer = null, this.attributes = null, this.nativeState = null, this.nativeVao && this.nativeVaoExtension.deleteVertexArrayOES(this.nativeVao), this.nativeVaoExtension = null, this.nativeVao = null;
      }, n.prototype.getSize = function () {
        var t = this.attributes[0];
        return t.buffer.data.length / (t.stride / 4 || t.attribute.size);
      };
    }, {
      "./setVertexAttribArrays": 16
    }],
    14: [function (t, e, r) {
      var n = function n(t, e) {
        var r = t.getContext("webgl", e) || t.getContext("experimental-webgl", e);
        if (!r) throw new Error("This browser does not support webGL. Try using the canvas renderer");
        return r;
      };
      e.exports = n;
    }, {}],
    15: [function (t, e, r) {
      var n = {
        createContext: t("./createContext"),
        setVertexAttribArrays: t("./setVertexAttribArrays"),
        GLBuffer: t("./GLBuffer"),
        GLFramebuffer: t("./GLFramebuffer"),
        GLShader: t("./GLShader"),
        GLTexture: t("./GLTexture"),
        VertexArrayObject: t("./VertexArrayObject"),
        shader: t("./shader")
      };
      void 0 !== e && e.exports && (e.exports = n), "undefined" != typeof window && (window.PIXI = window.PIXI || {}, window.PIXI.glCore = n);
    }, {
      "./GLBuffer": 9,
      "./GLFramebuffer": 10,
      "./GLShader": 11,
      "./GLTexture": 12,
      "./VertexArrayObject": 13,
      "./createContext": 14,
      "./setVertexAttribArrays": 16,
      "./shader": 22
    }],
    16: [function (t, e, r) {
      var n = function n(t, e, r) {
        var n;
        if (r) {
          var i = r.tempAttribState,
            o = r.attribState;
          for (n = 0; n < i.length; n++) i[n] = !1;
          for (n = 0; n < e.length; n++) i[e[n].attribute.location] = !0;
          for (n = 0; n < o.length; n++) o[n] !== i[n] && (o[n] = i[n], r.attribState[n] ? t.enableVertexAttribArray(n) : t.disableVertexAttribArray(n));
        } else
          for (n = 0; n < e.length; n++) {
            var s = e[n];
            t.enableVertexAttribArray(s.attribute.location);
          }
      };
      e.exports = n;
    }, {}],
    17: [function (t, e, r) {
      var n = function n(t, e, r, _n2) {
          var o = i(t, t.VERTEX_SHADER, e),
            s = i(t, t.FRAGMENT_SHADER, r),
            a = t.createProgram();
          if (t.attachShader(a, o), t.attachShader(a, s), _n2)
            for (var u in _n2) t.bindAttribLocation(a, _n2[u], u);
          return t.linkProgram(a), t.getProgramParameter(a, t.LINK_STATUS) || (console.error("Pixi.js Error: Could not initialize shader."), console.error("gl.VALIDATE_STATUS", t.getProgramParameter(a, t.VALIDATE_STATUS)), console.error("gl.getError()", t.getError()), "" !== t.getProgramInfoLog(a) && console.warn("Pixi.js Warning: gl.getProgramInfoLog()", t.getProgramInfoLog(a)), t.deleteProgram(a), a = null), t.deleteShader(o), t.deleteShader(s), a;
        },
        i = function i(t, e, r) {
          var n = t.createShader(e);
          return t.shaderSource(n, r), t.compileShader(n), t.getShaderParameter(n, t.COMPILE_STATUS) ? n : (console.log(t.getShaderInfoLog(n)), null);
        };
      e.exports = n;
    }, {}],
    18: [function (t, e, r) {
      var n = function n(t, e) {
          switch (t) {
            case "float":
              return 0;
            case "vec2":
              return new Float32Array(2 * e);
            case "vec3":
              return new Float32Array(3 * e);
            case "vec4":
              return new Float32Array(4 * e);
            case "int":
            case "sampler2D":
              return 0;
            case "ivec2":
              return new Int32Array(2 * e);
            case "ivec3":
              return new Int32Array(3 * e);
            case "ivec4":
              return new Int32Array(4 * e);
            case "bool":
              return !1;
            case "bvec2":
              return i(2 * e);
            case "bvec3":
              return i(3 * e);
            case "bvec4":
              return i(4 * e);
            case "mat2":
              return new Float32Array([1, 0, 0, 1]);
            case "mat3":
              return new Float32Array([1, 0, 0, 0, 1, 0, 0, 0, 1]);
            case "mat4":
              return new Float32Array([1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1]);
          }
        },
        i = function i(t) {
          for (var e = new Array(t), r = 0; r < e.length; r++) e[r] = !1;
          return e;
        };
      e.exports = n;
    }, {}],
    19: [function (t, e, r) {
      var n = t("./mapType"),
        i = t("./mapSize"),
        o = function o(t, e) {
          for (var r = {}, o = t.getProgramParameter(e, t.ACTIVE_ATTRIBUTES), a = 0; a < o; a++) {
            var u = t.getActiveAttrib(e, a),
              h = n(t, u.type);
            r[u.name] = {
              type: h,
              size: i(h),
              location: t.getAttribLocation(e, u.name),
              pointer: s
            };
          }
          return r;
        },
        s = function s(t, e, r, n) {
          gl.vertexAttribPointer(this.location, this.size, t || gl.FLOAT, e || !1, r || 0, n || 0);
        };
      e.exports = o;
    }, {
      "./mapSize": 23,
      "./mapType": 24
    }],
    20: [function (t, e, r) {
      var n = t("./mapType"),
        i = t("./defaultValue"),
        o = function o(t, e) {
          for (var r = {}, o = t.getProgramParameter(e, t.ACTIVE_UNIFORMS), s = 0; s < o; s++) {
            var a = t.getActiveUniform(e, s),
              u = a.name.replace(/\[.*?\]/, ""),
              h = n(t, a.type);
            r[u] = {
              type: h,
              size: a.size,
              location: t.getUniformLocation(e, u),
              value: i(h, a.size)
            };
          }
          return r;
        };
      e.exports = o;
    }, {
      "./defaultValue": 18,
      "./mapType": 24
    }],
    21: [function (t, e, r) {
      function n(t, e) {
        return function (r) {
          this.data[t].value = r;
          var n = this.data[t].location;
          1 === e.size ? a[e.type](this.gl, n, r) : u[e.type](this.gl, n, r);
        };
      }

      function i(t, e) {
        for (var r = e, n = 0; n < t.length - 1; n++) {
          var i = r[t[n]] || {
            data: {}
          };
          r[t[n]] = i, r = i;
        }
        return r;
      }
      var o = function o(t, e) {
          var r = {
            data: {}
          };
          r.gl = t;
          for (var o = Object.keys(e), a = 0; a < o.length; a++) {
            var u = o[a],
              h = u.split("."),
              l = h[h.length - 1],
              c = i(h, r),
              d = e[u];
            c.data[l] = d, c.gl = t, Object.defineProperty(c, l, {
              get: s(l),
              set: n(l, d)
            });
          }
          return r;
        },
        s = function s(t) {
          return function () {
            return this.data[t].value;
          };
        },
        a = {
          "float": function float(t, e, r) {
            t.uniform1f(e, r);
          },
          vec2: function vec2(t, e, r) {
            t.uniform2f(e, r[0], r[1]);
          },
          vec3: function vec3(t, e, r) {
            t.uniform3f(e, r[0], r[1], r[2]);
          },
          vec4: function vec4(t, e, r) {
            t.uniform4f(e, r[0], r[1], r[2], r[3]);
          },
          "int": function int(t, e, r) {
            t.uniform1i(e, r);
          },
          ivec2: function ivec2(t, e, r) {
            t.uniform2i(e, r[0], r[1]);
          },
          ivec3: function ivec3(t, e, r) {
            t.uniform3i(e, r[0], r[1], r[2]);
          },
          ivec4: function ivec4(t, e, r) {
            t.uniform4i(e, r[0], r[1], r[2], r[3]);
          },
          bool: function bool(t, e, r) {
            t.uniform1i(e, r);
          },
          bvec2: function bvec2(t, e, r) {
            t.uniform2i(e, r[0], r[1]);
          },
          bvec3: function bvec3(t, e, r) {
            t.uniform3i(e, r[0], r[1], r[2]);
          },
          bvec4: function bvec4(t, e, r) {
            t.uniform4i(e, r[0], r[1], r[2], r[3]);
          },
          mat2: function mat2(t, e, r) {
            t.uniformMatrix2fv(e, !1, r);
          },
          mat3: function mat3(t, e, r) {
            t.uniformMatrix3fv(e, !1, r);
          },
          mat4: function mat4(t, e, r) {
            t.uniformMatrix4fv(e, !1, r);
          },
          sampler2D: function sampler2D(t, e, r) {
            t.uniform1i(e, r);
          }
        },
        u = {
          "float": function float(t, e, r) {
            t.uniform1fv(e, r);
          },
          vec2: function vec2(t, e, r) {
            t.uniform2fv(e, r);
          },
          vec3: function vec3(t, e, r) {
            t.uniform3fv(e, r);
          },
          vec4: function vec4(t, e, r) {
            t.uniform4fv(e, r);
          },
          "int": function int(t, e, r) {
            t.uniform1iv(e, r);
          },
          ivec2: function ivec2(t, e, r) {
            t.uniform2iv(e, r);
          },
          ivec3: function ivec3(t, e, r) {
            t.uniform3iv(e, r);
          },
          ivec4: function ivec4(t, e, r) {
            t.uniform4iv(e, r);
          },
          bool: function bool(t, e, r) {
            t.uniform1iv(e, r);
          },
          bvec2: function bvec2(t, e, r) {
            t.uniform2iv(e, r);
          },
          bvec3: function bvec3(t, e, r) {
            t.uniform3iv(e, r);
          },
          bvec4: function bvec4(t, e, r) {
            t.uniform4iv(e, r);
          },
          sampler2D: function sampler2D(t, e, r) {
            t.uniform1iv(e, r);
          }
        };
      e.exports = o;
    }, {}],
    22: [function (t, e, r) {
      e.exports = {
        compileProgram: t("./compileProgram"),
        defaultValue: t("./defaultValue"),
        extractAttributes: t("./extractAttributes"),
        extractUniforms: t("./extractUniforms"),
        generateUniformAccessObject: t("./generateUniformAccessObject"),
        setPrecision: t("./setPrecision"),
        mapSize: t("./mapSize"),
        mapType: t("./mapType")
      };
    }, {
      "./compileProgram": 17,
      "./defaultValue": 18,
      "./extractAttributes": 19,
      "./extractUniforms": 20,
      "./generateUniformAccessObject": 21,
      "./mapSize": 23,
      "./mapType": 24,
      "./setPrecision": 25
    }],
    23: [function (t, e, r) {
      var n = function n(t) {
          return i[t];
        },
        i = {
          "float": 1,
          vec2: 2,
          vec3: 3,
          vec4: 4,
          "int": 1,
          ivec2: 2,
          ivec3: 3,
          ivec4: 4,
          bool: 1,
          bvec2: 2,
          bvec3: 3,
          bvec4: 4,
          mat2: 4,
          mat3: 9,
          mat4: 16,
          sampler2D: 1
        };
      e.exports = n;
    }, {}],
    24: [function (t, e, r) {
      var n = function n(t, e) {
          if (!i) {
            var r = Object.keys(o);
            i = {};
            for (var n = 0; n < r.length; ++n) {
              var s = r[n];
              i[t[s]] = o[s];
            }
          }
          return i[e];
        },
        i = null,
        o = {
          FLOAT: "float",
          FLOAT_VEC2: "vec2",
          FLOAT_VEC3: "vec3",
          FLOAT_VEC4: "vec4",
          INT: "int",
          INT_VEC2: "ivec2",
          INT_VEC3: "ivec3",
          INT_VEC4: "ivec4",
          BOOL: "bool",
          BOOL_VEC2: "bvec2",
          BOOL_VEC3: "bvec3",
          BOOL_VEC4: "bvec4",
          FLOAT_MAT2: "mat2",
          FLOAT_MAT3: "mat3",
          FLOAT_MAT4: "mat4",
          SAMPLER_2D: "sampler2D"
        };
      e.exports = n;
    }, {}],
    25: [function (t, e, r) {
      var n = function n(t, e) {
        return "precision" !== t.substring(0, 9) ? "precision " + e + " float;\n" + t : t;
      };
      e.exports = n;
    }, {}],
    26: [function (t, e, r) {
      function n() {
        throw new Error("setTimeout has not been defined");
      }

      function i() {
        throw new Error("clearTimeout has not been defined");
      }

      function o(t) {
        if (c === setTimeout) return setTimeout(t, 0);
        if ((c === n || !c) && setTimeout) return c = setTimeout, setTimeout(t, 0);
        try {
          return c(t, 0);
        } catch (e) {
          try {
            return c.call(null, t, 0);
          } catch (e) {
            return c.call(this, t, 0);
          }
        }
      }

      function s(t) {
        if (d === clearTimeout) return clearTimeout(t);
        if ((d === i || !d) && clearTimeout) return d = clearTimeout, clearTimeout(t);
        try {
          return d(t);
        } catch (e) {
          try {
            return d.call(null, t);
          } catch (e) {
            return d.call(this, t);
          }
        }
      }

      function a() {
        g && p && (g = !1, p.length ? v = p.concat(v) : y = -1, v.length && u());
      }

      function u() {
        if (!g) {
          var t = o(a);
          g = !0;
          for (var e = v.length; e;) {
            for (p = v, v = []; ++y < e;) p && p[y].run();
            y = -1, e = v.length;
          }
          p = null, g = !1, s(t);
        }
      }

      function h(t, e) {
        this.fun = t, this.array = e;
      }

      function l() {}
      var c,
        d,
        f = e.exports = {};
      ! function () {
        try {
          c = "function" == typeof setTimeout ? setTimeout : n;
        } catch (t) {
          c = n;
        }
        try {
          d = "function" == typeof clearTimeout ? clearTimeout : i;
        } catch (t) {
          d = i;
        }
      }();
      var p,
        v = [],
        g = !1,
        y = -1;
      f.nextTick = function (t) {
        var e = new Array(arguments.length - 1);
        if (arguments.length > 1)
          for (var r = 1; r < arguments.length; r++) e[r - 1] = arguments[r];
        v.push(new h(t, e)), 1 !== v.length || g || o(u);
      }, h.prototype.run = function () {
        this.fun.apply(null, this.array);
      }, f.title = "browser", f.browser = !0, f.env = {}, f.argv = [], f.version = "", f.versions = {}, f.on = l, f.addListener = l, f.once = l, f.off = l, f.removeListener = l, f.removeAllListeners = l, f.emit = l, f.prependListener = l, f.prependOnceListener = l, f.listeners = function (t) {
        return [];
      }, f.binding = function (t) {
        throw new Error("process.binding is not supported");
      }, f.cwd = function () {
        return "/";
      }, f.chdir = function (t) {
        throw new Error("process.chdir is not supported");
      }, f.umask = function () {
        return 0;
      };
    }, {}],
    27: [function (e, r, n) {
      (function (e) {
        ! function (i) {
          function o(t) {
            throw new RangeError(L[t]);
          }

          function s(t, e) {
            for (var r = t.length, n = []; r--;) n[r] = e(t[r]);
            return n;
          }

          function a(t, e) {
            var r = t.split("@"),
              n = "";
            return r.length > 1 && (n = r[0] + "@", t = r[1]), t = t.replace(D, "."), n + s(t.split("."), e).join(".");
          }

          function u(t) {
            for (var e, r, n = [], i = 0, o = t.length; i < o;) e = t.charCodeAt(i++), e >= 55296 && e <= 56319 && i < o ? (r = t.charCodeAt(i++), 56320 == (64512 & r) ? n.push(((1023 & e) << 10) + (1023 & r) + 65536) : (n.push(e), i--)) : n.push(e);
            return n;
          }

          function h(t) {
            return s(t, function (t) {
              var e = "";
              return t > 65535 && (t -= 65536, e += k(t >>> 10 & 1023 | 55296), t = 56320 | 1023 & t), e += k(t);
            }).join("");
          }

          function l(t) {
            return t - 48 < 10 ? t - 22 : t - 65 < 26 ? t - 65 : t - 97 < 26 ? t - 97 : w;
          }

          function c(t, e) {
            return t + 22 + 75 * (t < 26) - ((0 != e) << 5);
          }

          function d(t, e, r) {
            var n = 0;
            for (t = r ? B(t / M) : t >> 1, t += B(t / e); t > N * S >> 1; n += w) t = B(t / N);
            return B(n + (N + 1) * t / (t + O));
          }

          function f(t) {
            var e,
              r,
              n,
              i,
              s,
              a,
              u,
              c,
              f,
              p,
              v = [],
              g = t.length,
              y = 0,
              m = C,
              _ = P;
            for (r = t.lastIndexOf(R), r < 0 && (r = 0), n = 0; n < r; ++n) t.charCodeAt(n) >= 128 && o("not-basic"), v.push(t.charCodeAt(n));
            for (i = r > 0 ? r + 1 : 0; i < g;) {
              for (s = y, a = 1, u = w; i >= g && o("invalid-input"), c = l(t.charCodeAt(i++)), (c >= w || c > B((T - y) / a)) && o("overflow"), y += c * a, f = u <= _ ? E : u >= _ + S ? S : u - _, !(c < f); u += w) p = w - f, a > B(T / p) && o("overflow"), a *= p;
              e = v.length + 1, _ = d(y - s, e, 0 == s), B(y / e) > T - m && o("overflow"), m += B(y / e), y %= e, v.splice(y++, 0, m);
            }
            return h(v);
          }

          function p(t) {
            var e,
              r,
              n,
              i,
              s,
              a,
              h,
              l,
              f,
              p,
              v,
              g,
              y,
              m,
              _,
              b = [];
            for (t = u(t), g = t.length, e = C, r = 0, s = P, a = 0; a < g; ++a)(v = t[a]) < 128 && b.push(k(v));
            for (n = i = b.length, i && b.push(R); n < g;) {
              for (h = T, a = 0; a < g; ++a)(v = t[a]) >= e && v < h && (h = v);
              for (y = n + 1, h - e > B((T - r) / y) && o("overflow"), r += (h - e) * y, e = h, a = 0; a < g; ++a)
                if (v = t[a], v < e && ++r > T && o("overflow"), v == e) {
                  for (l = r, f = w; p = f <= s ? E : f >= s + S ? S : f - s, !(l < p); f += w) _ = l - p, m = w - p, b.push(k(c(p + _ % m, 0))), l = B(_ / m);
                  b.push(k(c(l, 0))), s = d(r, y, n == i), r = 0, ++n;
                }
                ++ r, ++e;
            }
            return b.join("");
          }

          function v(t) {
            return a(t, function (t) {
              return A.test(t) ? f(t.slice(4).toLowerCase()) : t;
            });
          }

          function g(t) {
            return a(t, function (t) {
              return I.test(t) ? "xn--" + p(t) : t;
            });
          }
          var y = "object" == _typeof(n) && n && !n.nodeType && n,
            m = "object" == _typeof(r) && r && !r.nodeType && r,
            _ = "object" == _typeof(e) && e;
          _.global !== _ && _.window !== _ && _.self !== _ || (i = _);
          var b,
            x,
            T = 2147483647,
            w = 36,
            E = 1,
            S = 26,
            O = 38,
            M = 700,
            P = 72,
            C = 128,
            R = "-",
            A = /^xn--/,
            I = /[^\x20-\x7E]/,
            D = /[\x2E\u3002\uFF0E\uFF61]/g,
            L = {
              overflow: "Overflow: input needs wider integers to process",
              "not-basic": "Illegal input >= 0x80 (not a basic code point)",
              "invalid-input": "Invalid input"
            },
            N = w - E,
            B = Math.floor,
            k = String.fromCharCode;
          if (b = {
              version: "1.4.1",
              ucs2: {
                decode: u,
                encode: h
              },
              decode: f,
              encode: p,
              toASCII: g,
              toUnicode: v
            }, "function" == typeof t && "object" == _typeof(t.amd) && t.amd) t("punycode", function () {
            return b;
          });
          else if (y && m) {
            if (r.exports == y) m.exports = b;
            else
              for (x in b) b.hasOwnProperty(x) && (y[x] = b[x]);
          } else i.punycode = b;
        }(this);
      }).call(this, "undefined" != typeof __webpack_require__.g ? __webpack_require__.g : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {}],
    28: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        return Object.prototype.hasOwnProperty.call(t, e);
      }
      e.exports = function (t, e, r, o) {
        e = e || "&", r = r || "=";
        var s = {};
        if ("string" != typeof t || 0 === t.length) return s;
        var a = /\+/g;
        t = t.split(e);
        var u = 1e3;
        o && "number" == typeof o.maxKeys && (u = o.maxKeys);
        var h = t.length;
        u > 0 && h > u && (h = u);
        for (var l = 0; l < h; ++l) {
          var c,
            d,
            f,
            p,
            v = t[l].replace(a, "%20"),
            g = v.indexOf(r);
          g >= 0 ? (c = v.substr(0, g), d = v.substr(g + 1)) : (c = v, d = ""), f = decodeURIComponent(c), p = decodeURIComponent(d), n(s, f) ? i(s[f]) ? s[f].push(p) : s[f] = [s[f], p] : s[f] = p;
        }
        return s;
      };
      var i = Array.isArray || function (t) {
        return "[object Array]" === Object.prototype.toString.call(t);
      };
    }, {}],
    29: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (t.map) return t.map(e);
        for (var r = [], n = 0; n < t.length; n++) r.push(e(t[n], n));
        return r;
      }
      var i = function i(t) {
        switch (_typeof(t)) {
          case "string":
            return t;
          case "boolean":
            return t ? "true" : "false";
          case "number":
            return isFinite(t) ? t : "";
          default:
            return "";
        }
      };
      e.exports = function (t, e, r, a) {
        return e = e || "&", r = r || "=", null === t && (t = void 0), "object" == _typeof(t) ? n(s(t), function (s) {
          var a = encodeURIComponent(i(s)) + r;
          return o(t[s]) ? n(t[s], function (t) {
            return a + encodeURIComponent(i(t));
          }).join(e) : a + encodeURIComponent(i(t[s]));
        }).join(e) : a ? encodeURIComponent(i(a)) + r + encodeURIComponent(i(t)) : "";
      };
      var o = Array.isArray || function (t) {
          return "[object Array]" === Object.prototype.toString.call(t);
        },
        s = Object.keys || function (t) {
          var e = [];
          for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && e.push(r);
          return e;
        };
    }, {}],
    30: [function (t, e, r) {
      "use strict";

      r.decode = r.parse = t("./decode"), r.encode = r.stringify = t("./encode");
    }, {
      "./decode": 28,
      "./encode": 29
    }],
    31: [function (t, e, r) {
      "use strict";

      e.exports = function (t, e, r) {
        var n,
          i = t.length;
        if (!(e >= i || 0 === r)) {
          r = e + r > i ? i - e : r;
          var o = i - r;
          for (n = e; n < o; ++n) t[n] = t[n + r];
          t.length = o;
        }
      };
    }, {}],
    32: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0, r.Loader = void 0;
      var o = "function" == typeof Symbol && "symbol" == _typeof(Symbol.iterator) ? function (t) {
          return _typeof(t);
        } : function (t) {
          return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : _typeof(t);
        },
        s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("mini-signals"),
        u = n(a),
        h = t("parse-uri"),
        l = n(h),
        c = t("./async"),
        d = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(c),
        f = t("./Resource"),
        p = /(#[\w-]+)?$/,
        v = r.Loader = function () {
          function t() {
            var e = this,
              r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "",
              n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 10;
            i(this, t), this.baseUrl = r, this.progress = 0, this.loading = !1, this.defaultQueryString = "", this._beforeMiddleware = [], this._afterMiddleware = [], this._resourcesParsing = [], this._boundLoadResource = function (t, r) {
              return e._loadResource(t, r);
            }, this._queue = d.queue(this._boundLoadResource, n), this._queue.pause(), this.resources = {}, this.onProgress = new u["default"](), this.onError = new u["default"](), this.onLoad = new u["default"](), this.onStart = new u["default"](), this.onComplete = new u["default"]();
            for (var o = 0; o < t._defaultBeforeMiddleware.length; ++o) this.pre(t._defaultBeforeMiddleware[o]);
            for (var s = 0; s < t._defaultAfterMiddleware.length; ++s) this.use(t._defaultAfterMiddleware[s]);
          }
          return t.prototype.add = function (t, e, r, n) {
            if (Array.isArray(t)) {
              for (var i = 0; i < t.length; ++i) this.add(t[i]);
              return this;
            }
            if ("object" === (void 0 === t ? "undefined" : o(t)) && (n = e || t.callback || t.onComplete, r = t, e = t.url, t = t.name || t.key || t.url), "string" != typeof e && (n = r, r = e, e = t), "string" != typeof e) throw new Error("No url passed to add resource to loader.");
            if ("function" == typeof r && (n = r, r = null), this.loading && (!r || !r.parentResource)) throw new Error("Cannot add resources while the loader is running.");
            if (this.resources[t]) throw new Error('Resource named "' + t + '" already exists.');
            if (e = this._prepareUrl(e), this.resources[t] = new f.Resource(t, e, r), "function" == typeof n && this.resources[t].onAfterMiddleware.once(n), this.loading) {
              for (var s = r.parentResource, a = [], u = 0; u < s.children.length; ++u) s.children[u].isComplete || a.push(s.children[u]);
              var h = s.progressChunk * (a.length + 1),
                l = h / (a.length + 2);
              s.children.push(this.resources[t]), s.progressChunk = l;
              for (var c = 0; c < a.length; ++c) a[c].progressChunk = l;
              this.resources[t].progressChunk = l;
            }
            return this._queue.push(this.resources[t]), this;
          }, t.prototype.pre = function (t) {
            return this._beforeMiddleware.push(t), this;
          }, t.prototype.use = function (t) {
            return this._afterMiddleware.push(t), this;
          }, t.prototype.reset = function () {
            this.progress = 0, this.loading = !1, this._queue.kill(), this._queue.pause();
            for (var t in this.resources) {
              var e = this.resources[t];
              e._onLoadBinding && e._onLoadBinding.detach(), e.isLoading && e.abort();
            }
            return this.resources = {}, this;
          }, t.prototype.load = function (t) {
            if ("function" == typeof t && this.onComplete.once(t), this.loading) return this;
            if (this._queue.idle()) this._onStart(), this._onComplete();
            else {
              for (var e = this._queue._tasks.length, r = 100 / e, n = 0; n < this._queue._tasks.length; ++n) this._queue._tasks[n].data.progressChunk = r;
              this._onStart(), this._queue.resume();
            }
            return this;
          }, t.prototype._prepareUrl = function (t) {
            var e = (0, l["default"])(t, {
                strictMode: !0
              }),
              r = void 0;
            if (r = e.protocol || !e.path || 0 === t.indexOf("//") ? t : this.baseUrl.length && this.baseUrl.lastIndexOf("/") !== this.baseUrl.length - 1 && "/" !== t.charAt(0) ? this.baseUrl + "/" + t : this.baseUrl + t, this.defaultQueryString) {
              var n = p.exec(r)[0];
              r = r.substr(0, r.length - n.length), -1 !== r.indexOf("?") ? r += "&" + this.defaultQueryString : r += "?" + this.defaultQueryString, r += n;
            }
            return r;
          }, t.prototype._loadResource = function (t, e) {
            var r = this;
            t._dequeue = e, d.eachSeries(this._beforeMiddleware, function (e, n) {
              e.call(r, t, function () {
                n(t.isComplete ? {} : null);
              });
            }, function () {
              t.isComplete ? r._onLoad(t) : (t._onLoadBinding = t.onComplete.once(r._onLoad, r), t.load());
            }, !0);
          }, t.prototype._onStart = function () {
            this.progress = 0, this.loading = !0, this.onStart.dispatch(this);
          }, t.prototype._onComplete = function () {
            this.progress = 100, this.loading = !1, this.onComplete.dispatch(this, this.resources);
          }, t.prototype._onLoad = function (t) {
            var e = this;
            t._onLoadBinding = null, this._resourcesParsing.push(t), t._dequeue(), d.eachSeries(this._afterMiddleware, function (r, n) {
              r.call(e, t, n);
            }, function () {
              t.onAfterMiddleware.dispatch(t), e.progress = Math.min(100, e.progress + t.progressChunk), e.onProgress.dispatch(e, t), t.error ? e.onError.dispatch(t.error, e, t) : e.onLoad.dispatch(e, t), e._resourcesParsing.splice(e._resourcesParsing.indexOf(t), 1), e._queue.idle() && 0 === e._resourcesParsing.length && e._onComplete();
            }, !0);
          }, s(t, [{
            key: "concurrency",
            get: function get() {
              return this._queue.concurrency;
            },
            set: function set(t) {
              this._queue.concurrency = t;
            }
          }]), t;
        }();
      v._defaultBeforeMiddleware = [], v._defaultAfterMiddleware = [], v.pre = function (t) {
        return v._defaultBeforeMiddleware.push(t), v;
      }, v.use = function (t) {
        return v._defaultAfterMiddleware.push(t), v;
      };
    }, {
      "./Resource": 33,
      "./async": 34,
      "mini-signals": 5,
      "parse-uri": 7
    }],
    33: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o() {}

      function s(t, e, r) {
        e && 0 === e.indexOf(".") && (e = e.substring(1)), e && (t[e] = r);
      }

      function a(t) {
        return t.toString().replace("object ", "");
      }
      r.__esModule = !0, r.Resource = void 0;
      var u = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        h = t("parse-uri"),
        l = n(h),
        c = t("mini-signals"),
        d = n(c),
        f = !(!window.XDomainRequest || "withCredentials" in new XMLHttpRequest()),
        p = null,
        v = r.Resource = function () {
          function t(e, r, n) {
            if (i(this, t), "string" != typeof e || "string" != typeof r) throw new Error("Both name and url are required for constructing a resource.");
            n = n || {}, this._flags = 0, this._setFlag(t.STATUS_FLAGS.DATA_URL, 0 === r.indexOf("data:")), this.name = e, this.url = r, this.extension = this._getExtension(), this.data = null, this.crossOrigin = "anonymous", this.timeout = n.timeout || 0, this.loadType = n.loadType || this._determineLoadType(), this.xhrType = n.xhrType, this.metadata = n.metadata || {}, this.error = null, this.xhr = null, this.children = [], this.type = t.TYPE.UNKNOWN, this.progressChunk = 0, this._dequeue = o, this._onLoadBinding = null, this._elementTimer = 0, this._boundComplete = this.complete.bind(this), this._boundOnError = this._onError.bind(this), this._boundOnProgress = this._onProgress.bind(this), this._boundOnTimeout = this._onTimeout.bind(this), this._boundXhrOnError = this._xhrOnError.bind(this), this._boundXhrOnTimeout = this._xhrOnTimeout.bind(this), this._boundXhrOnAbort = this._xhrOnAbort.bind(this), this._boundXhrOnLoad = this._xhrOnLoad.bind(this), this.onStart = new d["default"](), this.onProgress = new d["default"](), this.onComplete = new d["default"](), this.onAfterMiddleware = new d["default"]();
          }
          return t.setExtensionLoadType = function (e, r) {
            s(t._loadTypeMap, e, r);
          }, t.setExtensionXhrType = function (e, r) {
            s(t._xhrTypeMap, e, r);
          }, t.prototype.complete = function () {
            this._clearEvents(), this._finish();
          }, t.prototype.abort = function (e) {
            if (!this.error) {
              if (this.error = new Error(e), this._clearEvents(), this.xhr) this.xhr.abort();
              else if (this.xdr) this.xdr.abort();
              else if (this.data)
                if (this.data.src) this.data.src = t.EMPTY_GIF;
                else
                  for (; this.data.firstChild;) this.data.removeChild(this.data.firstChild);
              this._finish();
            }
          }, t.prototype.load = function (e) {
            var r = this;
            if (!this.isLoading) {
              if (this.isComplete) return void(e && setTimeout(function () {
                return e(r);
              }, 1));
              switch (e && this.onComplete.once(e), this._setFlag(t.STATUS_FLAGS.LOADING, !0), this.onStart.dispatch(this), !1 !== this.crossOrigin && "string" == typeof this.crossOrigin || (this.crossOrigin = this._determineCrossOrigin(this.url)), this.loadType) {
                case t.LOAD_TYPE.IMAGE:
                  this.type = t.TYPE.IMAGE, this._loadElement("image");
                  break;
                case t.LOAD_TYPE.AUDIO:
                  this.type = t.TYPE.AUDIO, this._loadSourceElement("audio");
                  break;
                case t.LOAD_TYPE.VIDEO:
                  this.type = t.TYPE.VIDEO, this._loadSourceElement("video");
                  break;
                case t.LOAD_TYPE.XHR:
                default:
                  f && this.crossOrigin ? this._loadXdr() : this._loadXhr();
              }
            }
          }, t.prototype._hasFlag = function (t) {
            return 0 != (this._flags & t);
          }, t.prototype._setFlag = function (t, e) {
            this._flags = e ? this._flags | t : this._flags & ~t;
          }, t.prototype._clearEvents = function () {
            clearTimeout(this._elementTimer), this.data && this.data.removeEventListener && (this.data.removeEventListener("error", this._boundOnError, !1), this.data.removeEventListener("load", this._boundComplete, !1), this.data.removeEventListener("progress", this._boundOnProgress, !1), this.data.removeEventListener("canplaythrough", this._boundComplete, !1)), this.xhr && (this.xhr.removeEventListener ? (this.xhr.removeEventListener("error", this._boundXhrOnError, !1), this.xhr.removeEventListener("timeout", this._boundXhrOnTimeout, !1), this.xhr.removeEventListener("abort", this._boundXhrOnAbort, !1), this.xhr.removeEventListener("progress", this._boundOnProgress, !1), this.xhr.removeEventListener("load", this._boundXhrOnLoad, !1)) : (this.xhr.onerror = null, this.xhr.ontimeout = null, this.xhr.onprogress = null, this.xhr.onload = null));
          }, t.prototype._finish = function () {
            if (this.isComplete) throw new Error("Complete called again for an already completed resource.");
            this._setFlag(t.STATUS_FLAGS.COMPLETE, !0), this._setFlag(t.STATUS_FLAGS.LOADING, !1), this.onComplete.dispatch(this);
          }, t.prototype._loadElement = function (t) {
            this.metadata.loadElement ? this.data = this.metadata.loadElement : "image" === t && void 0 !== window.Image ? this.data = new Image() : this.data = document.createElement(t), this.crossOrigin && (this.data.crossOrigin = this.crossOrigin), this.metadata.skipSource || (this.data.src = this.url), this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1), this.timeout && (this._elementTimer = setTimeout(this._boundOnTimeout, this.timeout));
          }, t.prototype._loadSourceElement = function (t) {
            if (this.metadata.loadElement ? this.data = this.metadata.loadElement : "audio" === t && void 0 !== window.Audio ? this.data = new Audio() : this.data = document.createElement(t), null === this.data) return void this.abort("Unsupported element: " + t);
            if (this.crossOrigin && (this.data.crossOrigin = this.crossOrigin), !this.metadata.skipSource)
              if (navigator.isCocoonJS) this.data.src = Array.isArray(this.url) ? this.url[0] : this.url;
              else if (Array.isArray(this.url))
              for (var e = this.metadata.mimeType, r = 0; r < this.url.length; ++r) this.data.appendChild(this._createSource(t, this.url[r], Array.isArray(e) ? e[r] : e));
            else {
              var n = this.metadata.mimeType;
              this.data.appendChild(this._createSource(t, this.url, Array.isArray(n) ? n[0] : n));
            }
            this.data.addEventListener("error", this._boundOnError, !1), this.data.addEventListener("load", this._boundComplete, !1), this.data.addEventListener("progress", this._boundOnProgress, !1), this.data.addEventListener("canplaythrough", this._boundComplete, !1), this.data.load(), this.timeout && (this._elementTimer = setTimeout(this._boundOnTimeout, this.timeout));
          }, t.prototype._loadXhr = function () {
            "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType());
            var e = this.xhr = new XMLHttpRequest();
            e.open("GET", this.url, !0), e.timeout = this.timeout, this.xhrType === t.XHR_RESPONSE_TYPE.JSON || this.xhrType === t.XHR_RESPONSE_TYPE.DOCUMENT ? e.responseType = t.XHR_RESPONSE_TYPE.TEXT : e.responseType = this.xhrType,
            e.onerror = this._boundXhrOnError,
            e.ontimeout = this._boundXhrOnTimeout,
            e.onabort = this._boundXhrOnAbort,
            e.onprogress = this._boundOnProgress,
            e.onload = this._boundXhrOnLoad,
            e.send();
          }, t.prototype._loadXdr = function () {
            "string" != typeof this.xhrType && (this.xhrType = this._determineXhrType());
            var t = this.xhr = new XDomainRequest();
            t.timeout = this.timeout || 5e3, t.onerror = this._boundXhrOnError, t.ontimeout = this._boundXhrOnTimeout, t.onprogress = this._boundOnProgress, t.onload = this._boundXhrOnLoad, t.open("GET", this.url, !0), setTimeout(function () {
              return t.send();
            }, 1);
          }, t.prototype._createSource = function (t, e, r) {
            r || (r = t + "/" + this._getExtension(e));
            var n = document.createElement("source");
            return n.src = e, n.type = r, n;
          }, t.prototype._onError = function (t) {
            this.abort("Failed to load element using: " + t.target.nodeName);
          }, t.prototype._onProgress = function (t) {
            t && t.lengthComputable && this.onProgress.dispatch(this, t.loaded / t.total);
          }, t.prototype._onTimeout = function () {
            this.abort("Load timed out.");
          }, t.prototype._xhrOnError = function () {
            var t = this.xhr;
            this.abort(a(t) + " Request failed. Status: " + t.status + ', text: "' + t.statusText + '"');
          }, t.prototype._xhrOnTimeout = function () {
            var t = this.xhr;
            this.abort(a(t) + " Request timed out.");
          }, t.prototype._xhrOnAbort = function () {
            var t = this.xhr;
            this.abort(a(t) + " Request was aborted by the user.");
          }, t.prototype._xhrOnLoad = function () {
            var e = this.xhr,
              r = "",
              n = void 0 === e.status ? 200 : e.status;
            if ("" !== e.responseType && "text" !== e.responseType && void 0 !== e.responseType || (r = e.responseText), 0 === n && (r.length > 0 || e.responseType === t.XHR_RESPONSE_TYPE.BUFFER) ? n = 200 : 1223 === n && (n = 204), 2 != (n / 100 | 0)) return void this.abort("[" + e.status + "] " + e.statusText + ": " + e.responseURL);
            if (this.xhrType === t.XHR_RESPONSE_TYPE.TEXT) this.data = r, this.type = t.TYPE.TEXT;
            else if (this.xhrType === t.XHR_RESPONSE_TYPE.JSON) try {
              this.data = JSON.parse(r), this.type = t.TYPE.JSON;
            } catch (t) {
              return void this.abort("Error trying to parse loaded json: " + t);
            } else if (this.xhrType === t.XHR_RESPONSE_TYPE.DOCUMENT) try {
              if (window.DOMParser) {
                var i = new DOMParser();
                this.data = i.parseFromString(r, "text/xml");
              } else {
                var o = document.createElement("div");
                o.innerHTML = r, this.data = o;
              }
              this.type = t.TYPE.XML;
            } catch (t) {
              return void this.abort("Error trying to parse loaded xml: " + t);
            } else this.data = e.response || r;
            this.complete();
          }, t.prototype._determineCrossOrigin = function (t, e) {
            if (0 === t.indexOf("data:")) return "";
            if (window.origin !== window.location.origin) return "anonymous";
            e = e || window.location, p || (p = document.createElement("a")), p.href = t, t = (0, l["default"])(p.href, {
              strictMode: !0
            });
            var r = !t.port && "" === e.port || t.port === e.port,
              n = t.protocol ? t.protocol + ":" : "";
            return t.host === e.hostname && r && n === e.protocol ? "" : "anonymous";
          }, t.prototype._determineXhrType = function () {
            return t._xhrTypeMap[this.extension] || t.XHR_RESPONSE_TYPE.TEXT;
          }, t.prototype._determineLoadType = function () {
            return t._loadTypeMap[this.extension] || t.LOAD_TYPE.XHR;
          }, t.prototype._getExtension = function () {
            var t = this.url,
              e = "";
            if (this.isDataUrl) {
              var r = t.indexOf("/");
              e = t.substring(r + 1, t.indexOf(";", r));
            } else {
              var n = t.indexOf("?"),
                i = t.indexOf("#"),
                o = Math.min(n > -1 ? n : t.length, i > -1 ? i : t.length);
              t = t.substring(0, o), e = t.substring(t.lastIndexOf(".") + 1);
            }
            return e.toLowerCase();
          }, t.prototype._getMimeFromXhrType = function (e) {
            switch (e) {
              case t.XHR_RESPONSE_TYPE.BUFFER:
                return "application/octet-binary";
              case t.XHR_RESPONSE_TYPE.BLOB:
                return "application/blob";
              case t.XHR_RESPONSE_TYPE.DOCUMENT:
                return "application/xml";
              case t.XHR_RESPONSE_TYPE.JSON:
                return "application/json";
              case t.XHR_RESPONSE_TYPE.DEFAULT:
              case t.XHR_RESPONSE_TYPE.TEXT:
              default:
                return "text/plain";
            }
          }, u(t, [{
            key: "isDataUrl",
            get: function get() {
              return this._hasFlag(t.STATUS_FLAGS.DATA_URL);
            }
          }, {
            key: "isComplete",
            get: function get() {
              return this._hasFlag(t.STATUS_FLAGS.COMPLETE);
            }
          }, {
            key: "isLoading",
            get: function get() {
              return this._hasFlag(t.STATUS_FLAGS.LOADING);
            }
          }]), t;
        }();
      v.STATUS_FLAGS = {
        NONE: 0,
        DATA_URL: 1,
        COMPLETE: 2,
        LOADING: 4
      }, v.TYPE = {
        UNKNOWN: 0,
        JSON: 1,
        XML: 2,
        IMAGE: 3,
        AUDIO: 4,
        VIDEO: 5,
        TEXT: 6
      }, v.LOAD_TYPE = {
        XHR: 1,
        IMAGE: 2,
        AUDIO: 3,
        VIDEO: 4
      }, v.XHR_RESPONSE_TYPE = {
        DEFAULT: "text",
        BUFFER: "arraybuffer",
        BLOB: "blob",
        DOCUMENT: "document",
        JSON: "json",
        TEXT: "text"
      }, v._loadTypeMap = {
        gif: v.LOAD_TYPE.IMAGE,
        png: v.LOAD_TYPE.IMAGE,
        bmp: v.LOAD_TYPE.IMAGE,
        jpg: v.LOAD_TYPE.IMAGE,
        jpeg: v.LOAD_TYPE.IMAGE,
        tif: v.LOAD_TYPE.IMAGE,
        tiff: v.LOAD_TYPE.IMAGE,
        webp: v.LOAD_TYPE.IMAGE,
        tga: v.LOAD_TYPE.IMAGE,
        svg: v.LOAD_TYPE.IMAGE,
        "svg+xml": v.LOAD_TYPE.IMAGE,
        mp3: v.LOAD_TYPE.AUDIO,
        ogg: v.LOAD_TYPE.AUDIO,
        wav: v.LOAD_TYPE.AUDIO,
        mp4: v.LOAD_TYPE.VIDEO,
        webm: v.LOAD_TYPE.VIDEO
      }, v._xhrTypeMap = {
        xhtml: v.XHR_RESPONSE_TYPE.DOCUMENT,
        html: v.XHR_RESPONSE_TYPE.DOCUMENT,
        htm: v.XHR_RESPONSE_TYPE.DOCUMENT,
        xml: v.XHR_RESPONSE_TYPE.DOCUMENT,
        tmx: v.XHR_RESPONSE_TYPE.DOCUMENT,
        svg: v.XHR_RESPONSE_TYPE.DOCUMENT,
        tsx: v.XHR_RESPONSE_TYPE.DOCUMENT,
        gif: v.XHR_RESPONSE_TYPE.BLOB,
        png: v.XHR_RESPONSE_TYPE.BLOB,
        bmp: v.XHR_RESPONSE_TYPE.BLOB,
        jpg: v.XHR_RESPONSE_TYPE.BLOB,
        jpeg: v.XHR_RESPONSE_TYPE.BLOB,
        tif: v.XHR_RESPONSE_TYPE.BLOB,
        tiff: v.XHR_RESPONSE_TYPE.BLOB,
        webp: v.XHR_RESPONSE_TYPE.BLOB,
        tga: v.XHR_RESPONSE_TYPE.BLOB,
        json: v.XHR_RESPONSE_TYPE.JSON,
        text: v.XHR_RESPONSE_TYPE.TEXT,
        txt: v.XHR_RESPONSE_TYPE.TEXT,
        ttf: v.XHR_RESPONSE_TYPE.BUFFER,
        otf: v.XHR_RESPONSE_TYPE.BUFFER
      }, v.EMPTY_GIF = "data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==", void 0 !== e && (e.exports["default"] = v);
    }, {
      "mini-signals": 5,
      "parse-uri": 7
    }],
    34: [function (t, e, r) {
      "use strict";

      function n() {}

      function i(t, e, r, n) {
        var i = 0,
          o = t.length;
        ! function s(a) {
          if (a || i === o) return void(r && r(a));
          n ? setTimeout(function () {
            e(t[i++], s);
          }, 1) : e(t[i++], s);
        }();
      }

      function o(t) {
        return function () {
          if (null === t) throw new Error("Callback was already called.");
          var e = t;
          t = null, e.apply(this, arguments);
        };
      }

      function s(t, e) {
        function r(t, e, r) {
          if (null != r && "function" != typeof r) throw new Error("task callback must be a function");
          if (a.started = !0, null == t && a.idle()) return void setTimeout(function () {
            return a.drain();
          }, 1);
          var i = {
            data: t,
            callback: "function" == typeof r ? r : n
          };
          e ? a._tasks.unshift(i) : a._tasks.push(i), setTimeout(function () {
            return a.process();
          }, 1);
        }

        function i(t) {
          return function () {
            s -= 1, t.callback.apply(t, arguments), null != arguments[0] && a.error(arguments[0], t.data), s <= a.concurrency - a.buffer && a.unsaturated(), a.idle() && a.drain(), a.process();
          };
        }
        if (null == e) e = 1;
        else if (0 === e) throw new Error("Concurrency must not be zero");
        var s = 0,
          a = {
            _tasks: [],
            concurrency: e,
            saturated: n,
            unsaturated: n,
            buffer: e / 4,
            empty: n,
            drain: n,
            error: n,
            started: !1,
            paused: !1,
            push: function push(t, e) {
              r(t, !1, e);
            },
            kill: function kill() {
              s = 0, a.drain = n, a.started = !1, a._tasks = [];
            },
            unshift: function unshift(t, e) {
              r(t, !0, e);
            },
            process: function process() {
              for (; !a.paused && s < a.concurrency && a._tasks.length;) {
                var e = a._tasks.shift();
                0 === a._tasks.length && a.empty(), s += 1, s === a.concurrency && a.saturated(), t(e.data, o(i(e)));
              }
            },
            length: function length() {
              return a._tasks.length;
            },
            running: function running() {
              return s;
            },
            idle: function idle() {
              return a._tasks.length + s === 0;
            },
            pause: function pause() {
              !0 !== a.paused && (a.paused = !0);
            },
            resume: function resume() {
              if (!1 !== a.paused) {
                a.paused = !1;
                for (var t = 1; t <= a.concurrency; t++) a.process();
              }
            }
          };
        return a;
      }
      r.__esModule = !0, r.eachSeries = i, r.queue = s;
    }, {}],
    35: [function (t, e, r) {
      "use strict";

      function n(t) {
        for (var e = "", r = 0; r < t.length;) {
          for (var n = [0, 0, 0], o = [0, 0, 0, 0], s = 0; s < n.length; ++s) r < t.length ? n[s] = 255 & t.charCodeAt(r++) : n[s] = 0;
          o[0] = n[0] >> 2, o[1] = (3 & n[0]) << 4 | n[1] >> 4, o[2] = (15 & n[1]) << 2 | n[2] >> 6, o[3] = 63 & n[2];
          switch (r - (t.length - 1)) {
            case 2:
              o[3] = 64, o[2] = 64;
              break;
            case 1:
              o[3] = 64;
          }
          for (var a = 0; a < o.length; ++a) e += i.charAt(o[a]);
        }
        return e;
      }
      r.__esModule = !0, r.encodeBinary = n;
      var i = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
      void 0 !== e && (e.exports["default"] = n);
    }, {}],
    36: [function (t, e, r) {
      "use strict";

      var n = t("./Loader").Loader,
        i = t("./Resource").Resource,
        o = t("./async"),
        s = t("./b64");
      n.Resource = i, n.async = o, n.encodeBinary = s, n.base64 = s, e.exports = n, e.exports.Loader = n, e.exports["default"] = n;
    }, {
      "./Loader": 32,
      "./Resource": 33,
      "./async": 34,
      "./b64": 35
    }],
    37: [function (t, e, r) {
      "use strict";

      function n() {
        return function (t, e) {
          if (!t.data) return void e();
          if (t.xhr && t.xhrType === i.Resource.XHR_RESPONSE_TYPE.BLOB)
            if (window.Blob && "string" != typeof t.data) {
              if (0 === t.data.type.indexOf("image")) {
                var r = s.createObjectURL(t.data);
                return t.blob = t.data, t.data = new Image(), t.data.src = r, t.type = i.Resource.TYPE.IMAGE, void(t.data.onload = function () {
                  s.revokeObjectURL(r), t.data.onload = null, e();
                });
              }
            } else {
              var n = t.xhr.getResponseHeader("content-type");
              if (n && 0 === n.indexOf("image")) return t.data = new Image(), t.data.src = "data:" + n + ";base64," + (0, o.encodeBinary)(t.xhr.responseText), t.type = i.Resource.TYPE.IMAGE, void(t.data.onload = function () {
                t.data.onload = null, e();
              });
            }
          e();
        };
      }
      r.__esModule = !0, r.blobMiddlewareFactory = n;
      var i = t("../../Resource"),
        o = t("../../b64"),
        s = window.URL || window.webkitURL;
    }, {
      "../../Resource": 33,
      "../../b64": 35
    }],
    38: [function (t, e, r) {
      "use strict";

      function n() {
        this.protocol = null, this.slashes = null, this.auth = null, this.host = null, this.port = null, this.hostname = null, this.hash = null, this.search = null, this.query = null, this.pathname = null, this.path = null, this.href = null;
      }

      function i(t, e, r) {
        if (t && h.isObject(t) && t instanceof n) return t;
        var i = new n();
        return i.parse(t, e, r), i;
      }

      function o(t) {
        return h.isString(t) && (t = i(t)), t instanceof n ? t.format() : n.prototype.format.call(t);
      }

      function s(t, e) {
        return i(t, !1, !0).resolve(e);
      }

      function a(t, e) {
        return t ? i(t, !1, !0).resolveObject(e) : e;
      }
      var u = t("punycode"),
        h = t("./util");
      r.parse = i, r.resolve = s, r.resolveObject = a, r.format = o, r.Url = n;
      var l = /^([a-z0-9.+-]+:)/i,
        c = /:[0-9]*$/,
        d = /^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,
        f = ["<", ">", '"', "`", " ", "\r", "\n", "\t"],
        p = ["{", "}", "|", "\\", "^", "`"].concat(f),
        v = ["'"].concat(p),
        g = ["%", "/", "?", ";", "#"].concat(v),
        y = ["/", "?", "#"],
        m = /^[+a-z0-9A-Z_-]{0,63}$/,
        _ = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,
        b = {
          javascript: !0,
          "javascript:": !0
        },
        x = {
          javascript: !0,
          "javascript:": !0
        },
        T = {
          http: !0,
          https: !0,
          ftp: !0,
          gopher: !0,
          file: !0,
          "http:": !0,
          "https:": !0,
          "ftp:": !0,
          "gopher:": !0,
          "file:": !0
        },
        w = t("querystring");
      n.prototype.parse = function (t, e, r) {
        if (!h.isString(t)) throw new TypeError("Parameter 'url' must be a string, not " + _typeof(t));
        var n = t.indexOf("?"),
          i = -1 !== n && n < t.indexOf("#") ? "?" : "#",
          o = t.split(i),
          s = /\\/g;
        o[0] = o[0].replace(s, "/"), t = o.join(i);
        var a = t;
        if (a = a.trim(), !r && 1 === t.split("#").length) {
          var c = d.exec(a);
          if (c) return this.path = a, this.href = a, this.pathname = c[1], c[2] ? (this.search = c[2], this.query = e ? w.parse(this.search.substr(1)) : this.search.substr(1)) : e && (this.search = "", this.query = {}), this;
        }
        var f = l.exec(a);
        if (f) {
          f = f[0];
          var p = f.toLowerCase();
          this.protocol = p, a = a.substr(f.length);
        }
        if (r || f || a.match(/^\/\/[^@\/]+@[^@\/]+/)) {
          var E = "//" === a.substr(0, 2);
          !E || f && x[f] || (a = a.substr(2), this.slashes = !0);
        }
        if (!x[f] && (E || f && !T[f])) {
          for (var S = -1, O = 0; O < y.length; O++) {
            var M = a.indexOf(y[O]); -
            1 !== M && (-1 === S || M < S) && (S = M);
          }
          var P, C;
          C = -1 === S ? a.lastIndexOf("@") : a.lastIndexOf("@", S), -1 !== C && (P = a.slice(0, C), a = a.slice(C + 1), this.auth = decodeURIComponent(P)), S = -1;
          for (var O = 0; O < g.length; O++) {
            var M = a.indexOf(g[O]); -
            1 !== M && (-1 === S || M < S) && (S = M);
          } -
          1 === S && (S = a.length), this.host = a.slice(0, S), a = a.slice(S), this.parseHost(), this.hostname = this.hostname || "";
          var R = "[" === this.hostname[0] && "]" === this.hostname[this.hostname.length - 1];
          if (!R)
            for (var A = this.hostname.split(/\./), O = 0, I = A.length; O < I; O++) {
              var D = A[O];
              if (D && !D.match(m)) {
                for (var L = "", N = 0, B = D.length; N < B; N++) D.charCodeAt(N) > 127 ? L += "x" : L += D[N];
                if (!L.match(m)) {
                  var k = A.slice(0, O),
                    F = A.slice(O + 1),
                    j = D.match(_);
                  j && (k.push(j[1]), F.unshift(j[2])), F.length && (a = "/" + F.join(".") + a), this.hostname = k.join(".");
                  break;
                }
              }
            }
          this.hostname.length > 255 ? this.hostname = "" : this.hostname = this.hostname.toLowerCase(), R || (this.hostname = u.toASCII(this.hostname));
          var U = this.port ? ":" + this.port : "",
            X = this.hostname || "";
          this.host = X + U, this.href += this.host, R && (this.hostname = this.hostname.substr(1, this.hostname.length - 2), "/" !== a[0] && (a = "/" + a));
        }
        if (!b[p])
          for (var O = 0, I = v.length; O < I; O++) {
            var G = v[O];
            if (-1 !== a.indexOf(G)) {
              var W = encodeURIComponent(G);
              W === G && (W = escape(G)), a = a.split(G).join(W);
            }
          }
        var H = a.indexOf("#"); -
        1 !== H && (this.hash = a.substr(H), a = a.slice(0, H));
        var Y = a.indexOf("?");
        if (-1 !== Y ? (this.search = a.substr(Y), this.query = a.substr(Y + 1), e && (this.query = w.parse(this.query)), a = a.slice(0, Y)) : e && (this.search = "", this.query = {}), a && (this.pathname = a), T[p] && this.hostname && !this.pathname && (this.pathname = "/"), this.pathname || this.search) {
          var U = this.pathname || "",
            V = this.search || "";
          this.path = U + V;
        }
        return this.href = this.format(), this;
      }, n.prototype.format = function () {
        var t = this.auth || "";
        t && (t = encodeURIComponent(t), t = t.replace(/%3A/i, ":"), t += "@");
        var e = this.protocol || "",
          r = this.pathname || "",
          n = this.hash || "",
          i = !1,
          o = "";
        this.host ? i = t + this.host : this.hostname && (i = t + (-1 === this.hostname.indexOf(":") ? this.hostname : "[" + this.hostname + "]"), this.port && (i += ":" + this.port)), this.query && h.isObject(this.query) && Object.keys(this.query).length && (o = w.stringify(this.query));
        var s = this.search || o && "?" + o || "";
        return e && ":" !== e.substr(-1) && (e += ":"), this.slashes || (!e || T[e]) && !1 !== i ? (i = "//" + (i || ""), r && "/" !== r.charAt(0) && (r = "/" + r)) : i || (i = ""), n && "#" !== n.charAt(0) && (n = "#" + n), s && "?" !== s.charAt(0) && (s = "?" + s), r = r.replace(/[?#]/g, function (t) {
          return encodeURIComponent(t);
        }), s = s.replace("#", "%23"), e + i + r + s + n;
      }, n.prototype.resolve = function (t) {
        return this.resolveObject(i(t, !1, !0)).format();
      }, n.prototype.resolveObject = function (t) {
        if (h.isString(t)) {
          var e = new n();
          e.parse(t, !1, !0), t = e;
        }
        for (var r = new n(), i = Object.keys(this), o = 0; o < i.length; o++) {
          var s = i[o];
          r[s] = this[s];
        }
        if (r.hash = t.hash, "" === t.href) return r.href = r.format(), r;
        if (t.slashes && !t.protocol) {
          for (var a = Object.keys(t), u = 0; u < a.length; u++) {
            var l = a[u];
            "protocol" !== l && (r[l] = t[l]);
          }
          return T[r.protocol] && r.hostname && !r.pathname && (r.path = r.pathname = "/"), r.href = r.format(), r;
        }
        if (t.protocol && t.protocol !== r.protocol) {
          if (!T[t.protocol]) {
            for (var c = Object.keys(t), d = 0; d < c.length; d++) {
              var f = c[d];
              r[f] = t[f];
            }
            return r.href = r.format(), r;
          }
          if (r.protocol = t.protocol, t.host || x[t.protocol]) r.pathname = t.pathname;
          else {
            for (var p = (t.pathname || "").split("/"); p.length && !(t.host = p.shift()););
            t.host || (t.host = ""), t.hostname || (t.hostname = ""), "" !== p[0] && p.unshift(""), p.length < 2 && p.unshift(""), r.pathname = p.join("/");
          }
          if (r.search = t.search, r.query = t.query, r.host = t.host || "", r.auth = t.auth, r.hostname = t.hostname || t.host, r.port = t.port, r.pathname || r.search) {
            var v = r.pathname || "",
              g = r.search || "";
            r.path = v + g;
          }
          return r.slashes = r.slashes || t.slashes, r.href = r.format(), r;
        }
        var y = r.pathname && "/" === r.pathname.charAt(0),
          m = t.host || t.pathname && "/" === t.pathname.charAt(0),
          _ = m || y || r.host && t.pathname,
          b = _,
          w = r.pathname && r.pathname.split("/") || [],
          p = t.pathname && t.pathname.split("/") || [],
          E = r.protocol && !T[r.protocol];
        if (E && (r.hostname = "", r.port = null, r.host && ("" === w[0] ? w[0] = r.host : w.unshift(r.host)), r.host = "", t.protocol && (t.hostname = null, t.port = null, t.host && ("" === p[0] ? p[0] = t.host : p.unshift(t.host)), t.host = null), _ = _ && ("" === p[0] || "" === w[0])), m) r.host = t.host || "" === t.host ? t.host : r.host, r.hostname = t.hostname || "" === t.hostname ? t.hostname : r.hostname, r.search = t.search, r.query = t.query, w = p;
        else if (p.length) w || (w = []), w.pop(), w = w.concat(p), r.search = t.search, r.query = t.query;
        else if (!h.isNullOrUndefined(t.search)) {
          if (E) {
            r.hostname = r.host = w.shift();
            var S = !!(r.host && r.host.indexOf("@") > 0) && r.host.split("@");
            S && (r.auth = S.shift(), r.host = r.hostname = S.shift());
          }
          return r.search = t.search, r.query = t.query, h.isNull(r.pathname) && h.isNull(r.search) || (r.path = (r.pathname ? r.pathname : "") + (r.search ? r.search : "")), r.href = r.format(), r;
        }
        if (!w.length) return r.pathname = null, r.search ? r.path = "/" + r.search : r.path = null, r.href = r.format(), r;
        for (var O = w.slice(-1)[0], M = (r.host || t.host || w.length > 1) && ("." === O || ".." === O) || "" === O, P = 0, C = w.length; C >= 0; C--) O = w[C], "." === O ? w.splice(C, 1) : ".." === O ? (w.splice(C, 1), P++) : P && (w.splice(C, 1), P--);
        if (!_ && !b)
          for (; P--; P) w.unshift("..");
        !_ || "" === w[0] || w[0] && "/" === w[0].charAt(0) || w.unshift(""), M && "/" !== w.join("/").substr(-1) && w.push("");
        var R = "" === w[0] || w[0] && "/" === w[0].charAt(0);
        if (E) {
          r.hostname = r.host = R ? "" : w.length ? w.shift() : "";
          var S = !!(r.host && r.host.indexOf("@") > 0) && r.host.split("@");
          S && (r.auth = S.shift(), r.host = r.hostname = S.shift());
        }
        return _ = _ || r.host && w.length, _ && !R && w.unshift(""), w.length ? r.pathname = w.join("/") : (r.pathname = null, r.path = null), h.isNull(r.pathname) && h.isNull(r.search) || (r.path = (r.pathname ? r.pathname : "") + (r.search ? r.search : "")), r.auth = t.auth || r.auth, r.slashes = r.slashes || t.slashes, r.href = r.format(), r;
      }, n.prototype.parseHost = function () {
        var t = this.host,
          e = c.exec(t);
        e && (e = e[0], ":" !== e && (this.port = e.substr(1)), t = t.substr(0, t.length - e.length)), t && (this.hostname = t);
      };
    }, {
      "./util": 39,
      punycode: 27,
      querystring: 30
    }],
    39: [function (t, e, r) {
      "use strict";

      e.exports = {
        isString: function isString(t) {
          return "string" == typeof t;
        },
        isObject: function isObject(t) {
          return "object" == _typeof(t) && null !== t;
        },
        isNull: function isNull(t) {
          return null === t;
        },
        isNullOrUndefined: function isNullOrUndefined(t) {
          return null == t;
        }
      };
    }, {}],
    40: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = t("../core"),
        s = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(o),
        a = t("ismobilejs"),
        u = n(a),
        h = t("./accessibleTarget"),
        l = n(h);
      s.utils.mixins.delayMixin(s.DisplayObject.prototype, l["default"]);
      var c = 100,
        d = 0,
        f = 0,
        p = 2,
        v = function () {
          function t(e) {
            i(this, t), !u["default"].tablet && !u["default"].phone || navigator.isCocoonJS || this.createTouchHook();
            var r = document.createElement("div");
            r.style.width = c + "px", r.style.height = c + "px", r.style.position = "absolute", r.style.top = d + "px", r.style.left = f + "px", r.style.zIndex = p, this.div = r, this.pool = [], this.renderId = 0, this.debug = !1, this.renderer = e, this.children = [], this._onKeyDown = this._onKeyDown.bind(this), this._onMouseMove = this._onMouseMove.bind(this), this.isActive = !1, this.isMobileAccessabillity = !1, window.addEventListener("keydown", this._onKeyDown, !1);
          }
          return t.prototype.createTouchHook = function () {
            var t = this,
              e = document.createElement("button");
            e.style.width = "1px", e.style.height = "1px", e.style.position = "absolute", e.style.top = "-1000px", e.style.left = "-1000px", e.style.zIndex = 2, e.style.backgroundColor = "#FF0000", e.title = "HOOK DIV", e.addEventListener("focus", function () {
              t.isMobileAccessabillity = !0, t.activate(), document.body.removeChild(e);
            }), document.body.appendChild(e);
          }, t.prototype.activate = function () {
            this.isActive || (this.isActive = !0, window.document.addEventListener("mousemove", this._onMouseMove, !0), window.removeEventListener("keydown", this._onKeyDown, !1), this.renderer.on("postrender", this.update, this), this.renderer.view.parentNode && this.renderer.view.parentNode.appendChild(this.div));
          }, t.prototype.deactivate = function () {
            this.isActive && !this.isMobileAccessabillity && (this.isActive = !1, window.document.removeEventListener("mousemove", this._onMouseMove, !0), window.addEventListener("keydown", this._onKeyDown, !1), this.renderer.off("postrender", this.update), this.div.parentNode && this.div.parentNode.removeChild(this.div));
          }, t.prototype.updateAccessibleObjects = function (t) {
            if (t.visible) {
              t.accessible && t.interactive && (t._accessibleActive || this.addChild(t), t.renderId = this.renderId);
              for (var e = t.children, r = 0; r < e.length; r++) this.updateAccessibleObjects(e[r]);
            }
          }, t.prototype.update = function () {
            if (this.renderer.renderingToScreen) {
              this.updateAccessibleObjects(this.renderer._lastObjectRendered);
              var t = this.renderer.view.getBoundingClientRect(),
                e = t.width / this.renderer.width,
                r = t.height / this.renderer.height,
                n = this.div;
              n.style.left = t.left + "px", n.style.top = t.top + "px", n.style.width = this.renderer.width + "px", n.style.height = this.renderer.height + "px";
              for (var i = 0; i < this.children.length; i++) {
                var o = this.children[i];
                if (o.renderId !== this.renderId) o._accessibleActive = !1, s.utils.removeItems(this.children, i, 1), this.div.removeChild(o._accessibleDiv), this.pool.push(o._accessibleDiv), o._accessibleDiv = null, i--, 0 === this.children.length && this.deactivate();
                else {
                  n = o._accessibleDiv;
                  var a = o.hitArea,
                    u = o.worldTransform;
                  o.hitArea ? (n.style.left = (u.tx + a.x * u.a) * e + "px", n.style.top = (u.ty + a.y * u.d) * r + "px", n.style.width = a.width * u.a * e + "px", n.style.height = a.height * u.d * r + "px") : (a = o.getBounds(), this.capHitArea(a), n.style.left = a.x * e + "px", n.style.top = a.y * r + "px", n.style.width = a.width * e + "px", n.style.height = a.height * r + "px", n.title !== o.accessibleTitle && null !== o.accessibleTitle && (n.title = o.accessibleTitle), n.getAttribute("aria-label") !== o.accessibleHint && null !== o.accessibleHint && n.setAttribute("aria-label", o.accessibleHint));
                }
              }
              this.renderId++;
            }
          }, t.prototype.capHitArea = function (t) {
            t.x < 0 && (t.width += t.x, t.x = 0), t.y < 0 && (t.height += t.y, t.y = 0), t.x + t.width > this.renderer.width && (t.width = this.renderer.width - t.x), t.y + t.height > this.renderer.height && (t.height = this.renderer.height - t.y);
          }, t.prototype.addChild = function (t) {
            var e = this.pool.pop();
            e || (e = document.createElement("button"), e.style.width = c + "px", e.style.height = c + "px", e.style.backgroundColor = this.debug ? "rgba(255,0,0,0.5)" : "transparent", e.style.position = "absolute", e.style.zIndex = p, e.style.borderStyle = "none", navigator.userAgent.toLowerCase().indexOf("chrome") > -1 ? e.setAttribute("aria-live", "off") : e.setAttribute("aria-live", "polite"), navigator.userAgent.match(/rv:.*Gecko\//) ? e.setAttribute("aria-relevant", "additions") : e.setAttribute("aria-relevant", "text"), e.addEventListener("click", this._onClick.bind(this)), e.addEventListener("focus", this._onFocus.bind(this)), e.addEventListener("focusout", this._onFocusOut.bind(this))), t.accessibleTitle && null !== t.accessibleTitle ? e.title = t.accessibleTitle : t.accessibleHint && null !== t.accessibleHint || (e.title = "displayObject " + t.tabIndex), t.accessibleHint && null !== t.accessibleHint && e.setAttribute("aria-label", t.accessibleHint), t._accessibleActive = !0, t._accessibleDiv = e, e.displayObject = t, this.children.push(t), this.div.appendChild(t._accessibleDiv), t._accessibleDiv.tabIndex = t.tabIndex;
          }, t.prototype._onClick = function (t) {
            var e = this.renderer.plugins.interaction;
            e.dispatchEvent(t.target.displayObject, "click", e.eventData);
          }, t.prototype._onFocus = function (t) {
            t.target.getAttribute("aria-live", "off") || t.target.setAttribute("aria-live", "assertive");
            var e = this.renderer.plugins.interaction;
            e.dispatchEvent(t.target.displayObject, "mouseover", e.eventData);
          }, t.prototype._onFocusOut = function (t) {
            t.target.getAttribute("aria-live", "off") || t.target.setAttribute("aria-live", "polite");
            var e = this.renderer.plugins.interaction;
            e.dispatchEvent(t.target.displayObject, "mouseout", e.eventData);
          }, t.prototype._onKeyDown = function (t) {
            9 === t.keyCode && this.activate();
          }, t.prototype._onMouseMove = function (t) {
            0 === t.movementX && 0 === t.movementY || this.deactivate();
          }, t.prototype.destroy = function () {
            this.div = null;
            for (var t = 0; t < this.children.length; t++) this.children[t].div = null;
            window.document.removeEventListener("mousemove", this._onMouseMove, !0), window.removeEventListener("keydown", this._onKeyDown), this.pool = null, this.children = null, this.renderer = null;
          }, t;
        }();
      r["default"] = v, s.WebGLRenderer.registerPlugin("accessibility", v), s.CanvasRenderer.registerPlugin("accessibility", v);
    }, {
      "../core": 65,
      "./accessibleTarget": 41,
      ismobilejs: 4
    }],
    41: [function (t, e, r) {
      "use strict";

      r.__esModule = !0, r["default"] = {
        accessible: !1,
        accessibleTitle: null,
        accessibleHint: null,
        tabIndex: 0,
        _accessibleActive: !1,
        _accessibleDiv: !1
      };
    }, {}],
    42: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./accessibleTarget");
      Object.defineProperty(r, "accessibleTarget", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./AccessibilityManager");
      Object.defineProperty(r, "AccessibilityManager", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
    }, {
      "./AccessibilityManager": 40,
      "./accessibleTarget": 41
    }],
    43: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        s = t("./autoDetectRenderer"),
        a = t("./display/Container"),
        u = n(a),
        h = t("./ticker"),
        l = t("./settings"),
        c = n(l),
        d = t("./const"),
        f = function () {
          function t(e, r, n, o, a) {
            i(this, t), "number" == typeof e && (e = Object.assign({
              width: e,
              height: r || c["default"].RENDER_OPTIONS.height,
              forceCanvas: !!o,
              sharedTicker: !!a
            }, n)), this._options = e = Object.assign({
              autoStart: !0,
              sharedTicker: !1,
              forceCanvas: !1,
              sharedLoader: !1
            }, e), this.renderer = (0, s.autoDetectRenderer)(e), this.stage = new u["default"](), this._ticker = null, this.ticker = e.sharedTicker ? h.shared : new h.Ticker(), e.autoStart && this.start();
          }
          return t.prototype.render = function () {
            this.renderer.render(this.stage);
          }, t.prototype.stop = function () {
            this._ticker.stop();
          }, t.prototype.start = function () {
            this._ticker.start();
          }, t.prototype.destroy = function (t, e) {
            if (this._ticker) {
              var r = this._ticker;
              this.ticker = null, r.destroy();
            }
            this.stage.destroy(e), this.stage = null, this.renderer.destroy(t), this.renderer = null, this._options = null;
          }, o(t, [{
            key: "ticker",
            set: function set(t) {
              this._ticker && this._ticker.remove(this.render, this), this._ticker = t, t && t.add(this.render, this, d.UPDATE_PRIORITY.LOW);
            },
            get: function get() {
              return this._ticker;
            }
          }, {
            key: "view",
            get: function get() {
              return this.renderer.view;
            }
          }, {
            key: "screen",
            get: function get() {
              return this.renderer.screen;
            }
          }]), t;
        }();
      r["default"] = f;
    }, {
      "./autoDetectRenderer": 45,
      "./const": 46,
      "./display/Container": 48,
      "./settings": 101,
      "./ticker": 121
    }],
    44: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function s(t, e) {
        if (t instanceof Array) {
          if ("precision" !== t[0].substring(0, 9)) {
            var r = t.slice(0);
            return r.unshift("precision " + e + " float;"), r;
          }
        } else if ("precision" !== t.trim().substring(0, 9)) return "precision " + e + " float;\n" + t;
        return t;
      }
      r.__esModule = !0;
      var a = t("pixi-gl-core"),
        u = t("./settings"),
        h = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(u),
        l = function (t) {
          function e(r, o, a, u, l) {
            return n(this, e), i(this, t.call(this, r, s(o, l || h["default"].PRECISION_VERTEX), s(a, l || h["default"].PRECISION_FRAGMENT), void 0, u));
          }
          return o(e, t), e;
        }(a.GLShader);
      r["default"] = l;
    }, {
      "./settings": 101,
      "pixi-gl-core": 15
    }],
    45: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e, r, n) {
        var i = t && t.forceCanvas;
        return void 0 !== n && (i = n), !i && s.isWebGLSupported() ? new l["default"](t, e, r) : new u["default"](t, e, r);
      }
      r.__esModule = !0, r.autoDetectRenderer = i;
      var o = t("./utils"),
        s = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(o),
        a = t("./renderers/canvas/CanvasRenderer"),
        u = n(a),
        h = t("./renderers/webgl/WebGLRenderer"),
        l = n(h);
    }, {
      "./renderers/canvas/CanvasRenderer": 77,
      "./renderers/webgl/WebGLRenderer": 84,
      "./utils": 125
    }],
    46: [function (t, e, r) {
      "use strict";

      r.__esModule = !0;
      r.VERSION = "4.8.8", r.PI_2 = 2 * Math.PI, r.RAD_TO_DEG = 180 / Math.PI, r.DEG_TO_RAD = Math.PI / 180, r.RENDERER_TYPE = {
        UNKNOWN: 0,
        WEBGL: 1,
        CANVAS: 2
      }, r.BLEND_MODES = {
        NORMAL: 0,
        ADD: 1,
        MULTIPLY: 2,
        SCREEN: 3,
        OVERLAY: 4,
        DARKEN: 5,
        LIGHTEN: 6,
        COLOR_DODGE: 7,
        COLOR_BURN: 8,
        HARD_LIGHT: 9,
        SOFT_LIGHT: 10,
        DIFFERENCE: 11,
        EXCLUSION: 12,
        HUE: 13,
        SATURATION: 14,
        COLOR: 15,
        LUMINOSITY: 16,
        NORMAL_NPM: 17,
        ADD_NPM: 18,
        SCREEN_NPM: 19
      }, r.DRAW_MODES = {
        POINTS: 0,
        LINES: 1,
        LINE_LOOP: 2,
        LINE_STRIP: 3,
        TRIANGLES: 4,
        TRIANGLE_STRIP: 5,
        TRIANGLE_FAN: 6
      }, r.SCALE_MODES = {
        LINEAR: 0,
        NEAREST: 1
      }, r.WRAP_MODES = {
        CLAMP: 0,
        REPEAT: 1,
        MIRRORED_REPEAT: 2
      }, r.GC_MODES = {
        AUTO: 0,
        MANUAL: 1
      }, r.URL_FILE_EXTENSION = /\.(\w{3,4})(?:$|\?|#)/i, r.DATA_URI = /^\s*data:(?:([\w-]+)\/([\w+.-]+))?(?:;charset=([\w-]+))?(?:;(base64))?,(.*)/i, r.SVG_SIZE = /<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i, r.SHAPES = {
        POLY: 0,
        RECT: 1,
        CIRC: 2,
        ELIP: 3,
        RREC: 4
      }, r.PRECISION = {
        LOW: "lowp",
        MEDIUM: "mediump",
        HIGH: "highp"
      }, r.TRANSFORM_MODE = {
        STATIC: 0,
        DYNAMIC: 1
      }, r.TEXT_GRADIENT = {
        LINEAR_VERTICAL: 0,
        LINEAR_HORIZONTAL: 1
      }, r.UPDATE_PRIORITY = {
        INTERACTION: 50,
        HIGH: 25,
        NORMAL: 0,
        LOW: -25,
        UTILITY: -50
      };
    }, {}],
    47: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../math"),
        o = function () {
          function t() {
            n(this, t), this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0, this.rect = null;
          }
          return t.prototype.isEmpty = function () {
            return this.minX > this.maxX || this.minY > this.maxY;
          }, t.prototype.clear = function () {
            this.updateID++, this.minX = 1 / 0, this.minY = 1 / 0, this.maxX = -1 / 0, this.maxY = -1 / 0;
          }, t.prototype.getRectangle = function (t) {
            return this.minX > this.maxX || this.minY > this.maxY ? i.Rectangle.EMPTY : (t = t || new i.Rectangle(0, 0, 1, 1), t.x = this.minX, t.y = this.minY, t.width = this.maxX - this.minX, t.height = this.maxY - this.minY, t);
          }, t.prototype.addPoint = function (t) {
            this.minX = Math.min(this.minX, t.x), this.maxX = Math.max(this.maxX, t.x), this.minY = Math.min(this.minY, t.y), this.maxY = Math.max(this.maxY, t.y);
          }, t.prototype.addQuad = function (t) {
            var e = this.minX,
              r = this.minY,
              n = this.maxX,
              i = this.maxY,
              o = t[0],
              s = t[1];
            e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[2], s = t[3], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[4], s = t[5], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, o = t[6], s = t[7], e = o < e ? o : e, r = s < r ? s : r, n = o > n ? o : n, i = s > i ? s : i, this.minX = e, this.minY = r, this.maxX = n, this.maxY = i;
          }, t.prototype.addFrame = function (t, e, r, n, i) {
            var o = t.worldTransform,
              s = o.a,
              a = o.b,
              u = o.c,
              h = o.d,
              l = o.tx,
              c = o.ty,
              d = this.minX,
              f = this.minY,
              p = this.maxX,
              v = this.maxY,
              g = s * e + u * r + l,
              y = a * e + h * r + c;
            d = g < d ? g : d, f = y < f ? y : f, p = g > p ? g : p, v = y > v ? y : v, g = s * n + u * r + l, y = a * n + h * r + c, d = g < d ? g : d, f = y < f ? y : f, p = g > p ? g : p, v = y > v ? y : v, g = s * e + u * i + l, y = a * e + h * i + c, d = g < d ? g : d, f = y < f ? y : f, p = g > p ? g : p, v = y > v ? y : v, g = s * n + u * i + l, y = a * n + h * i + c, d = g < d ? g : d, f = y < f ? y : f, p = g > p ? g : p, v = y > v ? y : v, this.minX = d, this.minY = f, this.maxX = p, this.maxY = v;
          }, t.prototype.addVertices = function (t, e, r, n) {
            for (var i = t.worldTransform, o = i.a, s = i.b, a = i.c, u = i.d, h = i.tx, l = i.ty, c = this.minX, d = this.minY, f = this.maxX, p = this.maxY, v = r; v < n; v += 2) {
              var g = e[v],
                y = e[v + 1],
                m = o * g + a * y + h,
                _ = u * y + s * g + l;
              c = m < c ? m : c, d = _ < d ? _ : d, f = m > f ? m : f, p = _ > p ? _ : p;
            }
            this.minX = c, this.minY = d, this.maxX = f, this.maxY = p;
          }, t.prototype.addBounds = function (t) {
            var e = this.minX,
              r = this.minY,
              n = this.maxX,
              i = this.maxY;
            this.minX = t.minX < e ? t.minX : e, this.minY = t.minY < r ? t.minY : r, this.maxX = t.maxX > n ? t.maxX : n, this.maxY = t.maxY > i ? t.maxY : i;
          }, t.prototype.addBoundsMask = function (t, e) {
            var r = t.minX > e.minX ? t.minX : e.minX,
              n = t.minY > e.minY ? t.minY : e.minY,
              i = t.maxX < e.maxX ? t.maxX : e.maxX,
              o = t.maxY < e.maxY ? t.maxY : e.maxY;
            if (r <= i && n <= o) {
              var s = this.minX,
                a = this.minY,
                u = this.maxX,
                h = this.maxY;
              this.minX = r < s ? r : s, this.minY = n < a ? n : a, this.maxX = i > u ? i : u, this.maxY = o > h ? o : h;
            }
          }, t.prototype.addBoundsArea = function (t, e) {
            var r = t.minX > e.x ? t.minX : e.x,
              n = t.minY > e.y ? t.minY : e.y,
              i = t.maxX < e.x + e.width ? t.maxX : e.x + e.width,
              o = t.maxY < e.y + e.height ? t.maxY : e.y + e.height;
            if (r <= i && n <= o) {
              var s = this.minX,
                a = this.minY,
                u = this.maxX,
                h = this.maxY;
              this.minX = r < s ? r : s, this.minY = n < a ? n : a, this.maxX = i > u ? i : u, this.maxY = o > h ? o : h;
            }
          }, t;
        }();
      r["default"] = o;
    }, {
      "../math": 70
    }],
    48: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../utils"),
        u = t("./DisplayObject"),
        h = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(u),
        l = function (t) {
          function e() {
            n(this, e);
            var r = i(this, t.call(this));
            return r.children = [], r;
          }
          return o(e, t), e.prototype.onChildrenChange = function () {}, e.prototype.addChild = function (t) {
            var e = arguments.length;
            if (e > 1)
              for (var r = 0; r < e; r++) this.addChild(arguments[r]);
            else t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.push(t), this._boundsID++, this.onChildrenChange(this.children.length - 1), t.emit("added", this);
            return t;
          }, e.prototype.addChildAt = function (t, e) {
            if (e < 0 || e > this.children.length) throw new Error(t + "addChildAt: The index " + e + " supplied is out of bounds " + this.children.length);
            return t.parent && t.parent.removeChild(t), t.parent = this, t.transform._parentID = -1, this.children.splice(e, 0, t), this._boundsID++, this.onChildrenChange(e), t.emit("added", this), t;
          }, e.prototype.swapChildren = function (t, e) {
            if (t !== e) {
              var r = this.getChildIndex(t),
                n = this.getChildIndex(e);
              this.children[r] = e, this.children[n] = t, this.onChildrenChange(r < n ? r : n);
            }
          }, e.prototype.getChildIndex = function (t) {
            var e = this.children.indexOf(t);
            if (-1 === e) throw new Error("The supplied DisplayObject must be a child of the caller");
            return e;
          }, e.prototype.setChildIndex = function (t, e) {
            if (e < 0 || e >= this.children.length) throw new Error("The index " + e + " supplied is out of bounds " + this.children.length);
            var r = this.getChildIndex(t);
            (0, a.removeItems)(this.children, r, 1), this.children.splice(e, 0, t), this.onChildrenChange(e);
          }, e.prototype.getChildAt = function (t) {
            if (t < 0 || t >= this.children.length) throw new Error("getChildAt: Index (" + t + ") does not exist.");
            return this.children[t];
          }, e.prototype.removeChild = function (t) {
            var e = arguments.length;
            if (e > 1)
              for (var r = 0; r < e; r++) this.removeChild(arguments[r]);
            else {
              var n = this.children.indexOf(t);
              if (-1 === n) return null;
              t.parent = null, t.transform._parentID = -1, (0, a.removeItems)(this.children, n, 1), this._boundsID++, this.onChildrenChange(n), t.emit("removed", this);
            }
            return t;
          }, e.prototype.removeChildAt = function (t) {
            var e = this.getChildAt(t);
            return e.parent = null, e.transform._parentID = -1, (0, a.removeItems)(this.children, t, 1), this._boundsID++, this.onChildrenChange(t), e.emit("removed", this), e;
          }, e.prototype.removeChildren = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              e = arguments[1],
              r = t,
              n = "number" == typeof e ? e : this.children.length,
              i = n - r,
              o = void 0;
            if (i > 0 && i <= n) {
              o = this.children.splice(r, i);
              for (var s = 0; s < o.length; ++s) o[s].parent = null, o[s].transform && (o[s].transform._parentID = -1);
              this._boundsID++, this.onChildrenChange(t);
              for (var a = 0; a < o.length; ++a) o[a].emit("removed", this);
              return o;
            }
            if (0 === i && 0 === this.children.length) return [];
            throw new RangeError("removeChildren: numeric values are outside the acceptable range.");
          }, e.prototype.updateTransform = function () {
            this._boundsID++, this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha;
            for (var t = 0, e = this.children.length; t < e; ++t) {
              var r = this.children[t];
              r.visible && r.updateTransform();
            }
          }, e.prototype.calculateBounds = function () {
            this._bounds.clear(), this._calculateBounds();
            for (var t = 0; t < this.children.length; t++) {
              var e = this.children[t];
              e.visible && e.renderable && (e.calculateBounds(), e._mask ? (e._mask.calculateBounds(), this._bounds.addBoundsMask(e._bounds, e._mask._bounds)) : e.filterArea ? this._bounds.addBoundsArea(e._bounds, e.filterArea) : this._bounds.addBounds(e._bounds));
            }
            this._lastBoundsID = this._boundsID;
          }, e.prototype._calculateBounds = function () {}, e.prototype.renderWebGL = function (t) {
            if (this.visible && !(this.worldAlpha <= 0) && this.renderable)
              if (this._mask || this._filters) this.renderAdvancedWebGL(t);
              else {
                this._renderWebGL(t);
                for (var e = 0, r = this.children.length; e < r; ++e) this.children[e].renderWebGL(t);
              }
          }, e.prototype.renderAdvancedWebGL = function (t) {
            t.flush();
            var e = this._filters,
              r = this._mask;
            if (e) {
              this._enabledFilters || (this._enabledFilters = []), this._enabledFilters.length = 0;
              for (var n = 0; n < e.length; n++) e[n].enabled && this._enabledFilters.push(e[n]);
              this._enabledFilters.length && t.filterManager.pushFilter(this, this._enabledFilters);
            }
            r && t.maskManager.pushMask(this, this._mask), this._renderWebGL(t);
            for (var i = 0, o = this.children.length; i < o; i++) this.children[i].renderWebGL(t);
            t.flush(), r && t.maskManager.popMask(this, this._mask), e && this._enabledFilters && this._enabledFilters.length && t.filterManager.popFilter();
          }, e.prototype._renderWebGL = function (t) {}, e.prototype._renderCanvas = function (t) {}, e.prototype.renderCanvas = function (t) {
            if (this.visible && !(this.worldAlpha <= 0) && this.renderable) {
              this._mask && t.maskManager.pushMask(this._mask), this._renderCanvas(t);
              for (var e = 0, r = this.children.length; e < r; ++e) this.children[e].renderCanvas(t);
              this._mask && t.maskManager.popMask(t);
            }
          }, e.prototype.destroy = function (e) {
            t.prototype.destroy.call(this);
            var r = "boolean" == typeof e ? e : e && e.children,
              n = this.removeChildren(0, this.children.length);
            if (r)
              for (var i = 0; i < n.length; ++i) n[i].destroy(e);
          }, s(e, [{
            key: "width",
            get: function get() {
              return this.scale.x * this.getLocalBounds().width;
            },
            set: function set(t) {
              var e = this.getLocalBounds().width;
              this.scale.x = 0 !== e ? t / e : 1, this._width = t;
            }
          }, {
            key: "height",
            get: function get() {
              return this.scale.y * this.getLocalBounds().height;
            },
            set: function set(t) {
              var e = this.getLocalBounds().height;
              this.scale.y = 0 !== e ? t / e : 1, this._height = t;
            }
          }]), e;
        }(h["default"]);
      r["default"] = l, l.prototype.containerUpdateTransform = l.prototype.updateTransform;
    }, {
      "../utils": 125,
      "./DisplayObject": 49
    }],
    49: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("eventemitter3"),
        h = n(u),
        l = t("../const"),
        c = t("../settings"),
        d = n(c),
        f = t("./TransformStatic"),
        p = n(f),
        v = t("./Transform"),
        g = n(v),
        y = t("./Bounds"),
        m = n(y),
        _ = t("../math"),
        b = function (t) {
          function e() {
            i(this, e);
            var r = o(this, t.call(this)),
              n = d["default"].TRANSFORM_MODE === l.TRANSFORM_MODE.STATIC ? p["default"] : g["default"];
            return r.tempDisplayObjectParent = null, r.transform = new n(), r.alpha = 1, r.visible = !0, r.renderable = !0, r.parent = null, r.worldAlpha = 1, r.filterArea = null, r._filters = null, r._enabledFilters = null, r._bounds = new m["default"](), r._boundsID = 0, r._lastBoundsID = -1, r._boundsRect = null, r._localBoundsRect = null, r._mask = null, r._destroyed = !1, r;
          }
          return s(e, t), e.prototype.updateTransform = function () {
            this.transform.updateTransform(this.parent.transform), this.worldAlpha = this.alpha * this.parent.worldAlpha, this._bounds.updateID++;
          }, e.prototype._recursivePostUpdateTransform = function () {
            this.parent ? (this.parent._recursivePostUpdateTransform(), this.transform.updateTransform(this.parent.transform)) : this.transform.updateTransform(this._tempDisplayObjectParent.transform);
          }, e.prototype.getBounds = function (t, e) {
            return t || (this.parent ? (this._recursivePostUpdateTransform(), this.updateTransform()) : (this.parent = this._tempDisplayObjectParent, this.updateTransform(), this.parent = null)), this._boundsID !== this._lastBoundsID && this.calculateBounds(), e || (this._boundsRect || (this._boundsRect = new _.Rectangle()), e = this._boundsRect), this._bounds.getRectangle(e);
          }, e.prototype.getLocalBounds = function (t) {
            var e = this.transform,
              r = this.parent;
            this.parent = null, this.transform = this._tempDisplayObjectParent.transform, t || (this._localBoundsRect || (this._localBoundsRect = new _.Rectangle()), t = this._localBoundsRect);
            var n = this.getBounds(!1, t);
            return this.parent = r, this.transform = e, n;
          }, e.prototype.toGlobal = function (t, e) {
            return arguments.length > 2 && void 0 !== arguments[2] && arguments[2] || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.apply(t, e);
          }, e.prototype.toLocal = function (t, e, r, n) {
            return e && (t = e.toGlobal(t, r, n)), n || (this._recursivePostUpdateTransform(), this.parent ? this.displayObjectUpdateTransform() : (this.parent = this._tempDisplayObjectParent, this.displayObjectUpdateTransform(), this.parent = null)), this.worldTransform.applyInverse(t, r);
          }, e.prototype.renderWebGL = function (t) {}, e.prototype.renderCanvas = function (t) {}, e.prototype.setParent = function (t) {
            if (!t || !t.addChild) throw new Error("setParent: Argument must be a Container");
            return t.addChild(this), t;
          }, e.prototype.setTransform = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 1,
              n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1,
              i = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0,
              o = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0,
              s = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : 0,
              a = arguments.length > 7 && void 0 !== arguments[7] ? arguments[7] : 0,
              u = arguments.length > 8 && void 0 !== arguments[8] ? arguments[8] : 0;
            return this.position.x = t, this.position.y = e, this.scale.x = r || 1, this.scale.y = n || 1, this.rotation = i, this.skew.x = o, this.skew.y = s, this.pivot.x = a, this.pivot.y = u, this;
          }, e.prototype.destroy = function () {
            this.removeAllListeners(), this.parent && this.parent.removeChild(this), this.transform = null, this.parent = null, this._bounds = null, this._currentBounds = null, this._mask = null, this.filterArea = null, this.interactive = !1, this.interactiveChildren = !1, this._destroyed = !0;
          }, a(e, [{
            key: "_tempDisplayObjectParent",
            get: function get() {
              return null === this.tempDisplayObjectParent && (this.tempDisplayObjectParent = new e()), this.tempDisplayObjectParent;
            }
          }, {
            key: "x",
            get: function get() {
              return this.position.x;
            },
            set: function set(t) {
              this.transform.position.x = t;
            }
          }, {
            key: "y",
            get: function get() {
              return this.position.y;
            },
            set: function set(t) {
              this.transform.position.y = t;
            }
          }, {
            key: "worldTransform",
            get: function get() {
              return this.transform.worldTransform;
            }
          }, {
            key: "localTransform",
            get: function get() {
              return this.transform.localTransform;
            }
          }, {
            key: "position",
            get: function get() {
              return this.transform.position;
            },
            set: function set(t) {
              this.transform.position.copy(t);
            }
          }, {
            key: "scale",
            get: function get() {
              return this.transform.scale;
            },
            set: function set(t) {
              this.transform.scale.copy(t);
            }
          }, {
            key: "pivot",
            get: function get() {
              return this.transform.pivot;
            },
            set: function set(t) {
              this.transform.pivot.copy(t);
            }
          }, {
            key: "skew",
            get: function get() {
              return this.transform.skew;
            },
            set: function set(t) {
              this.transform.skew.copy(t);
            }
          }, {
            key: "rotation",
            get: function get() {
              return this.transform.rotation;
            },
            set: function set(t) {
              this.transform.rotation = t;
            }
          }, {
            key: "worldVisible",
            get: function get() {
              var t = this;
              do {
                if (!t.visible) return !1;
                t = t.parent;
              } while (t);
              return !0;
            }
          }, {
            key: "mask",
            get: function get() {
              return this._mask;
            },
            set: function set(t) {
              this._mask && (this._mask.renderable = !0, this._mask.isMask = !1), this._mask = t, this._mask && (this._mask.renderable = !1, this._mask.isMask = !0);
            }
          }, {
            key: "filters",
            get: function get() {
              return this._filters && this._filters.slice();
            },
            set: function set(t) {
              this._filters = t && t.slice();
            }
          }]), e;
        }(h["default"]);
      r["default"] = b, b.prototype.displayObjectUpdateTransform = b.prototype.updateTransform;
    }, {
      "../const": 46,
      "../math": 70,
      "../settings": 101,
      "./Bounds": 47,
      "./Transform": 50,
      "./TransformStatic": 52,
      eventemitter3: 3
    }],
    50: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../math"),
        u = t("./TransformBase"),
        h = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(u),
        l = function (t) {
          function e() {
            n(this, e);
            var r = i(this, t.call(this));
            return r.position = new a.Point(0, 0), r.scale = new a.Point(1, 1), r.skew = new a.ObservablePoint(r.updateSkew, r, 0, 0), r.pivot = new a.Point(0, 0), r._rotation = 0, r._cx = 1, r._sx = 0, r._cy = 0, r._sy = 1, r;
          }
          return o(e, t), e.prototype.updateSkew = function () {
            this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x);
          }, e.prototype.updateLocalTransform = function () {
            var t = this.localTransform;
            t.a = this._cx * this.scale.x, t.b = this._sx * this.scale.x, t.c = this._cy * this.scale.y, t.d = this._sy * this.scale.y, t.tx = this.position.x - (this.pivot.x * t.a + this.pivot.y * t.c), t.ty = this.position.y - (this.pivot.x * t.b + this.pivot.y * t.d);
          }, e.prototype.updateTransform = function (t) {
            var e = this.localTransform;
            e.a = this._cx * this.scale.x, e.b = this._sx * this.scale.x, e.c = this._cy * this.scale.y, e.d = this._sy * this.scale.y, e.tx = this.position.x - (this.pivot.x * e.a + this.pivot.y * e.c), e.ty = this.position.y - (this.pivot.x * e.b + this.pivot.y * e.d);
            var r = t.worldTransform,
              n = this.worldTransform;
            n.a = e.a * r.a + e.b * r.c, n.b = e.a * r.b + e.b * r.d, n.c = e.c * r.a + e.d * r.c, n.d = e.c * r.b + e.d * r.d, n.tx = e.tx * r.a + e.ty * r.c + r.tx, n.ty = e.tx * r.b + e.ty * r.d + r.ty, this._worldID++;
          }, e.prototype.setFromMatrix = function (t) {
            t.decompose(this);
          }, s(e, [{
            key: "rotation",
            get: function get() {
              return this._rotation;
            },
            set: function set(t) {
              this._rotation = t, this.updateSkew();
            }
          }]), e;
        }(h["default"]);
      r["default"] = l;
    }, {
      "../math": 70,
      "./TransformBase": 51
    }],
    51: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../math"),
        o = function () {
          function t() {
            n(this, t), this.worldTransform = new i.Matrix(), this.localTransform = new i.Matrix(), this._worldID = 0, this._parentID = 0;
          }
          return t.prototype.updateLocalTransform = function () {}, t.prototype.updateTransform = function (t) {
            var e = t.worldTransform,
              r = this.worldTransform,
              n = this.localTransform;
            r.a = n.a * e.a + n.b * e.c, r.b = n.a * e.b + n.b * e.d, r.c = n.c * e.a + n.d * e.c, r.d = n.c * e.b + n.d * e.d, r.tx = n.tx * e.a + n.ty * e.c + e.tx, r.ty = n.tx * e.b + n.ty * e.d + e.ty, this._worldID++;
          }, t;
        }();
      r["default"] = o, o.prototype.updateWorldTransform = o.prototype.updateTransform, o.IDENTITY = new o();
    }, {
      "../math": 70
    }],
    52: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../math"),
        u = t("./TransformBase"),
        h = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(u),
        l = function (t) {
          function e() {
            n(this, e);
            var r = i(this, t.call(this));
            return r.position = new a.ObservablePoint(r.onChange, r, 0, 0), r.scale = new a.ObservablePoint(r.onChange, r, 1, 1), r.pivot = new a.ObservablePoint(r.onChange, r, 0, 0), r.skew = new a.ObservablePoint(r.updateSkew, r, 0, 0), r._rotation = 0, r._cx = 1, r._sx = 0, r._cy = 0, r._sy = 1, r._localID = 0, r._currentLocalID = 0, r;
          }
          return o(e, t), e.prototype.onChange = function () {
            this._localID++;
          }, e.prototype.updateSkew = function () {
            this._cx = Math.cos(this._rotation + this.skew._y), this._sx = Math.sin(this._rotation + this.skew._y), this._cy = -Math.sin(this._rotation - this.skew._x), this._sy = Math.cos(this._rotation - this.skew._x), this._localID++;
          }, e.prototype.updateLocalTransform = function () {
            var t = this.localTransform;
            this._localID !== this._currentLocalID && (t.a = this._cx * this.scale._x, t.b = this._sx * this.scale._x, t.c = this._cy * this.scale._y, t.d = this._sy * this.scale._y, t.tx = this.position._x - (this.pivot._x * t.a + this.pivot._y * t.c), t.ty = this.position._y - (this.pivot._x * t.b + this.pivot._y * t.d), this._currentLocalID = this._localID, this._parentID = -1);
          }, e.prototype.updateTransform = function (t) {
            var e = this.localTransform;
            if (this._localID !== this._currentLocalID && (e.a = this._cx * this.scale._x, e.b = this._sx * this.scale._x, e.c = this._cy * this.scale._y, e.d = this._sy * this.scale._y, e.tx = this.position._x - (this.pivot._x * e.a + this.pivot._y * e.c), e.ty = this.position._y - (this.pivot._x * e.b + this.pivot._y * e.d), this._currentLocalID = this._localID, this._parentID = -1), this._parentID !== t._worldID) {
              var r = t.worldTransform,
                n = this.worldTransform;
              n.a = e.a * r.a + e.b * r.c, n.b = e.a * r.b + e.b * r.d, n.c = e.c * r.a + e.d * r.c, n.d = e.c * r.b + e.d * r.d, n.tx = e.tx * r.a + e.ty * r.c + r.tx, n.ty = e.tx * r.b + e.ty * r.d + r.ty, this._parentID = t._worldID, this._worldID++;
            }
          }, e.prototype.setFromMatrix = function (t) {
            t.decompose(this), this._localID++;
          }, s(e, [{
            key: "rotation",
            get: function get() {
              return this._rotation;
            },
            set: function set(t) {
              this._rotation !== t && (this._rotation = t, this.updateSkew());
            }
          }]), e;
        }(h["default"]);
      r["default"] = l;
    }, {
      "../math": 70,
      "./TransformBase": 51
    }],
    53: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../display/Container"),
        u = n(a),
        h = t("../textures/RenderTexture"),
        l = n(h),
        c = t("../textures/Texture"),
        d = n(c),
        f = t("./GraphicsData"),
        p = n(f),
        v = t("../sprites/Sprite"),
        g = n(v),
        y = t("../math"),
        m = t("../utils"),
        _ = t("../const"),
        b = t("../display/Bounds"),
        x = n(b),
        T = t("./utils/bezierCurveTo"),
        w = n(T),
        E = t("../renderers/canvas/CanvasRenderer"),
        S = n(E),
        O = void 0,
        M = new y.Matrix(),
        P = new y.Point(),
        C = new Float32Array(4),
        R = new Float32Array(4),
        A = function (t) {
          function e() {
            var r = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
            i(this, e);
            var n = o(this, t.call(this));
            return n.fillAlpha = 1, n.lineWidth = 0, n.nativeLines = r, n.lineColor = 0, n.lineAlignment = .5, n.graphicsData = [], n.tint = 16777215, n._prevTint = 16777215, n.blendMode = _.BLEND_MODES.NORMAL, n.currentPath = null, n._webGL = {}, n.isMask = !1, n.boundsPadding = 0, n._localBounds = new x["default"](), n.dirty = 0, n.fastRectDirty = -1, n.clearDirty = 0, n.boundsDirty = -1, n.cachedSpriteDirty = !1, n._spriteRect = null, n._fastRect = !1, n._prevRectTint = null, n._prevRectFillColor = null, n;
          }
          return s(e, t), e.prototype.clone = function () {
            var t = new e();
            t.renderable = this.renderable, t.fillAlpha = this.fillAlpha, t.lineWidth = this.lineWidth, t.lineColor = this.lineColor, t.lineAlignment = this.lineAlignment, t.tint = this.tint, t.blendMode = this.blendMode, t.isMask = this.isMask, t.boundsPadding = this.boundsPadding, t.dirty = 0, t.cachedSpriteDirty = this.cachedSpriteDirty;
            for (var r = 0; r < this.graphicsData.length; ++r) t.graphicsData.push(this.graphicsData[r].clone());
            return t.currentPath = t.graphicsData[t.graphicsData.length - 1], t.updateLocalBounds(), t;
          }, e.prototype._quadraticCurveLength = function (t, e, r, n, i, o) {
            var s = t - 2 * r + i,
              a = e - 2 * n + o,
              u = 2 * r - 2 * t,
              h = 2 * n - 2 * e,
              l = 4 * (s * s + a * a),
              c = 4 * (s * u + a * h),
              d = u * u + h * h,
              f = 2 * Math.sqrt(l + c + d),
              p = Math.sqrt(l),
              v = 2 * l * p,
              g = 2 * Math.sqrt(d),
              y = c / p;
            return (v * f + p * c * (f - g) + (4 * d * l - c * c) * Math.log((2 * p + y + f) / (y + g))) / (4 * v);
          }, e.prototype._bezierCurveLength = function (t, e, r, n, i, o, s, a) {
            for (var u = 0, h = 0, l = 0, c = 0, d = 0, f = 0, p = 0, v = 0, g = 0, y = 0, m = 0, _ = t, b = e, x = 1; x <= 10; ++x) h = x / 10, l = h * h, c = l * h, d = 1 - h, f = d * d, p = f * d, v = p * t + 3 * f * h * r + 3 * d * l * i + c * s, g = p * e + 3 * f * h * n + 3 * d * l * o + c * a, y = _ - v, m = b - g, _ = v, b = g, u += Math.sqrt(y * y + m * m);
            return u;
          }, e.prototype._segmentsCount = function (t) {
            var r = Math.ceil(t / e.CURVES.maxLength);
            return r < e.CURVES.minSegments ? r = e.CURVES.minSegments : r > e.CURVES.maxSegments && (r = e.CURVES.maxSegments), r;
          }, e.prototype.lineStyle = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 1,
              n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : .5;
            if (this.lineWidth = t, this.lineColor = e, this.lineAlpha = r, this.lineAlignment = n, this.currentPath)
              if (this.currentPath.shape.points.length) {
                var i = new y.Polygon(this.currentPath.shape.points.slice(-2));
                i.closed = !1, this.drawShape(i);
              } else this.currentPath.lineWidth = this.lineWidth, this.currentPath.lineColor = this.lineColor, this.currentPath.lineAlpha = this.lineAlpha, this.currentPath.lineAlignment = this.lineAlignment;
            return this;
          }, e.prototype.moveTo = function (t, e) {
            var r = new y.Polygon([t, e]);
            return r.closed = !1, this.drawShape(r), this;
          }, e.prototype.lineTo = function (t, e) {
            var r = this.currentPath.shape.points,
              n = r[r.length - 2],
              i = r[r.length - 1];
            return n === t && i === e || (r.push(t, e), this.dirty++), this;
          }, e.prototype.quadraticCurveTo = function (t, r, n, i) {
            this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0);
            var o = this.currentPath.shape.points,
              s = 0,
              a = 0;
            0 === o.length && this.moveTo(0, 0);
            for (var u = o[o.length - 2], h = o[o.length - 1], l = e.CURVES.adaptive ? this._segmentsCount(this._quadraticCurveLength(u, h, t, r, n, i)) : 20, c = 1; c <= l; ++c) {
              var d = c / l;
              s = u + (t - u) * d, a = h + (r - h) * d, o.push(s + (t + (n - t) * d - s) * d, a + (r + (i - r) * d - a) * d);
            }
            return this.dirty++, this;
          }, e.prototype.bezierCurveTo = function (t, r, n, i, o, s) {
            this.currentPath ? 0 === this.currentPath.shape.points.length && (this.currentPath.shape.points = [0, 0]) : this.moveTo(0, 0);
            var a = this.currentPath.shape.points,
              u = a[a.length - 2],
              h = a[a.length - 1];
            a.length -= 2;
            var l = e.CURVES.adaptive ? this._segmentsCount(this._bezierCurveLength(u, h, t, r, n, i, o, s)) : 20;
            return (0, w["default"])(u, h, t, r, n, i, o, s, l, a), this.dirty++, this;
          }, e.prototype.arcTo = function (t, e, r, n, i) {
            this.currentPath ? 0 === this.currentPath.shape.points.length && this.currentPath.shape.points.push(t, e) : this.moveTo(t, e);
            var o = this.currentPath.shape.points,
              s = o[o.length - 2],
              a = o[o.length - 1],
              u = a - e,
              h = s - t,
              l = n - e,
              c = r - t,
              d = Math.abs(u * c - h * l);
            if (d < 1e-8 || 0 === i) o[o.length - 2] === t && o[o.length - 1] === e || o.push(t, e);
            else {
              var f = u * u + h * h,
                p = l * l + c * c,
                v = u * l + h * c,
                g = i * Math.sqrt(f) / d,
                y = i * Math.sqrt(p) / d,
                m = g * v / f,
                _ = y * v / p,
                b = g * c + y * h,
                x = g * l + y * u,
                T = h * (y + m),
                w = u * (y + m),
                E = c * (g + _),
                S = l * (g + _),
                O = Math.atan2(w - x, T - b),
                M = Math.atan2(S - x, E - b);
              this.arc(b + t, x + e, i, O, M, h * l > c * u);
            }
            return this.dirty++, this;
          }, e.prototype.arc = function (t, r, n, i, o) {
            var s = arguments.length > 5 && void 0 !== arguments[5] && arguments[5];
            if (i === o) return this;
            !s && o <= i ? o += _.PI_2 : s && i <= o && (i += _.PI_2);
            var a = o - i,
              u = e.CURVES.adaptive ? this._segmentsCount(Math.abs(a) * n) : 40 * Math.ceil(Math.abs(a) / _.PI_2);
            if (0 === a) return this;
            var h = t + Math.cos(i) * n,
              l = r + Math.sin(i) * n,
              c = this.currentPath ? this.currentPath.shape.points : null;
            if (c) {
              var d = Math.abs(c[c.length - 2] - h),
                f = Math.abs(c[c.length - 1] - l);
              d < .001 && f < .001 || c.push(h, l);
            } else this.moveTo(h, l), c = this.currentPath.shape.points;
            for (var p = a / (2 * u), v = 2 * p, g = Math.cos(p), y = Math.sin(p), m = u - 1, b = m % 1 / m, x = 0; x <= m; ++x) {
              var T = x + b * x,
                w = p + i + v * T,
                E = Math.cos(w),
                S = -Math.sin(w);
              c.push((g * E + y * S) * n + t, (g * -S + y * E) * n + r);
            }
            return this.dirty++, this;
          }, e.prototype.beginFill = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
            return this.filling = !0, this.fillColor = t, this.fillAlpha = e, this.currentPath && this.currentPath.shape.points.length <= 2 && (this.currentPath.fill = this.filling, this.currentPath.fillColor = this.fillColor, this.currentPath.fillAlpha = this.fillAlpha), this;
          }, e.prototype.endFill = function () {
            return this.filling = !1, this.fillColor = null, this.fillAlpha = 1, this;
          }, e.prototype.drawRect = function (t, e, r, n) {
            return this.drawShape(new y.Rectangle(t, e, r, n)), this;
          }, e.prototype.drawRoundedRect = function (t, e, r, n, i) {
            return this.drawShape(new y.RoundedRectangle(t, e, r, n, i)), this;
          }, e.prototype.drawCircle = function (t, e, r) {
            return this.drawShape(new y.Circle(t, e, r)), this;
          }, e.prototype.drawEllipse = function (t, e, r, n) {
            return this.drawShape(new y.Ellipse(t, e, r, n)), this;
          }, e.prototype.drawPolygon = function (t) {
            var e = t,
              r = !0;
            if (e instanceof y.Polygon && (r = e.closed, e = e.points), !Array.isArray(e)) {
              e = new Array(arguments.length);
              for (var n = 0; n < e.length; ++n) e[n] = arguments[n];
            }
            var i = new y.Polygon(e);
            return i.closed = r, this.drawShape(i), this;
          }, e.prototype.drawStar = function (t, e, r, n, i) {
            var o = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0;
            i = i || n / 2;
            for (var s = -1 * Math.PI / 2 + o, a = 2 * r, u = _.PI_2 / a, h = [], l = 0; l < a; l++) {
              var c = l % 2 ? i : n,
                d = l * u + s;
              h.push(t + c * Math.cos(d), e + c * Math.sin(d));
            }
            return this.drawPolygon(h);
          }, e.prototype.clear = function () {
            return (this.lineWidth || this.filling || this.graphicsData.length > 0) && (this.lineWidth = 0, this.lineAlignment = .5, this.filling = !1, this.boundsDirty = -1, this.canvasTintDirty = -1, this.dirty++, this.clearDirty++, this.graphicsData.length = 0), this.currentPath = null, this._spriteRect = null, this;
          }, e.prototype.isFastRect = function () {
            return 1 === this.graphicsData.length && this.graphicsData[0].shape.type === _.SHAPES.RECT && !this.graphicsData[0].lineWidth;
          }, e.prototype._renderWebGL = function (t) {
            this.dirty !== this.fastRectDirty && (this.fastRectDirty = this.dirty, this._fastRect = this.isFastRect()), this._fastRect ? this._renderSpriteRect(t) : (t.setObjectRenderer(t.plugins.graphics), t.plugins.graphics.render(this));
          }, e.prototype._renderSpriteRect = function (t) {
            var e = this.graphicsData[0].shape;
            this._spriteRect || (this._spriteRect = new g["default"](new d["default"](d["default"].WHITE)));
            var r = this._spriteRect,
              n = this.graphicsData[0].fillColor;
            if (16777215 === this.tint) r.tint = n;
            else if (this.tint !== this._prevRectTint || n !== this._prevRectFillColor) {
              var i = C,
                o = R;
              (0, m.hex2rgb)(n, i), (0, m.hex2rgb)(this.tint, o), i[0] *= o[0], i[1] *= o[1], i[2] *= o[2], r.tint = (0, m.rgb2hex)(i), this._prevRectTint = this.tint, this._prevRectFillColor = n;
            }
            r.alpha = this.graphicsData[0].fillAlpha, r.worldAlpha = this.worldAlpha * r.alpha, r.blendMode = this.blendMode, r._texture._frame.width = e.width, r._texture._frame.height = e.height, r.transform.worldTransform = this.transform.worldTransform, r.anchor.set(-e.x / e.width, -e.y / e.height), r._onAnchorUpdate(), r._renderWebGL(t);
          }, e.prototype._renderCanvas = function (t) {
            !0 !== this.isMask && t.plugins.graphics.render(this);
          }, e.prototype._calculateBounds = function () {
            this.boundsDirty !== this.dirty && (this.boundsDirty = this.dirty, this.updateLocalBounds(), this.cachedSpriteDirty = !0);
            var t = this._localBounds;
            this._bounds.addFrame(this.transform, t.minX, t.minY, t.maxX, t.maxY);
          }, e.prototype.containsPoint = function (t) {
            this.worldTransform.applyInverse(t, P);
            for (var e = this.graphicsData, r = 0; r < e.length; ++r) {
              var n = e[r];
              if (n.fill && n.shape && n.shape.contains(P.x, P.y)) {
                if (n.holes)
                  for (var i = 0; i < n.holes.length; i++) {
                    var o = n.holes[i];
                    if (o.contains(P.x, P.y)) return !1;
                  }
                return !0;
              }
            }
            return !1;
          }, e.prototype.updateLocalBounds = function () {
            var t = 1 / 0,
              e = -1 / 0,
              r = 1 / 0,
              n = -1 / 0;
            if (this.graphicsData.length)
              for (var i = 0, o = 0, s = 0, a = 0, u = 0, h = 0; h < this.graphicsData.length; h++) {
                var l = this.graphicsData[h],
                  c = l.type,
                  d = l.lineWidth,
                  f = l.lineAlignment,
                  p = d * f;
                if (i = l.shape, c === _.SHAPES.RECT || c === _.SHAPES.RREC) o = i.x - p, s = i.y - p, a = i.width + 2 * p, u = i.height + 2 * p, t = o < t ? o : t, e = o + a > e ? o + a : e, r = s < r ? s : r, n = s + u > n ? s + u : n;
                else if (c === _.SHAPES.CIRC) o = i.x, s = i.y, a = i.radius + p, u = i.radius + p, t = o - a < t ? o - a : t, e = o + a > e ? o + a : e, r = s - u < r ? s - u : r, n = s + u > n ? s + u : n;
                else if (c === _.SHAPES.ELIP) o = i.x, s = i.y, a = i.width + p, u = i.height + p, t = o - a < t ? o - a : t, e = o + a > e ? o + a : e, r = s - u < r ? s - u : r, n = s + u > n ? s + u : n;
                else
                  for (var v = i.points, g = 0, y = 0, m = 0, b = 0, x = 0, T = 0, w = 0, E = 0, S = 0; S + 2 < v.length; S += 2) o = v[S], s = v[S + 1], g = v[S + 2], y = v[S + 3], m = Math.abs(g - o), b = Math.abs(y - s), u = 2 * p, (a = Math.sqrt(m * m + b * b)) < 1e-9 || (x = (u / a * b + m) / 2, T = (u / a * m + b) / 2, w = (g + o) / 2, E = (y + s) / 2, t = w - x < t ? w - x : t, e = w + x > e ? w + x : e, r = E - T < r ? E - T : r, n = E + T > n ? E + T : n);
              } else t = 0, e = 0, r = 0, n = 0;
            var O = this.boundsPadding;
            this._localBounds.minX = t - O, this._localBounds.maxX = e + O, this._localBounds.minY = r - O, this._localBounds.maxY = n + O;
          }, e.prototype.drawShape = function (t) {
            this.currentPath && this.currentPath.shape.points.length <= 2 && this.graphicsData.pop(), this.currentPath = null;
            var e = new p["default"](this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.filling, this.nativeLines, t, this.lineAlignment);
            return this.graphicsData.push(e), e.type === _.SHAPES.POLY && (e.shape.closed = e.shape.closed, this.currentPath = e), this.dirty++, e;
          }, e.prototype.generateCanvasTexture = function (t) {
            var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1,
              r = this.getLocalBounds(),
              n = l["default"].create(r.width, r.height, t, e);
            O || (O = new S["default"]()), this.transform.updateLocalTransform(), this.transform.localTransform.copy(M), M.invert(), M.tx -= r.x, M.ty -= r.y, O.render(this, n, !0, M);
            var i = d["default"].fromCanvas(n.baseTexture._canvasRenderTarget.canvas, t, "graphics");
            return i.baseTexture.resolution = e, i.baseTexture.update(), i;
          }, e.prototype.closePath = function () {
            var t = this.currentPath;
            return t && t.shape && t.shape.close(), this;
          }, e.prototype.addHole = function () {
            var t = this.graphicsData.pop();
            return this.currentPath = this.graphicsData[this.graphicsData.length - 1], this.currentPath.addHole(t.shape), this.currentPath = null, this;
          }, e.prototype.destroy = function (e) {
            t.prototype.destroy.call(this, e);
            for (var r = 0; r < this.graphicsData.length; ++r) this.graphicsData[r].destroy();
            for (var n in this._webGL)
              for (var i = 0; i < this._webGL[n].data.length; ++i) this._webGL[n].data[i].destroy();
            this._spriteRect && this._spriteRect.destroy(), this.graphicsData = null, this.currentPath = null, this._webGL = null, this._localBounds = null;
          }, e;
        }(u["default"]);
      r["default"] = A, A._SPRITE_TEXTURE = null, A.CURVES = {
        adaptive: !1,
        maxLength: 10,
        minSegments: 8,
        maxSegments: 2048
      };
    }, {
      "../const": 46,
      "../display/Bounds": 47,
      "../display/Container": 48,
      "../math": 70,
      "../renderers/canvas/CanvasRenderer": 77,
      "../sprites/Sprite": 102,
      "../textures/RenderTexture": 113,
      "../textures/Texture": 115,
      "../utils": 125,
      "./GraphicsData": 54,
      "./utils/bezierCurveTo": 56
    }],
    54: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e, r, i, o, s, a, u, h, l) {
          n(this, t), this.lineWidth = e, this.lineAlignment = l, this.nativeLines = u, this.lineColor = r, this.lineAlpha = i, this._lineTint = r, this.fillColor = o, this.fillAlpha = s, this._fillTint = o, this.fill = a, this.holes = [], this.shape = h, this.type = h.type;
        }
        return t.prototype.clone = function () {
          return new t(this.lineWidth, this.lineColor, this.lineAlpha, this.fillColor, this.fillAlpha, this.fill, this.nativeLines, this.shape, this.lineAlignment);
        }, t.prototype.addHole = function (t) {
          this.holes.push(t);
        }, t.prototype.destroy = function () {
          this.shape = null, this.holes = null;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    55: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../renderers/canvas/CanvasRenderer"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../const"),
        a = function () {
          function t(e) {
            n(this, t), this.renderer = e;
          }
          return t.prototype.render = function (t) {
            var e = this.renderer,
              r = e.context,
              n = t.worldAlpha,
              i = t.transform.worldTransform,
              o = e.resolution;
            r.setTransform(i.a * o, i.b * o, i.c * o, i.d * o, i.tx * o, i.ty * o), t.canvasTintDirty === t.dirty && t._prevTint === t.tint || this.updateGraphicsTint(t), e.setBlendMode(t.blendMode);
            for (var a = 0; a < t.graphicsData.length; a++) {
              var u = t.graphicsData[a],
                h = u.shape,
                l = u._fillTint,
                c = u._lineTint;
              if (r.lineWidth = u.lineWidth, u.type === s.SHAPES.POLY) {
                r.beginPath();
                var d = h.points,
                  f = u.holes,
                  p = void 0,
                  v = void 0,
                  g = void 0,
                  y = void 0;
                r.moveTo(d[0], d[1]);
                for (var m = 2; m < d.length; m += 2) r.lineTo(d[m], d[m + 1]);
                if (h.closed && r.closePath(), f.length > 0) {
                  p = 0, g = d[0], y = d[1];
                  for (var _ = 2; _ + 2 < d.length; _ += 2) p += (d[_] - g) * (d[_ + 3] - y) - (d[_ + 2] - g) * (d[_ + 1] - y);
                  for (var b = 0; b < f.length; b++)
                    if (d = f[b].points) {
                      v = 0, g = d[0], y = d[1];
                      for (var x = 2; x + 2 < d.length; x += 2) v += (d[x] - g) * (d[x + 3] - y) - (d[x + 2] - g) * (d[x + 1] - y);
                      if (v * p < 0) {
                        r.moveTo(d[0], d[1]);
                        for (var T = 2; T < d.length; T += 2) r.lineTo(d[T], d[T + 1]);
                      } else {
                        r.moveTo(d[d.length - 2], d[d.length - 1]);
                        for (var w = d.length - 4; w >= 0; w -= 2) r.lineTo(d[w], d[w + 1]);
                      }
                      f[b].close && r.closePath();
                    }
                }
                u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke());
              } else if (u.type === s.SHAPES.RECT)(u.fillColor || 0 === u.fillColor) && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fillRect(h.x, h.y, h.width, h.height)), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.strokeRect(h.x, h.y, h.width, h.height));
              else if (u.type === s.SHAPES.CIRC) r.beginPath(), r.arc(h.x, h.y, h.radius, 0, 2 * Math.PI), r.closePath(), u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke());
              else if (u.type === s.SHAPES.ELIP) {
                var E = 2 * h.width,
                  S = 2 * h.height,
                  O = h.x - E / 2,
                  M = h.y - S / 2;
                r.beginPath();
                var P = E / 2 * .5522848,
                  C = S / 2 * .5522848,
                  R = O + E,
                  A = M + S,
                  I = O + E / 2,
                  D = M + S / 2;
                r.moveTo(O, D), r.bezierCurveTo(O, D - C, I - P, M, I, M), r.bezierCurveTo(I + P, M, R, D - C, R, D), r.bezierCurveTo(R, D + C, I + P, A, I, A), r.bezierCurveTo(I - P, A, O, D + C, O, D), r.closePath(), u.fill && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke());
              } else if (u.type === s.SHAPES.RREC) {
                var L = h.x,
                  N = h.y,
                  B = h.width,
                  k = h.height,
                  F = h.radius,
                  j = Math.min(B, k) / 2 | 0;
                F = F > j ? j : F, r.beginPath(), r.moveTo(L, N + F), r.lineTo(L, N + k - F), r.quadraticCurveTo(L, N + k, L + F, N + k), r.lineTo(L + B - F, N + k), r.quadraticCurveTo(L + B, N + k, L + B, N + k - F), r.lineTo(L + B, N + F), r.quadraticCurveTo(L + B, N, L + B - F, N), r.lineTo(L + F, N), r.quadraticCurveTo(L, N, L, N + F), r.closePath(), (u.fillColor || 0 === u.fillColor) && (r.globalAlpha = u.fillAlpha * n, r.fillStyle = "#" + ("00000" + (0 | l).toString(16)).substr(-6), r.fill()), u.lineWidth && (r.globalAlpha = u.lineAlpha * n, r.strokeStyle = "#" + ("00000" + (0 | c).toString(16)).substr(-6), r.stroke());
              }
            }
          }, t.prototype.updateGraphicsTint = function (t) {
            t._prevTint = t.tint, t.canvasTintDirty = t.dirty;
            for (var e = (t.tint >> 16 & 255) / 255, r = (t.tint >> 8 & 255) / 255, n = (255 & t.tint) / 255, i = 0; i < t.graphicsData.length; ++i) {
              var o = t.graphicsData[i],
                s = 0 | o.fillColor,
                a = 0 | o.lineColor;
              o._fillTint = ((s >> 16 & 255) / 255 * e * 255 << 16) + ((s >> 8 & 255) / 255 * r * 255 << 8) + (255 & s) / 255 * n * 255, o._lineTint = ((a >> 16 & 255) / 255 * e * 255 << 16) + ((a >> 8 & 255) / 255 * r * 255 << 8) + (255 & a) / 255 * n * 255;
            }
          }, t.prototype.renderPolygon = function (t, e, r) {
            r.moveTo(t[0], t[1]);
            for (var n = 1; n < t.length / 2; ++n) r.lineTo(t[2 * n], t[2 * n + 1]);
            e && r.closePath();
          }, t.prototype.destroy = function () {
            this.renderer = null;
          }, t;
        }();
      r["default"] = a, o["default"].registerPlugin("graphics", a);
    }, {
      "../../const": 46,
      "../../renderers/canvas/CanvasRenderer": 77
    }],
    56: [function (t, e, r) {
      "use strict";

      function n(t, e, r, n, i, o, s, a, u) {
        var h = arguments.length > 9 && void 0 !== arguments[9] ? arguments[9] : [],
          l = 0,
          c = 0,
          d = 0,
          f = 0,
          p = 0;
        h.push(t, e);
        for (var v = 1, g = 0; v <= u; ++v) g = v / u, l = 1 - g, c = l * l, d = c * l, f = g * g, p = f * g, h.push(d * t + 3 * c * g * r + 3 * l * f * i + p * s, d * e + 3 * c * g * n + 3 * l * f * o + p * a);
        return h;
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    57: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../../utils"),
        u = t("../../const"),
        h = t("../../renderers/webgl/utils/ObjectRenderer"),
        l = n(h),
        c = t("../../renderers/webgl/WebGLRenderer"),
        d = n(c),
        f = t("./WebGLGraphicsData"),
        p = n(f),
        v = t("./shaders/PrimitiveShader"),
        g = n(v),
        y = t("./utils/buildPoly"),
        m = n(y),
        _ = t("./utils/buildRectangle"),
        b = n(_),
        x = t("./utils/buildRoundedRectangle"),
        T = n(x),
        w = t("./utils/buildCircle"),
        E = n(w),
        S = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this, r));
            return n.graphicsDataPool = [], n.primitiveShader = null, n.gl = r.gl, n.CONTEXT_UID = 0, n;
          }
          return s(e, t), e.prototype.onContextChange = function () {
            this.gl = this.renderer.gl, this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.primitiveShader = new g["default"](this.gl);
          }, e.prototype.destroy = function () {
            l["default"].prototype.destroy.call(this);
            for (var t = 0; t < this.graphicsDataPool.length; ++t) this.graphicsDataPool[t].destroy();
            this.graphicsDataPool = null;
          }, e.prototype.render = function (t) {
            var e = this.renderer,
              r = e.gl,
              n = void 0,
              i = t._webGL[this.CONTEXT_UID];
            i && t.dirty === i.dirty || (this.updateGraphics(t), i = t._webGL[this.CONTEXT_UID]);
            var o = this.primitiveShader;
            e.bindShader(o), e.state.setBlendMode(t.blendMode);
            for (var s = 0, u = i.data.length; s < u; s++) {
              n = i.data[s];
              var h = n.shader;
              e.bindShader(h), h.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), h.uniforms.tint = (0, a.hex2rgb)(t.tint), h.uniforms.alpha = t.worldAlpha, e.bindVao(n.vao), n.nativeLines ? r.drawArrays(r.LINES, 0, n.points.length / 6) : n.vao.draw(r.TRIANGLE_STRIP, n.indices.length);
            }
          }, e.prototype.updateGraphics = function (t) {
            var e = this.renderer.gl,
              r = t._webGL[this.CONTEXT_UID];
            if (r || (r = t._webGL[this.CONTEXT_UID] = {
                lastIndex: 0,
                data: [],
                gl: e,
                clearDirty: -1,
                dirty: -1
              }), r.dirty = t.dirty, t.clearDirty !== r.clearDirty) {
              r.clearDirty = t.clearDirty;
              for (var n = 0; n < r.data.length; n++) this.graphicsDataPool.push(r.data[n]);
              r.data.length = 0, r.lastIndex = 0;
            }
            for (var i = void 0, o = void 0, s = r.lastIndex; s < t.graphicsData.length; s++) {
              var a = t.graphicsData[s];
              i = this.getWebGLData(r, 0), a.nativeLines && a.lineWidth && (o = this.getWebGLData(r, 0, !0), r.lastIndex++), a.type === u.SHAPES.POLY && (0, m["default"])(a, i, o), a.type === u.SHAPES.RECT ? (0, b["default"])(a, i, o) : a.type === u.SHAPES.CIRC || a.type === u.SHAPES.ELIP ? (0, E["default"])(a, i, o) : a.type === u.SHAPES.RREC && (0, T["default"])(a, i, o), r.lastIndex++;
            }
            this.renderer.bindVao(null);
            for (var h = 0; h < r.data.length; h++) i = r.data[h], i.dirty && i.upload();
          }, e.prototype.getWebGLData = function (t, e, r) {
            var n = t.data[t.data.length - 1];
            return (!n || n.nativeLines !== r || n.points.length > 32e4) && (n = this.graphicsDataPool.pop() || new p["default"](this.renderer.gl, this.primitiveShader, this.renderer.state.attribsState), n.nativeLines = r, n.reset(e), t.data.push(n)), n.dirty = !0, n;
          }, e;
        }(l["default"]);
      r["default"] = S, d["default"].registerPlugin("graphics", S);
    }, {
      "../../const": 46,
      "../../renderers/webgl/WebGLRenderer": 84,
      "../../renderers/webgl/utils/ObjectRenderer": 94,
      "../../utils": 125,
      "./WebGLGraphicsData": 58,
      "./shaders/PrimitiveShader": 59,
      "./utils/buildCircle": 60,
      "./utils/buildPoly": 62,
      "./utils/buildRectangle": 63,
      "./utils/buildRoundedRectangle": 64
    }],
    58: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("pixi-gl-core"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = function () {
          function t(e, r, i) {
            n(this, t), this.gl = e, this.color = [0, 0, 0], this.points = [], this.indices = [], this.buffer = o["default"].GLBuffer.createVertexBuffer(e), this.indexBuffer = o["default"].GLBuffer.createIndexBuffer(e), this.dirty = !0, this.nativeLines = !1, this.glPoints = null, this.glIndices = null, this.shader = r, this.vao = new o["default"].VertexArrayObject(e, i).addIndex(this.indexBuffer).addAttribute(this.buffer, r.attributes.aVertexPosition, e.FLOAT, !1, 24, 0).addAttribute(this.buffer, r.attributes.aColor, e.FLOAT, !1, 24, 8);
          }
          return t.prototype.reset = function () {
            this.points.length = 0, this.indices.length = 0;
          }, t.prototype.upload = function () {
            this.glPoints = new Float32Array(this.points), this.buffer.upload(this.glPoints), this.glIndices = new Uint16Array(this.indices), this.indexBuffer.upload(this.glIndices), this.dirty = !1;
          }, t.prototype.destroy = function () {
            this.color = null, this.points = null, this.indices = null, this.vao.destroy(), this.buffer.destroy(), this.indexBuffer.destroy(), this.gl = null, this.buffer = null, this.indexBuffer = null, this.glPoints = null, this.glIndices = null;
          }, t;
        }();
      r["default"] = s;
    }, {
      "pixi-gl-core": 15
    }],
    59: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("../../../Shader"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e(r) {
            return n(this, e), i(this, t.call(this, r, ["attribute vec2 aVertexPosition;", "attribute vec4 aColor;", "uniform mat3 translationMatrix;", "uniform mat3 projectionMatrix;", "uniform float alpha;", "uniform vec3 tint;", "varying vec4 vColor;", "void main(void){", "   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vColor = aColor * vec4(tint * alpha, alpha);", "}"].join("\n"), ["varying vec4 vColor;", "void main(void){", "   gl_FragColor = vColor;", "}"].join("\n")));
          }
          return o(e, t), e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "../../../Shader": 44
    }],
    60: [function (t, e, r) {
      "use strict";

      function n(t, e, r) {
        var n = t.shape,
          i = n.x,
          u = n.y,
          h = void 0,
          l = void 0;
        if (t.type === s.SHAPES.CIRC ? (h = n.radius, l = n.radius) : (h = n.width, l = n.height), 0 !== h && 0 !== l) {
          var c = Math.floor(30 * Math.sqrt(n.radius)) || Math.floor(15 * Math.sqrt(n.width + n.height)),
            d = 2 * Math.PI / c;
          if (t.fill) {
            var f = (0, a.hex2rgb)(t.fillColor),
              p = t.fillAlpha,
              v = f[0] * p,
              g = f[1] * p,
              y = f[2] * p,
              m = e.points,
              _ = e.indices,
              b = m.length / 6;
            _.push(b);
            for (var x = 0; x < c + 1; x++) m.push(i, u, v, g, y, p), m.push(i + Math.sin(d * x) * h, u + Math.cos(d * x) * l, v, g, y, p), _.push(b++, b++);
            _.push(b - 1);
          }
          if (t.lineWidth) {
            var T = t.points;
            t.points = [];
            for (var w = 0; w < c; w++) t.points.push(i + Math.sin(d * -w) * h, u + Math.cos(d * -w) * l);
            t.points.push(t.points[0], t.points[1]), (0, o["default"])(t, e, r), t.points = T;
          }
        }
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("./buildLine"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../../const"),
        a = t("../../../utils");
    }, {
      "../../../const": 46,
      "../../../utils": 125,
      "./buildLine": 61
    }],
    61: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        var r = t.points;
        if (0 !== r.length) {
          var n = new o.Point(r[0], r[1]),
            i = new o.Point(r[r.length - 2], r[r.length - 1]);
          if (n.x === i.x && n.y === i.y) {
            r = r.slice(), r.pop(), r.pop(), i = new o.Point(r[r.length - 2], r[r.length - 1]);
            var a = i.x + .5 * (n.x - i.x),
              u = i.y + .5 * (n.y - i.y);
            r.unshift(a, u), r.push(a, u);
          }
          var h = e.points,
            l = e.indices,
            c = r.length / 2,
            d = r.length,
            f = h.length / 6,
            p = t.lineWidth / 2,
            v = (0, s.hex2rgb)(t.lineColor),
            g = t.lineAlpha,
            y = v[0] * g,
            m = v[1] * g,
            _ = v[2] * g,
            b = r[0],
            x = r[1],
            T = r[2],
            w = r[3],
            E = 0,
            S = 0,
            O = -(x - w),
            M = b - T,
            P = 0,
            C = 0,
            R = 0,
            A = 0,
            I = Math.sqrt(O * O + M * M);
          O /= I, M /= I, O *= p, M *= p;
          var D = t.lineAlignment,
            L = 2 * (1 - D),
            N = 2 * D;
          h.push(b - O * L, x - M * L, y, m, _, g), h.push(b + O * N, x + M * N, y, m, _, g);
          for (var B = 1; B < c - 1; ++B) {
            b = r[2 * (B - 1)], x = r[2 * (B - 1) + 1], T = r[2 * B], w = r[2 * B + 1], E = r[2 * (B + 1)], S = r[2 * (B + 1) + 1], O = -(x - w), M = b - T, I = Math.sqrt(O * O + M * M), O /= I, M /= I, O *= p, M *= p, P = -(w - S), C = T - E, I = Math.sqrt(P * P + C * C), P /= I, C /= I, P *= p, C *= p;
            var k = -M + x - (-M + w),
              F = -O + T - (-O + b),
              j = (-O + b) * (-M + w) - (-O + T) * (-M + x),
              U = -C + S - (-C + w),
              X = -P + T - (-P + E),
              G = (-P + E) * (-C + w) - (-P + T) * (-C + S),
              W = k * X - U * F;
            if (Math.abs(W) < .1) W += 10.1, h.push(T - O * L, w - M * L, y, m, _, g), h.push(T + O * N, w + M * N, y, m, _, g);
            else {
              var H = (F * G - X * j) / W,
                Y = (U * j - k * G) / W;
              (H - T) * (H - T) + (Y - w) * (Y - w) > 196 * p * p ? (R = O - P, A = M - C, I = Math.sqrt(R * R + A * A), R /= I, A /= I, R *= p, A *= p, h.push(T - R * L, w - A * L), h.push(y, m, _, g), h.push(T + R * N, w + A * N), h.push(y, m, _, g), h.push(T - R * N * L, w - A * L), h.push(y, m, _, g), d++) : (h.push(T + (H - T) * L, w + (Y - w) * L), h.push(y, m, _, g), h.push(T - (H - T) * N, w - (Y - w) * N), h.push(y, m, _, g));
            }
          }
          b = r[2 * (c - 2)], x = r[2 * (c - 2) + 1], T = r[2 * (c - 1)], w = r[2 * (c - 1) + 1], O = -(x - w), M = b - T, I = Math.sqrt(O * O + M * M), O /= I, M /= I, O *= p, M *= p, h.push(T - O * L, w - M * L), h.push(y, m, _, g), h.push(T + O * N, w + M * N), h.push(y, m, _, g), l.push(f);
          for (var V = 0; V < d; ++V) l.push(f++);
          l.push(f - 1);
        }
      }

      function i(t, e) {
        var r = 0,
          n = t.points;
        if (0 !== n.length) {
          var i = e.points,
            o = n.length / 2,
            a = (0, s.hex2rgb)(t.lineColor),
            u = t.lineAlpha,
            h = a[0] * u,
            l = a[1] * u,
            c = a[2] * u;
          for (r = 1; r < o; r++) {
            var d = n[2 * (r - 1)],
              f = n[2 * (r - 1) + 1],
              p = n[2 * r],
              v = n[2 * r + 1];
            i.push(d, f), i.push(h, l, c, u), i.push(p, v), i.push(h, l, c, u);
          }
        }
      }
      r.__esModule = !0, r["default"] = function (t, e, r) {
        t.nativeLines ? i(t, r) : n(t, e);
      };
      var o = t("../../../math"),
        s = t("../../../utils");
    }, {
      "../../../math": 70,
      "../../../utils": 125
    }],
    62: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e, r) {
        t.points = t.shape.points.slice();
        var n = t.points;
        if (t.fill && n.length >= 6) {
          for (var i = [], o = t.holes, u = 0; u < o.length; u++) {
            var l = o[u];
            i.push(n.length / 2), n = n.concat(l.points);
          }
          var c = e.points,
            d = e.indices,
            f = n.length / 2,
            p = (0, a.hex2rgb)(t.fillColor),
            v = t.fillAlpha,
            g = p[0] * v,
            y = p[1] * v,
            m = p[2] * v,
            _ = (0, h["default"])(n, i, 2);
          if (!_) return;
          for (var b = c.length / 6, x = 0; x < _.length; x += 3) d.push(_[x] + b), d.push(_[x] + b), d.push(_[x + 1] + b), d.push(_[x + 2] + b), d.push(_[x + 2] + b);
          for (var T = 0; T < f; T++) c.push(n[2 * T], n[2 * T + 1], g, y, m, v);
        }
        t.lineWidth > 0 && (0, s["default"])(t, e, r);
      }
      r.__esModule = !0, r["default"] = i;
      var o = t("./buildLine"),
        s = n(o),
        a = t("../../../utils"),
        u = t("earcut"),
        h = n(u);
    }, {
      "../../../utils": 125,
      "./buildLine": 61,
      earcut: 2
    }],
    63: [function (t, e, r) {
      "use strict";

      function n(t, e, r) {
        var n = t.shape,
          i = n.x,
          a = n.y,
          u = n.width,
          h = n.height;
        if (t.fill) {
          var l = (0, s.hex2rgb)(t.fillColor),
            c = t.fillAlpha,
            d = l[0] * c,
            f = l[1] * c,
            p = l[2] * c,
            v = e.points,
            g = e.indices,
            y = v.length / 6;
          v.push(i, a), v.push(d, f, p, c), v.push(i + u, a), v.push(d, f, p, c), v.push(i, a + h), v.push(d, f, p, c), v.push(i + u, a + h), v.push(d, f, p, c), g.push(y, y, y + 1, y + 2, y + 3, y + 3);
        }
        if (t.lineWidth) {
          var m = t.points;
          t.points = [i, a, i + u, a, i + u, a + h, i, a + h, i, a], (0, o["default"])(t, e, r), t.points = m;
        }
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("./buildLine"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../../utils");
    }, {
      "../../../utils": 125,
      "./buildLine": 61
    }],
    64: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e, r) {
        var n = t.shape,
          i = n.x,
          o = n.y,
          a = n.width,
          h = n.height,
          d = n.radius,
          f = [];
        if (f.push(i + d, o), s(i + a - d, o, i + a, o, i + a, o + d, f), s(i + a, o + h - d, i + a, o + h, i + a - d, o + h, f), s(i + d, o + h, i, o + h, i, o + h - d, f), s(i, o + d, i, o, i + d + 1e-10, o, f), t.fill) {
          for (var p = (0, c.hex2rgb)(t.fillColor), v = t.fillAlpha, g = p[0] * v, y = p[1] * v, m = p[2] * v, _ = e.points, b = e.indices, x = _.length / 6, T = (0, u["default"])(f, null, 2), w = 0, E = T.length; w < E; w += 3) b.push(T[w] + x), b.push(T[w] + x), b.push(T[w + 1] + x), b.push(T[w + 2] + x), b.push(T[w + 2] + x);
          for (var S = 0, O = f.length; S < O; S++) _.push(f[S], f[++S], g, y, m, v);
        }
        if (t.lineWidth) {
          var M = t.points;
          t.points = f, (0, l["default"])(t, e, r), t.points = M;
        }
      }

      function o(t, e, r) {
        return t + (e - t) * r;
      }

      function s(t, e, r, n, i, s) {
        for (var a = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : [], u = a, h = 0, l = 0, c = 0, d = 0, f = 0, p = 0, v = 0, g = 0; v <= 20; ++v) g = v / 20, h = o(t, r, g), l = o(e, n, g), c = o(r, i, g), d = o(n, s, g), f = o(h, c, g), p = o(l, d, g), u.push(f, p);
        return u;
      }
      r.__esModule = !0, r["default"] = i;
      var a = t("earcut"),
        u = n(a),
        h = t("./buildLine"),
        l = n(h),
        c = t("../../../utils");
    }, {
      "../../../utils": 125,
      "./buildLine": 61,
      earcut: 2
    }],
    65: [function (t, e, r) {
      "use strict";

      function n(t) {
        if (t && t.__esModule) return t;
        var e = {};
        if (null != t)
          for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
        return e["default"] = t, e;
      }

      function i(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0, r.autoDetectRenderer = r.Application = r.Filter = r.SpriteMaskFilter = r.Quad = r.RenderTarget = r.ObjectRenderer = r.WebGLManager = r.Shader = r.CanvasRenderTarget = r.TextureUvs = r.VideoBaseTexture = r.BaseRenderTexture = r.RenderTexture = r.BaseTexture = r.TextureMatrix = r.Texture = r.Spritesheet = r.CanvasGraphicsRenderer = r.GraphicsRenderer = r.GraphicsData = r.Graphics = r.TextMetrics = r.TextStyle = r.Text = r.SpriteRenderer = r.CanvasTinter = r.CanvasSpriteRenderer = r.Sprite = r.TransformBase = r.TransformStatic = r.Transform = r.Container = r.DisplayObject = r.Bounds = r.glCore = r.WebGLRenderer = r.CanvasRenderer = r.ticker = r.utils = r.settings = void 0;
      var o = t("./const");
      Object.keys(o).forEach(function (t) {
        "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
          enumerable: !0,
          get: function get() {
            return o[t];
          }
        });
      });
      var s = t("./math");
      Object.keys(s).forEach(function (t) {
        "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
          enumerable: !0,
          get: function get() {
            return s[t];
          }
        });
      });
      var a = t("pixi-gl-core");
      Object.defineProperty(r, "glCore", {
        enumerable: !0,
        get: function get() {
          return i(a)["default"];
        }
      });
      var u = t("./display/Bounds");
      Object.defineProperty(r, "Bounds", {
        enumerable: !0,
        get: function get() {
          return i(u)["default"];
        }
      });
      var h = t("./display/DisplayObject");
      Object.defineProperty(r, "DisplayObject", {
        enumerable: !0,
        get: function get() {
          return i(h)["default"];
        }
      });
      var l = t("./display/Container");
      Object.defineProperty(r, "Container", {
        enumerable: !0,
        get: function get() {
          return i(l)["default"];
        }
      });
      var c = t("./display/Transform");
      Object.defineProperty(r, "Transform", {
        enumerable: !0,
        get: function get() {
          return i(c)["default"];
        }
      });
      var d = t("./display/TransformStatic");
      Object.defineProperty(r, "TransformStatic", {
        enumerable: !0,
        get: function get() {
          return i(d)["default"];
        }
      });
      var f = t("./display/TransformBase");
      Object.defineProperty(r, "TransformBase", {
        enumerable: !0,
        get: function get() {
          return i(f)["default"];
        }
      });
      var p = t("./sprites/Sprite");
      Object.defineProperty(r, "Sprite", {
        enumerable: !0,
        get: function get() {
          return i(p)["default"];
        }
      });
      var v = t("./sprites/canvas/CanvasSpriteRenderer");
      Object.defineProperty(r, "CanvasSpriteRenderer", {
        enumerable: !0,
        get: function get() {
          return i(v)["default"];
        }
      });
      var g = t("./sprites/canvas/CanvasTinter");
      Object.defineProperty(r, "CanvasTinter", {
        enumerable: !0,
        get: function get() {
          return i(g)["default"];
        }
      });
      var y = t("./sprites/webgl/SpriteRenderer");
      Object.defineProperty(r, "SpriteRenderer", {
        enumerable: !0,
        get: function get() {
          return i(y)["default"];
        }
      });
      var m = t("./text/Text");
      Object.defineProperty(r, "Text", {
        enumerable: !0,
        get: function get() {
          return i(m)["default"];
        }
      });
      var _ = t("./text/TextStyle");
      Object.defineProperty(r, "TextStyle", {
        enumerable: !0,
        get: function get() {
          return i(_)["default"];
        }
      });
      var b = t("./text/TextMetrics");
      Object.defineProperty(r, "TextMetrics", {
        enumerable: !0,
        get: function get() {
          return i(b)["default"];
        }
      });
      var x = t("./graphics/Graphics");
      Object.defineProperty(r, "Graphics", {
        enumerable: !0,
        get: function get() {
          return i(x)["default"];
        }
      });
      var T = t("./graphics/GraphicsData");
      Object.defineProperty(r, "GraphicsData", {
        enumerable: !0,
        get: function get() {
          return i(T)["default"];
        }
      });
      var w = t("./graphics/webgl/GraphicsRenderer");
      Object.defineProperty(r, "GraphicsRenderer", {
        enumerable: !0,
        get: function get() {
          return i(w)["default"];
        }
      });
      var E = t("./graphics/canvas/CanvasGraphicsRenderer");
      Object.defineProperty(r, "CanvasGraphicsRenderer", {
        enumerable: !0,
        get: function get() {
          return i(E)["default"];
        }
      });
      var S = t("./textures/Spritesheet");
      Object.defineProperty(r, "Spritesheet", {
        enumerable: !0,
        get: function get() {
          return i(S)["default"];
        }
      });
      var O = t("./textures/Texture");
      Object.defineProperty(r, "Texture", {
        enumerable: !0,
        get: function get() {
          return i(O)["default"];
        }
      });
      var M = t("./textures/TextureMatrix");
      Object.defineProperty(r, "TextureMatrix", {
        enumerable: !0,
        get: function get() {
          return i(M)["default"];
        }
      });
      var P = t("./textures/BaseTexture");
      Object.defineProperty(r, "BaseTexture", {
        enumerable: !0,
        get: function get() {
          return i(P)["default"];
        }
      });
      var C = t("./textures/RenderTexture");
      Object.defineProperty(r, "RenderTexture", {
        enumerable: !0,
        get: function get() {
          return i(C)["default"];
        }
      });
      var R = t("./textures/BaseRenderTexture");
      Object.defineProperty(r, "BaseRenderTexture", {
        enumerable: !0,
        get: function get() {
          return i(R)["default"];
        }
      });
      var A = t("./textures/VideoBaseTexture");
      Object.defineProperty(r, "VideoBaseTexture", {
        enumerable: !0,
        get: function get() {
          return i(A)["default"];
        }
      });
      var I = t("./textures/TextureUvs");
      Object.defineProperty(r, "TextureUvs", {
        enumerable: !0,
        get: function get() {
          return i(I)["default"];
        }
      });
      var D = t("./renderers/canvas/utils/CanvasRenderTarget");
      Object.defineProperty(r, "CanvasRenderTarget", {
        enumerable: !0,
        get: function get() {
          return i(D)["default"];
        }
      });
      var L = t("./Shader");
      Object.defineProperty(r, "Shader", {
        enumerable: !0,
        get: function get() {
          return i(L)["default"];
        }
      });
      var N = t("./renderers/webgl/managers/WebGLManager");
      Object.defineProperty(r, "WebGLManager", {
        enumerable: !0,
        get: function get() {
          return i(N)["default"];
        }
      });
      var B = t("./renderers/webgl/utils/ObjectRenderer");
      Object.defineProperty(r, "ObjectRenderer", {
        enumerable: !0,
        get: function get() {
          return i(B)["default"];
        }
      });
      var k = t("./renderers/webgl/utils/RenderTarget");
      Object.defineProperty(r, "RenderTarget", {
        enumerable: !0,
        get: function get() {
          return i(k)["default"];
        }
      });
      var F = t("./renderers/webgl/utils/Quad");
      Object.defineProperty(r, "Quad", {
        enumerable: !0,
        get: function get() {
          return i(F)["default"];
        }
      });
      var j = t("./renderers/webgl/filters/spriteMask/SpriteMaskFilter");
      Object.defineProperty(r, "SpriteMaskFilter", {
        enumerable: !0,
        get: function get() {
          return i(j)["default"];
        }
      });
      var U = t("./renderers/webgl/filters/Filter");
      Object.defineProperty(r, "Filter", {
        enumerable: !0,
        get: function get() {
          return i(U)["default"];
        }
      });
      var X = t("./Application");
      Object.defineProperty(r, "Application", {
        enumerable: !0,
        get: function get() {
          return i(X)["default"];
        }
      });
      var G = t("./autoDetectRenderer");
      Object.defineProperty(r, "autoDetectRenderer", {
        enumerable: !0,
        get: function get() {
          return G.autoDetectRenderer;
        }
      });
      var W = t("./utils"),
        H = n(W),
        Y = t("./ticker"),
        V = n(Y),
        z = t("./settings"),
        q = i(z),
        K = t("./renderers/canvas/CanvasRenderer"),
        Z = i(K),
        J = t("./renderers/webgl/WebGLRenderer"),
        Q = i(J);
      r.settings = q["default"], r.utils = H, r.ticker = V, r.CanvasRenderer = Z["default"], r.WebGLRenderer = Q["default"];
    }, {
      "./Application": 43,
      "./Shader": 44,
      "./autoDetectRenderer": 45,
      "./const": 46,
      "./display/Bounds": 47,
      "./display/Container": 48,
      "./display/DisplayObject": 49,
      "./display/Transform": 50,
      "./display/TransformBase": 51,
      "./display/TransformStatic": 52,
      "./graphics/Graphics": 53,
      "./graphics/GraphicsData": 54,
      "./graphics/canvas/CanvasGraphicsRenderer": 55,
      "./graphics/webgl/GraphicsRenderer": 57,
      "./math": 70,
      "./renderers/canvas/CanvasRenderer": 77,
      "./renderers/canvas/utils/CanvasRenderTarget": 79,
      "./renderers/webgl/WebGLRenderer": 84,
      "./renderers/webgl/filters/Filter": 86,
      "./renderers/webgl/filters/spriteMask/SpriteMaskFilter": 89,
      "./renderers/webgl/managers/WebGLManager": 93,
      "./renderers/webgl/utils/ObjectRenderer": 94,
      "./renderers/webgl/utils/Quad": 95,
      "./renderers/webgl/utils/RenderTarget": 96,
      "./settings": 101,
      "./sprites/Sprite": 102,
      "./sprites/canvas/CanvasSpriteRenderer": 103,
      "./sprites/canvas/CanvasTinter": 104,
      "./sprites/webgl/SpriteRenderer": 106,
      "./text/Text": 108,
      "./text/TextMetrics": 109,
      "./text/TextStyle": 110,
      "./textures/BaseRenderTexture": 111,
      "./textures/BaseTexture": 112,
      "./textures/RenderTexture": 113,
      "./textures/Spritesheet": 114,
      "./textures/Texture": 115,
      "./textures/TextureMatrix": 116,
      "./textures/TextureUvs": 117,
      "./textures/VideoBaseTexture": 118,
      "./ticker": 121,
      "./utils": 125,
      "pixi-gl-core": 15
    }],
    66: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t < 0 ? -1 : t > 0 ? 1 : 0;
      }
      r.__esModule = !0;
      var i = t("./Matrix"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = [1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1, 0, 1],
        a = [0, 1, 1, 1, 0, -1, -1, -1, 0, 1, 1, 1, 0, -1, -1, -1],
        u = [0, -1, -1, -1, 0, 1, 1, 1, 0, 1, 1, 1, 0, -1, -1, -1],
        h = [1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, 1, 1, 1, 0, -1],
        l = [],
        c = [];
      ! function () {
        for (var t = 0; t < 16; t++) {
          var e = [];
          c.push(e);
          for (var r = 0; r < 16; r++)
            for (var i = n(s[t] * s[r] + u[t] * a[r]), d = n(a[t] * s[r] + h[t] * a[r]), f = n(s[t] * u[r] + u[t] * h[r]), p = n(a[t] * u[r] + h[t] * h[r]), v = 0; v < 16; v++)
              if (s[v] === i && a[v] === d && u[v] === f && h[v] === p) {
                e.push(v);
                break;
              }
        }
        for (var g = 0; g < 16; g++) {
          var y = new o["default"]();
          y.set(s[g], a[g], u[g], h[g], 0, 0), l.push(y);
        }
      }();
      var d = {
        E: 0,
        SE: 1,
        S: 2,
        SW: 3,
        W: 4,
        NW: 5,
        N: 6,
        NE: 7,
        MIRROR_VERTICAL: 8,
        MIRROR_HORIZONTAL: 12,
        uX: function uX(t) {
          return s[t];
        },
        uY: function uY(t) {
          return a[t];
        },
        vX: function vX(t) {
          return u[t];
        },
        vY: function vY(t) {
          return h[t];
        },
        inv: function inv(t) {
          return 8 & t ? 15 & t : 7 & -t;
        },
        add: function add(t, e) {
          return c[t][e];
        },
        sub: function sub(t, e) {
          return c[t][d.inv(e)];
        },
        rotate180: function rotate180(t) {
          return 4 ^ t;
        },
        isVertical: function isVertical(t) {
          return 2 == (3 & t);
        },
        byDirection: function byDirection(t, e) {
          return 2 * Math.abs(t) <= Math.abs(e) ? e >= 0 ? d.S : d.N : 2 * Math.abs(e) <= Math.abs(t) ? t > 0 ? d.E : d.W : e > 0 ? t > 0 ? d.SE : d.SW : t > 0 ? d.NE : d.NW;
        },
        matrixAppendRotationInv: function matrixAppendRotationInv(t, e) {
          var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
            n = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0,
            i = l[d.inv(e)];
          i.tx = r, i.ty = n, t.append(i);
        }
      };
      r["default"] = d;
    }, {
      "./Matrix": 67
    }],
    67: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("./Point"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = t("../const"),
        u = function () {
          function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
              o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 1,
              s = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 0,
              a = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : 0;
            n(this, t), this.a = e, this.b = r, this.c = i, this.d = o, this.tx = s, this.ty = a, this.array = null;
          }
          return t.prototype.fromArray = function (t) {
            this.a = t[0], this.b = t[1], this.c = t[3], this.d = t[4], this.tx = t[2], this.ty = t[5];
          }, t.prototype.set = function (t, e, r, n, i, o) {
            return this.a = t, this.b = e, this.c = r, this.d = n, this.tx = i, this.ty = o, this;
          }, t.prototype.toArray = function (t, e) {
            this.array || (this.array = new Float32Array(9));
            var r = e || this.array;
            return t ? (r[0] = this.a, r[1] = this.b, r[2] = 0, r[3] = this.c, r[4] = this.d, r[5] = 0, r[6] = this.tx, r[7] = this.ty, r[8] = 1) : (r[0] = this.a, r[1] = this.c, r[2] = this.tx, r[3] = this.b, r[4] = this.d, r[5] = this.ty, r[6] = 0, r[7] = 0, r[8] = 1), r;
          }, t.prototype.apply = function (t, e) {
            e = e || new s["default"]();
            var r = t.x,
              n = t.y;
            return e.x = this.a * r + this.c * n + this.tx, e.y = this.b * r + this.d * n + this.ty, e;
          }, t.prototype.applyInverse = function (t, e) {
            e = e || new s["default"]();
            var r = 1 / (this.a * this.d + this.c * -this.b),
              n = t.x,
              i = t.y;
            return e.x = this.d * r * n + -this.c * r * i + (this.ty * this.c - this.tx * this.d) * r, e.y = this.a * r * i + -this.b * r * n + (-this.ty * this.a + this.tx * this.b) * r, e;
          }, t.prototype.translate = function (t, e) {
            return this.tx += t, this.ty += e, this;
          }, t.prototype.scale = function (t, e) {
            return this.a *= t, this.d *= e, this.c *= t, this.b *= e, this.tx *= t, this.ty *= e, this;
          }, t.prototype.rotate = function (t) {
            var e = Math.cos(t),
              r = Math.sin(t),
              n = this.a,
              i = this.c,
              o = this.tx;
            return this.a = n * e - this.b * r, this.b = n * r + this.b * e, this.c = i * e - this.d * r, this.d = i * r + this.d * e, this.tx = o * e - this.ty * r, this.ty = o * r + this.ty * e, this;
          }, t.prototype.append = function (t) {
            var e = this.a,
              r = this.b,
              n = this.c,
              i = this.d;
            return this.a = t.a * e + t.b * n, this.b = t.a * r + t.b * i, this.c = t.c * e + t.d * n, this.d = t.c * r + t.d * i, this.tx = t.tx * e + t.ty * n + this.tx, this.ty = t.tx * r + t.ty * i + this.ty, this;
          }, t.prototype.setTransform = function (t, e, r, n, i, o, s, a, u) {
            return this.a = Math.cos(s + u) * i, this.b = Math.sin(s + u) * i, this.c = -Math.sin(s - a) * o, this.d = Math.cos(s - a) * o, this.tx = t - (r * this.a + n * this.c), this.ty = e - (r * this.b + n * this.d), this;
          }, t.prototype.prepend = function (t) {
            var e = this.tx;
            if (1 !== t.a || 0 !== t.b || 0 !== t.c || 1 !== t.d) {
              var r = this.a,
                n = this.c;
              this.a = r * t.a + this.b * t.c, this.b = r * t.b + this.b * t.d, this.c = n * t.a + this.d * t.c, this.d = n * t.b + this.d * t.d;
            }
            return this.tx = e * t.a + this.ty * t.c + t.tx, this.ty = e * t.b + this.ty * t.d + t.ty, this;
          }, t.prototype.decompose = function (t) {
            var e = this.a,
              r = this.b,
              n = this.c,
              i = this.d,
              o = -Math.atan2(-n, i),
              s = Math.atan2(r, e),
              u = Math.abs(o + s);
            return u < 1e-5 || Math.abs(a.PI_2 - u) < 1e-5 ? (t.rotation = s, t.skew.x = t.skew.y = 0) : (t.rotation = 0, t.skew.x = o, t.skew.y = s), t.scale.x = Math.sqrt(e * e + r * r), t.scale.y = Math.sqrt(n * n + i * i), t.position.x = this.tx, t.position.y = this.ty, t;
          }, t.prototype.invert = function () {
            var t = this.a,
              e = this.b,
              r = this.c,
              n = this.d,
              i = this.tx,
              o = t * n - e * r;
            return this.a = n / o, this.b = -e / o, this.c = -r / o, this.d = t / o, this.tx = (r * this.ty - n * i) / o, this.ty = -(t * this.ty - e * i) / o, this;
          }, t.prototype.identity = function () {
            return this.a = 1, this.b = 0, this.c = 0, this.d = 1, this.tx = 0, this.ty = 0, this;
          }, t.prototype.clone = function () {
            var e = new t();
            return e.a = this.a, e.b = this.b, e.c = this.c, e.d = this.d, e.tx = this.tx, e.ty = this.ty, e;
          }, t.prototype.copy = function (t) {
            return t.a = this.a, t.b = this.b, t.c = this.c, t.d = this.d, t.tx = this.tx, t.ty = this.ty, t;
          }, i(t, null, [{
            key: "IDENTITY",
            get: function get() {
              return new t();
            }
          }, {
            key: "TEMP_MATRIX",
            get: function get() {
              return new t();
            }
          }]), t;
        }();
      r["default"] = u;
    }, {
      "../const": 46,
      "./Point": 69
    }],
    68: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = function () {
          function t(e, r) {
            var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
              o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
            n(this, t), this._x = i, this._y = o, this.cb = e, this.scope = r;
          }
          return t.prototype.clone = function () {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;
            return new t(e || this.cb, r || this.scope, this._x, this._y);
          }, t.prototype.set = function (t, e) {
            var r = t || 0,
              n = e || (0 !== e ? r : 0);
            this._x === r && this._y === n || (this._x = r, this._y = n, this.cb.call(this.scope));
          }, t.prototype.copy = function (t) {
            this._x === t.x && this._y === t.y || (this._x = t.x, this._y = t.y, this.cb.call(this.scope));
          }, t.prototype.equals = function (t) {
            return t.x === this._x && t.y === this._y;
          }, i(t, [{
            key: "x",
            get: function get() {
              return this._x;
            },
            set: function set(t) {
              this._x !== t && (this._x = t, this.cb.call(this.scope));
            }
          }, {
            key: "y",
            get: function get() {
              return this._y;
            },
            set: function set(t) {
              this._y !== t && (this._y = t, this.cb.call(this.scope));
            }
          }]), t;
        }();
      r["default"] = o;
    }, {}],
    69: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t() {
          var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
            r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0;
          n(this, t), this.x = e, this.y = r;
        }
        return t.prototype.clone = function () {
          return new t(this.x, this.y);
        }, t.prototype.copy = function (t) {
          this.set(t.x, t.y);
        }, t.prototype.equals = function (t) {
          return t.x === this.x && t.y === this.y;
        }, t.prototype.set = function (t, e) {
          this.x = t || 0, this.y = e || (0 !== e ? this.x : 0);
        }, t;
      }();
      r["default"] = i;
    }, {}],
    70: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./Point");
      Object.defineProperty(r, "Point", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./ObservablePoint");
      Object.defineProperty(r, "ObservablePoint", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./Matrix");
      Object.defineProperty(r, "Matrix", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./GroupD8");
      Object.defineProperty(r, "GroupD8", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      });
      var u = t("./shapes/Circle");
      Object.defineProperty(r, "Circle", {
        enumerable: !0,
        get: function get() {
          return n(u)["default"];
        }
      });
      var h = t("./shapes/Ellipse");
      Object.defineProperty(r, "Ellipse", {
        enumerable: !0,
        get: function get() {
          return n(h)["default"];
        }
      });
      var l = t("./shapes/Polygon");
      Object.defineProperty(r, "Polygon", {
        enumerable: !0,
        get: function get() {
          return n(l)["default"];
        }
      });
      var c = t("./shapes/Rectangle");
      Object.defineProperty(r, "Rectangle", {
        enumerable: !0,
        get: function get() {
          return n(c)["default"];
        }
      });
      var d = t("./shapes/RoundedRectangle");
      Object.defineProperty(r, "RoundedRectangle", {
        enumerable: !0,
        get: function get() {
          return n(d)["default"];
        }
      });
    }, {
      "./GroupD8": 66,
      "./Matrix": 67,
      "./ObservablePoint": 68,
      "./Point": 69,
      "./shapes/Circle": 71,
      "./shapes/Ellipse": 72,
      "./shapes/Polygon": 73,
      "./shapes/Rectangle": 74,
      "./shapes/RoundedRectangle": 75
    }],
    71: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("./Rectangle"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../const"),
        a = function () {
          function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0;
            n(this, t), this.x = e, this.y = r, this.radius = i, this.type = s.SHAPES.CIRC;
          }
          return t.prototype.clone = function () {
            return new t(this.x, this.y, this.radius);
          }, t.prototype.contains = function (t, e) {
            if (this.radius <= 0) return !1;
            var r = this.radius * this.radius,
              n = this.x - t,
              i = this.y - e;
            return n *= n, i *= i, n + i <= r;
          }, t.prototype.getBounds = function () {
            return new o["default"](this.x - this.radius, this.y - this.radius, 2 * this.radius, 2 * this.radius);
          }, t;
        }();
      r["default"] = a;
    }, {
      "../../const": 46,
      "./Rectangle": 74
    }],
    72: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("./Rectangle"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../const"),
        a = function () {
          function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
              o = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
            n(this, t), this.x = e, this.y = r, this.width = i, this.height = o, this.type = s.SHAPES.ELIP;
          }
          return t.prototype.clone = function () {
            return new t(this.x, this.y, this.width, this.height);
          }, t.prototype.contains = function (t, e) {
            if (this.width <= 0 || this.height <= 0) return !1;
            var r = (t - this.x) / this.width,
              n = (e - this.y) / this.height;
            return r *= r, n *= n, r + n <= 1;
          }, t.prototype.getBounds = function () {
            return new o["default"](this.x - this.width, this.y - this.height, this.width, this.height);
          }, t;
        }();
      r["default"] = a;
    }, {
      "../../const": 46,
      "./Rectangle": 74
    }],
    73: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../Point"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = t("../../const"),
        a = function () {
          function t() {
            for (var e = arguments.length, r = Array(e), i = 0; i < e; i++) r[i] = arguments[i];
            if (n(this, t), Array.isArray(r[0]) && (r = r[0]), r[0] instanceof o["default"]) {
              for (var a = [], u = 0, h = r.length; u < h; u++) a.push(r[u].x, r[u].y);
              r = a;
            }
            this.closed = !0, this.points = r, this.type = s.SHAPES.POLY;
          }
          return t.prototype.clone = function () {
            return new t(this.points.slice());
          }, t.prototype.close = function () {
            var t = this.points;
            t[0] === t[t.length - 2] && t[1] === t[t.length - 1] || t.push(t[0], t[1]);
          }, t.prototype.contains = function (t, e) {
            for (var r = !1, n = this.points.length / 2, i = 0, o = n - 1; i < n; o = i++) {
              var s = this.points[2 * i],
                a = this.points[2 * i + 1],
                u = this.points[2 * o],
                h = this.points[2 * o + 1];
              a > e != h > e && t < (e - a) / (h - a) * (u - s) + s && (r = !r);
            }
            return r;
          }, t;
        }();
      r["default"] = a;
    }, {
      "../../const": 46,
      "../Point": 69
    }],
    74: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("../../const"),
        s = function () {
          function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
              s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0;
            n(this, t), this.x = Number(e), this.y = Number(r), this.width = Number(i), this.height = Number(s), this.type = o.SHAPES.RECT;
          }
          return t.prototype.clone = function () {
            return new t(this.x, this.y, this.width, this.height);
          }, t.prototype.copy = function (t) {
            return this.x = t.x, this.y = t.y, this.width = t.width, this.height = t.height, this;
          }, t.prototype.contains = function (t, e) {
            return !(this.width <= 0 || this.height <= 0) && t >= this.x && t < this.x + this.width && e >= this.y && e < this.y + this.height;
          }, t.prototype.pad = function (t, e) {
            t = t || 0, e = e || (0 !== e ? t : 0), this.x -= t, this.y -= e, this.width += 2 * t, this.height += 2 * e;
          }, t.prototype.fit = function (t) {
            var e = Math.max(this.x, t.x),
              r = Math.min(this.x + this.width, t.x + t.width),
              n = Math.max(this.y, t.y),
              i = Math.min(this.y + this.height, t.y + t.height);
            this.x = e, this.width = Math.max(r - e, 0), this.y = n, this.height = Math.max(i - n, 0);
          }, t.prototype.enlarge = function (t) {
            var e = Math.min(this.x, t.x),
              r = Math.max(this.x + this.width, t.x + t.width),
              n = Math.min(this.y, t.y),
              i = Math.max(this.y + this.height, t.y + t.height);
            this.x = e, this.width = r - e, this.y = n, this.height = i - n;
          }, t.prototype.ceil = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1,
              e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : .001,
              r = Math.ceil((this.x + this.width - e) * t) / t,
              n = Math.ceil((this.y + this.height - e) * t) / t;
            this.x = Math.floor((this.x + e) * t) / t, this.y = Math.floor((this.y + e) * t) / t, this.width = r - this.x, this.height = n - this.y;
          }, i(t, [{
            key: "left",
            get: function get() {
              return this.x;
            }
          }, {
            key: "right",
            get: function get() {
              return this.x + this.width;
            }
          }, {
            key: "top",
            get: function get() {
              return this.y;
            }
          }, {
            key: "bottom",
            get: function get() {
              return this.y + this.height;
            }
          }], [{
            key: "EMPTY",
            get: function get() {
              return new t(0, 0, 0, 0);
            }
          }]), t;
        }();
      r["default"] = s;
    }, {
      "../../const": 46
    }],
    75: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../const"),
        o = function () {
          function t() {
            var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 0,
              o = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
              s = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0,
              a = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 20;
            n(this, t), this.x = e, this.y = r, this.width = o, this.height = s, this.radius = a, this.type = i.SHAPES.RREC;
          }
          return t.prototype.clone = function () {
            return new t(this.x, this.y, this.width, this.height, this.radius);
          }, t.prototype.contains = function (t, e) {
            if (this.width <= 0 || this.height <= 0) return !1;
            if (t >= this.x && t <= this.x + this.width && e >= this.y && e <= this.y + this.height) {
              if (e >= this.y + this.radius && e <= this.y + this.height - this.radius || t >= this.x + this.radius && t <= this.x + this.width - this.radius) return !0;
              var r = t - (this.x + this.radius),
                n = e - (this.y + this.radius),
                i = this.radius * this.radius;
              if (r * r + n * n <= i) return !0;
              if ((r = t - (this.x + this.width - this.radius)) * r + n * n <= i) return !0;
              if (n = e - (this.y + this.height - this.radius), r * r + n * n <= i) return !0;
              if ((r = t - (this.x + this.radius)) * r + n * n <= i) return !0;
            }
            return !1;
          }, t;
        }();
      r["default"] = o;
    }, {
      "../../const": 46
    }],
    76: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../utils"),
        h = t("../math"),
        l = t("../const"),
        c = t("../settings"),
        d = n(c),
        f = t("../display/Container"),
        p = n(f),
        v = t("../textures/RenderTexture"),
        g = n(v),
        y = t("eventemitter3"),
        m = n(y),
        _ = new h.Matrix(),
        b = function (t) {
          function e(r, n, s, a) {
            i(this, e);
            var c = o(this, t.call(this));
            return (0, u.sayHello)(r), "number" == typeof n && (n = Object.assign({
              width: n,
              height: s || d["default"].RENDER_OPTIONS.height
            }, a)), n = Object.assign({}, d["default"].RENDER_OPTIONS, n), c.options = n, c.type = l.RENDERER_TYPE.UNKNOWN, c.screen = new h.Rectangle(0, 0, n.width, n.height), c.view = n.view || document.createElement("canvas"), c.resolution = n.resolution || d["default"].RESOLUTION, c.transparent = n.transparent, c.autoResize = n.autoResize || !1, c.blendModes = null, c.preserveDrawingBuffer = n.preserveDrawingBuffer, c.clearBeforeRender = n.clearBeforeRender, c.roundPixels = n.roundPixels, c._backgroundColor = 0, c._backgroundColorRgba = [0, 0, 0, 0], c._backgroundColorString = "#000000", c.backgroundColor = n.backgroundColor || c._backgroundColor, c._tempDisplayObjectParent = new p["default"](), c._lastObjectRendered = c._tempDisplayObjectParent, c;
          }
          return s(e, t), e.prototype.resize = function (t, e) {
            this.screen.width = t, this.screen.height = e, this.view.width = t * this.resolution, this.view.height = e * this.resolution, this.autoResize && (this.view.style.width = t + "px", this.view.style.height = e + "px");
          }, e.prototype.generateTexture = function (t, e, r, n) {
            n = n || t.getLocalBounds();
            var i = g["default"].create(0 | n.width, 0 | n.height, e, r);
            return _.tx = -n.x, _.ty = -n.y, this.render(t, i, !1, _, !!t.parent), i;
          }, e.prototype.destroy = function (t) {
            t && this.view.parentNode && this.view.parentNode.removeChild(this.view), this.type = l.RENDERER_TYPE.UNKNOWN, this.view = null, this.screen = null, this.resolution = 0, this.transparent = !1, this.autoResize = !1, this.blendModes = null, this.options = null, this.preserveDrawingBuffer = !1, this.clearBeforeRender = !1, this.roundPixels = !1, this._backgroundColor = 0, this._backgroundColorRgba = null, this._backgroundColorString = null, this._tempDisplayObjectParent = null, this._lastObjectRendered = null;
          }, a(e, [{
            key: "width",
            get: function get() {
              return this.view.width;
            }
          }, {
            key: "height",
            get: function get() {
              return this.view.height;
            }
          }, {
            key: "backgroundColor",
            get: function get() {
              return this._backgroundColor;
            },
            set: function set(t) {
              this._backgroundColor = t, this._backgroundColorString = (0, u.hex2string)(t), (0, u.hex2rgb)(t, this._backgroundColorRgba);
            }
          }]), e;
        }(m["default"]);
      r["default"] = b;
    }, {
      "../const": 46,
      "../display/Container": 48,
      "../math": 70,
      "../settings": 101,
      "../textures/RenderTexture": 113,
      "../utils": 125,
      eventemitter3: 3
    }],
    77: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../SystemRenderer"),
        u = n(a),
        h = t("./utils/CanvasMaskManager"),
        l = n(h),
        c = t("./utils/CanvasRenderTarget"),
        d = n(c),
        f = t("./utils/mapCanvasBlendModesToPixi"),
        p = n(f),
        v = t("../../utils"),
        g = t("../../const"),
        y = t("../../settings"),
        m = n(y),
        _ = function (t) {
          function e(r, n, s) {
            i(this, e);
            var a = o(this, t.call(this, "Canvas", r, n, s));
            return a.type = g.RENDERER_TYPE.CANVAS, a.rootContext = a.view.getContext("2d", {
              alpha: a.transparent
            }), a.context = a.rootContext, a.refresh = !0, a.maskManager = new l["default"](a), a.smoothProperty = "imageSmoothingEnabled", a.rootContext.imageSmoothingEnabled || (a.rootContext.webkitImageSmoothingEnabled ? a.smoothProperty = "webkitImageSmoothingEnabled" : a.rootContext.mozImageSmoothingEnabled ? a.smoothProperty = "mozImageSmoothingEnabled" : a.rootContext.oImageSmoothingEnabled ? a.smoothProperty = "oImageSmoothingEnabled" : a.rootContext.msImageSmoothingEnabled && (a.smoothProperty = "msImageSmoothingEnabled")), a.initPlugins(), a.blendModes = (0, p["default"])(), a._activeBlendMode = null, a.renderingToScreen = !1, a.resize(a.options.width, a.options.height), a;
          }
          return s(e, t), e.prototype.render = function (t, e, r, n, i) {
            if (this.view) {
              this.renderingToScreen = !e, this.emit("prerender");
              var o = this.resolution;
              e ? (e = e.baseTexture || e, e._canvasRenderTarget || (e._canvasRenderTarget = new d["default"](e.width, e.height, e.resolution), e.source = e._canvasRenderTarget.canvas, e.valid = !0), this.context = e._canvasRenderTarget.context, this.resolution = e._canvasRenderTarget.resolution) : this.context = this.rootContext;
              var s = this.context;
              if (e || (this._lastObjectRendered = t), !i) {
                var a = t.parent,
                  u = this._tempDisplayObjectParent.transform.worldTransform;
                n ? (n.copy(u), this._tempDisplayObjectParent.transform._worldID = -1) : u.identity(), t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = a;
              }
              s.save(), s.setTransform(1, 0, 0, 1, 0, 0), s.globalAlpha = 1, this._activeBlendMode = g.BLEND_MODES.NORMAL, s.globalCompositeOperation = this.blendModes[g.BLEND_MODES.NORMAL], navigator.isCocoonJS && this.view.screencanvas && (s.fillStyle = "black", s.clear()), (void 0 !== r ? r : this.clearBeforeRender) && this.renderingToScreen && (this.transparent ? s.clearRect(0, 0, this.width, this.height) : (s.fillStyle = this._backgroundColorString, s.fillRect(0, 0, this.width, this.height)));
              var h = this.context;
              this.context = s, t.renderCanvas(this), this.context = h, s.restore(), this.resolution = o, this.emit("postrender");
            }
          }, e.prototype.clear = function (t) {
            var e = this.context;
            t = t || this._backgroundColorString, !this.transparent && t ? (e.fillStyle = t, e.fillRect(0, 0, this.width, this.height)) : e.clearRect(0, 0, this.width, this.height);
          }, e.prototype.setBlendMode = function (t) {
            this._activeBlendMode !== t && (this._activeBlendMode = t, this.context.globalCompositeOperation = this.blendModes[t]);
          }, e.prototype.destroy = function (e) {
            this.destroyPlugins(), t.prototype.destroy.call(this, e), this.context = null, this.refresh = !0, this.maskManager.destroy(), this.maskManager = null, this.smoothProperty = null;
          }, e.prototype.resize = function (e, r) {
            t.prototype.resize.call(this, e, r), this.smoothProperty && (this.rootContext[this.smoothProperty] = m["default"].SCALE_MODE === g.SCALE_MODES.LINEAR);
          }, e.prototype.invalidateBlendMode = function () {
            this._activeBlendMode = this.blendModes.indexOf(this.context.globalCompositeOperation);
          }, e;
        }(u["default"]);
      r["default"] = _, v.pluginTarget.mixin(_);
    }, {
      "../../const": 46,
      "../../settings": 101,
      "../../utils": 125,
      "../SystemRenderer": 76,
      "./utils/CanvasMaskManager": 78,
      "./utils/CanvasRenderTarget": 79,
      "./utils/mapCanvasBlendModesToPixi": 81
    }],
    78: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../../const"),
        o = function () {
          function t(e) {
            n(this, t), this.renderer = e;
          }
          return t.prototype.pushMask = function (t) {
            var e = this.renderer;
            e.context.save();
            var r = t.alpha,
              n = t.transform.worldTransform,
              i = e.resolution;
            e.context.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), t._texture || (this.renderGraphicsShape(t), e.context.clip()), t.worldAlpha = r;
          }, t.prototype.renderGraphicsShape = function (t) {
            var e = this.renderer.context,
              r = t.graphicsData.length;
            if (0 !== r) {
              e.beginPath();
              for (var n = 0; n < r; n++) {
                var o = t.graphicsData[n],
                  s = o.shape;
                if (o.type === i.SHAPES.POLY) {
                  var a = s.points,
                    u = o.holes,
                    h = void 0,
                    l = void 0;
                  e.moveTo(a[0], a[1]);
                  for (var c = 2; c < a.length; c += 2) e.lineTo(a[c], a[c + 1]);
                  if (a[0] === a[a.length - 2] && a[1] === a[a.length - 1] && e.closePath(), u.length > 0) {
                    h = 0;
                    for (var d = 0; d < a.length; d += 2) h += a[d] * a[d + 3] - a[d + 1] * a[d + 2];
                    for (var f = 0; f < u.length; f++) {
                      a = u[f].points, l = 0;
                      for (var p = 0; p < a.length; p += 2) l += a[p] * a[p + 3] - a[p + 1] * a[p + 2];
                      if (e.moveTo(a[0], a[1]), l * h < 0)
                        for (var v = 2; v < a.length; v += 2) e.lineTo(a[v], a[v + 1]);
                      else
                        for (var g = a.length - 2; g >= 2; g -= 2) e.lineTo(a[g], a[g + 1]);
                    }
                  }
                } else if (o.type === i.SHAPES.RECT) e.rect(s.x, s.y, s.width, s.height), e.closePath();
                else if (o.type === i.SHAPES.CIRC) e.arc(s.x, s.y, s.radius, 0, 2 * Math.PI), e.closePath();
                else if (o.type === i.SHAPES.ELIP) {
                  var y = 2 * s.width,
                    m = 2 * s.height,
                    _ = s.x - y / 2,
                    b = s.y - m / 2,
                    x = y / 2 * .5522848,
                    T = m / 2 * .5522848,
                    w = _ + y,
                    E = b + m,
                    S = _ + y / 2,
                    O = b + m / 2;
                  e.moveTo(_, O), e.bezierCurveTo(_, O - T, S - x, b, S, b), e.bezierCurveTo(S + x, b, w, O - T, w, O), e.bezierCurveTo(w, O + T, S + x, E, S, E), e.bezierCurveTo(S - x, E, _, O + T, _, O), e.closePath();
                } else if (o.type === i.SHAPES.RREC) {
                  var M = s.x,
                    P = s.y,
                    C = s.width,
                    R = s.height,
                    A = s.radius,
                    I = Math.min(C, R) / 2 | 0;
                  A = A > I ? I : A, e.moveTo(M, P + A), e.lineTo(M, P + R - A), e.quadraticCurveTo(M, P + R, M + A, P + R), e.lineTo(M + C - A, P + R), e.quadraticCurveTo(M + C, P + R, M + C, P + R - A), e.lineTo(M + C, P + A), e.quadraticCurveTo(M + C, P, M + C - A, P), e.lineTo(M + A, P), e.quadraticCurveTo(M, P, M, P + A), e.closePath();
                }
              }
            }
          }, t.prototype.popMask = function (t) {
            t.context.restore(), t.invalidateBlendMode();
          }, t.prototype.destroy = function () {}, t;
        }();
      r["default"] = o;
    }, {
      "../../../const": 46
    }],
    79: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("../../../settings"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = function () {
          function t(e, r, i) {
            n(this, t), this.canvas = document.createElement("canvas"), this.context = this.canvas.getContext("2d"), this.resolution = i || s["default"].RESOLUTION, this.resize(e, r);
          }
          return t.prototype.clear = function () {
            this.context.setTransform(1, 0, 0, 1, 0, 0), this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
          }, t.prototype.resize = function (t, e) {
            this.canvas.width = t * this.resolution, this.canvas.height = e * this.resolution;
          }, t.prototype.destroy = function () {
            this.context = null, this.canvas = null;
          }, i(t, [{
            key: "width",
            get: function get() {
              return this.canvas.width;
            },
            set: function set(t) {
              this.canvas.width = t;
            }
          }, {
            key: "height",
            get: function get() {
              return this.canvas.height;
            },
            set: function set(t) {
              this.canvas.height = t;
            }
          }]), t;
        }();
      r["default"] = a;
    }, {
      "../../../settings": 101
    }],
    80: [function (t, e, r) {
      "use strict";

      function n(t) {
        var e = document.createElement("canvas");
        e.width = 6, e.height = 1;
        var r = e.getContext("2d");
        return r.fillStyle = t, r.fillRect(0, 0, 6, 1), e;
      }

      function i() {
        if ("undefined" == typeof document) return !1;
        var t = n("#ff00ff"),
          e = n("#ffff00"),
          r = document.createElement("canvas");
        r.width = 6, r.height = 1;
        var i = r.getContext("2d");
        i.globalCompositeOperation = "multiply", i.drawImage(t, 0, 0), i.drawImage(e, 2, 0);
        var o = i.getImageData(2, 0, 1, 1);
        if (!o) return !1;
        var s = o.data;
        return 255 === s[0] && 0 === s[1] && 0 === s[2];
      }
      r.__esModule = !0, r["default"] = i;
    }, {}],
    81: [function (t, e, r) {
      "use strict";

      function n() {
        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : [];
        return (0, s["default"])() ? (t[i.BLEND_MODES.NORMAL] = "source-over", t[i.BLEND_MODES.ADD] = "lighter", t[i.BLEND_MODES.MULTIPLY] = "multiply", t[i.BLEND_MODES.SCREEN] = "screen", t[i.BLEND_MODES.OVERLAY] = "overlay", t[i.BLEND_MODES.DARKEN] = "darken", t[i.BLEND_MODES.LIGHTEN] = "lighten", t[i.BLEND_MODES.COLOR_DODGE] = "color-dodge", t[i.BLEND_MODES.COLOR_BURN] = "color-burn", t[i.BLEND_MODES.HARD_LIGHT] = "hard-light", t[i.BLEND_MODES.SOFT_LIGHT] = "soft-light", t[i.BLEND_MODES.DIFFERENCE] = "difference", t[i.BLEND_MODES.EXCLUSION] = "exclusion", t[i.BLEND_MODES.HUE] = "hue", t[i.BLEND_MODES.SATURATION] = "saturate", t[i.BLEND_MODES.COLOR] = "color", t[i.BLEND_MODES.LUMINOSITY] = "luminosity") : (t[i.BLEND_MODES.NORMAL] = "source-over", t[i.BLEND_MODES.ADD] = "lighter", t[i.BLEND_MODES.MULTIPLY] = "source-over", t[i.BLEND_MODES.SCREEN] = "source-over", t[i.BLEND_MODES.OVERLAY] = "source-over", t[i.BLEND_MODES.DARKEN] = "source-over", t[i.BLEND_MODES.LIGHTEN] = "source-over", t[i.BLEND_MODES.COLOR_DODGE] = "source-over", t[i.BLEND_MODES.COLOR_BURN] = "source-over", t[i.BLEND_MODES.HARD_LIGHT] = "source-over", t[i.BLEND_MODES.SOFT_LIGHT] = "source-over", t[i.BLEND_MODES.DIFFERENCE] = "source-over", t[i.BLEND_MODES.EXCLUSION] = "source-over", t[i.BLEND_MODES.HUE] = "source-over", t[i.BLEND_MODES.SATURATION] = "source-over", t[i.BLEND_MODES.COLOR] = "source-over", t[i.BLEND_MODES.LUMINOSITY] = "source-over"), t[i.BLEND_MODES.NORMAL_NPM] = t[i.BLEND_MODES.NORMAL], t[i.BLEND_MODES.ADD_NPM] = t[i.BLEND_MODES.ADD], t[i.BLEND_MODES.SCREEN_NPM] = t[i.BLEND_MODES.SCREEN], t;
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("../../../const"),
        o = t("./canUseNewCanvasBlendModes"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o);
    }, {
      "../../../const": 46,
      "./canUseNewCanvasBlendModes": 80
    }],
    82: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../const"),
        o = t("../../settings"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = function () {
          function t(e) {
            n(this, t), this.renderer = e, this.count = 0, this.checkCount = 0, this.maxIdle = s["default"].GC_MAX_IDLE, this.checkCountMax = s["default"].GC_MAX_CHECK_COUNT, this.mode = s["default"].GC_MODE;
          }
          return t.prototype.update = function () {
            this.count++, this.mode !== i.GC_MODES.MANUAL && ++this.checkCount > this.checkCountMax && (this.checkCount = 0, this.run());
          }, t.prototype.run = function () {
            for (var t = this.renderer.textureManager, e = t._managedTextures, r = !1, n = 0; n < e.length; n++) {
              var i = e[n];
              !i._glRenderTargets && this.count - i.touched > this.maxIdle && (t.destroyTexture(i, !0), e[n] = null, r = !0);
            }
            if (r) {
              for (var o = 0, s = 0; s < e.length; s++) null !== e[s] && (e[o++] = e[s]);
              e.length = o;
            }
          }, t.prototype.unload = function (t) {
            var e = this.renderer.textureManager;
            t._texture && t._texture._glRenderTargets && e.destroyTexture(t._texture, !0);
            for (var r = t.children.length - 1; r >= 0; r--) this.unload(t.children[r]);
          }, t;
        }();
      r["default"] = a;
    }, {
      "../../const": 46,
      "../../settings": 101
    }],
    83: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("pixi-gl-core"),
        o = t("../../const"),
        s = t("./utils/RenderTarget"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = t("../../utils"),
        h = function () {
          function t(e) {
            n(this, t), this.renderer = e, this.gl = e.gl, this._managedTextures = [];
          }
          return t.prototype.bindTexture = function () {}, t.prototype.getTexture = function () {}, t.prototype.updateTexture = function (t, e) {
            var r = this.gl,
              n = !!t._glRenderTargets;
            if (!t.hasLoaded) return null;
            var s = this.renderer.boundTextures;
            if (void 0 === e) {
              e = 0;
              for (var u = 0; u < s.length; ++u)
                if (s[u] === t) {
                  e = u;
                  break;
                }
            }
            s[e] = t, r.activeTexture(r.TEXTURE0 + e);
            var h = t._glTextures[this.renderer.CONTEXT_UID];
            if (h) n ? t._glRenderTargets[this.renderer.CONTEXT_UID].resize(t.width, t.height) : h.upload(t.source);
            else {
              if (n) {
                var l = new a["default"](this.gl, t.width, t.height, t.scaleMode, t.resolution);
                l.resize(t.width, t.height), t._glRenderTargets[this.renderer.CONTEXT_UID] = l, h = l.texture, this.renderer._activeRenderTarget.root || this.renderer._activeRenderTarget.frameBuffer.bind();
              } else h = new i.GLTexture(this.gl, null, null, null, null), h.bind(e), h.premultiplyAlpha = !0, h.upload(t.source);
              t._glTextures[this.renderer.CONTEXT_UID] = h, t.on("update", this.updateTexture, this), t.on("dispose", this.destroyTexture, this), this._managedTextures.push(t), t.isPowerOfTwo ? (t.mipmap && h.enableMipmap(), t.wrapMode === o.WRAP_MODES.CLAMP ? h.enableWrapClamp() : t.wrapMode === o.WRAP_MODES.REPEAT ? h.enableWrapRepeat() : h.enableWrapMirrorRepeat()) : h.enableWrapClamp(), t.scaleMode === o.SCALE_MODES.NEAREST ? h.enableNearestScaling() : h.enableLinearScaling();
            }
            return h;
          }, t.prototype.destroyTexture = function (t, e) {
            if (t = t.baseTexture || t, t.hasLoaded) {
              var r = this.renderer,
                n = r.CONTEXT_UID,
                i = t._glTextures,
                o = t._glRenderTargets;
              if (i[n] && (r.unbindTexture(t), i[n].destroy(), t.off("update", this.updateTexture, this), t.off("dispose", this.destroyTexture, this), delete i[n], !e)) {
                var s = this._managedTextures.indexOf(t); -
                1 !== s && (0, u.removeItems)(this._managedTextures, s, 1);
              }
              o && o[n] && (r._activeRenderTarget === o[n] && r.bindRenderTarget(r.rootRenderTarget), o[n].destroy(), delete o[n]);
            }
          }, t.prototype.removeAll = function () {
            for (var t = 0; t < this._managedTextures.length; ++t) {
              var e = this._managedTextures[t];
              e._glTextures[this.renderer.CONTEXT_UID] && delete e._glTextures[this.renderer.CONTEXT_UID];
            }
          }, t.prototype.destroy = function () {
            for (var t = 0; t < this._managedTextures.length; ++t) {
              var e = this._managedTextures[t];
              this.destroyTexture(e, !0), e.off("update", this.updateTexture, this), e.off("dispose", this.destroyTexture, this);
            }
            this._managedTextures = null;
          }, t;
        }();
      r["default"] = h;
    }, {
      "../../const": 46,
      "../../utils": 125,
      "./utils/RenderTarget": 96,
      "pixi-gl-core": 15
    }],
    84: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../SystemRenderer"),
        u = n(a),
        h = t("./managers/MaskManager"),
        l = n(h),
        c = t("./managers/StencilManager"),
        d = n(c),
        f = t("./managers/FilterManager"),
        p = n(f),
        v = t("./utils/RenderTarget"),
        g = n(v),
        y = t("./utils/ObjectRenderer"),
        m = n(y),
        _ = t("./TextureManager"),
        b = n(_),
        x = t("../../textures/BaseTexture"),
        T = n(x),
        w = t("./TextureGarbageCollector"),
        E = n(w),
        S = t("./WebGLState"),
        O = n(S),
        M = t("./utils/mapWebGLDrawModesToPixi"),
        P = n(M),
        C = t("./utils/validateContext"),
        R = n(C),
        A = t("../../utils"),
        I = t("pixi-gl-core"),
        D = n(I),
        L = t("../../const"),
        N = 0,
        B = function (t) {
          function e(r, n, s) {
            i(this, e);
            var a = o(this, t.call(this, "WebGL", r, n, s));
            return a.legacy = a.options.legacy, a.legacy && (D["default"].VertexArrayObject.FORCE_NATIVE = !0), a.type = L.RENDERER_TYPE.WEBGL, a.handleContextLost = a.handleContextLost.bind(a), a.handleContextRestored = a.handleContextRestored.bind(a), a.view.addEventListener("webglcontextlost", a.handleContextLost, !1), a.view.addEventListener("webglcontextrestored", a.handleContextRestored, !1), a._contextOptions = {
              alpha: a.transparent,
              antialias: a.options.antialias,
              premultipliedAlpha: a.transparent && "notMultiplied" !== a.transparent,
              stencil: !0,
              preserveDrawingBuffer: a.options.preserveDrawingBuffer,
              powerPreference: a.options.powerPreference
            }, a._backgroundColorRgba[3] = a.transparent ? 0 : 1, a.maskManager = new l["default"](a), a.stencilManager = new d["default"](a), a.emptyRenderer = new m["default"](a), a.currentRenderer = a.emptyRenderer, a.textureManager = null, a.filterManager = null, a.initPlugins(), a.options.context && (0, R["default"])(a.options.context), a.gl = a.options.context || D["default"].createContext(a.view, a._contextOptions), a.CONTEXT_UID = N++, a.state = new O["default"](a.gl), a.renderingToScreen = !0, a.boundTextures = null, a._activeShader = null, a._activeVao = null, a._activeRenderTarget = null, a._initContext(), a.drawModes = (0, P["default"])(a.gl), a._nextTextureLocation = 0, a.setBlendMode(0), a;
          }
          return s(e, t), e.prototype._initContext = function () {
            var t = this.gl;
            t.isContextLost() && t.getExtension("WEBGL_lose_context") && t.getExtension("WEBGL_lose_context").restoreContext();
            var e = t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);
            this._activeShader = null, this._activeVao = null, this.boundTextures = new Array(e), this.emptyTextures = new Array(e), this._unknownBoundTextures = !1, this.textureManager = new b["default"](this), this.filterManager = new p["default"](this), this.textureGC = new E["default"](this), this.state.resetToDefault(), this.rootRenderTarget = new g["default"](t, this.width, this.height, null, this.resolution, !0), this.rootRenderTarget.clearColor = this._backgroundColorRgba, this.bindRenderTarget(this.rootRenderTarget);
            var r = new D["default"].GLTexture.fromData(t, null, 1, 1),
              n = {
                _glTextures: {}
              };
            n._glTextures[this.CONTEXT_UID] = {};
            for (var i = 0; i < e; i++) {
              var o = new T["default"]();
              o._glTextures[this.CONTEXT_UID] = r, this.boundTextures[i] = n, this.emptyTextures[i] = o, this.bindTexture(null, i);
            }
            this.emit("context", t), this.resize(this.screen.width, this.screen.height);
          }, e.prototype.render = function (t, e, r, n, i) {
            if (this.renderingToScreen = !e, this.emit("prerender"), this.gl && !this.gl.isContextLost()) {
              if (this._nextTextureLocation = 0, e || (this._lastObjectRendered = t), !i) {
                var o = t.parent;
                t.parent = this._tempDisplayObjectParent, t.updateTransform(), t.parent = o;
              }
              this.bindRenderTexture(e, n), this.currentRenderer.start(), (void 0 !== r ? r : this.clearBeforeRender) && this._activeRenderTarget.clear(), t.renderWebGL(this), this.currentRenderer.flush(), this.textureGC.update(), this.emit("postrender");
            }
          }, e.prototype.setObjectRenderer = function (t) {
            this.currentRenderer !== t && (this.currentRenderer.stop(), this.currentRenderer = t, this.currentRenderer.start());
          }, e.prototype.flush = function () {
            this.setObjectRenderer(this.emptyRenderer);
          }, e.prototype.resize = function (t, e) {
            u["default"].prototype.resize.call(this, t, e), this.rootRenderTarget.resize(t, e), this._activeRenderTarget === this.rootRenderTarget && (this.rootRenderTarget.activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = this.rootRenderTarget.projectionMatrix.toArray(!0)));
          }, e.prototype.setBlendMode = function (t) {
            this.state.setBlendMode(t);
          }, e.prototype.clear = function (t) {
            this._activeRenderTarget.clear(t);
          }, e.prototype.setTransform = function (t) {
            this._activeRenderTarget.transform = t;
          }, e.prototype.clearRenderTexture = function (t, e) {
            var r = t.baseTexture,
              n = r._glRenderTargets[this.CONTEXT_UID];
            return n && n.clear(e), this;
          }, e.prototype.bindRenderTexture = function (t, e) {
            var r = void 0;
            if (t) {
              var n = t.baseTexture;
              n._glRenderTargets[this.CONTEXT_UID] || this.textureManager.updateTexture(n, 0), this.unbindTexture(n), r = n._glRenderTargets[this.CONTEXT_UID], r.setFrame(t.frame);
            } else r = this.rootRenderTarget;
            return r.transform = e, this.bindRenderTarget(r), this;
          }, e.prototype.bindRenderTarget = function (t) {
            return t !== this._activeRenderTarget && (this._activeRenderTarget = t, t.activate(), this._activeShader && (this._activeShader.uniforms.projectionMatrix = t.projectionMatrix.toArray(!0)), this.stencilManager.setMaskStack(t.stencilMaskStack)), this;
          }, e.prototype.bindShader = function (t, e) {
            return this._activeShader !== t && (this._activeShader = t, t.bind(), !1 !== e && (t.uniforms.projectionMatrix = this._activeRenderTarget.projectionMatrix.toArray(!0))), this;
          }, e.prototype.bindTexture = function (t, e, r) {
            if (t = t || this.emptyTextures[e], t = t.baseTexture || t, t.touched = this.textureGC.count, r) e = e || 0;
            else {
              for (var n = 0; n < this.boundTextures.length; n++)
                if (this.boundTextures[n] === t) return n;
              void 0 === e && (this._nextTextureLocation++, this._nextTextureLocation %= this.boundTextures.length, e = this.boundTextures.length - this._nextTextureLocation - 1);
            }
            var i = this.gl,
              o = t._glTextures[this.CONTEXT_UID];
            return o ? (this.boundTextures[e] = t, i.activeTexture(i.TEXTURE0 + e), i.bindTexture(i.TEXTURE_2D, o.texture)) : this.textureManager.updateTexture(t, e), e;
          }, e.prototype.unbindTexture = function (t) {
            var e = this.gl;
            if (t = t.baseTexture || t, this._unknownBoundTextures) {
              this._unknownBoundTextures = !1;
              for (var r = 0; r < this.boundTextures.length; r++) this.boundTextures[r] === this.emptyTextures[r] && (e.activeTexture(e.TEXTURE0 + r), e.bindTexture(e.TEXTURE_2D, this.emptyTextures[r]._glTextures[this.CONTEXT_UID].texture));
            }
            for (var n = 0; n < this.boundTextures.length; n++) this.boundTextures[n] === t && (this.boundTextures[n] = this.emptyTextures[n], e.activeTexture(e.TEXTURE0 + n), e.bindTexture(e.TEXTURE_2D, this.emptyTextures[n]._glTextures[this.CONTEXT_UID].texture));
            return this;
          }, e.prototype.createVao = function () {
            return new D["default"].VertexArrayObject(this.gl, this.state.attribState);
          }, e.prototype.bindVao = function (t) {
            return this._activeVao === t ? this : (t ? t.bind() : this._activeVao && this._activeVao.unbind(), this._activeVao = t, this);
          }, e.prototype.reset = function () {
            this.setObjectRenderer(this.emptyRenderer), this.bindVao(null), this._activeShader = null, this._activeRenderTarget = this.rootRenderTarget, this._unknownBoundTextures = !0;
            for (var t = 0; t < this.boundTextures.length; t++) this.boundTextures[t] = this.emptyTextures[t];
            return this.rootRenderTarget.activate(), this.state.resetToDefault(), this;
          }, e.prototype.handleContextLost = function (t) {
            t.preventDefault();
          }, e.prototype.handleContextRestored = function () {
            this.textureManager.removeAll(), this.filterManager.destroy(!0), this._initContext();
          }, e.prototype.destroy = function (e) {
            this.destroyPlugins(), this.view.removeEventListener("webglcontextlost", this.handleContextLost), this.view.removeEventListener("webglcontextrestored", this.handleContextRestored), this.textureManager.destroy(), t.prototype.destroy.call(this, e), this.uid = 0, this.maskManager.destroy(), this.stencilManager.destroy(), this.filterManager.destroy(), this.maskManager = null, this.filterManager = null, this.textureManager = null, this.currentRenderer = null, this.handleContextLost = null, this.handleContextRestored = null, this._contextOptions = null, this.gl.useProgram(null), this.gl.getExtension("WEBGL_lose_context") && this.gl.getExtension("WEBGL_lose_context").loseContext(), this.gl = null;
          }, e;
        }(u["default"]);
      r["default"] = B, A.pluginTarget.mixin(B);
    }, {
      "../../const": 46,
      "../../textures/BaseTexture": 112,
      "../../utils": 125,
      "../SystemRenderer": 76,
      "./TextureGarbageCollector": 82,
      "./TextureManager": 83,
      "./WebGLState": 85,
      "./managers/FilterManager": 90,
      "./managers/MaskManager": 91,
      "./managers/StencilManager": 92,
      "./utils/ObjectRenderer": 94,
      "./utils/RenderTarget": 96,
      "./utils/mapWebGLDrawModesToPixi": 99,
      "./utils/validateContext": 100,
      "pixi-gl-core": 15
    }],
    85: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("./utils/mapWebGLBlendModesToPixi"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = function () {
          function t(e) {
            n(this, t), this.activeState = new Uint8Array(16), this.defaultState = new Uint8Array(16), this.defaultState[0] = 1, this.stackIndex = 0, this.stack = [], this.gl = e, this.maxAttribs = e.getParameter(e.MAX_VERTEX_ATTRIBS), this.attribState = {
              tempAttribState: new Array(this.maxAttribs),
              attribState: new Array(this.maxAttribs)
            }, this.blendModes = (0, o["default"])(e), this.nativeVaoExtension = e.getExtension("OES_vertex_array_object") || e.getExtension("MOZ_OES_vertex_array_object") || e.getExtension("WEBKIT_OES_vertex_array_object");
          }
          return t.prototype.push = function () {
            var t = this.stack[this.stackIndex];
            t || (t = this.stack[this.stackIndex] = new Uint8Array(16)), ++this.stackIndex;
            for (var e = 0; e < this.activeState.length; e++) t[e] = this.activeState[e];
          }, t.prototype.pop = function () {
            var t = this.stack[--this.stackIndex];
            this.setState(t);
          }, t.prototype.setState = function (t) {
            this.setBlend(t[0]), this.setDepthTest(t[1]), this.setFrontFace(t[2]), this.setCullFace(t[3]), this.setBlendMode(t[4]);
          }, t.prototype.setBlend = function (t) {
            t = t ? 1 : 0, this.activeState[0] !== t && (this.activeState[0] = t, this.gl[t ? "enable" : "disable"](this.gl.BLEND));
          }, t.prototype.setBlendMode = function (t) {
            if (t !== this.activeState[4]) {
              this.activeState[4] = t;
              var e = this.blendModes[t];
              2 === e.length ? this.gl.blendFunc(e[0], e[1]) : this.gl.blendFuncSeparate(e[0], e[1], e[2], e[3]);
            }
          }, t.prototype.setDepthTest = function (t) {
            t = t ? 1 : 0, this.activeState[1] !== t && (this.activeState[1] = t, this.gl[t ? "enable" : "disable"](this.gl.DEPTH_TEST));
          }, t.prototype.setCullFace = function (t) {
            t = t ? 1 : 0, this.activeState[3] !== t && (this.activeState[3] = t, this.gl[t ? "enable" : "disable"](this.gl.CULL_FACE));
          }, t.prototype.setFrontFace = function (t) {
            t = t ? 1 : 0, this.activeState[2] !== t && (this.activeState[2] = t, this.gl.frontFace(this.gl[t ? "CW" : "CCW"]));
          }, t.prototype.resetAttributes = function () {
            for (var t = 0; t < this.attribState.tempAttribState.length; t++) this.attribState.tempAttribState[t] = 0;
            for (var e = 0; e < this.attribState.attribState.length; e++) this.attribState.attribState[e] = 0;
            for (var r = 1; r < this.maxAttribs; r++) this.gl.disableVertexAttribArray(r);
          }, t.prototype.resetToDefault = function () {
            this.nativeVaoExtension && this.nativeVaoExtension.bindVertexArrayOES(null), this.resetAttributes();
            for (var t = 0; t < this.activeState.length; ++t) this.activeState[t] = 32;
            this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL, !1), this.setState(this.defaultState);
          }, t;
        }();
      r["default"] = s;
    }, {
      "./utils/mapWebGLBlendModesToPixi": 98
    }],
    86: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        s = t("./extractUniformsFromSrc"),
        a = n(s),
        u = t("../../../utils"),
        h = t("../../../const"),
        l = t("../../../settings"),
        c = n(l),
        d = {},
        f = function () {
          function t(e, r, n) {
            i(this, t), this.vertexSrc = e || t.defaultVertexSrc, this.fragmentSrc = r || t.defaultFragmentSrc, this._blendMode = h.BLEND_MODES.NORMAL, this.uniformData = n || (0, a["default"])(this.vertexSrc, this.fragmentSrc, "projectionMatrix|uSampler"), this.uniforms = {};
            for (var o in this.uniformData) this.uniforms[o] = this.uniformData[o].value, this.uniformData[o].type && (this.uniformData[o].type = this.uniformData[o].type.toLowerCase());
            this.glShaders = {}, d[this.vertexSrc + this.fragmentSrc] || (d[this.vertexSrc + this.fragmentSrc] = (0, u.uid)()), this.glShaderKey = d[this.vertexSrc + this.fragmentSrc], this.padding = 4, this.resolution = c["default"].FILTER_RESOLUTION, this.enabled = !0, this.autoFit = !0;
          }
          return t.prototype.apply = function (t, e, r, n, i) {
            t.applyFilter(this, e, r, n);
          }, o(t, [{
            key: "blendMode",
            get: function get() {
              return this._blendMode;
            },
            set: function set(t) {
              this._blendMode = t;
            }
          }], [{
            key: "defaultVertexSrc",
            get: function get() {
              return ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform mat3 projectionMatrix;", "uniform mat3 filterMatrix;", "varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "void main(void){", "   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);", "   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;", "   vTextureCoord = aTextureCoord ;", "}"].join("\n");
            }
          }, {
            key: "defaultFragmentSrc",
            get: function get() {
              return ["varying vec2 vTextureCoord;", "varying vec2 vFilterCoord;", "uniform sampler2D uSampler;", "uniform sampler2D filterSampler;", "void main(void){", "   vec4 masky = texture2D(filterSampler, vFilterCoord);", "   vec4 sample = texture2D(uSampler, vTextureCoord);", "   vec4 color;", "   if(mod(vFilterCoord.x, 1.0) > 0.5)", "   {", "     color = vec4(1.0, 0.0, 0.0, 1.0);", "   }", "   else", "   {", "     color = vec4(0.0, 1.0, 0.0, 1.0);", "   }", "   gl_FragColor = mix(sample, masky, 0.5);", "   gl_FragColor *= sample.a;", "}"].join("\n");
            }
          }]), t;
        }();
      r["default"] = f;
    }, {
      "../../../const": 46,
      "../../../settings": 101,
      "../../../utils": 125,
      "./extractUniformsFromSrc": 87
    }],
    87: [function (t, e, r) {
      "use strict";

      function n(t, e, r) {
        var n = i(t),
          o = i(e);
        return Object.assign(n, o);
      }

      function i(t) {
        for (var e = new RegExp("^(projectionMatrix|uSampler|filterArea|filterClamp)$"), r = {}, n = void 0, i = t.replace(/\s+/g, " ").split(/\s*;\s*/), o = 0; o < i.length; o++) {
          var s = i[o].trim();
          if (s.indexOf("uniform") > -1) {
            var u = s.split(" "),
              h = u[1],
              l = u[2],
              c = 1;
            l.indexOf("[") > -1 && (n = l.split(/\[|]/), l = n[0], c *= Number(n[1])), l.match(e) || (r[l] = {
              value: a(h, c),
              name: l,
              type: h
            });
          }
        }
        return r;
      }
      r.__esModule = !0, r["default"] = n;
      var o = t("pixi-gl-core"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = s["default"].shader.defaultValue;
    }, {
      "pixi-gl-core": 15
    }],
    88: [function (t, e, r) {
      "use strict";

      function n(t, e, r) {
        var n = t.identity();
        return n.translate(e.x / r.width, e.y / r.height), n.scale(r.width, r.height), n;
      }

      function i(t, e, r) {
        var n = t.identity();
        n.translate(e.x / r.width, e.y / r.height);
        var i = r.width / e.width,
          o = r.height / e.height;
        return n.scale(i, o), n;
      }

      function o(t, e, r, n) {
        var i = n._texture.orig,
          o = t.set(r.width, 0, 0, r.height, e.x, e.y),
          a = n.worldTransform.copy(s.Matrix.TEMP_MATRIX);
        return a.invert(), o.prepend(a), o.scale(1 / i.width, 1 / i.height), o.translate(n.anchor.x, n.anchor.y), o;
      }
      r.__esModule = !0, r.calculateScreenSpaceMatrix = n, r.calculateNormalizedScreenSpaceMatrix = i, r.calculateSpriteMatrix = o;
      var s = t("../../../math");
    }, {
      "../../../math": 70
    }],
    89: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../Filter"),
        u = n(a),
        h = t("../../../../math"),
        l = (t("path"), t("../../../../textures/TextureMatrix")),
        c = n(l),
        d = function (t) {
          function e(r) {
            i(this, e);
            var n = new h.Matrix(),
              s = o(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n", "varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n\n    original *= (masky.r * masky.a * alpha * clip);\n\n    gl_FragColor = original;\n}\n"));
            return r.renderable = !1, s.maskSprite = r, s.maskMatrix = n, s;
          }
          return s(e, t), e.prototype.apply = function (t, e, r, n) {
            var i = this.maskSprite,
              o = this.maskSprite.texture;
            o.valid && (o.transform || (o.transform = new c["default"](o, 0)), o.transform.update(), this.uniforms.mask = o, this.uniforms.otherMatrix = t.calculateSpriteMatrix(this.maskMatrix, i).prepend(o.transform.mapCoord), this.uniforms.alpha = i.worldAlpha, this.uniforms.maskClamp = o.transform.uClampFrame, t.applyFilter(this, e, r, n));
          }, e;
        }(u["default"]);
      r["default"] = d;
    }, {
      "../../../../math": 70,
      "../../../../textures/TextureMatrix": 116,
      "../Filter": 86,
      path: 8
    }],
    90: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function s(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var a = t("./WebGLManager"),
        u = n(a),
        h = t("../utils/RenderTarget"),
        l = n(h),
        c = t("../utils/Quad"),
        d = n(c),
        f = t("../../../math"),
        p = t("../../../Shader"),
        v = n(p),
        g = t("../filters/filterTransforms"),
        y = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(g),
        m = t("bit-twiddle"),
        _ = n(m),
        b = function () {
          function t() {
            s(this, t), this.renderTarget = null, this.target = null, this.resolution = 1, this.sourceFrame = new f.Rectangle(), this.destinationFrame = new f.Rectangle(), this.filters = [];
          }
          return t.prototype.clear = function () {
            this.filters = null, this.target = null, this.renderTarget = null;
          }, t;
        }(),
        x = function (t) {
          function e(r) {
            s(this, e);
            var n = i(this, t.call(this, r));
            return n.gl = n.renderer.gl, n.quad = new d["default"](n.gl, r.state.attribState), n.shaderCache = {}, n.pool = {}, n.filterData = null, n.managedFilters = [], n.renderer.on("prerender", n.onPrerender, n), n._screenWidth = r.view.width, n._screenHeight = r.view.height, n;
          }
          return o(e, t), e.prototype.pushFilter = function (t, e) {
            var r = this.renderer,
              n = this.filterData;
            if (!n) {
              n = this.renderer._activeRenderTarget.filterStack;
              var i = new b();
              i.sourceFrame = i.destinationFrame = this.renderer._activeRenderTarget.size, i.renderTarget = r._activeRenderTarget, this.renderer._activeRenderTarget.filterData = n = {
                index: 0,
                stack: [i]
              }, this.filterData = n;
            }
            var o = n.stack[++n.index],
              s = n.stack[0].destinationFrame;
            o || (o = n.stack[n.index] = new b());
            var a = t.filterArea && 0 === t.filterArea.x && 0 === t.filterArea.y && t.filterArea.width === r.screen.width && t.filterArea.height === r.screen.height,
              u = e[0].resolution,
              h = 0 | e[0].padding,
              l = a ? r.screen : t.filterArea || t.getBounds(!0),
              c = o.sourceFrame,
              d = o.destinationFrame;
            c.x = (l.x * u | 0) / u, c.y = (l.y * u | 0) / u, c.width = (l.width * u | 0) / u, c.height = (l.height * u | 0) / u, a || (n.stack[0].renderTarget.transform || e[0].autoFit && c.fit(s), c.pad(h)), d.width = c.width, d.height = c.height;
            var f = this.getPotRenderTarget(r.gl, c.width, c.height, u);
            o.target = t, o.filters = e, o.resolution = u, o.renderTarget = f, f.setFrame(d, c), r.bindRenderTarget(f), f.clear();
          }, e.prototype.popFilter = function () {
            var t = this.filterData,
              e = t.stack[t.index - 1],
              r = t.stack[t.index];
            this.quad.map(r.renderTarget.size, r.sourceFrame).upload();
            var n = r.filters;
            if (1 === n.length) n[0].apply(this, r.renderTarget, e.renderTarget, !1, r), this.freePotRenderTarget(r.renderTarget);
            else {
              var i = r.renderTarget,
                o = this.getPotRenderTarget(this.renderer.gl, r.sourceFrame.width, r.sourceFrame.height, r.resolution);
              o.setFrame(r.destinationFrame, r.sourceFrame), o.clear();
              var s = 0;
              for (s = 0; s < n.length - 1; ++s) {
                n[s].apply(this, i, o, !0, r);
                var a = i;
                i = o, o = a;
              }
              n[s].apply(this, i, e.renderTarget, !1, r), this.freePotRenderTarget(i), this.freePotRenderTarget(o);
            }
            r.clear(), 0 === --t.index && (this.filterData = null);
          }, e.prototype.applyFilter = function (t, e, r, n) {
            var i = this.renderer,
              o = i.gl,
              s = t.glShaders[i.CONTEXT_UID];
            s || (t.glShaderKey ? (s = this.shaderCache[t.glShaderKey]) || (s = new v["default"](this.gl, t.vertexSrc, t.fragmentSrc), t.glShaders[i.CONTEXT_UID] = this.shaderCache[t.glShaderKey] = s, this.managedFilters.push(t)) : (s = t.glShaders[i.CONTEXT_UID] = new v["default"](this.gl, t.vertexSrc, t.fragmentSrc), this.managedFilters.push(t)), i.bindVao(null), this.quad.initVao(s)), i.bindVao(this.quad.vao), i.bindRenderTarget(r), n && (o.disable(o.SCISSOR_TEST), i.clear(), o.enable(o.SCISSOR_TEST)), r === i.maskManager.scissorRenderTarget && i.maskManager.pushScissorMask(null, i.maskManager.scissorData), i.bindShader(s);
            var a = this.renderer.emptyTextures[0];
            this.renderer.boundTextures[0] = a, this.syncUniforms(s, t), i.state.setBlendMode(t.blendMode), o.activeTexture(o.TEXTURE0), o.bindTexture(o.TEXTURE_2D, e.texture.texture), this.quad.vao.draw(this.renderer.gl.TRIANGLES, 6, 0), o.bindTexture(o.TEXTURE_2D, a._glTextures[this.renderer.CONTEXT_UID].texture);
          }, e.prototype.syncUniforms = function (t, e) {
            var r = e.uniformData,
              n = e.uniforms,
              i = 1,
              o = void 0;
            if (t.uniforms.filterArea) {
              o = this.filterData.stack[this.filterData.index];
              var s = t.uniforms.filterArea;
              s[0] = o.renderTarget.size.width, s[1] = o.renderTarget.size.height, s[2] = o.sourceFrame.x, s[3] = o.sourceFrame.y, t.uniforms.filterArea = s;
            }
            if (t.uniforms.filterClamp) {
              o = o || this.filterData.stack[this.filterData.index];
              var a = t.uniforms.filterClamp;
              a[0] = 0, a[1] = 0, a[2] = (o.sourceFrame.width - 1) / o.renderTarget.size.width, a[3] = (o.sourceFrame.height - 1) / o.renderTarget.size.height, t.uniforms.filterClamp = a;
            }
            for (var u in r)
              if (t.uniforms.data[u]) {
                var h = r[u].type;
                if ("sampler2d" === h && 0 !== n[u]) {
                  if (n[u].baseTexture) t.uniforms[u] = this.renderer.bindTexture(n[u].baseTexture, i);
                  else {
                    t.uniforms[u] = i;
                    var l = this.renderer.gl;
                    this.renderer.boundTextures[i] = this.renderer.emptyTextures[i], l.activeTexture(l.TEXTURE0 + i), n[u].texture.bind();
                  }
                  i++;
                } else if ("mat3" === h) void 0 !== n[u].a ? t.uniforms[u] = n[u].toArray(!0) : t.uniforms[u] = n[u];
                else if ("vec2" === h) {
                  if (void 0 !== n[u].x) {
                    var c = t.uniforms[u] || new Float32Array(2);
                    c[0] = n[u].x, c[1] = n[u].y, t.uniforms[u] = c;
                  } else t.uniforms[u] = n[u];
                } else "float" === h ? t.uniforms.data[u].value !== r[u] && (t.uniforms[u] = n[u]) : t.uniforms[u] = n[u];
              }
          }, e.prototype.getRenderTarget = function (t, e) {
            var r = this.filterData.stack[this.filterData.index],
              n = this.getPotRenderTarget(this.renderer.gl, r.sourceFrame.width, r.sourceFrame.height, e || r.resolution);
            return n.setFrame(r.destinationFrame, r.sourceFrame), n;
          }, e.prototype.returnRenderTarget = function (t) {
            this.freePotRenderTarget(t);
          }, e.prototype.calculateScreenSpaceMatrix = function (t) {
            var e = this.filterData.stack[this.filterData.index];
            return y.calculateScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size);
          }, e.prototype.calculateNormalizedScreenSpaceMatrix = function (t) {
            var e = this.filterData.stack[this.filterData.index];
            return y.calculateNormalizedScreenSpaceMatrix(t, e.sourceFrame, e.renderTarget.size, e.destinationFrame);
          }, e.prototype.calculateSpriteMatrix = function (t, e) {
            var r = this.filterData.stack[this.filterData.index];
            return y.calculateSpriteMatrix(t, r.sourceFrame, r.renderTarget.size, e);
          }, e.prototype.destroy = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0],
              e = this.renderer,
              r = this.managedFilters;
            e.off("prerender", this.onPrerender, this);
            for (var n = 0; n < r.length; n++) t || r[n].glShaders[e.CONTEXT_UID].destroy(), delete r[n].glShaders[e.CONTEXT_UID];
            this.shaderCache = {}, t ? this.pool = {} : this.emptyPool();
          }, e.prototype.getPotRenderTarget = function (t, e, r, n) {
            var i = "screen";
            e *= n, r *= n, e === this._screenWidth && r === this._screenHeight || (e = _["default"].nextPow2(e), r = _["default"].nextPow2(r), i = (65535 & e) << 16 | 65535 & r), this.pool[i] || (this.pool[i] = []);
            var o = this.pool[i].pop();
            if (!o) {
              var s = this.renderer.boundTextures[0];
              t.activeTexture(t.TEXTURE0), o = new l["default"](t, e, r, null, 1), t.bindTexture(t.TEXTURE_2D, s._glTextures[this.renderer.CONTEXT_UID].texture);
            }
            return o.resolution = n, o.defaultFrame.width = o.size.width = e / n, o.defaultFrame.height = o.size.height = r / n, o.filterPoolKey = i, o;
          }, e.prototype.emptyPool = function () {
            for (var t in this.pool) {
              var e = this.pool[t];
              if (e)
                for (var r = 0; r < e.length; r++) e[r].destroy(!0);
            }
            this.pool = {};
          }, e.prototype.freePotRenderTarget = function (t) {
            this.pool[t.filterPoolKey].push(t);
          }, e.prototype.onPrerender = function () {
            if (this._screenWidth !== this.renderer.view.width || this._screenHeight !== this.renderer.view.height) {
              this._screenWidth = this.renderer.view.width, this._screenHeight = this.renderer.view.height;
              var t = this.pool.screen;
              if (t)
                for (var e = 0; e < t.length; e++) t[e].destroy(!0);
              this.pool.screen = [];
            }
          }, e;
        }(u["default"]);
      r["default"] = x;
    }, {
      "../../../Shader": 44,
      "../../../math": 70,
      "../filters/filterTransforms": 88,
      "../utils/Quad": 95,
      "../utils/RenderTarget": 96,
      "./WebGLManager": 93,
      "bit-twiddle": 1
    }],
    91: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("./WebGLManager"),
        u = n(a),
        h = t("../filters/spriteMask/SpriteMaskFilter"),
        l = n(h),
        c = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this, r));
            return n.scissor = !1, n.scissorData = null, n.scissorRenderTarget = null, n.enableScissor = !0, n.alphaMaskPool = [], n.alphaMaskIndex = 0, n;
          }
          return s(e, t), e.prototype.pushMask = function (t, e) {
            if (e.texture) this.pushSpriteMask(t, e);
            else if (this.enableScissor && !this.scissor && this.renderer._activeRenderTarget.root && !this.renderer.stencilManager.stencilMaskStack.length && e.isFastRect()) {
              var r = e.worldTransform,
                n = Math.atan2(r.b, r.a);
              n = Math.round(n * (180 / Math.PI)), n % 90 ? this.pushStencilMask(e) : this.pushScissorMask(t, e);
            } else this.pushStencilMask(e);
          }, e.prototype.popMask = function (t, e) {
            e.texture ? this.popSpriteMask(t, e) : this.enableScissor && !this.renderer.stencilManager.stencilMaskStack.length ? this.popScissorMask(t, e) : this.popStencilMask(t, e);
          }, e.prototype.pushSpriteMask = function (t, e) {
            var r = this.alphaMaskPool[this.alphaMaskIndex];
            r || (r = this.alphaMaskPool[this.alphaMaskIndex] = [new l["default"](e)]), r[0].resolution = this.renderer.resolution, r[0].maskSprite = e;
            var n = t.filterArea;
            t.filterArea = e.getBounds(!0), this.renderer.filterManager.pushFilter(t, r), t.filterArea = n, this.alphaMaskIndex++;
          }, e.prototype.popSpriteMask = function () {
            this.renderer.filterManager.popFilter(), this.alphaMaskIndex--;
          }, e.prototype.pushStencilMask = function (t) {
            this.renderer.currentRenderer.stop(), this.renderer.stencilManager.pushStencil(t);
          }, e.prototype.popStencilMask = function () {
            this.renderer.currentRenderer.stop(), this.renderer.stencilManager.popStencil();
          }, e.prototype.pushScissorMask = function (t, e) {
            e.renderable = !0;
            var r = this.renderer._activeRenderTarget,
              n = e.getBounds();
            n.fit(r.size), e.renderable = !1, this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST);
            var i = this.renderer.resolution;
            this.renderer.gl.scissor(n.x * i, (r.root ? r.size.height - n.y - n.height : n.y) * i, n.width * i, n.height * i), this.scissorRenderTarget = r, this.scissorData = e, this.scissor = !0;
          }, e.prototype.popScissorMask = function () {
            this.scissorRenderTarget = null, this.scissorData = null, this.scissor = !1;
            var t = this.renderer.gl;
            t.disable(t.SCISSOR_TEST);
          }, e;
        }(u["default"]);
      r["default"] = c;
    }, {
      "../filters/spriteMask/SpriteMaskFilter": 89,
      "./WebGLManager": 93
    }],
    92: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("./WebGLManager"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e(r) {
            n(this, e);
            var o = i(this, t.call(this, r));
            return o.stencilMaskStack = null, o;
          }
          return o(e, t), e.prototype.setMaskStack = function (t) {
            this.stencilMaskStack = t;
            var e = this.renderer.gl;
            0 === t.length ? e.disable(e.STENCIL_TEST) : e.enable(e.STENCIL_TEST);
          }, e.prototype.pushStencil = function (t) {
            this.renderer.setObjectRenderer(this.renderer.plugins.graphics), this.renderer._activeRenderTarget.attachStencilBuffer();
            var e = this.renderer.gl,
              r = this.stencilMaskStack.length;
            0 === r && e.enable(e.STENCIL_TEST), this.stencilMaskStack.push(t), e.colorMask(!1, !1, !1, !1), e.stencilFunc(e.EQUAL, r, this._getBitwiseMask()), e.stencilOp(e.KEEP, e.KEEP, e.INCR), this.renderer.plugins.graphics.render(t), this._useCurrent();
          }, e.prototype.popStencil = function () {
            this.renderer.setObjectRenderer(this.renderer.plugins.graphics);
            var t = this.renderer.gl,
              e = this.stencilMaskStack.pop();
            0 === this.stencilMaskStack.length ? (t.disable(t.STENCIL_TEST), t.clear(t.STENCIL_BUFFER_BIT), t.clearStencil(0)) : (t.colorMask(!1, !1, !1, !1), t.stencilOp(t.KEEP, t.KEEP, t.DECR), this.renderer.plugins.graphics.render(e), this._useCurrent());
          }, e.prototype._useCurrent = function () {
            var t = this.renderer.gl;
            t.colorMask(!0, !0, !0, !0), t.stencilFunc(t.EQUAL, this.stencilMaskStack.length, this._getBitwiseMask()), t.stencilOp(t.KEEP, t.KEEP, t.KEEP);
          }, e.prototype._getBitwiseMask = function () {
            return (1 << this.stencilMaskStack.length) - 1;
          }, e.prototype.destroy = function () {
            a["default"].prototype.destroy.call(this), this.stencilMaskStack.stencilStack = null;
          }, e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "./WebGLManager": 93
    }],
    93: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e) {
          n(this, t), this.renderer = e, this.renderer.on("context", this.onContextChange, this);
        }
        return t.prototype.onContextChange = function () {}, t.prototype.destroy = function () {
          this.renderer.off("context", this.onContextChange, this), this.renderer = null;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    94: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("../managers/WebGLManager"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e() {
            return n(this, e), i(this, t.apply(this, arguments));
          }
          return o(e, t), e.prototype.start = function () {}, e.prototype.stop = function () {
            this.flush();
          }, e.prototype.flush = function () {}, e.prototype.render = function (t) {}, e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "../managers/WebGLManager": 93
    }],
    95: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = t("pixi-gl-core"),
        s = n(o),
        a = t("../../../utils/createIndicesForQuads"),
        u = n(a),
        h = function () {
          function t(e, r) {
            i(this, t), this.gl = e, this.vertices = new Float32Array([-1, -1, 1, -1, 1, 1, -1, 1]), this.uvs = new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), this.interleaved = new Float32Array(16);
            for (var n = 0; n < 4; n++) this.interleaved[4 * n] = this.vertices[2 * n], this.interleaved[4 * n + 1] = this.vertices[2 * n + 1], this.interleaved[4 * n + 2] = this.uvs[2 * n], this.interleaved[4 * n + 3] = this.uvs[2 * n + 1];
            this.indices = (0, u["default"])(1), this.vertexBuffer = s["default"].GLBuffer.createVertexBuffer(e, this.interleaved, e.STATIC_DRAW), this.indexBuffer = s["default"].GLBuffer.createIndexBuffer(e, this.indices, e.STATIC_DRAW), this.vao = new s["default"].VertexArrayObject(e, r);
          }
          return t.prototype.initVao = function (t) {
            this.vao.clear().addIndex(this.indexBuffer).addAttribute(this.vertexBuffer, t.attributes.aVertexPosition, this.gl.FLOAT, !1, 16, 0).addAttribute(this.vertexBuffer, t.attributes.aTextureCoord, this.gl.FLOAT, !1, 16, 8);
          }, t.prototype.map = function (t, e) {
            var r = 0,
              n = 0;
            return this.uvs[0] = r, this.uvs[1] = n, this.uvs[2] = r + e.width / t.width, this.uvs[3] = n, this.uvs[4] = r + e.width / t.width, this.uvs[5] = n + e.height / t.height, this.uvs[6] = r, this.uvs[7] = n + e.height / t.height, r = e.x, n = e.y, this.vertices[0] = r, this.vertices[1] = n, this.vertices[2] = r + e.width, this.vertices[3] = n, this.vertices[4] = r + e.width, this.vertices[5] = n + e.height, this.vertices[6] = r, this.vertices[7] = n + e.height, this;
          }, t.prototype.upload = function () {
            for (var t = 0; t < 4; t++) this.interleaved[4 * t] = this.vertices[2 * t], this.interleaved[4 * t + 1] = this.vertices[2 * t + 1], this.interleaved[4 * t + 2] = this.uvs[2 * t], this.interleaved[4 * t + 3] = this.uvs[2 * t + 1];
            return this.vertexBuffer.upload(this.interleaved), this;
          }, t.prototype.destroy = function () {
            var t = this.gl;
            t.deleteBuffer(this.vertexBuffer), t.deleteBuffer(this.indexBuffer);
          }, t;
        }();
      r["default"] = h;
    }, {
      "../../../utils/createIndicesForQuads": 123,
      "pixi-gl-core": 15
    }],
    96: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../../math"),
        o = t("../../../const"),
        s = t("../../../settings"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = t("pixi-gl-core"),
        h = function () {
          function t(e, r, s, h, l, c) {
            n(this, t), this.gl = e, this.frameBuffer = null, this.texture = null, this.clearColor = [0, 0, 0, 0], this.size = new i.Rectangle(0, 0, 1, 1), this.resolution = l || a["default"].RESOLUTION, this.projectionMatrix = new i.Matrix(), this.transform = null, this.frame = null, this.defaultFrame = new i.Rectangle(), this.destinationFrame = null, this.sourceFrame = null, this.stencilBuffer = null, this.stencilMaskStack = [], this.filterData = null, this.filterPoolKey = "", this.scaleMode = void 0 !== h ? h : a["default"].SCALE_MODE, this.root = c || !1, this.root ? (this.frameBuffer = new u.GLFramebuffer(e, 100, 100), this.frameBuffer.framebuffer = null) : (this.frameBuffer = u.GLFramebuffer.createRGBA(e, 100, 100), this.scaleMode === o.SCALE_MODES.NEAREST ? this.frameBuffer.texture.enableNearestScaling() : this.frameBuffer.texture.enableLinearScaling(), this.texture = this.frameBuffer.texture), this.setFrame(), this.resize(r, s);
          }
          return t.prototype.clear = function (t) {
            var e = t || this.clearColor;
            this.frameBuffer.clear(e[0], e[1], e[2], e[3]);
          }, t.prototype.attachStencilBuffer = function () {
            this.root || this.frameBuffer.enableStencil();
          }, t.prototype.setFrame = function (t, e) {
            this.destinationFrame = t || this.destinationFrame || this.defaultFrame, this.sourceFrame = e || this.sourceFrame || this.destinationFrame;
          }, t.prototype.activate = function () {
            var t = this.gl;
            this.frameBuffer.bind(), this.calculateProjection(this.destinationFrame, this.sourceFrame), this.transform && this.projectionMatrix.append(this.transform), this.destinationFrame !== this.sourceFrame ? (t.enable(t.SCISSOR_TEST), t.scissor(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0)) : t.disable(t.SCISSOR_TEST), t.viewport(0 | this.destinationFrame.x, 0 | this.destinationFrame.y, this.destinationFrame.width * this.resolution | 0, this.destinationFrame.height * this.resolution | 0);
          }, t.prototype.calculateProjection = function (t, e) {
            var r = this.projectionMatrix;
            e = e || t, r.identity(), this.root ? (r.a = 1 / t.width * 2, r.d = -1 / t.height * 2, r.tx = -1 - e.x * r.a, r.ty = 1 - e.y * r.d) : (r.a = 1 / t.width * 2, r.d = 1 / t.height * 2, r.tx = -1 - e.x * r.a, r.ty = -1 - e.y * r.d);
          }, t.prototype.resize = function (t, e) {
            if (t |= 0, e |= 0, this.size.width !== t || this.size.height !== e) {
              this.size.width = t, this.size.height = e, this.defaultFrame.width = t, this.defaultFrame.height = e, this.frameBuffer.resize(t * this.resolution, e * this.resolution);
              var r = this.frame || this.size;
              this.calculateProjection(r);
            }
          }, t.prototype.destroy = function () {
            this.frameBuffer.stencil && this.gl.deleteRenderbuffer(this.frameBuffer.stencil), this.frameBuffer.destroy(), this.frameBuffer = null, this.texture = null;
          }, t;
        }();
      r["default"] = h;
    }, {
      "../../../const": 46,
      "../../../math": 70,
      "../../../settings": 101,
      "pixi-gl-core": 15
    }],
    97: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        var r = !e;
        if (r) {
          var n = document.createElement("canvas");
          n.width = 1, n.height = 1, e = s["default"].createContext(n);
        }
        for (var o = e.createShader(e.FRAGMENT_SHADER);;) {
          var u = a.replace(/%forloop%/gi, i(t));
          if (e.shaderSource(o, u), e.compileShader(o), e.getShaderParameter(o, e.COMPILE_STATUS)) break;
          t = t / 2 | 0;
        }
        return r && e.getExtension("WEBGL_lose_context") && e.getExtension("WEBGL_lose_context").loseContext(), t;
      }

      function i(t) {
        for (var e = "", r = 0; r < t; ++r) r > 0 && (e += "\nelse "), r < t - 1 && (e += "if(test == " + r + ".0){}");
        return e;
      }
      r.__esModule = !0, r["default"] = n;
      var o = t("pixi-gl-core"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = ["precision mediump float;", "void main(void){", "float test = 0.1;", "%forloop%", "gl_FragColor = vec4(0.0);", "}"].join("\n");
    }, {
      "pixi-gl-core": 15
    }],
    98: [function (t, e, r) {
      "use strict";

      function n(t) {
        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : [];
        return e[i.BLEND_MODES.NORMAL] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.ADD] = [t.ONE, t.ONE], e[i.BLEND_MODES.MULTIPLY] = [t.DST_COLOR, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SCREEN] = [t.ONE, t.ONE_MINUS_SRC_COLOR, t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.OVERLAY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.DARKEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.LIGHTEN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR_DODGE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR_BURN] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.HARD_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SOFT_LIGHT] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.DIFFERENCE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.EXCLUSION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.HUE] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.SATURATION] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.COLOR] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.LUMINOSITY] = [t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.NORMAL_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_ALPHA, t.ONE, t.ONE_MINUS_SRC_ALPHA], e[i.BLEND_MODES.ADD_NPM] = [t.SRC_ALPHA, t.ONE, t.ONE, t.ONE], e[i.BLEND_MODES.SCREEN_NPM] = [t.SRC_ALPHA, t.ONE_MINUS_SRC_COLOR, t.ONE, t.ONE_MINUS_SRC_ALPHA], e;
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("../../../const");
    }, {
      "../../../const": 46
    }],
    99: [function (t, e, r) {
      "use strict";

      function n(t) {
        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
        return e[i.DRAW_MODES.POINTS] = t.POINTS, e[i.DRAW_MODES.LINES] = t.LINES, e[i.DRAW_MODES.LINE_LOOP] = t.LINE_LOOP, e[i.DRAW_MODES.LINE_STRIP] = t.LINE_STRIP, e[i.DRAW_MODES.TRIANGLES] = t.TRIANGLES, e[i.DRAW_MODES.TRIANGLE_STRIP] = t.TRIANGLE_STRIP, e[i.DRAW_MODES.TRIANGLE_FAN] = t.TRIANGLE_FAN, e;
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("../../../const");
    }, {
      "../../../const": 46
    }],
    100: [function (t, e, r) {
      "use strict";

      function n(t) {
        t.getContextAttributes().stencil || console.warn("Provided WebGL context does not have a stencil buffer, masks may not render correctly");
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    101: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./utils/maxRecommendedTextures"),
        o = n(i),
        s = t("./utils/canUploadSameBuffer"),
        a = n(s);
      r["default"] = {
        TARGET_FPMS: .06,
        MIPMAP_TEXTURES: !0,
        RESOLUTION: 1,
        FILTER_RESOLUTION: 1,
        SPRITE_MAX_TEXTURES: (0, o["default"])(32),
        SPRITE_BATCH_SIZE: 4096,
        RETINA_PREFIX: /@([0-9\.]+)x/,
        RENDER_OPTIONS: {
          view: null,
          antialias: !1,
          forceFXAA: !1,
          autoResize: !1,
          transparent: !1,
          backgroundColor: 0,
          clearBeforeRender: !0,
          preserveDrawingBuffer: !1,
          roundPixels: !1,
          width: 800,
          height: 600,
          legacy: !1
        },
        TRANSFORM_MODE: 0,
        GC_MODE: 0,
        GC_MAX_IDLE: 3600,
        GC_MAX_CHECK_COUNT: 600,
        WRAP_MODE: 0,
        SCALE_MODE: 0,
        PRECISION_VERTEX: "highp",
        PRECISION_FRAGMENT: "mediump",
        CAN_UPLOAD_SAME_BUFFER: (0, a["default"])(),
        MESH_CANVAS_PADDING: 0
      };
    }, {
      "./utils/canUploadSameBuffer": 122,
      "./utils/maxRecommendedTextures": 127
    }],
    102: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../math"),
        h = t("../utils"),
        l = t("../const"),
        c = t("../textures/Texture"),
        d = n(c),
        f = t("../display/Container"),
        p = n(f),
        v = new u.Point(),
        g = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this));
            return n._anchor = new u.ObservablePoint(n._onAnchorUpdate, n, r ? r.defaultAnchor.x : 0, r ? r.defaultAnchor.y : 0), n._texture = null, n._width = 0, n._height = 0, n._tint = null, n._tintRGB = null, n.tint = 16777215, n.blendMode = l.BLEND_MODES.NORMAL, n.shader = null, n.cachedTint = 16777215, n.texture = r || d["default"].EMPTY, n.vertexData = new Float32Array(8), n.vertexTrimmedData = null, n._transformID = -1, n._textureID = -1, n._transformTrimmedID = -1, n._textureTrimmedID = -1, n.pluginName = "sprite", n;
          }
          return s(e, t), e.prototype._onTextureUpdate = function () {
            this._textureID = -1, this._textureTrimmedID = -1, this.cachedTint = 16777215, this._width && (this.scale.x = (0, h.sign)(this.scale.x) * this._width / this._texture.orig.width), this._height && (this.scale.y = (0, h.sign)(this.scale.y) * this._height / this._texture.orig.height);
          }, e.prototype._onAnchorUpdate = function () {
            this._transformID = -1, this._transformTrimmedID = -1;
          }, e.prototype.calculateVertices = function () {
            if (this._transformID !== this.transform._worldID || this._textureID !== this._texture._updateID) {
              this._transformID = this.transform._worldID, this._textureID = this._texture._updateID;
              var t = this._texture,
                e = this.transform.worldTransform,
                r = e.a,
                n = e.b,
                i = e.c,
                o = e.d,
                s = e.tx,
                a = e.ty,
                u = this.vertexData,
                h = t.trim,
                l = t.orig,
                c = this._anchor,
                d = 0,
                f = 0,
                p = 0,
                v = 0;
              h ? (f = h.x - c._x * l.width, d = f + h.width, v = h.y - c._y * l.height, p = v + h.height) : (f = -c._x * l.width, d = f + l.width, v = -c._y * l.height, p = v + l.height), u[0] = r * f + i * v + s, u[1] = o * v + n * f + a, u[2] = r * d + i * v + s, u[3] = o * v + n * d + a, u[4] = r * d + i * p + s, u[5] = o * p + n * d + a, u[6] = r * f + i * p + s, u[7] = o * p + n * f + a;
            }
          }, e.prototype.calculateTrimmedVertices = function () {
            if (this.vertexTrimmedData) {
              if (this._transformTrimmedID === this.transform._worldID && this._textureTrimmedID === this._texture._updateID) return;
            } else this.vertexTrimmedData = new Float32Array(8);
            this._transformTrimmedID = this.transform._worldID, this._textureTrimmedID = this._texture._updateID;
            var t = this._texture,
              e = this.vertexTrimmedData,
              r = t.orig,
              n = this._anchor,
              i = this.transform.worldTransform,
              o = i.a,
              s = i.b,
              a = i.c,
              u = i.d,
              h = i.tx,
              l = i.ty,
              c = -n._x * r.width,
              d = c + r.width,
              f = -n._y * r.height,
              p = f + r.height;
            e[0] = o * c + a * f + h, e[1] = u * f + s * c + l, e[2] = o * d + a * f + h, e[3] = u * f + s * d + l, e[4] = o * d + a * p + h, e[5] = u * p + s * d + l, e[6] = o * c + a * p + h, e[7] = u * p + s * c + l;
          }, e.prototype._renderWebGL = function (t) {
            this.calculateVertices(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this);
          }, e.prototype._renderCanvas = function (t) {
            t.plugins[this.pluginName].render(this);
          }, e.prototype._calculateBounds = function () {
            var t = this._texture.trim,
              e = this._texture.orig;
            !t || t.width === e.width && t.height === e.height ? (this.calculateVertices(), this._bounds.addQuad(this.vertexData)) : (this.calculateTrimmedVertices(), this._bounds.addQuad(this.vertexTrimmedData));
          }, e.prototype.getLocalBounds = function (e) {
            return 0 === this.children.length ? (this._bounds.minX = this._texture.orig.width * -this._anchor._x, this._bounds.minY = this._texture.orig.height * -this._anchor._y, this._bounds.maxX = this._texture.orig.width * (1 - this._anchor._x), this._bounds.maxY = this._texture.orig.height * (1 - this._anchor._y), e || (this._localBoundsRect || (this._localBoundsRect = new u.Rectangle()), e = this._localBoundsRect), this._bounds.getRectangle(e)) : t.prototype.getLocalBounds.call(this, e);
          }, e.prototype.containsPoint = function (t) {
            this.worldTransform.applyInverse(t, v);
            var e = this._texture.orig.width,
              r = this._texture.orig.height,
              n = -e * this.anchor.x,
              i = 0;
            return v.x >= n && v.x < n + e && (i = -r * this.anchor.y, v.y >= i && v.y < i + r);
          }, e.prototype.destroy = function (e) {
            if (t.prototype.destroy.call(this, e), this._texture.off("update", this._onTextureUpdate, this), this._anchor = null, "boolean" == typeof e ? e : e && e.texture) {
              var r = "boolean" == typeof e ? e : e && e.baseTexture;
              this._texture.destroy(!!r);
            }
            this._texture = null, this.shader = null;
          }, e.from = function (t) {
            return new e(d["default"].from(t));
          }, e.fromFrame = function (t) {
            var r = h.TextureCache[t];
            if (!r) throw new Error('The frameId "' + t + '" does not exist in the texture cache');
            return new e(r);
          }, e.fromImage = function (t, r, n) {
            return new e(d["default"].fromImage(t, r, n));
          }, a(e, [{
            key: "width",
            get: function get() {
              return Math.abs(this.scale.x) * this._texture.orig.width;
            },
            set: function set(t) {
              var e = (0, h.sign)(this.scale.x) || 1;
              this.scale.x = e * t / this._texture.orig.width, this._width = t;
            }
          }, {
            key: "height",
            get: function get() {
              return Math.abs(this.scale.y) * this._texture.orig.height;
            },
            set: function set(t) {
              var e = (0, h.sign)(this.scale.y) || 1;
              this.scale.y = e * t / this._texture.orig.height, this._height = t;
            }
          }, {
            key: "anchor",
            get: function get() {
              return this._anchor;
            },
            set: function set(t) {
              this._anchor.copy(t);
            }
          }, {
            key: "tint",
            get: function get() {
              return this._tint;
            },
            set: function set(t) {
              this._tint = t, this._tintRGB = (t >> 16) + (65280 & t) + ((255 & t) << 16);
            }
          }, {
            key: "texture",
            get: function get() {
              return this._texture;
            },
            set: function set(t) {
              this._texture !== t && (this._texture = t || d["default"].EMPTY, this.cachedTint = 16777215, this._textureID = -1, this._textureTrimmedID = -1, t && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this)));
            }
          }]), e;
        }(p["default"]);
      r["default"] = g;
    }, {
      "../const": 46,
      "../display/Container": 48,
      "../math": 70,
      "../textures/Texture": 115,
      "../utils": 125
    }],
    103: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = t("../../renderers/canvas/CanvasRenderer"),
        s = n(o),
        a = t("../../const"),
        u = t("../../math"),
        h = t("./CanvasTinter"),
        l = n(h),
        c = new u.Matrix(),
        d = function () {
          function t(e) {
            i(this, t), this.renderer = e;
          }
          return t.prototype.render = function (t) {
            var e = t._texture,
              r = this.renderer,
              n = e._frame.width,
              i = e._frame.height,
              o = t.transform.worldTransform,
              s = 0,
              h = 0;
            if (!(e.orig.width <= 0 || e.orig.height <= 0) && e.baseTexture.source && (r.setBlendMode(t.blendMode), e.valid)) {
              r.context.globalAlpha = t.worldAlpha;
              var d = e.baseTexture.scaleMode === a.SCALE_MODES.LINEAR;
              r.smoothProperty && r.context[r.smoothProperty] !== d && (r.context[r.smoothProperty] = d), e.trim ? (s = e.trim.width / 2 + e.trim.x - t.anchor.x * e.orig.width, h = e.trim.height / 2 + e.trim.y - t.anchor.y * e.orig.height) : (s = (.5 - t.anchor.x) * e.orig.width, h = (.5 - t.anchor.y) * e.orig.height), e.rotate && (o.copy(c), o = c, u.GroupD8.matrixAppendRotationInv(o, e.rotate, s, h), s = 0, h = 0), s -= n / 2, h -= i / 2, r.roundPixels ? (r.context.setTransform(o.a, o.b, o.c, o.d, o.tx * r.resolution | 0, o.ty * r.resolution | 0), s |= 0, h |= 0) : r.context.setTransform(o.a, o.b, o.c, o.d, o.tx * r.resolution, o.ty * r.resolution);
              var f = e.baseTexture.resolution;
              16777215 !== t.tint ? (t.cachedTint === t.tint && t.tintedTexture.tintId === t._texture._updateID || (t.cachedTint = t.tint, t.tintedTexture = l["default"].getTintedTexture(t, t.tint)), r.context.drawImage(t.tintedTexture, 0, 0, n * f, i * f, s * r.resolution, h * r.resolution, n * r.resolution, i * r.resolution)) : r.context.drawImage(e.baseTexture.source, e._frame.x * f, e._frame.y * f, n * f, i * f, s * r.resolution, h * r.resolution, n * r.resolution, i * r.resolution);
            }
          }, t.prototype.destroy = function () {
            this.renderer = null;
          }, t;
        }();
      r["default"] = d, s["default"].registerPlugin("sprite", d);
    }, {
      "../../const": 46,
      "../../math": 70,
      "../../renderers/canvas/CanvasRenderer": 77,
      "./CanvasTinter": 104
    }],
    104: [function (t, e, r) {
      "use strict";

      r.__esModule = !0;
      var n = t("../../utils"),
        i = t("../../renderers/canvas/utils/canUseNewCanvasBlendModes"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = {
          getTintedTexture: function getTintedTexture(t, e) {
            var r = t._texture;
            e = s.roundColor(e);
            var n = "#" + ("00000" + (0 | e).toString(16)).substr(-6);
            r.tintCache = r.tintCache || {};
            var i = r.tintCache[n],
              o = void 0;
            if (i) {
              if (i.tintId === r._updateID) return r.tintCache[n];
              o = r.tintCache[n];
            } else o = s.canvas || document.createElement("canvas");
            if (s.tintMethod(r, e, o), o.tintId = r._updateID, s.convertTintToImage) {
              var a = new Image();
              a.src = o.toDataURL(), r.tintCache[n] = a;
            } else r.tintCache[n] = o, s.canvas = null;
            return o;
          },
          tintWithMultiply: function tintWithMultiply(t, e, r) {
            var n = r.getContext("2d"),
              i = t._frame.clone(),
              o = t.baseTexture.resolution;
            i.x *= o, i.y *= o, i.width *= o, i.height *= o, r.width = Math.ceil(i.width), r.height = Math.ceil(i.height), n.save(), n.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), n.fillRect(0, 0, i.width, i.height), n.globalCompositeOperation = "multiply", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.globalCompositeOperation = "destination-atop", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.restore();
          },
          tintWithOverlay: function tintWithOverlay(t, e, r) {
            var n = r.getContext("2d"),
              i = t._frame.clone(),
              o = t.baseTexture.resolution;
            i.x *= o, i.y *= o, i.width *= o, i.height *= o, r.width = Math.ceil(i.width), r.height = Math.ceil(i.height), n.save(), n.globalCompositeOperation = "copy", n.fillStyle = "#" + ("00000" + (0 | e).toString(16)).substr(-6), n.fillRect(0, 0, i.width, i.height), n.globalCompositeOperation = "destination-atop", n.drawImage(t.baseTexture.source, i.x, i.y, i.width, i.height, 0, 0, i.width, i.height), n.restore();
          },
          tintWithPerPixel: function tintWithPerPixel(t, e, r) {
            var i = r.getContext("2d"),
              o = t._frame.clone(),
              s = t.baseTexture.resolution;
            o.x *= s, o.y *= s, o.width *= s, o.height *= s, r.width = Math.ceil(o.width), r.height = Math.ceil(o.height), i.save(), i.globalCompositeOperation = "copy", i.drawImage(t.baseTexture.source, o.x, o.y, o.width, o.height, 0, 0, o.width, o.height), i.restore();
            for (var a = (0, n.hex2rgb)(e), u = a[0], h = a[1], l = a[2], c = i.getImageData(0, 0, o.width, o.height), d = c.data, f = 0; f < d.length; f += 4) d[f + 0] *= u, d[f + 1] *= h, d[f + 2] *= l;
            i.putImageData(c, 0, 0);
          },
          roundColor: function roundColor(t) {
            var e = s.cacheStepsPerColorChannel,
              r = (0, n.hex2rgb)(t);
            return r[0] = Math.min(255, r[0] / e * e), r[1] = Math.min(255, r[1] / e * e), r[2] = Math.min(255, r[2] / e * e), (0, n.rgb2hex)(r);
          },
          cacheStepsPerColorChannel: 8,
          convertTintToImage: !1,
          canUseMultiply: (0, o["default"])(),
          tintMethod: 0
        };
      s.tintMethod = s.canUseMultiply ? s.tintWithMultiply : s.tintWithPerPixel, r["default"] = s;
    }, {
      "../../renderers/canvas/utils/canUseNewCanvasBlendModes": 80,
      "../../utils": 125
    }],
    105: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e) {
          n(this, t), this.vertices = new ArrayBuffer(e), this.float32View = new Float32Array(this.vertices), this.uint32View = new Uint32Array(this.vertices);
        }
        return t.prototype.destroy = function () {
          this.vertices = null, this.positions = null, this.uvs = null, this.colors = null;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    106: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../../renderers/webgl/utils/ObjectRenderer"),
        u = n(a),
        h = t("../../renderers/webgl/WebGLRenderer"),
        l = n(h),
        c = t("../../utils/createIndicesForQuads"),
        d = n(c),
        f = t("./generateMultiTextureShader"),
        p = n(f),
        v = t("../../renderers/webgl/utils/checkMaxIfStatmentsInShader"),
        g = n(v),
        y = t("./BatchBuffer"),
        m = n(y),
        _ = t("../../settings"),
        b = n(_),
        x = t("../../utils"),
        T = t("pixi-gl-core"),
        w = n(T),
        E = t("bit-twiddle"),
        S = n(E),
        O = 0,
        M = 0,
        P = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this, r));
            n.vertSize = 5, n.vertByteSize = 4 * n.vertSize, n.size = b["default"].SPRITE_BATCH_SIZE, n.buffers = [];
            for (var s = 1; s <= S["default"].nextPow2(n.size); s *= 2) n.buffers.push(new m["default"](4 * s * n.vertByteSize));
            n.indices = (0, d["default"])(n.size), n.shader = null, n.currentIndex = 0, n.groups = [];
            for (var a = 0; a < n.size; a++) n.groups[a] = {
              textures: [],
              textureCount: 0,
              ids: [],
              size: 0,
              start: 0,
              blend: 0
            };
            return n.sprites = [], n.vertexBuffers = [], n.vaos = [], n.vaoMax = 2, n.vertexCount = 0, n.renderer.on("prerender", n.onPrerender, n), n;
          }
          return s(e, t), e.prototype.onContextChange = function () {
            var t = this.renderer.gl;
            this.renderer.legacy ? this.MAX_TEXTURES = 1 : (this.MAX_TEXTURES = Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS), b["default"].SPRITE_MAX_TEXTURES), this.MAX_TEXTURES = (0, g["default"])(this.MAX_TEXTURES, t)), this.shader = (0, p["default"])(t, this.MAX_TEXTURES), this.indexBuffer = w["default"].GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.renderer.bindVao(null);
            for (var e = this.shader.attributes, r = 0; r < this.vaoMax; r++) {
              var n = this.vertexBuffers[r] = w["default"].GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW),
                i = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(n, e.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(n, e.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(n, e.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12);
              e.aTextureId && i.addAttribute(n, e.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[r] = i;
            }
            this.vao = this.vaos[0], this.currentBlendMode = 99999, this.boundTextures = new Array(this.MAX_TEXTURES);
          }, e.prototype.onPrerender = function () {
            this.vertexCount = 0;
          }, e.prototype.render = function (t) {
            this.currentIndex >= this.size && this.flush(), t._texture._uvs && (this.sprites[this.currentIndex++] = t);
          }, e.prototype.flush = function () {
            if (0 !== this.currentIndex) {
              var t = this.renderer.gl,
                e = this.MAX_TEXTURES,
                r = S["default"].nextPow2(this.currentIndex),
                n = S["default"].log2(r),
                i = this.buffers[n],
                o = this.sprites,
                s = this.groups,
                a = i.float32View,
                u = i.uint32View,
                h = this.boundTextures,
                l = this.renderer.boundTextures,
                c = this.renderer.textureGC.count,
                d = 0,
                f = void 0,
                p = void 0,
                v = 1,
                g = 0,
                y = s[0],
                m = void 0,
                _ = void 0,
                T = x.premultiplyBlendMode[o[0]._texture.baseTexture.premultipliedAlpha ? 1 : 0][o[0].blendMode];
              y.textureCount = 0, y.start = 0, y.blend = T, O++;
              var E = void 0;
              for (E = 0; E < e; ++E) {
                var P = l[E];
                P._enabled !== O ? (h[E] = P, P._virtalBoundId = E, P._enabled = O) : h[E] = this.renderer.emptyTextures[E];
              }
              for (O++, E = 0; E < this.currentIndex; ++E) {
                var C = o[E];
                o[E] = null, f = C._texture.baseTexture;
                var R = x.premultiplyBlendMode[Number(f.premultipliedAlpha)][C.blendMode];
                if (T !== R && (T = R, p = null, g = e, O++), p !== f && (p = f, f._enabled !== O)) {
                  if (g === e && (O++, y.size = E - y.start, g = 0, y = s[v++], y.blend = T, y.textureCount = 0, y.start = E), f.touched = c, -1 === f._virtalBoundId)
                    for (var A = 0; A < e; ++A) {
                      var I = (A + M) % e,
                        D = h[I];
                      if (D._enabled !== O) {
                        M++, D._virtalBoundId = -1, f._virtalBoundId = I, h[I] = f;
                        break;
                      }
                    }
                  f._enabled = O, y.textureCount++, y.ids[g] = f._virtalBoundId, y.textures[g++] = f;
                }
                if (m = C.vertexData, _ = C._texture._uvs.uvsUint32, this.renderer.roundPixels) {
                  var L = this.renderer.resolution;
                  a[d] = (m[0] * L | 0) / L, a[d + 1] = (m[1] * L | 0) / L, a[d + 5] = (m[2] * L | 0) / L, a[d + 6] = (m[3] * L | 0) / L, a[d + 10] = (m[4] * L | 0) / L, a[d + 11] = (m[5] * L | 0) / L, a[d + 15] = (m[6] * L | 0) / L, a[d + 16] = (m[7] * L | 0) / L;
                } else a[d] = m[0], a[d + 1] = m[1], a[d + 5] = m[2], a[d + 6] = m[3], a[d + 10] = m[4], a[d + 11] = m[5], a[d + 15] = m[6], a[d + 16] = m[7];
                u[d + 2] = _[0], u[d + 7] = _[1], u[d + 12] = _[2], u[d + 17] = _[3];
                var N = Math.min(C.worldAlpha, 1),
                  B = N < 1 && f.premultipliedAlpha ? (0, x.premultiplyTint)(C._tintRGB, N) : C._tintRGB + (255 * N << 24);
                u[d + 3] = u[d + 8] = u[d + 13] = u[d + 18] = B, a[d + 4] = a[d + 9] = a[d + 14] = a[d + 19] = f._virtalBoundId, d += 20;
              }
              if (y.size = E - y.start, b["default"].CAN_UPLOAD_SAME_BUFFER) this.vertexBuffers[this.vertexCount].upload(i.vertices, 0, !0);
              else {
                if (this.vaoMax <= this.vertexCount) {
                  this.vaoMax++;
                  var k = this.shader.attributes,
                    F = this.vertexBuffers[this.vertexCount] = w["default"].GLBuffer.createVertexBuffer(t, null, t.STREAM_DRAW),
                    j = this.renderer.createVao().addIndex(this.indexBuffer).addAttribute(F, k.aVertexPosition, t.FLOAT, !1, this.vertByteSize, 0).addAttribute(F, k.aTextureCoord, t.UNSIGNED_SHORT, !0, this.vertByteSize, 8).addAttribute(F, k.aColor, t.UNSIGNED_BYTE, !0, this.vertByteSize, 12);
                  k.aTextureId && j.addAttribute(F, k.aTextureId, t.FLOAT, !1, this.vertByteSize, 16), this.vaos[this.vertexCount] = j;
                }
                this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].upload(i.vertices, 0, !1), this.vertexCount++;
              }
              for (E = 0; E < e; ++E) l[E]._virtalBoundId = -1;
              for (E = 0; E < v; ++E) {
                for (var U = s[E], X = U.textureCount, G = 0; G < X; G++) p = U.textures[G], l[U.ids[G]] !== p && this.renderer.bindTexture(p, U.ids[G], !0), p._virtalBoundId = -1;
                this.renderer.state.setBlendMode(U.blend), t.drawElements(t.TRIANGLES, 6 * U.size, t.UNSIGNED_SHORT, 6 * U.start * 2);
              }
              this.currentIndex = 0;
            }
          }, e.prototype.start = function () {
            this.renderer.bindShader(this.shader), b["default"].CAN_UPLOAD_SAME_BUFFER && (this.renderer.bindVao(this.vaos[this.vertexCount]), this.vertexBuffers[this.vertexCount].bind());
          }, e.prototype.stop = function () {
            this.flush();
          }, e.prototype.destroy = function () {
            for (var e = 0; e < this.vaoMax; e++) this.vertexBuffers[e] && this.vertexBuffers[e].destroy(), this.vaos[e] && this.vaos[e].destroy();
            this.indexBuffer && this.indexBuffer.destroy(), this.renderer.off("prerender", this.onPrerender, this), t.prototype.destroy.call(this), this.shader && (this.shader.destroy(), this.shader = null), this.vertexBuffers = null, this.vaos = null, this.indexBuffer = null, this.indices = null, this.sprites = null;
            for (var r = 0; r < this.buffers.length; ++r) this.buffers[r].destroy();
          }, e;
        }(u["default"]);
      r["default"] = P, l["default"].registerPlugin("sprite", P);
    }, {
      "../../renderers/webgl/WebGLRenderer": 84,
      "../../renderers/webgl/utils/ObjectRenderer": 94,
      "../../renderers/webgl/utils/checkMaxIfStatmentsInShader": 97,
      "../../settings": 101,
      "../../utils": 125,
      "../../utils/createIndicesForQuads": 123,
      "./BatchBuffer": 105,
      "./generateMultiTextureShader": 107,
      "bit-twiddle": 1,
      "pixi-gl-core": 15
    }],
    107: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        var r = a;
        r = r.replace(/%count%/gi, e), r = r.replace(/%forloop%/gi, i(e));
        for (var n = new s["default"](t, "precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor;\n}\n", r), o = [], u = 0; u < e; u++) o[u] = u;
        return n.bind(), n.uniforms.uSamplers = o, n;
      }

      function i(t) {
        var e = "";
        e += "\n", e += "\n";
        for (var r = 0; r < t; r++) r > 0 && (e += "\nelse "), r < t - 1 && (e += "if(vTextureId < " + r + ".5)"), e += "\n{", e += "\n\tcolor = texture2D(uSamplers[" + r + "], vTextureCoord);", e += "\n}";
        return e += "\n", e += "\n";
      }
      r.__esModule = !0, r["default"] = n;
      var o = t("../../Shader"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = (t("path"), ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "varying float vTextureId;", "uniform sampler2D uSamplers[%count%];", "void main(void){", "vec4 color;", "%forloop%", "gl_FragColor = color * vColor;", "}"].join("\n"));
    }, {
      "../../Shader": 44,
      path: 8
    }],
    108: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../sprites/Sprite"),
        h = n(u),
        l = t("../textures/Texture"),
        c = n(l),
        d = t("../math"),
        f = t("../utils"),
        p = t("../const"),
        v = t("../settings"),
        g = n(v),
        y = t("./TextStyle"),
        m = n(y),
        _ = t("./TextMetrics"),
        b = n(_),
        x = t("../utils/trimCanvas"),
        T = n(x),
        w = {
          texture: !0,
          children: !1,
          baseTexture: !0
        },
        E = function (t) {
          function e(r, n, s) {
            i(this, e), s = s || document.createElement("canvas"), s.width = 3, s.height = 3;
            var a = c["default"].fromCanvas(s, g["default"].SCALE_MODE, "text");
            a.orig = new d.Rectangle(), a.trim = new d.Rectangle();
            var u = o(this, t.call(this, a));
            return c["default"].addToCache(u._texture, u._texture.baseTexture.textureCacheIds[0]), u.canvas = s, u.context = u.canvas.getContext("2d"), u.resolution = g["default"].RESOLUTION, u._text = null, u._style = null, u._styleListener = null, u._font = "", u.text = r, u.style = n, u.localStyleID = -1, u;
          }
          return s(e, t), e.prototype.updateText = function (t) {
            var e = this._style;
            if (this.localStyleID !== e.styleID && (this.dirty = !0, this.localStyleID = e.styleID), this.dirty || !t) {
              this._font = this._style.toFontString();
              var r = this.context,
                n = b["default"].measureText(this._text, this._style, this._style.wordWrap, this.canvas),
                i = n.width,
                o = n.height,
                s = n.lines,
                a = n.lineHeight,
                u = n.lineWidths,
                h = n.maxLineWidth,
                l = n.fontProperties;
              this.canvas.width = Math.ceil((Math.max(1, i) + 2 * e.padding) * this.resolution), this.canvas.height = Math.ceil((Math.max(1, o) + 2 * e.padding) * this.resolution), r.scale(this.resolution, this.resolution), r.clearRect(0, 0, this.canvas.width, this.canvas.height), r.font = this._font, r.strokeStyle = e.stroke, r.lineWidth = e.strokeThickness, r.textBaseline = e.textBaseline, r.lineJoin = e.lineJoin, r.miterLimit = e.miterLimit;
              var c = void 0,
                d = void 0;
              if (e.dropShadow) {
                r.fillStyle = e.dropShadowColor, r.globalAlpha = e.dropShadowAlpha, r.shadowBlur = e.dropShadowBlur, e.dropShadowBlur > 0 && (r.shadowColor = e.dropShadowColor);
                for (var f = Math.cos(e.dropShadowAngle) * e.dropShadowDistance, p = Math.sin(e.dropShadowAngle) * e.dropShadowDistance, v = 0; v < s.length; v++) c = e.strokeThickness / 2, d = e.strokeThickness / 2 + v * a + l.ascent, "right" === e.align ? c += h - u[v] : "center" === e.align && (c += (h - u[v]) / 2), e.fill && (this.drawLetterSpacing(s[v], c + f + e.padding, d + p + e.padding), e.stroke && e.strokeThickness && (r.strokeStyle = e.dropShadowColor, this.drawLetterSpacing(s[v], c + f + e.padding, d + p + e.padding, !0), r.strokeStyle = e.stroke));
              }
              r.shadowBlur = 0, r.globalAlpha = 1, r.fillStyle = this._generateFillStyle(e, s);
              for (var g = 0; g < s.length; g++) c = e.strokeThickness / 2, d = e.strokeThickness / 2 + g * a + l.ascent, "right" === e.align ? c += h - u[g] : "center" === e.align && (c += (h - u[g]) / 2), e.stroke && e.strokeThickness && this.drawLetterSpacing(s[g], c + e.padding, d + e.padding, !0), e.fill && this.drawLetterSpacing(s[g], c + e.padding, d + e.padding);
              this.updateTexture();
            }
          }, e.prototype.drawLetterSpacing = function (t, e, r) {
            var n = arguments.length > 3 && void 0 !== arguments[3] && arguments[3],
              i = this._style,
              o = i.letterSpacing;
            if (0 === o) return void(n ? this.context.strokeText(t, e, r) : this.context.fillText(t, e, r));
            for (var s = String.prototype.split.call(t, ""), a = e, u = 0, h = ""; u < t.length;) h = s[u++], n ? this.context.strokeText(h, a, r) : this.context.fillText(h, a, r), a += this.context.measureText(h).width + o;
          }, e.prototype.updateTexture = function () {
            var t = this.canvas;
            if (this._style.trim) {
              var e = (0, T["default"])(t);
              e.data && (t.width = e.width, t.height = e.height, this.context.putImageData(e.data, 0, 0));
            }
            var r = this._texture,
              n = this._style,
              i = n.trim ? 0 : n.padding,
              o = r.baseTexture;
            o.hasLoaded = !0, o.resolution = this.resolution, o.realWidth = t.width, o.realHeight = t.height, o.width = t.width / this.resolution, o.height = t.height / this.resolution, r.trim.width = r._frame.width = t.width / this.resolution, r.trim.height = r._frame.height = t.height / this.resolution, r.trim.x = -i, r.trim.y = -i, r.orig.width = r._frame.width - 2 * i, r.orig.height = r._frame.height - 2 * i, this._onTextureUpdate(), o.emit("update", o), this.dirty = !1;
          }, e.prototype.renderWebGL = function (e) {
            this.resolution !== e.resolution && (this.resolution = e.resolution, this.dirty = !0), this.updateText(!0), t.prototype.renderWebGL.call(this, e);
          }, e.prototype._renderCanvas = function (e) {
            this.resolution !== e.resolution && (this.resolution = e.resolution, this.dirty = !0), this.updateText(!0), t.prototype._renderCanvas.call(this, e);
          }, e.prototype.getLocalBounds = function (e) {
            return this.updateText(!0), t.prototype.getLocalBounds.call(this, e);
          }, e.prototype._calculateBounds = function () {
            this.updateText(!0), this.calculateVertices(), this._bounds.addQuad(this.vertexData);
          }, e.prototype._onStyleChange = function () {
            this.dirty = !0;
          }, e.prototype._generateFillStyle = function (t, e) {
            if (!Array.isArray(t.fill)) return t.fill;
            if (navigator.isCocoonJS) return t.fill[0];
            var r = void 0,
              n = void 0,
              i = void 0,
              o = void 0,
              s = this.canvas.width / this.resolution,
              a = this.canvas.height / this.resolution,
              u = t.fill.slice(),
              h = t.fillGradientStops.slice();
            if (!h.length)
              for (var l = u.length + 1, c = 1; c < l; ++c) h.push(c / l);
            if (u.unshift(t.fill[0]), h.unshift(0), u.push(t.fill[t.fill.length - 1]), h.push(1), t.fillGradientType === p.TEXT_GRADIENT.LINEAR_VERTICAL) {
              r = this.context.createLinearGradient(s / 2, 0, s / 2, a), n = (u.length + 1) * e.length, i = 0;
              for (var d = 0; d < e.length; d++) {
                i += 1;
                for (var f = 0; f < u.length; f++) o = "number" == typeof h[f] ? h[f] / e.length + d / e.length : i / n, r.addColorStop(o, u[f]), i++;
              }
            } else {
              r = this.context.createLinearGradient(0, a / 2, s, a / 2), n = u.length + 1, i = 1;
              for (var v = 0; v < u.length; v++) o = "number" == typeof h[v] ? h[v] : i / n, r.addColorStop(o, u[v]), i++;
            }
            return r;
          }, e.prototype.destroy = function (e) {
            "boolean" == typeof e && (e = {
              children: e
            }), e = Object.assign({}, w, e), t.prototype.destroy.call(this, e), this.context = null, this.canvas = null, this._style = null;
          }, a(e, [{
            key: "width",
            get: function get() {
              return this.updateText(!0), Math.abs(this.scale.x) * this._texture.orig.width;
            },
            set: function set(t) {
              this.updateText(!0);
              var e = (0, f.sign)(this.scale.x) || 1;
              this.scale.x = e * t / this._texture.orig.width, this._width = t;
            }
          }, {
            key: "height",
            get: function get() {
              return this.updateText(!0), Math.abs(this.scale.y) * this._texture.orig.height;
            },
            set: function set(t) {
              this.updateText(!0);
              var e = (0, f.sign)(this.scale.y) || 1;
              this.scale.y = e * t / this._texture.orig.height, this._height = t;
            }
          }, {
            key: "style",
            get: function get() {
              return this._style;
            },
            set: function set(t) {
              t = t || {}, t instanceof m["default"] ? this._style = t : this._style = new m["default"](t), this.localStyleID = -1, this.dirty = !0;
            }
          }, {
            key: "text",
            get: function get() {
              return this._text;
            },
            set: function set(t) {
              t = String("" === t || null === t || void 0 === t ? " " : t), this._text !== t && (this._text = t, this.dirty = !0);
            }
          }]), e;
        }(h["default"]);
      r["default"] = E;
    }, {
      "../const": 46,
      "../math": 70,
      "../settings": 101,
      "../sprites/Sprite": 102,
      "../textures/Texture": 115,
      "../utils": 125,
      "../utils/trimCanvas": 130,
      "./TextMetrics": 109,
      "./TextStyle": 110
    }],
    109: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e, r, i, o, s, a, u, h, l) {
          n(this, t), this.text = e, this.style = r, this.width = i, this.height = o, this.lines = s, this.lineWidths = a, this.lineHeight = u, this.maxLineWidth = h, this.fontProperties = l;
        }
        return t.measureText = function (e, r, n) {
          var i = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : t._canvas;
          n = void 0 === n || null === n ? r.wordWrap : n;
          var o = r.toFontString(),
            s = t.measureFont(o),
            a = i.getContext("2d");
          a.font = o;
          for (var u = n ? t.wordWrap(e, r, i) : e, h = u.split(/(?:\r\n|\r|\n)/), l = new Array(h.length), c = 0, d = 0; d < h.length; d++) {
            var f = a.measureText(h[d]).width + (h[d].length - 1) * r.letterSpacing;
            l[d] = f, c = Math.max(c, f);
          }
          var p = c + r.strokeThickness;
          r.dropShadow && (p += r.dropShadowDistance);
          var v = r.lineHeight || s.fontSize + r.strokeThickness,
            g = Math.max(v, s.fontSize + r.strokeThickness) + (h.length - 1) * (v + r.leading);
          return r.dropShadow && (g += r.dropShadowDistance), new t(e, r, p, g, h, l, v + r.leading, c, s);
        }, t.wordWrap = function (e, r) {
          for (var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : t._canvas, i = n.getContext("2d"), o = 0, s = "", a = "", u = {}, h = r.letterSpacing, l = r.whiteSpace, c = t.collapseSpaces(l), d = t.collapseNewlines(l), f = !c, p = r.wordWrapWidth + h, v = t.tokenize(e), g = 0; g < v.length; g++) {
            var y = v[g];
            if (t.isNewline(y)) {
              if (!d) {
                a += t.addLine(s), f = !c, s = "", o = 0;
                continue;
              }
              y = " ";
            }
            if (c) {
              var m = t.isBreakingSpace(y),
                _ = t.isBreakingSpace(s[s.length - 1]);
              if (m && _) continue;
            }
            var b = t.getFromCache(y, h, u, i);
            if (b > p) {
              if ("" !== s && (a += t.addLine(s), s = "", o = 0), t.canBreakWords(y, r.breakWords))
                for (var x = y.split(""), T = 0; T < x.length; T++) {
                  for (var w = x[T], E = 1; x[T + E];) {
                    var S = x[T + E],
                      O = w[w.length - 1];
                    if (t.canBreakChars(O, S, y, T, r.breakWords)) break;
                    w += S, E++;
                  }
                  T += w.length - 1;
                  var M = t.getFromCache(w, h, u, i);
                  M + o > p && (a += t.addLine(s), f = !1, s = "", o = 0), s += w, o += M;
                } else {
                  s.length > 0 && (a += t.addLine(s), s = "", o = 0);
                  var P = g === v.length - 1;
                  a += t.addLine(y, !P), f = !1, s = "", o = 0;
                }
            } else b + o > p && (f = !1, a += t.addLine(s), s = "", o = 0), (s.length > 0 || !t.isBreakingSpace(y) || f) && (s += y, o += b);
          }
          return a += t.addLine(s, !1);
        }, t.addLine = function (e) {
          var r = !(arguments.length > 1 && void 0 !== arguments[1]) || arguments[1];
          return e = t.trimRight(e), e = r ? e + "\n" : e;
        }, t.getFromCache = function (t, e, r, n) {
          var i = r[t];
          if (void 0 === i) {
            var o = t.length * e;
            i = n.measureText(t).width + o, r[t] = i;
          }
          return i;
        }, t.collapseSpaces = function (t) {
          return "normal" === t || "pre-line" === t;
        }, t.collapseNewlines = function (t) {
          return "normal" === t;
        }, t.trimRight = function (e) {
          if ("string" != typeof e) return "";
          for (var r = e.length - 1; r >= 0; r--) {
            var n = e[r];
            if (!t.isBreakingSpace(n)) break;
            e = e.slice(0, -1);
          }
          return e;
        }, t.isNewline = function (e) {
          return "string" == typeof e && t._newlines.indexOf(e.charCodeAt(0)) >= 0;
        }, t.isBreakingSpace = function (e) {
          return "string" == typeof e && t._breakingSpaces.indexOf(e.charCodeAt(0)) >= 0;
        }, t.tokenize = function (e) {
          var r = [],
            n = "";
          if ("string" != typeof e) return r;
          for (var i = 0; i < e.length; i++) {
            var o = e[i];
            t.isBreakingSpace(o) || t.isNewline(o) ? ("" !== n && (r.push(n), n = ""), r.push(o)) : n += o;
          }
          return "" !== n && r.push(n), r;
        }, t.canBreakWords = function (t, e) {
          return e;
        }, t.canBreakChars = function (t, e, r, n, i) {
          return !0;
        }, t.measureFont = function (e) {
          if (t._fonts[e]) return t._fonts[e];
          var r = {},
            n = t._canvas,
            i = t._context;
          i.font = e;
          var o = t.METRICS_STRING + t.BASELINE_SYMBOL,
            s = Math.ceil(i.measureText(o).width),
            a = Math.ceil(i.measureText(t.BASELINE_SYMBOL).width),
            u = 2 * a;
          a = a * t.BASELINE_MULTIPLIER | 0, n.width = s, n.height = u, i.fillStyle = "#f00", i.fillRect(0, 0, s, u), i.font = e, i.textBaseline = "alphabetic", i.fillStyle = "#000", i.fillText(o, 0, a);
          var h = i.getImageData(0, 0, s, u).data,
            l = h.length,
            c = 4 * s,
            d = 0,
            f = 0,
            p = !1;
          for (d = 0; d < a; ++d) {
            for (var v = 0; v < c; v += 4)
              if (255 !== h[f + v]) {
                p = !0;
                break;
              }
            if (p) break;
            f += c;
          }
          for (r.ascent = a - d, f = l - c, p = !1, d = u; d > a; --d) {
            for (var g = 0; g < c; g += 4)
              if (255 !== h[f + g]) {
                p = !0;
                break;
              }
            if (p) break;
            f -= c;
          }
          return r.descent = d - a, r.fontSize = r.ascent + r.descent, t._fonts[e] = r, r;
        }, t.clearMetrics = function () {
          var e = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "";
          e ? delete t._fonts[e] : t._fonts = {};
        }, t;
      }();
      r["default"] = i;
      var o = document.createElement("canvas");
      o.width = o.height = 10, i._canvas = o, i._context = o.getContext("2d"), i._fonts = {}, i.METRICS_STRING = "|Éq", i.BASELINE_SYMBOL = "M", i.BASELINE_MULTIPLIER = 1.4, i._newlines = [10, 13], i._breakingSpaces = [9, 32, 8192, 8193, 8194, 8195, 8196, 8197, 8198, 8200, 8201, 8202, 8287, 12288];
    }, {}],
    110: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t) {
        return "number" == typeof t ? (0, l.hex2string)(t) : ("string" == typeof t && 0 === t.indexOf("0x") && (t = t.replace("0x", "#")), t);
      }

      function o(t) {
        if (Array.isArray(t)) {
          for (var e = 0; e < t.length; ++e) t[e] = i(t[e]);
          return t;
        }
        return i(t);
      }

      function s(t, e) {
        if (!Array.isArray(t) || !Array.isArray(e)) return !1;
        if (t.length !== e.length) return !1;
        for (var r = 0; r < t.length; ++r)
          if (t[r] !== e[r]) return !1;
        return !0;
      }

      function a(t, e, r) {
        for (var n in r) Array.isArray(e[n]) ? t[n] = e[n].slice() : t[n] = e[n];
      }
      r.__esModule = !0;
      var u = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        h = t("../const"),
        l = t("../utils"),
        c = {
          align: "left",
          breakWords: !1,
          dropShadow: !1,
          dropShadowAlpha: 1,
          dropShadowAngle: Math.PI / 6,
          dropShadowBlur: 0,
          dropShadowColor: "black",
          dropShadowDistance: 5,
          fill: "black",
          fillGradientType: h.TEXT_GRADIENT.LINEAR_VERTICAL,
          fillGradientStops: [],
          fontFamily: "Arial",
          fontSize: 26,
          fontStyle: "normal",
          fontVariant: "normal",
          fontWeight: "normal",
          letterSpacing: 0,
          lineHeight: 0,
          lineJoin: "miter",
          miterLimit: 10,
          padding: 0,
          stroke: "black",
          strokeThickness: 0,
          textBaseline: "alphabetic",
          trim: !1,
          whiteSpace: "pre",
          wordWrap: !1,
          wordWrapWidth: 100,
          leading: 0
        },
        d = ["serif", "sans-serif", "monospace", "cursive", "fantasy", "system-ui"],
        f = function () {
          function t(e) {
            n(this, t), this.styleID = 0, this.reset(), a(this, e, e);
          }
          return t.prototype.clone = function () {
            var e = {};
            return a(e, this, c), new t(e);
          }, t.prototype.reset = function () {
            a(this, c, c);
          }, t.prototype.toFontString = function () {
            var t = "number" == typeof this.fontSize ? this.fontSize + "px" : this.fontSize,
              e = this.fontFamily;
            Array.isArray(this.fontFamily) || (e = this.fontFamily.split(","));
            for (var r = e.length - 1; r >= 0; r--) {
              var n = e[r].trim();
              !/([\"\'])[^\'\"]+\1/.test(n) && d.indexOf(n) < 0 && (n = '"' + n + '"'), e[r] = n;
            }
            return this.fontStyle + " " + this.fontVariant + " " + this.fontWeight + " " + t + " " + e.join(",");
          }, u(t, [{
            key: "align",
            get: function get() {
              return this._align;
            },
            set: function set(t) {
              this._align !== t && (this._align = t, this.styleID++);
            }
          }, {
            key: "breakWords",
            get: function get() {
              return this._breakWords;
            },
            set: function set(t) {
              this._breakWords !== t && (this._breakWords = t, this.styleID++);
            }
          }, {
            key: "dropShadow",
            get: function get() {
              return this._dropShadow;
            },
            set: function set(t) {
              this._dropShadow !== t && (this._dropShadow = t, this.styleID++);
            }
          }, {
            key: "dropShadowAlpha",
            get: function get() {
              return this._dropShadowAlpha;
            },
            set: function set(t) {
              this._dropShadowAlpha !== t && (this._dropShadowAlpha = t, this.styleID++);
            }
          }, {
            key: "dropShadowAngle",
            get: function get() {
              return this._dropShadowAngle;
            },
            set: function set(t) {
              this._dropShadowAngle !== t && (this._dropShadowAngle = t, this.styleID++);
            }
          }, {
            key: "dropShadowBlur",
            get: function get() {
              return this._dropShadowBlur;
            },
            set: function set(t) {
              this._dropShadowBlur !== t && (this._dropShadowBlur = t, this.styleID++);
            }
          }, {
            key: "dropShadowColor",
            get: function get() {
              return this._dropShadowColor;
            },
            set: function set(t) {
              var e = o(t);
              this._dropShadowColor !== e && (this._dropShadowColor = e, this.styleID++);
            }
          }, {
            key: "dropShadowDistance",
            get: function get() {
              return this._dropShadowDistance;
            },
            set: function set(t) {
              this._dropShadowDistance !== t && (this._dropShadowDistance = t, this.styleID++);
            }
          }, {
            key: "fill",
            get: function get() {
              return this._fill;
            },
            set: function set(t) {
              var e = o(t);
              this._fill !== e && (this._fill = e, this.styleID++);
            }
          }, {
            key: "fillGradientType",
            get: function get() {
              return this._fillGradientType;
            },
            set: function set(t) {
              this._fillGradientType !== t && (this._fillGradientType = t, this.styleID++);
            }
          }, {
            key: "fillGradientStops",
            get: function get() {
              return this._fillGradientStops;
            },
            set: function set(t) {
              s(this._fillGradientStops, t) || (this._fillGradientStops = t, this.styleID++);
            }
          }, {
            key: "fontFamily",
            get: function get() {
              return this._fontFamily;
            },
            set: function set(t) {
              this.fontFamily !== t && (this._fontFamily = t, this.styleID++);
            }
          }, {
            key: "fontSize",
            get: function get() {
              return this._fontSize;
            },
            set: function set(t) {
              this._fontSize !== t && (this._fontSize = t, this.styleID++);
            }
          }, {
            key: "fontStyle",
            get: function get() {
              return this._fontStyle;
            },
            set: function set(t) {
              this._fontStyle !== t && (this._fontStyle = t, this.styleID++);
            }
          }, {
            key: "fontVariant",
            get: function get() {
              return this._fontVariant;
            },
            set: function set(t) {
              this._fontVariant !== t && (this._fontVariant = t, this.styleID++);
            }
          }, {
            key: "fontWeight",
            get: function get() {
              return this._fontWeight;
            },
            set: function set(t) {
              this._fontWeight !== t && (this._fontWeight = t, this.styleID++);
            }
          }, {
            key: "letterSpacing",
            get: function get() {
              return this._letterSpacing;
            },
            set: function set(t) {
              this._letterSpacing !== t && (this._letterSpacing = t, this.styleID++);
            }
          }, {
            key: "lineHeight",
            get: function get() {
              return this._lineHeight;
            },
            set: function set(t) {
              this._lineHeight !== t && (this._lineHeight = t, this.styleID++);
            }
          }, {
            key: "leading",
            get: function get() {
              return this._leading;
            },
            set: function set(t) {
              this._leading !== t && (this._leading = t, this.styleID++);
            }
          }, {
            key: "lineJoin",
            get: function get() {
              return this._lineJoin;
            },
            set: function set(t) {
              this._lineJoin !== t && (this._lineJoin = t, this.styleID++);
            }
          }, {
            key: "miterLimit",
            get: function get() {
              return this._miterLimit;
            },
            set: function set(t) {
              this._miterLimit !== t && (this._miterLimit = t, this.styleID++);
            }
          }, {
            key: "padding",
            get: function get() {
              return this._padding;
            },
            set: function set(t) {
              this._padding !== t && (this._padding = t, this.styleID++);
            }
          }, {
            key: "stroke",
            get: function get() {
              return this._stroke;
            },
            set: function set(t) {
              var e = o(t);
              this._stroke !== e && (this._stroke = e, this.styleID++);
            }
          }, {
            key: "strokeThickness",
            get: function get() {
              return this._strokeThickness;
            },
            set: function set(t) {
              this._strokeThickness !== t && (this._strokeThickness = t, this.styleID++);
            }
          }, {
            key: "textBaseline",
            get: function get() {
              return this._textBaseline;
            },
            set: function set(t) {
              this._textBaseline !== t && (this._textBaseline = t, this.styleID++);
            }
          }, {
            key: "trim",
            get: function get() {
              return this._trim;
            },
            set: function set(t) {
              this._trim !== t && (this._trim = t, this.styleID++);
            }
          }, {
            key: "whiteSpace",
            get: function get() {
              return this._whiteSpace;
            },
            set: function set(t) {
              this._whiteSpace !== t && (this._whiteSpace = t, this.styleID++);
            }
          }, {
            key: "wordWrap",
            get: function get() {
              return this._wordWrap;
            },
            set: function set(t) {
              this._wordWrap !== t && (this._wordWrap = t, this.styleID++);
            }
          }, {
            key: "wordWrapWidth",
            get: function get() {
              return this._wordWrapWidth;
            },
            set: function set(t) {
              this._wordWrapWidth !== t && (this._wordWrapWidth = t, this.styleID++);
            }
          }]), t;
        }();
      r["default"] = f;
    }, {
      "../const": 46,
      "../utils": 125
    }],
    111: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("./BaseTexture"),
        u = n(a),
        h = t("../settings"),
        l = n(h),
        c = function (t) {
          function e() {
            var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 100,
              n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 100,
              s = arguments[2],
              a = arguments[3];
            i(this, e);
            var u = o(this, t.call(this, null, s));
            return u.resolution = a || l["default"].RESOLUTION, u.width = Math.ceil(r), u.height = Math.ceil(n), u.realWidth = u.width * u.resolution, u.realHeight = u.height * u.resolution, u.scaleMode = void 0 !== s ? s : l["default"].SCALE_MODE, u.hasLoaded = !0, u._glRenderTargets = {}, u._canvasRenderTarget = null, u.valid = !1, u;
          }
          return s(e, t), e.prototype.resize = function (t, e) {
            t = Math.ceil(t), e = Math.ceil(e), t === this.width && e === this.height || (this.valid = t > 0 && e > 0, this.width = t, this.height = e, this.realWidth = this.width * this.resolution, this.realHeight = this.height * this.resolution, this.valid && this.emit("update", this));
          }, e.prototype.destroy = function () {
            t.prototype.destroy.call(this, !0), this.renderer = null;
          }, e;
        }(u["default"]);
      r["default"] = c;
    }, {
      "../settings": 101,
      "./BaseTexture": 112
    }],
    112: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../utils"),
        u = t("../settings"),
        h = n(u),
        l = t("eventemitter3"),
        c = n(l),
        d = t("../utils/determineCrossOrigin"),
        f = n(d),
        p = t("bit-twiddle"),
        v = n(p),
        g = function (t) {
          function e(r, n, s) {
            i(this, e);
            var u = o(this, t.call(this));
            return u.uid = (0, a.uid)(), u.touched = 0, u.resolution = s || h["default"].RESOLUTION, u.width = 100, u.height = 100, u.realWidth = 100, u.realHeight = 100, u.scaleMode = void 0 !== n ? n : h["default"].SCALE_MODE, u.hasLoaded = !1, u.isLoading = !1, u.source = null, u.origSource = null, u.imageType = null, u.sourceScale = 1, u.premultipliedAlpha = !0, u.imageUrl = null, u.isPowerOfTwo = !1, u.mipmap = h["default"].MIPMAP_TEXTURES, u.wrapMode = h["default"].WRAP_MODE, u._glTextures = {}, u._enabled = 0, u._virtalBoundId = -1, u._destroyed = !1, u.textureCacheIds = [], r && u.loadSource(r), u;
          }
          return s(e, t), e.prototype.update = function () {
            "svg" !== this.imageType && (this.realWidth = this.source.naturalWidth || this.source.videoWidth || this.source.width, this.realHeight = this.source.naturalHeight || this.source.videoHeight || this.source.height, this._updateDimensions()), this.emit("update", this);
          }, e.prototype._updateDimensions = function () {
            this.width = this.realWidth / this.resolution, this.height = this.realHeight / this.resolution, this.isPowerOfTwo = v["default"].isPow2(this.realWidth) && v["default"].isPow2(this.realHeight);
          }, e.prototype.loadSource = function (t) {
            var e = this.isLoading;
            this.hasLoaded = !1, this.isLoading = !1, e && this.source && (this.source.onload = null, this.source.onerror = null);
            var r = !this.source;
            if (this.source = t, (t.src && t.complete || t.getContext) && t.width && t.height) this._updateImageType(), "svg" === this.imageType ? this._loadSvgSource() : this._sourceLoaded(), r && this.emit("loaded", this);
            else if (!t.getContext) {
              this.isLoading = !0;
              var n = this;
              if (t.onload = function () {
                  if (n._updateImageType(), t.onload = null, t.onerror = null, n.isLoading) {
                    if (n.isLoading = !1, n._sourceLoaded(), "svg" === n.imageType) return void n._loadSvgSource();
                    n.emit("loaded", n);
                  }
                }, t.onerror = function () {
                  t.onload = null, t.onerror = null, n.isLoading && (n.isLoading = !1, n.emit("error", n));
                }, t.complete && t.src) {
                if (t.onload = null, t.onerror = null, "svg" === n.imageType) return void n._loadSvgSource();
                this.isLoading = !1, t.width && t.height ? (this._sourceLoaded(), e && this.emit("loaded", this)) : e && this.emit("error", this);
              }
            }
          }, e.prototype._updateImageType = function () {
            if (this.imageUrl) {
              var t = (0, a.decomposeDataUri)(this.imageUrl),
                e = void 0;
              if (t && "image" === t.mediaType) {
                var r = t.subType.split("+")[0];
                if (!(e = (0, a.getUrlFileExtension)("." + r))) throw new Error("Invalid image type in data URI.");
              } else(e = (0, a.getUrlFileExtension)(this.imageUrl)) || (e = "png");
              this.imageType = e;
            }
          }, e.prototype._loadSvgSource = function () {
            if ("svg" === this.imageType) {
              var t = (0, a.decomposeDataUri)(this.imageUrl);
              t ? this._loadSvgSourceUsingDataUri(t) : this._loadSvgSourceUsingXhr();
            }
          }, e.prototype._loadSvgSourceUsingDataUri = function (t) {
            var e = void 0;
            if ("base64" === t.encoding) {
              if (!atob) throw new Error("Your browser doesn't support base64 conversions.");
              e = atob(t.data);
            } else e = t.data;
            this._loadSvgSourceUsingString(e);
          }, e.prototype._loadSvgSourceUsingXhr = function () {
            var t = this,
              e = new XMLHttpRequest();
            e.onload = function () {
              if (e.readyState !== e.DONE || 200 !== e.status) throw new Error("Failed to load SVG using XHR.");
              t._loadSvgSourceUsingString(e.response);
            }, e.onerror = function () {
              return t.emit("error", t);
            }, e.open("GET", this.imageUrl, !0), e.send();
          }, e.prototype._loadSvgSourceUsingString = function (t) {
            var r = (0, a.getSvgSize)(t),
              n = r.width,
              i = r.height;
            if (!n || !i) throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");
            this.realWidth = Math.round(n * this.sourceScale), this.realHeight = Math.round(i * this.sourceScale), this._updateDimensions();
            var o = document.createElement("canvas");
            o.width = this.realWidth, o.height = this.realHeight, o._pixiId = "canvas_" + (0, a.uid)(), o.getContext("2d").drawImage(this.source, 0, 0, n, i, 0, 0, this.realWidth, this.realHeight), this.origSource = this.source, this.source = o, e.addToCache(this, o._pixiId), this.isLoading = !1, this._sourceLoaded(), this.emit("loaded", this);
          }, e.prototype._sourceLoaded = function () {
            this.hasLoaded = !0, this.update();
          }, e.prototype.destroy = function () {
            this.imageUrl && (delete a.TextureCache[this.imageUrl], this.imageUrl = null, navigator.isCocoonJS || (this.source.src = "")), this.source = null, this.dispose(), e.removeFromCache(this), this.textureCacheIds = null, this._destroyed = !0;
          }, e.prototype.dispose = function () {
            this.emit("dispose", this);
          }, e.prototype.updateSourceImage = function (t) {
            this.source.src = t, this.loadSource(this.source);
          }, e.fromImage = function (t, r, n, i) {
            var o = a.BaseTextureCache[t];
            if (!o) {
              var s = new Image();
              void 0 === r && 0 !== t.indexOf("data:") ? s.crossOrigin = (0, f["default"])(t) : r && (s.crossOrigin = "string" == typeof r ? r : "anonymous"), o = new e(s, n), o.imageUrl = t, i && (o.sourceScale = i), o.resolution = (0, a.getResolutionOfUrl)(t), s.src = t, e.addToCache(o, t);
            }
            return o;
          }, e.fromCanvas = function (t, r) {
            var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "canvas";
            t._pixiId || (t._pixiId = n + "_" + (0, a.uid)());
            var i = a.BaseTextureCache[t._pixiId];
            return i || (i = new e(t, r), e.addToCache(i, t._pixiId)), i;
          }, e.from = function (t, r, n) {
            if ("string" == typeof t) return e.fromImage(t, void 0, r, n);
            if (t instanceof HTMLImageElement) {
              var i = t.src,
                o = a.BaseTextureCache[i];
              return o || (o = new e(t, r), o.imageUrl = i, n && (o.sourceScale = n), o.resolution = (0, a.getResolutionOfUrl)(i), e.addToCache(o, i)), o;
            }
            return t instanceof HTMLCanvasElement ? e.fromCanvas(t, r) : t;
          }, e.addToCache = function (t, e) {
            e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), a.BaseTextureCache[e] = t);
          }, e.removeFromCache = function (t) {
            if ("string" == typeof t) {
              var e = a.BaseTextureCache[t];
              if (e) {
                var r = e.textureCacheIds.indexOf(t);
                return r > -1 && e.textureCacheIds.splice(r, 1), delete a.BaseTextureCache[t], e;
              }
            } else if (t && t.textureCacheIds) {
              for (var n = 0; n < t.textureCacheIds.length; ++n) delete a.BaseTextureCache[t.textureCacheIds[n]];
              return t.textureCacheIds.length = 0, t;
            }
            return null;
          }, e;
        }(c["default"]);
      r["default"] = g;
    }, {
      "../settings": 101,
      "../utils": 125,
      "../utils/determineCrossOrigin": 124,
      "bit-twiddle": 1,
      eventemitter3: 3
    }],
    113: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("./BaseRenderTexture"),
        u = n(a),
        h = t("./Texture"),
        l = n(h),
        c = function (t) {
          function e(r, n) {
            i(this, e);
            var s = null;
            if (!(r instanceof u["default"])) {
              var a = arguments[1],
                h = arguments[2],
                l = arguments[3],
                c = arguments[4];
              console.warn("Please use RenderTexture.create(" + a + ", " + h + ") instead of the ctor directly."), s = arguments[0], n = null, r = new u["default"](a, h, l, c);
            }
            var d = o(this, t.call(this, r, n));
            return d.legacyRenderer = s, d.valid = !0, d._updateUvs(), d;
          }
          return s(e, t), e.prototype.resize = function (t, e, r) {
            t = Math.ceil(t), e = Math.ceil(e), this.valid = t > 0 && e > 0, this._frame.width = this.orig.width = t, this._frame.height = this.orig.height = e, r || this.baseTexture.resize(t, e), this._updateUvs();
          }, e.create = function (t, r, n, i) {
            return new e(new u["default"](t, r, n, i));
          }, e;
        }(l["default"]);
      r["default"] = c;
    }, {
      "./BaseRenderTexture": 111,
      "./Texture": 115
    }],
    114: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("../"),
        s = t("../utils"),
        a = function () {
          function t(e, r) {
            var i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
            n(this, t), this.baseTexture = e, this.textures = {}, this.animations = {}, this.data = r, this.resolution = this._updateResolution(i || this.baseTexture.imageUrl), this._frames = this.data.frames, this._frameKeys = Object.keys(this._frames), this._batchIndex = 0, this._callback = null;
          }
          return i(t, null, [{
            key: "BATCH_SIZE",
            get: function get() {
              return 1e3;
            }
          }]), t.prototype._updateResolution = function (t) {
            var e = this.data.meta.scale,
              r = (0, s.getResolutionOfUrl)(t, null);
            return null === r && (r = void 0 !== e ? parseFloat(e) : 1), 1 !== r && (this.baseTexture.resolution = r, this.baseTexture.update()), r;
          }, t.prototype.parse = function (e) {
            this._batchIndex = 0, this._callback = e, this._frameKeys.length <= t.BATCH_SIZE ? (this._processFrames(0), this._processAnimations(), this._parseComplete()) : this._nextBatch();
          }, t.prototype._processFrames = function (e) {
            for (var r = e, n = t.BATCH_SIZE, i = this.baseTexture.sourceScale; r - e < n && r < this._frameKeys.length;) {
              var s = this._frameKeys[r],
                a = this._frames[s],
                u = a.frame;
              if (u) {
                var h = null,
                  l = null,
                  c = !1 !== a.trimmed && a.sourceSize ? a.sourceSize : a.frame,
                  d = new o.Rectangle(0, 0, Math.floor(c.w * i) / this.resolution, Math.floor(c.h * i) / this.resolution);
                h = a.rotated ? new o.Rectangle(Math.floor(u.x * i) / this.resolution, Math.floor(u.y * i) / this.resolution, Math.floor(u.h * i) / this.resolution, Math.floor(u.w * i) / this.resolution) : new o.Rectangle(Math.floor(u.x * i) / this.resolution, Math.floor(u.y * i) / this.resolution, Math.floor(u.w * i) / this.resolution, Math.floor(u.h * i) / this.resolution), !1 !== a.trimmed && a.spriteSourceSize && (l = new o.Rectangle(Math.floor(a.spriteSourceSize.x * i) / this.resolution, Math.floor(a.spriteSourceSize.y * i) / this.resolution, Math.floor(u.w * i) / this.resolution, Math.floor(u.h * i) / this.resolution)), this.textures[s] = new o.Texture(this.baseTexture, h, d, l, a.rotated ? 2 : 0, a.anchor), o.Texture.addToCache(this.textures[s], s);
              }
              r++;
            }
          }, t.prototype._processAnimations = function () {
            var t = this.data.animations || {};
            for (var e in t) {
              this.animations[e] = [];
              for (var r = t[e], n = Array.isArray(r), i = 0, r = n ? r : r[Symbol.iterator]();;) {
                var o;
                if (n) {
                  if (i >= r.length) break;
                  o = r[i++];
                } else {
                  if (i = r.next(), i.done) break;
                  o = i.value;
                }
                var s = o;
                this.animations[e].push(this.textures[s]);
              }
            }
          }, t.prototype._parseComplete = function () {
            var t = this._callback;
            this._callback = null, this._batchIndex = 0, t.call(this, this.textures);
          }, t.prototype._nextBatch = function () {
            var e = this;
            this._processFrames(this._batchIndex * t.BATCH_SIZE), this._batchIndex++, setTimeout(function () {
              e._batchIndex * t.BATCH_SIZE < e._frameKeys.length ? e._nextBatch() : (e._processAnimations(), e._parseComplete());
            }, 0);
          }, t.prototype.destroy = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
            for (var e in this.textures) this.textures[e].destroy();
            this._frames = null, this._frameKeys = null, this.data = null, this.textures = null, t && this.baseTexture.destroy(), this.baseTexture = null;
          }, t;
        }();
      r["default"] = a;
    }, {
      "../": 65,
      "../utils": 125
    }],
    115: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function a(t) {
        t.destroy = function () {}, t.on = function () {}, t.once = function () {}, t.emit = function () {};
      }
      r.__esModule = !0;
      var u = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        h = t("./BaseTexture"),
        l = n(h),
        c = t("./VideoBaseTexture"),
        d = n(c),
        f = t("./TextureUvs"),
        p = n(f),
        v = t("eventemitter3"),
        g = n(v),
        y = t("../math"),
        m = t("../utils"),
        _ = t("../settings"),
        b = n(_),
        x = function (t) {
          function e(r, n, s, a, u, h) {
            i(this, e);
            var l = o(this, t.call(this));
            if (l.noFrame = !1, n || (l.noFrame = !0, n = new y.Rectangle(0, 0, 1, 1)), r instanceof e && (r = r.baseTexture), l.baseTexture = r, l._frame = n, l.trim = a, l.valid = !1, l.requiresUpdate = !1, l._uvs = null, l.orig = s || n, l._rotate = Number(u || 0), !0 === u) l._rotate = 2;
            else if (l._rotate % 2 != 0) throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");
            return r.hasLoaded ? (l.noFrame && (n = new y.Rectangle(0, 0, r.width, r.height), r.on("update", l.onBaseTextureUpdated, l)), l.frame = n) : r.once("loaded", l.onBaseTextureLoaded, l), l.defaultAnchor = h ? new y.Point(h.x, h.y) : new y.Point(0, 0), l._updateID = 0, l.transform = null, l.textureCacheIds = [], l;
          }
          return s(e, t), e.prototype.update = function () {
            this.baseTexture.update();
          }, e.prototype.onBaseTextureLoaded = function (t) {
            this._updateID++, this.noFrame ? this.frame = new y.Rectangle(0, 0, t.width, t.height) : this.frame = this._frame, this.baseTexture.on("update", this.onBaseTextureUpdated, this), this.emit("update", this);
          }, e.prototype.onBaseTextureUpdated = function (t) {
            this._updateID++, this._frame.width = t.width, this._frame.height = t.height, this.emit("update", this);
          }, e.prototype.destroy = function (t) {
            this.baseTexture && (t && (m.TextureCache[this.baseTexture.imageUrl] && e.removeFromCache(this.baseTexture.imageUrl), this.baseTexture.destroy()), this.baseTexture.off("update", this.onBaseTextureUpdated, this), this.baseTexture.off("loaded", this.onBaseTextureLoaded, this), this.baseTexture = null), this._frame = null, this._uvs = null, this.trim = null, this.orig = null, this.valid = !1, e.removeFromCache(this), this.textureCacheIds = null;
          }, e.prototype.clone = function () {
            return new e(this.baseTexture, this.frame, this.orig, this.trim, this.rotate, this.defaultAnchor);
          }, e.prototype._updateUvs = function () {
            this._uvs || (this._uvs = new p["default"]()), this._uvs.set(this._frame, this.baseTexture, this.rotate), this._updateID++;
          }, e.fromImage = function (t, r, n, i) {
            var o = m.TextureCache[t];
            return o || (o = new e(l["default"].fromImage(t, r, n, i)), e.addToCache(o, t)), o;
          }, e.fromFrame = function (t) {
            var e = m.TextureCache[t];
            if (!e) throw new Error('The frameId "' + t + '" does not exist in the texture cache');
            return e;
          }, e.fromCanvas = function (t, r) {
            var n = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "canvas";
            return new e(l["default"].fromCanvas(t, r, n));
          }, e.fromVideo = function (t, r, n, i) {
            return "string" == typeof t ? e.fromVideoUrl(t, r, n, i) : new e(d["default"].fromVideo(t, r, i));
          }, e.fromVideoUrl = function (t, r, n, i) {
            return new e(d["default"].fromUrl(t, r, n, i));
          }, e.from = function (t) {
            if ("string" == typeof t) {
              var r = m.TextureCache[t];
              if (!r) {
                return null !== t.match(/\.(mp4|webm|ogg|h264|avi|mov)$/) ? e.fromVideoUrl(t) : e.fromImage(t);
              }
              return r;
            }
            return t instanceof HTMLImageElement ? new e(l["default"].from(t)) : t instanceof HTMLCanvasElement ? e.fromCanvas(t, b["default"].SCALE_MODE, "HTMLCanvasElement") : t instanceof HTMLVideoElement ? e.fromVideo(t) : t instanceof l["default"] ? new e(t) : t;
          }, e.fromLoader = function (t, r, n) {
            var i = new l["default"](t, void 0, (0, m.getResolutionOfUrl)(r)),
              o = new e(i);
            return i.imageUrl = r, n || (n = r), l["default"].addToCache(o.baseTexture, n), e.addToCache(o, n), n !== r && (l["default"].addToCache(o.baseTexture, r), e.addToCache(o, r)), o;
          }, e.addToCache = function (t, e) {
            e && (-1 === t.textureCacheIds.indexOf(e) && t.textureCacheIds.push(e), m.TextureCache[e] = t);
          }, e.removeFromCache = function (t) {
            if ("string" == typeof t) {
              var e = m.TextureCache[t];
              if (e) {
                var r = e.textureCacheIds.indexOf(t);
                return r > -1 && e.textureCacheIds.splice(r, 1), delete m.TextureCache[t], e;
              }
            } else if (t && t.textureCacheIds) {
              for (var n = 0; n < t.textureCacheIds.length; ++n) m.TextureCache[t.textureCacheIds[n]] === t && delete m.TextureCache[t.textureCacheIds[n]];
              return t.textureCacheIds.length = 0, t;
            }
            return null;
          }, u(e, [{
            key: "frame",
            get: function get() {
              return this._frame;
            },
            set: function set(t) {
              this._frame = t, this.noFrame = !1;
              var e = t.x,
                r = t.y,
                n = t.width,
                i = t.height,
                o = e + n > this.baseTexture.width,
                s = r + i > this.baseTexture.height;
              if (o || s) {
                var a = o && s ? "and" : "or",
                  u = "X: " + e + " + " + n + " = " + (e + n) + " > " + this.baseTexture.width,
                  h = "Y: " + r + " + " + i + " = " + (r + i) + " > " + this.baseTexture.height;
                throw new Error("Texture Error: frame does not fit inside the base Texture dimensions: " + u + " " + a + " " + h);
              }
              this.valid = n && i && this.baseTexture.hasLoaded, this.trim || this.rotate || (this.orig = t), this.valid && this._updateUvs();
            }
          }, {
            key: "rotate",
            get: function get() {
              return this._rotate;
            },
            set: function set(t) {
              this._rotate = t, this.valid && this._updateUvs();
            }
          }, {
            key: "width",
            get: function get() {
              return this.orig.width;
            }
          }, {
            key: "height",
            get: function get() {
              return this.orig.height;
            }
          }]), e;
        }(g["default"]);
      r["default"] = x, x.EMPTY = new x(new l["default"]()), a(x.EMPTY), a(x.EMPTY.baseTexture), x.WHITE = function () {
        var t = document.createElement("canvas");
        t.width = 10, t.height = 10;
        var e = t.getContext("2d");
        return e.fillStyle = "white", e.fillRect(0, 0, 10, 10), new x(new l["default"](t));
      }(), a(x.WHITE), a(x.WHITE.baseTexture);
    }, {
      "../math": 70,
      "../settings": 101,
      "../utils": 125,
      "./BaseTexture": 112,
      "./TextureUvs": 117,
      "./VideoBaseTexture": 118,
      eventemitter3: 3
    }],
    116: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("../math/Matrix"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = new s["default"](),
        u = function () {
          function t(e, r) {
            n(this, t), this._texture = e, this.mapCoord = new s["default"](), this.uClampFrame = new Float32Array(4), this.uClampOffset = new Float32Array(2), this._lastTextureID = -1, this.clampOffset = 0, this.clampMargin = void 0 === r ? .5 : r;
          }
          return t.prototype.multiplyUvs = function (t, e) {
            void 0 === e && (e = t);
            for (var r = this.mapCoord, n = 0; n < t.length; n += 2) {
              var i = t[n],
                o = t[n + 1];
              e[n] = i * r.a + o * r.c + r.tx, e[n + 1] = i * r.b + o * r.d + r.ty;
            }
            return e;
          }, t.prototype.update = function (t) {
            var e = this._texture;
            if (!e || !e.valid) return !1;
            if (!t && this._lastTextureID === e._updateID) return !1;
            this._lastTextureID = e._updateID;
            var r = e._uvs;
            this.mapCoord.set(r.x1 - r.x0, r.y1 - r.y0, r.x3 - r.x0, r.y3 - r.y0, r.x0, r.y0);
            var n = e.orig,
              i = e.trim;
            i && (a.set(n.width / i.width, 0, 0, n.height / i.height, -i.x / i.width, -i.y / i.height), this.mapCoord.append(a));
            var o = e.baseTexture,
              s = this.uClampFrame,
              u = this.clampMargin / o.resolution,
              h = this.clampOffset;
            return s[0] = (e._frame.x + u + h) / o.width, s[1] = (e._frame.y + u + h) / o.height, s[2] = (e._frame.x + e._frame.width - u + h) / o.width, s[3] = (e._frame.y + e._frame.height - u + h) / o.height, this.uClampOffset[0] = h / o.realWidth, this.uClampOffset[1] = h / o.realHeight, !0;
          }, i(t, [{
            key: "texture",
            get: function get() {
              return this._texture;
            },
            set: function set(t) {
              this._texture = t, this._lastTextureID = -1;
            }
          }]), t;
        }();
      r["default"] = u;
    }, {
      "../math/Matrix": 67
    }],
    117: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../math/GroupD8"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = function () {
          function t() {
            n(this, t), this.x0 = 0, this.y0 = 0, this.x1 = 1, this.y1 = 0, this.x2 = 1, this.y2 = 1, this.x3 = 0, this.y3 = 1, this.uvsUint32 = new Uint32Array(4);
          }
          return t.prototype.set = function (t, e, r) {
            var n = e.width,
              i = e.height;
            if (r) {
              var s = t.width / 2 / n,
                a = t.height / 2 / i,
                u = t.x / n + s,
                h = t.y / i + a;
              r = o["default"].add(r, o["default"].NW), this.x0 = u + s * o["default"].uX(r), this.y0 = h + a * o["default"].uY(r), r = o["default"].add(r, 2), this.x1 = u + s * o["default"].uX(r), this.y1 = h + a * o["default"].uY(r), r = o["default"].add(r, 2), this.x2 = u + s * o["default"].uX(r), this.y2 = h + a * o["default"].uY(r), r = o["default"].add(r, 2), this.x3 = u + s * o["default"].uX(r), this.y3 = h + a * o["default"].uY(r);
            } else this.x0 = t.x / n, this.y0 = t.y / i, this.x1 = (t.x + t.width) / n, this.y1 = t.y / i, this.x2 = (t.x + t.width) / n, this.y2 = (t.y + t.height) / i, this.x3 = t.x / n, this.y3 = (t.y + t.height) / i;
            this.uvsUint32[0] = (65535 & Math.round(65535 * this.y0)) << 16 | 65535 & Math.round(65535 * this.x0), this.uvsUint32[1] = (65535 & Math.round(65535 * this.y1)) << 16 | 65535 & Math.round(65535 * this.x1), this.uvsUint32[2] = (65535 & Math.round(65535 * this.y2)) << 16 | 65535 & Math.round(65535 * this.x2), this.uvsUint32[3] = (65535 & Math.round(65535 * this.y3)) << 16 | 65535 & Math.round(65535 * this.x3);
          }, t;
        }();
      r["default"] = s;
    }, {
      "../math/GroupD8": 66
    }],
    118: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function a(t, e) {
        if (!e) {
          var r = t.split("?").shift().toLowerCase();
          e = "video/" + r.substr(r.lastIndexOf(".") + 1);
        }
        var n = document.createElement("source");
        return n.src = t, n.type = e, n;
      }
      r.__esModule = !0;
      var u = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        h = t("./BaseTexture"),
        l = n(h),
        c = t("../utils"),
        d = t("../ticker"),
        f = t("../const"),
        p = t("../utils/determineCrossOrigin"),
        v = n(p),
        g = function (t) {
          function e(r, n) {
            var s = !(arguments.length > 2 && void 0 !== arguments[2]) || arguments[2];
            if (i(this, e), !r) throw new Error("No video source element specified.");
            (r.readyState === r.HAVE_ENOUGH_DATA || r.readyState === r.HAVE_FUTURE_DATA) && r.width && r.height && (r.complete = !0);
            var a = o(this, t.call(this, r, n));
            return a.width = r.videoWidth, a.height = r.videoHeight, a._autoUpdate = !0, a._isAutoUpdating = !1, a.autoPlay = s, a.update = a.update.bind(a), a._onCanPlay = a._onCanPlay.bind(a), r.addEventListener("play", a._onPlayStart.bind(a)), r.addEventListener("pause", a._onPlayStop.bind(a)), a.hasLoaded = !1, a.__loaded = !1, a._isSourceReady() ? a._onCanPlay() : (r.addEventListener("canplay", a._onCanPlay), r.addEventListener("canplaythrough", a._onCanPlay)), a;
          }
          return s(e, t), e.prototype._isSourcePlaying = function () {
            var t = this.source;
            return t.currentTime > 0 && !1 === t.paused && !1 === t.ended && t.readyState > 2;
          }, e.prototype._isSourceReady = function () {
            return 3 === this.source.readyState || 4 === this.source.readyState;
          }, e.prototype._onPlayStart = function () {
            this.hasLoaded || this._onCanPlay(), !this._isAutoUpdating && this.autoUpdate && (d.shared.add(this.update, this, f.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0);
          }, e.prototype._onPlayStop = function () {
            this._isAutoUpdating && (d.shared.remove(this.update, this), this._isAutoUpdating = !1);
          }, e.prototype._onCanPlay = function () {
            this.hasLoaded = !0, this.source && (this.source.removeEventListener("canplay", this._onCanPlay), this.source.removeEventListener("canplaythrough", this._onCanPlay), this.width = this.source.videoWidth, this.height = this.source.videoHeight, this.__loaded || (this.__loaded = !0, this.emit("loaded", this)), this._isSourcePlaying() ? this._onPlayStart() : this.autoPlay && this.source.play());
          }, e.prototype.destroy = function () {
            this._isAutoUpdating && d.shared.remove(this.update, this), this.source && this.source._pixiId && (l["default"].removeFromCache(this.source._pixiId), delete this.source._pixiId, this.source.pause(), this.source.src = "", this.source.load()), t.prototype.destroy.call(this);
          }, e.fromVideo = function (t, r, n) {
            t._pixiId || (t._pixiId = "video_" + (0, c.uid)());
            var i = c.BaseTextureCache[t._pixiId];
            return i || (i = new e(t, r, n), l["default"].addToCache(i, t._pixiId)), i;
          }, e.fromUrl = function (t, r, n, i) {
            var o = document.createElement("video");
            o.setAttribute("webkit-playsinline", ""), o.setAttribute("playsinline", "");
            var s = Array.isArray(t) ? t[0].src || t[0] : t.src || t;
            if (void 0 === n && 0 !== s.indexOf("data:") ? o.crossOrigin = (0, v["default"])(s) : n && (o.crossOrigin = "string" == typeof n ? n : "anonymous"), Array.isArray(t))
              for (var u = 0; u < t.length; ++u) o.appendChild(a(t[u].src || t[u], t[u].mime));
            else o.appendChild(a(s, t.mime));
            return o.load(), e.fromVideo(o, r, i);
          }, u(e, [{
            key: "autoUpdate",
            get: function get() {
              return this._autoUpdate;
            },
            set: function set(t) {
              t !== this._autoUpdate && (this._autoUpdate = t, !this._autoUpdate && this._isAutoUpdating ? (d.shared.remove(this.update, this), this._isAutoUpdating = !1) : this._autoUpdate && !this._isAutoUpdating && (d.shared.add(this.update, this, f.UPDATE_PRIORITY.HIGH), this._isAutoUpdating = !0));
            }
          }]), e;
        }(l["default"]);
      r["default"] = g, g.fromUrls = g.fromUrl;
    }, {
      "../const": 46,
      "../ticker": 121,
      "../utils": 125,
      "../utils/determineCrossOrigin": 124,
      "./BaseTexture": 112
    }],
    119: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        s = t("../settings"),
        a = n(s),
        u = t("../const"),
        h = t("./TickerListener"),
        l = n(h),
        c = function () {
          function t() {
            var e = this;
            i(this, t), this._head = new l["default"](null, null, 1 / 0), this._requestId = null, this._maxElapsedMS = 100, this.autoStart = !1, this.deltaTime = 1, this.elapsedMS = 1 / a["default"].TARGET_FPMS, this.lastTime = -1, this.speed = 1, this.started = !1, this._tick = function (t) {
              e._requestId = null, e.started && (e.update(t), e.started && null === e._requestId && e._head.next && (e._requestId = requestAnimationFrame(e._tick)));
            };
          }
          return t.prototype._requestIfNeeded = function () {
            null === this._requestId && this._head.next && (this.lastTime = performance.now(), this._requestId = requestAnimationFrame(this._tick));
          }, t.prototype._cancelIfNeeded = function () {
            null !== this._requestId && (cancelAnimationFrame(this._requestId), this._requestId = null);
          }, t.prototype._startIfPossible = function () {
            this.started ? this._requestIfNeeded() : this.autoStart && this.start();
          }, t.prototype.add = function (t, e) {
            var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : u.UPDATE_PRIORITY.NORMAL;
            return this._addListener(new l["default"](t, e, r));
          }, t.prototype.addOnce = function (t, e) {
            var r = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : u.UPDATE_PRIORITY.NORMAL;
            return this._addListener(new l["default"](t, e, r, !0));
          }, t.prototype._addListener = function (t) {
            var e = this._head.next,
              r = this._head;
            if (e) {
              for (; e;) {
                if (t.priority > e.priority) {
                  t.connect(r);
                  break;
                }
                r = e, e = e.next;
              }
              t.previous || t.connect(r);
            } else t.connect(r);
            return this._startIfPossible(), this;
          }, t.prototype.remove = function (t, e) {
            for (var r = this._head.next; r;) r = r.match(t, e) ? r.destroy() : r.next;
            return this._head.next || this._cancelIfNeeded(), this;
          }, t.prototype.start = function () {
            this.started || (this.started = !0, this._requestIfNeeded());
          }, t.prototype.stop = function () {
            this.started && (this.started = !1, this._cancelIfNeeded());
          }, t.prototype.destroy = function () {
            this.stop();
            for (var t = this._head.next; t;) t = t.destroy(!0);
            this._head.destroy(), this._head = null;
          }, t.prototype.update = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : performance.now(),
              e = void 0;
            if (t > this.lastTime) {
              e = this.elapsedMS = t - this.lastTime, e > this._maxElapsedMS && (e = this._maxElapsedMS), this.deltaTime = e * a["default"].TARGET_FPMS * this.speed;
              for (var r = this._head, n = r.next; n;) n = n.emit(this.deltaTime);
              r.next || this._cancelIfNeeded();
            } else this.deltaTime = this.elapsedMS = 0;
            this.lastTime = t;
          }, o(t, [{
            key: "FPS",
            get: function get() {
              return 1e3 / this.elapsedMS;
            }
          }, {
            key: "minFPS",
            get: function get() {
              return 1e3 / this._maxElapsedMS;
            },
            set: function set(t) {
              var e = Math.min(Math.max(0, t) / 1e3, a["default"].TARGET_FPMS);
              this._maxElapsedMS = 1 / e;
            }
          }]), t;
        }();
      r["default"] = c;
    }, {
      "../const": 46,
      "../settings": 101,
      "./TickerListener": 120
    }],
    120: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e) {
          var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null,
            i = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 0,
            o = arguments.length > 3 && void 0 !== arguments[3] && arguments[3];
          n(this, t), this.fn = e, this.context = r, this.priority = i, this.once = o, this.next = null, this.previous = null, this._destroyed = !1;
        }
        return t.prototype.match = function (t, e) {
          return e = e || null, this.fn === t && this.context === e;
        }, t.prototype.emit = function (t) {
          this.fn && (this.context ? this.fn.call(this.context, t) : this.fn(t));
          var e = this.next;
          return this.once && this.destroy(!0), this._destroyed && (this.next = null), e;
        }, t.prototype.connect = function (t) {
          this.previous = t, t.next && (t.next.previous = this), this.next = t.next, t.next = this;
        }, t.prototype.destroy = function () {
          var t = arguments.length > 0 && void 0 !== arguments[0] && arguments[0];
          this._destroyed = !0, this.fn = null, this.context = null, this.previous && (this.previous.next = this.next), this.next && (this.next.previous = this.previous);
          var e = this.next;
          return this.next = t ? null : e, this.previous = null, e;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    121: [function (t, e, r) {
      "use strict";

      r.__esModule = !0, r.Ticker = r.shared = void 0;
      var n = t("./Ticker"),
        i = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(n),
        o = new i["default"]();
      o.autoStart = !0, o.destroy = function () {}, r.shared = o, r.Ticker = i["default"];
    }, {
      "./Ticker": 119
    }],
    122: [function (t, e, r) {
      "use strict";

      function n() {
        return !(!!navigator.platform && /iPad|iPhone|iPod/.test(navigator.platform));
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    123: [function (t, e, r) {
      "use strict";

      function n(t) {
        for (var e = 6 * t, r = new Uint16Array(e), n = 0, i = 0; n < e; n += 6, i += 4) r[n + 0] = i + 0, r[n + 1] = i + 1, r[n + 2] = i + 2, r[n + 3] = i + 0, r[n + 4] = i + 2, r[n + 5] = i + 3;
        return r;
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    124: [function (t, e, r) {
      "use strict";

      function n(t) {
        var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : window.location;
        if (0 === t.indexOf("data:")) return "";
        e = e || window.location, s || (s = document.createElement("a")), s.href = t, t = o["default"].parse(s.href);
        var r = !t.port && "" === e.port || t.port === e.port;
        return t.hostname === e.hostname && r && t.protocol === e.protocol ? "" : "anonymous";
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("url"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i),
        s = void 0;
    }, {
      url: 38
    }],
    125: [function (t, e, r) {
      "use strict";

      function n(t) {
        if (t && t.__esModule) return t;
        var e = {};
        if (null != t)
          for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
        return e["default"] = t, e;
      }

      function i(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function o() {
        return ++U;
      }

      function s(t, e) {
        return e = e || [], e[0] = (t >> 16 & 255) / 255, e[1] = (t >> 8 & 255) / 255, e[2] = (255 & t) / 255, e;
      }

      function a(t) {
        return t = t.toString(16), "#" + (t = "000000".substr(0, 6 - t.length) + t);
      }

      function u(t) {
        return (255 * t[0] << 16) + (255 * t[1] << 8) + (255 * t[2] | 0);
      }

      function h(t, e) {
        var r = S["default"].RETINA_PREFIX.exec(t);
        return r ? parseFloat(r[1]) : void 0 !== e ? e : 1;
      }

      function l(t) {
        var e = w.DATA_URI.exec(t);
        if (e) return {
          mediaType: e[1] ? e[1].toLowerCase() : void 0,
          subType: e[2] ? e[2].toLowerCase() : void 0,
          charset: e[3] ? e[3].toLowerCase() : void 0,
          encoding: e[4] ? e[4].toLowerCase() : void 0,
          data: e[5]
        };
      }

      function c(t) {
        var e = w.URL_FILE_EXTENSION.exec(t);
        if (e) return e[1].toLowerCase();
      }

      function d(t) {
        var e = w.SVG_SIZE.exec(t),
          r = {};
        return e && (r[e[1]] = Math.round(parseFloat(e[3])), r[e[5]] = Math.round(parseFloat(e[7]))), r;
      }

      function f() {
        X = !0;
      }

      function p(t) {
        if (!X) {
          if (navigator.userAgent.toLowerCase().indexOf("chrome") > -1) {
            var e = ["\n %c %c %c PixiJS " + w.VERSION + " - ✰ " + t + " ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n", "background: #ff66a5; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff66a5; background: #030307; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "background: #ffc3dc; padding:5px 0;", "background: #ff66a5; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;", "color: #ff2424; background: #fff; padding:5px 0;"];
            window.console.log.apply(console, e);
          } else window.console && window.console.log("PixiJS " + w.VERSION + " - " + t + " - http://www.pixijs.com/");
          X = !0;
        }
      }

      function v() {
        var t = {
          stencil: !0
        };
        try {
          if (!window.WebGLRenderingContext) return !1;
          var e = document.createElement("canvas"),
            r = e.getContext("webgl", t) || e.getContext("experimental-webgl", t),
            n = !!r;
          if (r) {
            var i = r.getExtension("WEBGL_lose_context");
            i && i.loseContext();
          }
          return r = null, n;
        } catch (t) {
          return !1;
        }
      }

      function g(t) {
        return 0 === t ? 0 : t < 0 ? -1 : 1;
      }

      function y() {
        var t = void 0;
        for (t in G) G[t].destroy();
        for (t in W) W[t].destroy();
      }

      function m() {
        var t = void 0;
        for (t in G) delete G[t];
        for (t in W) delete W[t];
      }

      function _(t, e) {
        return H[e ? 1 : 0][t];
      }

      function b(t, e) {
        if (1 === e) return (255 * e << 24) + t;
        if (0 === e) return 0;
        var r = t >> 16 & 255,
          n = t >> 8 & 255,
          i = 255 & t;
        return r = r * e + .5 | 0, n = n * e + .5 | 0, i = i * e + .5 | 0, (255 * e << 24) + (r << 16) + (n << 8) + i;
      }

      function x(t, e, r, n) {
        return r = r || new Float32Array(4), n || void 0 === n ? (r[0] = t[0] * e, r[1] = t[1] * e, r[2] = t[2] * e) : (r[0] = t[0], r[1] = t[1], r[2] = t[2]), r[3] = e, r;
      }

      function T(t, e, r, n) {
        return r = r || new Float32Array(4), r[0] = (t >> 16 & 255) / 255, r[1] = (t >> 8 & 255) / 255, r[2] = (255 & t) / 255, (n || void 0 === n) && (r[0] *= e, r[1] *= e, r[2] *= e), r[3] = e, r;
      }
      r.__esModule = !0, r.premultiplyBlendMode = r.BaseTextureCache = r.TextureCache = r.earcut = r.mixins = r.pluginTarget = r.EventEmitter = r.removeItems = r.isMobile = void 0, r.uid = o, r.hex2rgb = s, r.hex2string = a, r.rgb2hex = u, r.getResolutionOfUrl = h, r.decomposeDataUri = l, r.getUrlFileExtension = c, r.getSvgSize = d, r.skipHello = f, r.sayHello = p, r.isWebGLSupported = v, r.sign = g, r.destroyTextureCache = y, r.clearTextureCache = m, r.correctBlendMode = _, r.premultiplyTint = b, r.premultiplyRgba = x, r.premultiplyTintToRgba = T;
      var w = t("../const"),
        E = t("../settings"),
        S = i(E),
        O = t("eventemitter3"),
        M = i(O),
        P = t("./pluginTarget"),
        C = i(P),
        R = t("./mixin"),
        A = n(R),
        I = t("ismobilejs"),
        D = n(I),
        L = t("remove-array-items"),
        N = i(L),
        B = t("./mapPremultipliedBlendModes"),
        k = i(B),
        F = t("earcut"),
        j = i(F),
        U = 0,
        X = !1;
      r.isMobile = D, r.removeItems = N["default"], r.EventEmitter = M["default"], r.pluginTarget = C["default"], r.mixins = A, r.earcut = j["default"];
      var G = r.TextureCache = Object.create(null),
        W = r.BaseTextureCache = Object.create(null),
        H = r.premultiplyBlendMode = (0, k["default"])();
    }, {
      "../const": 46,
      "../settings": 101,
      "./mapPremultipliedBlendModes": 126,
      "./mixin": 128,
      "./pluginTarget": 129,
      earcut: 2,
      eventemitter3: 3,
      ismobilejs: 4,
      "remove-array-items": 31
    }],
    126: [function (t, e, r) {
      "use strict";

      function n() {
        for (var t = [], e = [], r = 0; r < 32; r++) t[r] = r, e[r] = r;
        t[i.BLEND_MODES.NORMAL_NPM] = i.BLEND_MODES.NORMAL, t[i.BLEND_MODES.ADD_NPM] = i.BLEND_MODES.ADD, t[i.BLEND_MODES.SCREEN_NPM] = i.BLEND_MODES.SCREEN, e[i.BLEND_MODES.NORMAL] = i.BLEND_MODES.NORMAL_NPM, e[i.BLEND_MODES.ADD] = i.BLEND_MODES.ADD_NPM, e[i.BLEND_MODES.SCREEN] = i.BLEND_MODES.SCREEN_NPM;
        var n = [];
        return n.push(e), n.push(t), n;
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("../const");
    }, {
      "../const": 46
    }],
    127: [function (t, e, r) {
      "use strict";

      function n(t) {
        return o["default"].tablet || o["default"].phone ? 4 : t;
      }
      r.__esModule = !0, r["default"] = n;
      var i = t("ismobilejs"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i);
    }, {
      ismobilejs: 4
    }],
    128: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (t && e)
          for (var r = Object.keys(e), n = 0; n < r.length; ++n) {
            var i = r[n];
            Object.defineProperty(t, i, Object.getOwnPropertyDescriptor(e, i));
          }
      }

      function i(t, e) {
        s.push(t, e);
      }

      function o() {
        for (var t = 0; t < s.length; t += 2) n(s[t], s[t + 1]);
        s.length = 0;
      }
      r.__esModule = !0, r.mixin = n, r.delayMixin = i, r.performMixins = o;
      var s = [];
    }, {}],
    129: [function (t, e, r) {
      "use strict";

      function n(t) {
        t.__plugins = {}, t.registerPlugin = function (e, r) {
          t.__plugins[e] = r;
        }, t.prototype.initPlugins = function () {
          this.plugins = this.plugins || {};
          for (var e in t.__plugins) this.plugins[e] = new t.__plugins[e](this);
        }, t.prototype.destroyPlugins = function () {
          for (var t in this.plugins) this.plugins[t].destroy(), this.plugins[t] = null;
          this.plugins = null;
        };
      }
      r.__esModule = !0, r["default"] = {
        mixin: function mixin(t) {
          n(t);
        }
      };
    }, {}],
    130: [function (t, e, r) {
      "use strict";

      function n(t) {
        var e = t.width,
          r = t.height,
          n = t.getContext("2d"),
          i = n.getImageData(0, 0, e, r),
          o = i.data,
          s = o.length,
          a = {
            top: null,
            left: null,
            right: null,
            bottom: null
          },
          u = null,
          h = void 0,
          l = void 0,
          c = void 0;
        for (h = 0; h < s; h += 4) 0 !== o[h + 3] && (l = h / 4 % e, c = ~~(h / 4 / e), null === a.top && (a.top = c), null === a.left ? a.left = l : l < a.left && (a.left = l), null === a.right ? a.right = l + 1 : a.right < l && (a.right = l + 1), null === a.bottom ? a.bottom = c : a.bottom < c && (a.bottom = c));
        return null !== a.top && (e = a.right - a.left, r = a.bottom - a.top + 1, u = n.getImageData(a.left, a.top, e, r)), {
          height: r,
          width: e,
          data: u
        };
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    131: [function (t, e, r) {
      "use strict";

      function n(t) {
        if (!o[t]) {
          var e = new Error().stack;
          void 0 === e ? console.warn("Deprecation Warning: ", t) : (e = e.split("\n").splice(3).join("\n"), console.groupCollapsed ? (console.groupCollapsed("%cDeprecation Warning: %c%s", "color:#614108;background:#fffbe6", "font-weight:normal;color:#614108;background:#fffbe6", t), console.warn(e), console.groupEnd()) : (console.warn("Deprecation Warning: ", t), console.warn(e))), o[t] = !0;
        }
      }

      function i(t) {
        var e = t.mesh,
          r = t.particles,
          i = t.extras,
          o = t.filters,
          s = t.prepare,
          a = t.loaders,
          u = t.interaction;
        Object.defineProperties(t, {
          SpriteBatch: {
            get: function get() {
              throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.");
            }
          },
          AssetLoader: {
            get: function get() {
              throw new ReferenceError("The loader system was overhauled in PixiJS v3, please see the new PIXI.loaders.Loader class.");
            }
          },
          Stage: {
            get: function get() {
              return n("You do not need to use a PIXI Stage any more, you can simply render any container."), t.Container;
            }
          },
          DisplayObjectContainer: {
            get: function get() {
              return n("DisplayObjectContainer has been shortened to Container, please use Container from now on."), t.Container;
            }
          },
          Strip: {
            get: function get() {
              return n("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."), e.Mesh;
            }
          },
          Rope: {
            get: function get() {
              return n("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."), e.Rope;
            }
          },
          ParticleContainer: {
            get: function get() {
              return n("The ParticleContainer class has been moved to particles.ParticleContainer, please use particles.ParticleContainer from now on."), r.ParticleContainer;
            }
          },
          MovieClip: {
            get: function get() {
              return n("The MovieClip class has been moved to extras.AnimatedSprite, please use extras.AnimatedSprite."), i.AnimatedSprite;
            }
          },
          TilingSprite: {
            get: function get() {
              return n("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."), i.TilingSprite;
            }
          },
          BitmapText: {
            get: function get() {
              return n("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."), i.BitmapText;
            }
          },
          blendModes: {
            get: function get() {
              return n("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."), t.BLEND_MODES;
            }
          },
          scaleModes: {
            get: function get() {
              return n("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."), t.SCALE_MODES;
            }
          },
          BaseTextureCache: {
            get: function get() {
              return n("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."), t.utils.BaseTextureCache;
            }
          },
          TextureCache: {
            get: function get() {
              return n("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."), t.utils.TextureCache;
            }
          },
          math: {
            get: function get() {
              return n("The math namespace is deprecated, please access members already accessible on PIXI."), t;
            }
          },
          AbstractFilter: {
            get: function get() {
              return n("AstractFilter has been renamed to Filter, please use PIXI.Filter"), t.Filter;
            }
          },
          TransformManual: {
            get: function get() {
              return n("TransformManual has been renamed to TransformBase, please update your pixi-spine"), t.TransformBase;
            }
          },
          TARGET_FPMS: {
            get: function get() {
              return n("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), t.settings.TARGET_FPMS;
            },
            set: function set(e) {
              n("PIXI.TARGET_FPMS has been deprecated, please use PIXI.settings.TARGET_FPMS"), t.settings.TARGET_FPMS = e;
            }
          },
          FILTER_RESOLUTION: {
            get: function get() {
              return n("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), t.settings.FILTER_RESOLUTION;
            },
            set: function set(e) {
              n("PIXI.FILTER_RESOLUTION has been deprecated, please use PIXI.settings.FILTER_RESOLUTION"), t.settings.FILTER_RESOLUTION = e;
            }
          },
          RESOLUTION: {
            get: function get() {
              return n("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), t.settings.RESOLUTION;
            },
            set: function set(e) {
              n("PIXI.RESOLUTION has been deprecated, please use PIXI.settings.RESOLUTION"), t.settings.RESOLUTION = e;
            }
          },
          MIPMAP_TEXTURES: {
            get: function get() {
              return n("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), t.settings.MIPMAP_TEXTURES;
            },
            set: function set(e) {
              n("PIXI.MIPMAP_TEXTURES has been deprecated, please use PIXI.settings.MIPMAP_TEXTURES"), t.settings.MIPMAP_TEXTURES = e;
            }
          },
          SPRITE_BATCH_SIZE: {
            get: function get() {
              return n("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), t.settings.SPRITE_BATCH_SIZE;
            },
            set: function set(e) {
              n("PIXI.SPRITE_BATCH_SIZE has been deprecated, please use PIXI.settings.SPRITE_BATCH_SIZE"), t.settings.SPRITE_BATCH_SIZE = e;
            }
          },
          SPRITE_MAX_TEXTURES: {
            get: function get() {
              return n("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), t.settings.SPRITE_MAX_TEXTURES;
            },
            set: function set(e) {
              n("PIXI.SPRITE_MAX_TEXTURES has been deprecated, please use PIXI.settings.SPRITE_MAX_TEXTURES"), t.settings.SPRITE_MAX_TEXTURES = e;
            }
          },
          RETINA_PREFIX: {
            get: function get() {
              return n("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), t.settings.RETINA_PREFIX;
            },
            set: function set(e) {
              n("PIXI.RETINA_PREFIX has been deprecated, please use PIXI.settings.RETINA_PREFIX"), t.settings.RETINA_PREFIX = e;
            }
          },
          DEFAULT_RENDER_OPTIONS: {
            get: function get() {
              return n("PIXI.DEFAULT_RENDER_OPTIONS has been deprecated, please use PIXI.settings.DEFAULT_RENDER_OPTIONS"), t.settings.RENDER_OPTIONS;
            }
          }
        });
        for (var h = [{
            parent: "TRANSFORM_MODE",
            target: "TRANSFORM_MODE"
          }, {
            parent: "GC_MODES",
            target: "GC_MODE"
          }, {
            parent: "WRAP_MODES",
            target: "WRAP_MODE"
          }, {
            parent: "SCALE_MODES",
            target: "SCALE_MODE"
          }, {
            parent: "PRECISION",
            target: "PRECISION_FRAGMENT"
          }], l = 0; l < h.length; l++) ! function (e) {
          var r = h[e];
          Object.defineProperty(t[r.parent], "DEFAULT", {
            get: function get() {
              return n("PIXI." + r.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + r.target), t.settings[r.target];
            },
            set: function set(e) {
              n("PIXI." + r.parent + ".DEFAULT has been deprecated, please use PIXI.settings." + r.target), t.settings[r.target] = e;
            }
          });
        }(l);
        Object.defineProperties(t.settings, {
          PRECISION: {
            get: function get() {
              return n("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), t.settings.PRECISION_FRAGMENT;
            },
            set: function set(e) {
              n("PIXI.settings.PRECISION has been deprecated, please use PIXI.settings.PRECISION_FRAGMENT"), t.settings.PRECISION_FRAGMENT = e;
            }
          }
        }), i.AnimatedSprite && Object.defineProperties(i, {
          MovieClip: {
            get: function get() {
              return n("The MovieClip class has been renamed to AnimatedSprite, please use AnimatedSprite from now on."), i.AnimatedSprite;
            }
          }
        }), i && Object.defineProperties(i, {
          TextureTransform: {
            get: function get() {
              return n("The TextureTransform class has been renamed to TextureMatrix, please use PIXI.TextureMatrix from now on."), t.TextureMatrix;
            }
          }
        }), t.DisplayObject.prototype.generateTexture = function (t, e, r) {
          return n("generateTexture has moved to the renderer, please use renderer.generateTexture(displayObject)"), t.generateTexture(this, e, r);
        }, t.Graphics.prototype.generateTexture = function (t, e) {
          return n("graphics generate texture has moved to the renderer. Or to render a graphics to a texture using canvas please use generateCanvasTexture"), this.generateCanvasTexture(t, e);
        }, t.GroupD8.isSwapWidthHeight = function (e) {
          return n("GroupD8.isSwapWidthHeight was renamed to GroupD8.isVertical"), t.GroupD8.isVertical(e);
        }, t.RenderTexture.prototype.render = function (t, e, r, i) {
          this.legacyRenderer.render(t, this, r, e, !i), n("RenderTexture.render is now deprecated, please use renderer.render(displayObject, renderTexture)");
        }, t.RenderTexture.prototype.getImage = function (t) {
          return n("RenderTexture.getImage is now deprecated, please use renderer.extract.image(target)"), this.legacyRenderer.extract.image(t);
        }, t.RenderTexture.prototype.getBase64 = function (t) {
          return n("RenderTexture.getBase64 is now deprecated, please use renderer.extract.base64(target)"), this.legacyRenderer.extract.base64(t);
        }, t.RenderTexture.prototype.getCanvas = function (t) {
          return n("RenderTexture.getCanvas is now deprecated, please use renderer.extract.canvas(target)"), this.legacyRenderer.extract.canvas(t);
        }, t.RenderTexture.prototype.getPixels = function (t) {
          return n("RenderTexture.getPixels is now deprecated, please use renderer.extract.pixels(target)"), this.legacyRenderer.pixels(t);
        }, t.Sprite.prototype.setTexture = function (t) {
          this.texture = t, n("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;");
        }, i.BitmapText && (i.BitmapText.prototype.setText = function (t) {
          this.text = t, n("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';");
        }), t.Text.prototype.setText = function (t) {
          this.text = t, n("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';");
        }, t.Text.calculateFontProperties = function (e) {
          return n("Text.calculateFontProperties is now deprecated, please use the TextMetrics.measureFont"), t.TextMetrics.measureFont(e);
        }, Object.defineProperties(t.Text, {
          fontPropertiesCache: {
            get: function get() {
              return n("Text.fontPropertiesCache is deprecated"), t.TextMetrics._fonts;
            }
          },
          fontPropertiesCanvas: {
            get: function get() {
              return n("Text.fontPropertiesCanvas is deprecated"), t.TextMetrics._canvas;
            }
          },
          fontPropertiesContext: {
            get: function get() {
              return n("Text.fontPropertiesContext is deprecated"), t.TextMetrics._context;
            }
          }
        }), t.Text.prototype.setStyle = function (t) {
          this.style = t, n("setStyle is now deprecated, please use the style property, e.g : myText.style = style;");
        }, t.Text.prototype.determineFontProperties = function (e) {
          return n("determineFontProperties is now deprecated, please use TextMetrics.measureFont method"), t.TextMetrics.measureFont(e);
        }, t.Text.getFontStyle = function (e) {
          return n("getFontStyle is now deprecated, please use TextStyle.toFontString() instead"), e = e || {}, e instanceof t.TextStyle || (e = new t.TextStyle(e)), e.toFontString();
        }, Object.defineProperties(t.TextStyle.prototype, {
          font: {
            get: function get() {
              n("text style property 'font' is now deprecated, please use the 'fontFamily', 'fontSize', 'fontStyle', 'fontVariant' and 'fontWeight' properties from now on");
              var t = "number" == typeof this._fontSize ? this._fontSize + "px" : this._fontSize;
              return this._fontStyle + " " + this._fontVariant + " " + this._fontWeight + " " + t + " " + this._fontFamily;
            },
            set: function set(t) {
              n("text style property 'font' is now deprecated, please use the 'fontFamily','fontSize',fontStyle','fontVariant' and 'fontWeight' properties from now on"), t.indexOf("italic") > 1 ? this._fontStyle = "italic" : t.indexOf("oblique") > -1 ? this._fontStyle = "oblique" : this._fontStyle = "normal", t.indexOf("small-caps") > -1 ? this._fontVariant = "small-caps" : this._fontVariant = "normal";
              var e = t.split(" "),
                r = -1;
              this._fontSize = 26;
              for (var i = 0; i < e.length; ++i)
                if (e[i].match(/(px|pt|em|%)/)) {
                  r = i, this._fontSize = e[i];
                  break;
                }
              this._fontWeight = "normal";
              for (var o = 0; o < r; ++o)
                if (e[o].match(/(bold|bolder|lighter|100|200|300|400|500|600|700|800|900)/)) {
                  this._fontWeight = e[o];
                  break;
                }
              if (r > -1 && r < e.length - 1) {
                this._fontFamily = "";
                for (var s = r + 1; s < e.length; ++s) this._fontFamily += e[s] + " ";
                this._fontFamily = this._fontFamily.slice(0, -1);
              } else this._fontFamily = "Arial";
              this.styleID++;
            }
          }
        }), t.Texture.prototype.setFrame = function (t) {
          this.frame = t, n("setFrame is now deprecated, please use the frame property, e.g: myTexture.frame = frame;");
        }, t.Texture.addTextureToCache = function (e, r) {
          t.Texture.addToCache(e, r), n("Texture.addTextureToCache is deprecated, please use Texture.addToCache from now on.");
        }, t.Texture.removeTextureFromCache = function (e) {
          return n("Texture.removeTextureFromCache is deprecated, please use Texture.removeFromCache from now on. Be aware that Texture.removeFromCache does not automatically its BaseTexture from the BaseTextureCache. For that, use BaseTexture.removeFromCache"), t.BaseTexture.removeFromCache(e), t.Texture.removeFromCache(e);
        }, Object.defineProperties(o, {
          AbstractFilter: {
            get: function get() {
              return n("AstractFilter has been renamed to Filter, please use PIXI.Filter"), t.AbstractFilter;
            }
          },
          SpriteMaskFilter: {
            get: function get() {
              return n("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."), t.SpriteMaskFilter;
            }
          },
          VoidFilter: {
            get: function get() {
              return n("VoidFilter has been renamed to AlphaFilter, please use PIXI.filters.AlphaFilter"), o.AlphaFilter;
            }
          }
        }), t.utils.uuid = function () {
          return n("utils.uuid() is deprecated, please use utils.uid() from now on."), t.utils.uid();
        }, t.utils.canUseNewCanvasBlendModes = function () {
          return n("utils.canUseNewCanvasBlendModes() is deprecated, please use CanvasTinter.canUseMultiply from now on"), t.CanvasTinter.canUseMultiply;
        };
        var c = !0;
        if (Object.defineProperty(t.utils, "_saidHello", {
            set: function set(t) {
              t && (n("PIXI.utils._saidHello is deprecated, please use PIXI.utils.skipHello()"), this.skipHello()), c = t;
            },
            get: function get() {
              return c;
            }
          }), s.BasePrepare && (s.BasePrepare.prototype.register = function (t, e) {
            return n("renderer.plugins.prepare.register is now deprecated, please use renderer.plugins.prepare.registerFindHook & renderer.plugins.prepare.registerUploadHook"), t && this.registerFindHook(t), e && this.registerUploadHook(e), this;
          }), s.canvas && Object.defineProperty(s.canvas, "UPLOADS_PER_FRAME", {
            set: function set() {
              n("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer");
            },
            get: function get() {
              return n("PIXI.CanvasPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN;
            }
          }), s.webgl && Object.defineProperty(s.webgl, "UPLOADS_PER_FRAME", {
            set: function set() {
              n("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please set renderer.plugins.prepare.limiter.maxItemsPerFrame on your renderer");
            },
            get: function get() {
              return n("PIXI.WebGLPrepare.UPLOADS_PER_FRAME has been removed. Please use renderer.plugins.prepare.limiter"), NaN;
            }
          }), a.Loader) {
          var d = a.Resource,
            f = a.Loader;
          Object.defineProperties(d.prototype, {
            isJson: {
              get: function get() {
                return n("The isJson property is deprecated, please use `resource.type === Resource.TYPE.JSON`."), this.type === d.TYPE.JSON;
              }
            },
            isXml: {
              get: function get() {
                return n("The isXml property is deprecated, please use `resource.type === Resource.TYPE.XML`."), this.type === d.TYPE.XML;
              }
            },
            isImage: {
              get: function get() {
                return n("The isImage property is deprecated, please use `resource.type === Resource.TYPE.IMAGE`."), this.type === d.TYPE.IMAGE;
              }
            },
            isAudio: {
              get: function get() {
                return n("The isAudio property is deprecated, please use `resource.type === Resource.TYPE.AUDIO`."), this.type === d.TYPE.AUDIO;
              }
            },
            isVideo: {
              get: function get() {
                return n("The isVideo property is deprecated, please use `resource.type === Resource.TYPE.VIDEO`."), this.type === d.TYPE.VIDEO;
              }
            }
          }), Object.defineProperties(f.prototype, {
            before: {
              get: function get() {
                return n("The before() method is deprecated, please use pre()."), this.pre;
              }
            },
            after: {
              get: function get() {
                return n("The after() method is deprecated, please use use()."), this.use;
              }
            }
          });
        }
        u.interactiveTarget && Object.defineProperty(u.interactiveTarget, "defaultCursor", {
          set: function set(t) {
            n("Property defaultCursor has been replaced with 'cursor'. "), this.cursor = t;
          },
          get: function get() {
            return n("Property defaultCursor has been replaced with 'cursor'. "), this.cursor;
          }
        }), u.InteractionManager && (Object.defineProperty(u.InteractionManager, "defaultCursorStyle", {
          set: function set(t) {
            n("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles["default"] = t;
          },
          get: function get() {
            return n("Property defaultCursorStyle has been replaced with 'cursorStyles.default'. "), this.cursorStyles["default"];
          }
        }), Object.defineProperty(u.InteractionManager, "currentCursorStyle", {
          set: function set(t) {
            n("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode = t;
          },
          get: function get() {
            return n("Property currentCursorStyle has been removed.See the currentCursorMode property, which works differently."), this.currentCursorMode;
          }
        }));
      }
      r.__esModule = !0, r["default"] = i;
      var o = {};
    }, {}],
    132: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../core"),
        o = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(i),
        s = new o.Rectangle(),
        a = function () {
          function t(e) {
            n(this, t), this.renderer = e, e.extract = this;
          }
          return t.prototype.image = function (t) {
            var e = new Image();
            return e.src = this.base64(t), e;
          }, t.prototype.base64 = function (t) {
            return this.canvas(t).toDataURL();
          }, t.prototype.canvas = function (t) {
            var e = this.renderer,
              r = void 0,
              n = void 0,
              i = void 0,
              a = void 0;
            t && (a = t instanceof o.RenderTexture ? t : e.generateTexture(t)), a ? (r = a.baseTexture._canvasRenderTarget.context, n = a.baseTexture._canvasRenderTarget.resolution, i = a.frame) : (r = e.rootContext, n = e.resolution, i = s, i.width = this.renderer.width, i.height = this.renderer.height);
            var u = i.width * n,
              h = i.height * n,
              l = new o.CanvasRenderTarget(u, h, 1),
              c = r.getImageData(i.x * n, i.y * n, u, h);
            return l.context.putImageData(c, 0, 0), l.canvas;
          }, t.prototype.pixels = function (t) {
            var e = this.renderer,
              r = void 0,
              n = void 0,
              i = void 0,
              a = void 0;
            return t && (a = t instanceof o.RenderTexture ? t : e.generateTexture(t)), a ? (r = a.baseTexture._canvasRenderTarget.context, n = a.baseTexture._canvasRenderTarget.resolution, i = a.frame) : (r = e.rootContext, i = s, i.width = e.width, i.height = e.height), r.getImageData(0, 0, i.width * n, i.height * n).data;
          }, t.prototype.destroy = function () {
            this.renderer.extract = null, this.renderer = null;
          }, t;
        }();
      r["default"] = a, o.CanvasRenderer.registerPlugin("extract", a);
    }, {
      "../../core": 65
    }],
    133: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./webgl/WebGLExtract");
      Object.defineProperty(r, "webgl", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./canvas/CanvasExtract");
      Object.defineProperty(r, "canvas", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
    }, {
      "./canvas/CanvasExtract": 132,
      "./webgl/WebGLExtract": 134
    }],
    134: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../core"),
        o = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(i),
        s = new o.Rectangle(),
        a = function () {
          function t(e) {
            n(this, t), this.renderer = e, e.extract = this;
          }
          return t.prototype.image = function (t) {
            var e = new Image();
            return e.src = this.base64(t), e;
          }, t.prototype.base64 = function (t) {
            return this.canvas(t).toDataURL();
          }, t.prototype.canvas = function (t) {
            var e = this.renderer,
              r = void 0,
              n = void 0,
              i = void 0,
              a = !1,
              u = void 0,
              h = !1;
            t && (t instanceof o.RenderTexture ? u = t : (u = this.renderer.generateTexture(t), h = !0)), u ? (r = u.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID], n = r.resolution, i = u.frame, a = !1) : (r = this.renderer.rootRenderTarget, n = r.resolution, a = !0, i = s, i.width = r.size.width, i.height = r.size.height);
            var l = i.width * n,
              c = i.height * n,
              d = new o.CanvasRenderTarget(l, c, 1);
            if (r) {
              e.bindRenderTarget(r);
              var f = new Uint8Array(4 * l * c),
                p = e.gl;
              p.readPixels(i.x * n, i.y * n, l, c, p.RGBA, p.UNSIGNED_BYTE, f);
              var v = d.context.getImageData(0, 0, l, c);
              v.data.set(f), d.context.putImageData(v, 0, 0), a && (d.context.scale(1, -1), d.context.drawImage(d.canvas, 0, -c));
            }
            return h && u.destroy(!0), d.canvas;
          }, t.prototype.pixels = function (t) {
            var e = this.renderer,
              r = void 0,
              n = void 0,
              i = void 0,
              a = void 0,
              u = !1;
            t && (t instanceof o.RenderTexture ? a = t : (a = this.renderer.generateTexture(t), u = !0)), a ? (r = a.baseTexture._glRenderTargets[this.renderer.CONTEXT_UID], n = r.resolution, i = a.frame) : (r = this.renderer.rootRenderTarget, n = r.resolution, i = s, i.width = r.size.width, i.height = r.size.height);
            var h = i.width * n,
              l = i.height * n,
              c = new Uint8Array(4 * h * l);
            if (r) {
              e.bindRenderTarget(r);
              var d = e.gl;
              d.readPixels(i.x * n, i.y * n, h, l, d.RGBA, d.UNSIGNED_BYTE, c);
            }
            return u && a.destroy(!0), c;
          }, t.prototype.destroy = function () {
            this.renderer.extract = null, this.renderer = null;
          }, t;
        }();
      r["default"] = a, o.WebGLRenderer.registerPlugin("extract", a);
    }, {
      "../../core": 65
    }],
    135: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = function (t) {
          function e(r, o) {
            n(this, e);
            var s = i(this, t.call(this, r[0] instanceof u.Texture ? r[0] : r[0].texture));
            return s._textures = null, s._durations = null, s.textures = r, s._autoUpdate = !1 !== o, s.animationSpeed = 1, s.loop = !0, s.updateAnchor = !1, s.onComplete = null, s.onFrameChange = null, s.onLoop = null, s._currentTime = 0, s.playing = !1, s;
          }
          return o(e, t), e.prototype.stop = function () {
            this.playing && (this.playing = !1, this._autoUpdate && u.ticker.shared.remove(this.update, this));
          }, e.prototype.play = function () {
            this.playing || (this.playing = !0, this._autoUpdate && u.ticker.shared.add(this.update, this, u.UPDATE_PRIORITY.HIGH));
          }, e.prototype.gotoAndStop = function (t) {
            this.stop();
            var e = this.currentFrame;
            this._currentTime = t, e !== this.currentFrame && this.updateTexture();
          }, e.prototype.gotoAndPlay = function (t) {
            var e = this.currentFrame;
            this._currentTime = t, e !== this.currentFrame && this.updateTexture(), this.play();
          }, e.prototype.update = function (t) {
            var e = this.animationSpeed * t,
              r = this.currentFrame;
            if (null !== this._durations) {
              var n = this._currentTime % 1 * this._durations[this.currentFrame];
              for (n += e / 60 * 1e3; n < 0;) this._currentTime--, n += this._durations[this.currentFrame];
              var i = Math.sign(this.animationSpeed * t);
              for (this._currentTime = Math.floor(this._currentTime); n >= this._durations[this.currentFrame];) n -= this._durations[this.currentFrame] * i, this._currentTime += i;
              this._currentTime += n / this._durations[this.currentFrame];
            } else this._currentTime += e;
            this._currentTime < 0 && !this.loop ? (this.gotoAndStop(0), this.onComplete && this.onComplete()) : this._currentTime >= this._textures.length && !this.loop ? (this.gotoAndStop(this._textures.length - 1), this.onComplete && this.onComplete()) : r !== this.currentFrame && (this.loop && this.onLoop && (this.animationSpeed > 0 && this.currentFrame < r ? this.onLoop() : this.animationSpeed < 0 && this.currentFrame > r && this.onLoop()), this.updateTexture());
          }, e.prototype.updateTexture = function () {
            this._texture = this._textures[this.currentFrame], this._textureID = -1, this.cachedTint = 16777215, this.updateAnchor && this._anchor.copy(this._texture.defaultAnchor), this.onFrameChange && this.onFrameChange(this.currentFrame);
          }, e.prototype.destroy = function (e) {
            this.stop(), t.prototype.destroy.call(this, e);
          }, e.fromFrames = function (t) {
            for (var r = [], n = 0; n < t.length; ++n) r.push(u.Texture.fromFrame(t[n]));
            return new e(r);
          }, e.fromImages = function (t) {
            for (var r = [], n = 0; n < t.length; ++n) r.push(u.Texture.fromImage(t[n]));
            return new e(r);
          }, s(e, [{
            key: "totalFrames",
            get: function get() {
              return this._textures.length;
            }
          }, {
            key: "textures",
            get: function get() {
              return this._textures;
            },
            set: function set(t) {
              if (t[0] instanceof u.Texture) this._textures = t, this._durations = null;
              else {
                this._textures = [], this._durations = [];
                for (var e = 0; e < t.length; e++) this._textures.push(t[e].texture), this._durations.push(t[e].time);
              }
              this.gotoAndStop(0), this.updateTexture();
            }
          }, {
            key: "currentFrame",
            get: function get() {
              var t = Math.floor(this._currentTime) % this._textures.length;
              return t < 0 && (t += this._textures.length), t;
            }
          }]), e;
        }(u.Sprite);
      r["default"] = h;
    }, {
      "../core": 65
    }],
    136: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../core"),
        h = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(u),
        l = t("../core/math/ObservablePoint"),
        c = n(l),
        d = t("../core/utils"),
        f = t("../core/settings"),
        p = n(f),
        v = function (t) {
          function e(r) {
            var n = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {};
            i(this, e);
            var s = o(this, t.call(this));
            return s._textWidth = 0, s._textHeight = 0, s._glyphs = [], s._font = {
              tint: void 0 !== n.tint ? n.tint : 16777215,
              align: n.align || "left",
              name: null,
              size: 0
            }, s.font = n.font, s._text = r, s._maxWidth = 0, s._maxLineHeight = 0, s._letterSpacing = 0, s._anchor = new c["default"](function () {
              s.dirty = !0;
            }, s, 0, 0), s.dirty = !1, s.updateText(), s;
          }
          return s(e, t), e.prototype.updateText = function () {
            for (var t = e.fonts[this._font.name], r = this._font.size / t.size, n = new h.Point(), i = [], o = [], s = this.text.replace(/(?:\r\n|\r)/g, "\n"), a = s.length, u = this._maxWidth * t.size / this._font.size, l = null, c = 0, d = 0, f = 0, p = -1, v = 0, g = 0, y = 0, m = 0; m < a; m++) {
              var _ = s.charCodeAt(m),
                b = s.charAt(m);
              if (/(?:\s)/.test(b) && (p = m, v = c), "\r" !== b && "\n" !== b) {
                var x = t.chars[_];
                x && (l && x.kerning[l] && (n.x += x.kerning[l]), i.push({
                  texture: x.texture,
                  line: f,
                  charCode: _,
                  position: new h.Point(n.x + x.xOffset + this._letterSpacing / 2, n.y + x.yOffset)
                }), n.x += x.xAdvance + this._letterSpacing, c = n.x, y = Math.max(y, x.yOffset + x.texture.height), l = _, -1 !== p && u > 0 && n.x > u && (++g, h.utils.removeItems(i, 1 + p - g, 1 + m - p), m = p, p = -1, o.push(v), d = Math.max(d, v), f++, n.x = 0, n.y += t.lineHeight, l = null));
              } else o.push(c), d = Math.max(d, c), ++f, ++g, n.x = 0, n.y += t.lineHeight, l = null;
            }
            var T = s.charAt(s.length - 1);
            "\r" !== T && "\n" !== T && (/(?:\s)/.test(T) && (c = v), o.push(c), d = Math.max(d, c));
            for (var w = [], E = 0; E <= f; E++) {
              var S = 0;
              "right" === this._font.align ? S = d - o[E] : "center" === this._font.align && (S = (d - o[E]) / 2), w.push(S);
            }
            for (var O = i.length, M = this.tint, P = 0; P < O; P++) {
              var C = this._glyphs[P];
              C ? C.texture = i[P].texture : (C = new h.Sprite(i[P].texture), this._glyphs.push(C)), C.position.x = (i[P].position.x + w[i[P].line]) * r, C.position.y = i[P].position.y * r, C.scale.x = C.scale.y = r, C.tint = M, C.parent || this.addChild(C);
            }
            for (var R = O; R < this._glyphs.length; ++R) this.removeChild(this._glyphs[R]);
            if (this._textWidth = d * r, this._textHeight = (n.y + t.lineHeight) * r, 0 !== this.anchor.x || 0 !== this.anchor.y)
              for (var A = 0; A < O; A++) this._glyphs[A].x -= this._textWidth * this.anchor.x, this._glyphs[A].y -= this._textHeight * this.anchor.y;
            this._maxLineHeight = y * r;
          }, e.prototype.updateTransform = function () {
            this.validate(), this.containerUpdateTransform();
          }, e.prototype.getLocalBounds = function () {
            return this.validate(), t.prototype.getLocalBounds.call(this);
          }, e.prototype.validate = function () {
            this.dirty && (this.updateText(), this.dirty = !1);
          }, e.registerFont = function (t, r) {
            var n = {},
              i = t.getElementsByTagName("info")[0],
              o = t.getElementsByTagName("common")[0],
              s = t.getElementsByTagName("page"),
              a = (0, d.getResolutionOfUrl)(s[0].getAttribute("file"), p["default"].RESOLUTION),
              u = {};
            n.font = i.getAttribute("face"), n.size = parseInt(i.getAttribute("size"), 10), n.lineHeight = parseInt(o.getAttribute("lineHeight"), 10) / a, n.chars = {}, r instanceof h.Texture && (r = [r]);
            for (var l = 0; l < s.length; l++) {
              var c = s[l].getAttribute("id"),
                f = s[l].getAttribute("file");
              u[c] = r instanceof Array ? r[l] : r[f];
            }
            for (var v = t.getElementsByTagName("char"), g = 0; g < v.length; g++) {
              var y = v[g],
                m = parseInt(y.getAttribute("id"), 10),
                _ = y.getAttribute("page") || 0,
                b = new h.Rectangle(parseInt(y.getAttribute("x"), 10) / a + u[_].frame.x / a, parseInt(y.getAttribute("y"), 10) / a + u[_].frame.y / a, parseInt(y.getAttribute("width"), 10) / a, parseInt(y.getAttribute("height"), 10) / a);
              n.chars[m] = {
                xOffset: parseInt(y.getAttribute("xoffset"), 10) / a,
                yOffset: parseInt(y.getAttribute("yoffset"), 10) / a,
                xAdvance: parseInt(y.getAttribute("xadvance"), 10) / a,
                kerning: {},
                texture: new h.Texture(u[_].baseTexture, b),
                page: _
              };
            }
            for (var x = t.getElementsByTagName("kerning"), T = 0; T < x.length; T++) {
              var w = x[T],
                E = parseInt(w.getAttribute("first"), 10) / a,
                S = parseInt(w.getAttribute("second"), 10) / a,
                O = parseInt(w.getAttribute("amount"), 10) / a;
              n.chars[S] && (n.chars[S].kerning[E] = O);
            }
            return e.fonts[n.font] = n, n;
          }, a(e, [{
            key: "tint",
            get: function get() {
              return this._font.tint;
            },
            set: function set(t) {
              this._font.tint = "number" == typeof t && t >= 0 ? t : 16777215, this.dirty = !0;
            }
          }, {
            key: "align",
            get: function get() {
              return this._font.align;
            },
            set: function set(t) {
              this._font.align = t || "left", this.dirty = !0;
            }
          }, {
            key: "anchor",
            get: function get() {
              return this._anchor;
            },
            set: function set(t) {
              "number" == typeof t ? this._anchor.set(t) : this._anchor.copy(t);
            }
          }, {
            key: "font",
            get: function get() {
              return this._font;
            },
            set: function set(t) {
              t && ("string" == typeof t ? (t = t.split(" "), this._font.name = 1 === t.length ? t[0] : t.slice(1).join(" "), this._font.size = t.length >= 2 ? parseInt(t[0], 10) : e.fonts[this._font.name].size) : (this._font.name = t.name, this._font.size = "number" == typeof t.size ? t.size : parseInt(t.size, 10)), this.dirty = !0);
            }
          }, {
            key: "text",
            get: function get() {
              return this._text;
            },
            set: function set(t) {
              t = t.toString() || " ", this._text !== t && (this._text = t, this.dirty = !0);
            }
          }, {
            key: "maxWidth",
            get: function get() {
              return this._maxWidth;
            },
            set: function set(t) {
              this._maxWidth !== t && (this._maxWidth = t, this.dirty = !0);
            }
          }, {
            key: "maxLineHeight",
            get: function get() {
              return this.validate(), this._maxLineHeight;
            }
          }, {
            key: "textWidth",
            get: function get() {
              return this.validate(), this._textWidth;
            }
          }, {
            key: "letterSpacing",
            get: function get() {
              return this._letterSpacing;
            },
            set: function set(t) {
              this._letterSpacing !== t && (this._letterSpacing = t, this.dirty = !0);
            }
          }, {
            key: "textHeight",
            get: function get() {
              return this.validate(), this._textHeight;
            }
          }]), e;
        }(h.Container);
      r["default"] = v, v.fonts = {};
    }, {
      "../core": 65,
      "../core/math/ObservablePoint": 68,
      "../core/settings": 101,
      "../core/utils": 125
    }],
    137: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("../core/sprites/canvas/CanvasTinter"),
        l = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(h),
        c = new u.Point(),
        d = function (t) {
          function e(r) {
            var o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 100,
              s = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 100;
            n(this, e);
            var a = i(this, t.call(this, r));
            return a.tileTransform = new u.TransformStatic(), a._width = o, a._height = s, a._canvasPattern = null, a.uvTransform = r.transform || new u.TextureMatrix(r), a.pluginName = "tilingSprite", a.uvRespectAnchor = !1, a;
          }
          return o(e, t), e.prototype._onTextureUpdate = function () {
            this.uvTransform && (this.uvTransform.texture = this._texture), this.cachedTint = 16777215;
          }, e.prototype._renderWebGL = function (t) {
            var e = this._texture;
            e && e.valid && (this.tileTransform.updateLocalTransform(), this.uvTransform.update(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this));
          }, e.prototype._renderCanvas = function (t) {
            var e = this._texture;
            if (e.baseTexture.hasLoaded) {
              var r = t.context,
                n = this.worldTransform,
                i = t.resolution,
                o = 2 === e.rotate,
                s = e.baseTexture,
                a = s.resolution,
                h = this.tilePosition.x / this.tileScale.x % e.orig.width * a,
                c = this.tilePosition.y / this.tileScale.y % e.orig.height * a;
              if (this._textureID !== this._texture._updateID || this.cachedTint !== this.tint) {
                this._textureID = this._texture._updateID;
                var d = new u.CanvasRenderTarget(e.orig.width, e.orig.height, a);
                if (16777215 !== this.tint) this.tintedTexture = l["default"].getTintedTexture(this, this.tint), d.context.drawImage(this.tintedTexture, 0, 0);
                else {
                  var f = e._frame.x * a,
                    p = e._frame.y * a,
                    v = e._frame.width * a,
                    g = e._frame.height * a,
                    y = (e.trim ? e.trim.width : e.orig.width) * a,
                    m = (e.trim ? e.trim.height : e.orig.height) * a,
                    _ = (e.trim ? e.trim.x : 0) * a,
                    b = (e.trim ? e.trim.y : 0) * a;
                  o ? (d.context.rotate(-Math.PI / 2), d.context.translate(-m, 0), d.context.drawImage(s.source, f, p, v, g, -b, _, m, y)) : d.context.drawImage(s.source, f, p, v, g, _, b, y, m);
                }
                this.cachedTint = this.tint, this._canvasPattern = d.context.createPattern(d.canvas, "repeat");
              }
              r.globalAlpha = this.worldAlpha, r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), t.setBlendMode(this.blendMode), r.fillStyle = this._canvasPattern, r.scale(this.tileScale.x / a, this.tileScale.y / a);
              var x = this.anchor.x * -this._width * a,
                T = this.anchor.y * -this._height * a;
              this.uvRespectAnchor ? (r.translate(h, c), r.fillRect(-h + x, -c + T, this._width / this.tileScale.x * a, this._height / this.tileScale.y * a)) : (r.translate(h + x, c + T), r.fillRect(-h, -c, this._width / this.tileScale.x * a, this._height / this.tileScale.y * a));
            }
          }, e.prototype._calculateBounds = function () {
            var t = this._width * -this._anchor._x,
              e = this._height * -this._anchor._y,
              r = this._width * (1 - this._anchor._x),
              n = this._height * (1 - this._anchor._y);
            this._bounds.addFrame(this.transform, t, e, r, n);
          }, e.prototype.getLocalBounds = function (e) {
            return 0 === this.children.length ? (this._bounds.minX = this._width * -this._anchor._x, this._bounds.minY = this._height * -this._anchor._y, this._bounds.maxX = this._width * (1 - this._anchor._x), this._bounds.maxY = this._height * (1 - this._anchor._y), e || (this._localBoundsRect || (this._localBoundsRect = new u.Rectangle()), e = this._localBoundsRect), this._bounds.getRectangle(e)) : t.prototype.getLocalBounds.call(this, e);
          }, e.prototype.containsPoint = function (t) {
            this.worldTransform.applyInverse(t, c);
            var e = this._width,
              r = this._height,
              n = -e * this.anchor._x;
            if (c.x >= n && c.x < n + e) {
              var i = -r * this.anchor._y;
              if (c.y >= i && c.y < i + r) return !0;
            }
            return !1;
          }, e.prototype.destroy = function (e) {
            t.prototype.destroy.call(this, e), this.tileTransform = null, this.uvTransform = null;
          }, e.from = function (t, r, n) {
            return new e(u.Texture.from(t), r, n);
          }, e.fromFrame = function (t, r, n) {
            var i = u.utils.TextureCache[t];
            if (!i) throw new Error('The frameId "' + t + '" does not exist in the texture cache ' + this);
            return new e(i, r, n);
          }, e.fromImage = function (t, r, n, i, o) {
            return new e(u.Texture.fromImage(t, i, o), r, n);
          }, s(e, [{
            key: "clampMargin",
            get: function get() {
              return this.uvTransform.clampMargin;
            },
            set: function set(t) {
              this.uvTransform.clampMargin = t, this.uvTransform.update(!0);
            }
          }, {
            key: "tileScale",
            get: function get() {
              return this.tileTransform.scale;
            },
            set: function set(t) {
              this.tileTransform.scale.copy(t);
            }
          }, {
            key: "tilePosition",
            get: function get() {
              return this.tileTransform.position;
            },
            set: function set(t) {
              this.tileTransform.position.copy(t);
            }
          }, {
            key: "width",
            get: function get() {
              return this._width;
            },
            set: function set(t) {
              this._width = t;
            }
          }, {
            key: "height",
            get: function get() {
              return this._height;
            },
            set: function set(t) {
              this._height = t;
            }
          }]), e;
        }(u.Sprite);
      r["default"] = d;
    }, {
      "../core": 65,
      "../core/sprites/canvas/CanvasTinter": 104
    }],
    138: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      var o = t("../core"),
        s = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(o),
        a = t("../core/textures/Texture"),
        u = n(a),
        h = t("../core/textures/BaseTexture"),
        l = n(h),
        c = t("../core/utils"),
        d = s.DisplayObject,
        f = new s.Matrix();
      d.prototype._cacheAsBitmap = !1, d.prototype._cacheData = !1;
      var p = function t() {
        i(this, t), this.textureCacheId = null, this.originalRenderWebGL = null, this.originalRenderCanvas = null, this.originalCalculateBounds = null, this.originalGetLocalBounds = null, this.originalUpdateTransform = null, this.originalHitTest = null, this.originalDestroy = null, this.originalMask = null, this.originalFilterArea = null, this.sprite = null;
      };
      Object.defineProperties(d.prototype, {
        cacheAsBitmap: {
          get: function get() {
            return this._cacheAsBitmap;
          },
          set: function set(t) {
            if (this._cacheAsBitmap !== t) {
              this._cacheAsBitmap = t;
              var e = void 0;
              t ? (this._cacheData || (this._cacheData = new p()), e = this._cacheData, e.originalRenderWebGL = this.renderWebGL, e.originalRenderCanvas = this.renderCanvas, e.originalUpdateTransform = this.updateTransform, e.originalCalculateBounds = this.calculateBounds, e.originalGetLocalBounds = this.getLocalBounds, e.originalDestroy = this.destroy, e.originalContainsPoint = this.containsPoint, e.originalMask = this._mask, e.originalFilterArea = this.filterArea, this.renderWebGL = this._renderCachedWebGL, this.renderCanvas = this._renderCachedCanvas, this.destroy = this._cacheAsBitmapDestroy) : (e = this._cacheData, e.sprite && this._destroyCachedDisplayObject(), this.renderWebGL = e.originalRenderWebGL, this.renderCanvas = e.originalRenderCanvas, this.calculateBounds = e.originalCalculateBounds, this.getLocalBounds = e.originalGetLocalBounds, this.destroy = e.originalDestroy, this.updateTransform = e.originalUpdateTransform, this.containsPoint = e.originalContainsPoint, this._mask = e.originalMask, this.filterArea = e.originalFilterArea);
            }
          }
        }
      }), d.prototype._renderCachedWebGL = function (t) {
        !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObject(t), this._cacheData.sprite.transform._worldID = this.transform._worldID, this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite._renderWebGL(t));
      }, d.prototype._initCachedDisplayObject = function (t) {
        if (!this._cacheData || !this._cacheData.sprite) {
          var e = this.alpha;
          this.alpha = 1, t.currentRenderer.flush();
          var r = this.getLocalBounds().clone();
          if (this._filters && this._filters.length) {
            var n = this._filters[0].padding;
            r.pad(n);
          }
          r.ceil(s.settings.RESOLUTION);
          var i = t._activeRenderTarget,
            o = t.filterManager.filterStack,
            a = s.RenderTexture.create(r.width, r.height),
            h = "cacheAsBitmap_" + (0, c.uid)();
          this._cacheData.textureCacheId = h, l["default"].addToCache(a.baseTexture, h), u["default"].addToCache(a, h);
          var d = f;
          d.tx = -r.x, d.ty = -r.y, this.transform.worldTransform.identity(), this.renderWebGL = this._cacheData.originalRenderWebGL, t.render(this, a, !0, d, !0), t.bindRenderTarget(i), t.filterManager.filterStack = o, this.renderWebGL = this._renderCachedWebGL, this.updateTransform = this.displayObjectUpdateTransform, this.calculateBounds = this._calculateCachedBounds, this.getLocalBounds = this._getCachedLocalBounds, this._mask = null, this.filterArea = null;
          var p = new s.Sprite(a);
          p.transform.worldTransform = this.transform.worldTransform, p.anchor.x = -r.x / r.width, p.anchor.y = -r.y / r.height, p.alpha = e, p._bounds = this._bounds, this._cacheData.sprite = p, this.transform._parentID = -1, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.containsPoint = p.containsPoint.bind(p);
        }
      }, d.prototype._renderCachedCanvas = function (t) {
        !this.visible || this.worldAlpha <= 0 || !this.renderable || (this._initCachedDisplayObjectCanvas(t), this._cacheData.sprite.worldAlpha = this.worldAlpha, this._cacheData.sprite._renderCanvas(t));
      }, d.prototype._initCachedDisplayObjectCanvas = function (t) {
        if (!this._cacheData || !this._cacheData.sprite) {
          var e = this.getLocalBounds(),
            r = this.alpha;
          this.alpha = 1;
          var n = t.context;
          e.ceil(s.settings.RESOLUTION);
          var i = s.RenderTexture.create(e.width, e.height),
            o = "cacheAsBitmap_" + (0, c.uid)();
          this._cacheData.textureCacheId = o, l["default"].addToCache(i.baseTexture, o), u["default"].addToCache(i, o);
          var a = f;
          this.transform.localTransform.copy(a), a.invert(), a.tx -= e.x, a.ty -= e.y, this.renderCanvas = this._cacheData.originalRenderCanvas, t.render(this, i, !0, a, !1), t.context = n, this.renderCanvas = this._renderCachedCanvas, this.updateTransform = this.displayObjectUpdateTransform, this.calculateBounds = this._calculateCachedBounds, this.getLocalBounds = this._getCachedLocalBounds, this._mask = null, this.filterArea = null;
          var h = new s.Sprite(i);
          h.transform.worldTransform = this.transform.worldTransform, h.anchor.x = -e.x / e.width, h.anchor.y = -e.y / e.height, h.alpha = r, h._bounds = this._bounds, this._cacheData.sprite = h, this.transform._parentID = -1, this.parent ? this.updateTransform() : (this.parent = t._tempDisplayObjectParent, this.updateTransform(), this.parent = null), this.containsPoint = h.containsPoint.bind(h);
        }
      }, d.prototype._calculateCachedBounds = function () {
        this._bounds.clear(), this._cacheData.sprite.transform._worldID = this.transform._worldID, this._cacheData.sprite._calculateBounds(), this._lastBoundsID = this._boundsID;
      }, d.prototype._getCachedLocalBounds = function () {
        return this._cacheData.sprite.getLocalBounds();
      }, d.prototype._destroyCachedDisplayObject = function () {
        this._cacheData.sprite._texture.destroy(!0), this._cacheData.sprite = null, l["default"].removeFromCache(this._cacheData.textureCacheId), u["default"].removeFromCache(this._cacheData.textureCacheId), this._cacheData.textureCacheId = null;
      }, d.prototype._cacheAsBitmapDestroy = function (t) {
        this.cacheAsBitmap = !1, this.destroy(t);
      };
    }, {
      "../core": 65,
      "../core/textures/BaseTexture": 112,
      "../core/textures/Texture": 115,
      "../core/utils": 125
    }],
    139: [function (t, e, r) {
      "use strict";

      var n = t("../core"),
        i = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(n);
      i.DisplayObject.prototype.name = null, i.Container.prototype.getChildByName = function (t) {
        for (var e = 0; e < this.children.length; e++)
          if (this.children[e].name === t) return this.children[e];
        return null;
      };
    }, {
      "../core": 65
    }],
    140: [function (t, e, r) {
      "use strict";

      var n = t("../core"),
        i = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(n);
      i.DisplayObject.prototype.getGlobalPosition = function () {
        var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : new i.Point(),
          e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
        return this.parent ? this.parent.toGlobal(this.position, t, e) : (t.x = this.position.x, t.y = this.position.y), t;
      };
    }, {
      "../core": 65
    }],
    141: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0, r.BitmapText = r.TilingSpriteRenderer = r.TilingSprite = r.AnimatedSprite = void 0;
      var i = t("./AnimatedSprite");
      Object.defineProperty(r, "AnimatedSprite", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./TilingSprite");
      Object.defineProperty(r, "TilingSprite", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./webgl/TilingSpriteRenderer");
      Object.defineProperty(r, "TilingSpriteRenderer", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./BitmapText");
      Object.defineProperty(r, "BitmapText", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      }), t("./cacheAsBitmap"), t("./getChildByName"), t("./getGlobalPosition");
    }, {
      "./AnimatedSprite": 135,
      "./BitmapText": 136,
      "./TilingSprite": 137,
      "./cacheAsBitmap": 138,
      "./getChildByName": 139,
      "./getGlobalPosition": 140,
      "./webgl/TilingSpriteRenderer": 142
    }],
    142: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("../../core"),
        a = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(s),
        u = t("../../core/const"),
        h = (t("path"), new a.Matrix()),
        l = function (t) {
          function e(r) {
            n(this, e);
            var o = i(this, t.call(this, r));
            return o.shader = null, o.simpleShader = null, o.quad = null, o;
          }
          return o(e, t), e.prototype.onContextChange = function () {
            var t = this.renderer.gl;
            this.shader = new a.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = mod(vTextureCoord - uClampOffset, vec2(1.0, 1.0)) + uClampOffset;\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 sample = texture2D(uSampler, coord);\n    gl_FragColor = sample * uColor;\n}\n"), this.simpleShader = new a.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 sample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = sample * uColor;\n}\n"), this.renderer.bindVao(null), this.quad = new a.Quad(t, this.renderer.state.attribState), this.quad.initVao(this.shader);
          }, e.prototype.render = function (t) {
            var e = this.renderer,
              r = this.quad;
            e.bindVao(r.vao);
            var n = r.vertices;
            n[0] = n[6] = t._width * -t.anchor.x, n[1] = n[3] = t._height * -t.anchor.y, n[2] = n[4] = t._width * (1 - t.anchor.x), n[5] = n[7] = t._height * (1 - t.anchor.y), t.uvRespectAnchor && (n = r.uvs, n[0] = n[6] = -t.anchor.x, n[1] = n[3] = -t.anchor.y, n[2] = n[4] = 1 - t.anchor.x, n[5] = n[7] = 1 - t.anchor.y), r.upload();
            var i = t._texture,
              o = i.baseTexture,
              s = t.tileTransform.localTransform,
              l = t.uvTransform,
              c = o.isPowerOfTwo && i.frame.width === o.width && i.frame.height === o.height;
            c && (o._glTextures[e.CONTEXT_UID] ? c = o.wrapMode !== u.WRAP_MODES.CLAMP : o.wrapMode === u.WRAP_MODES.CLAMP && (o.wrapMode = u.WRAP_MODES.REPEAT));
            var d = c ? this.simpleShader : this.shader;
            e.bindShader(d);
            var f = i.width,
              p = i.height,
              v = t._width,
              g = t._height;
            h.set(s.a * f / v, s.b * f / g, s.c * p / v, s.d * p / g, s.tx / v, s.ty / g), h.invert(), c ? h.prepend(l.mapCoord) : (d.uniforms.uMapCoord = l.mapCoord.toArray(!0), d.uniforms.uClampFrame = l.uClampFrame, d.uniforms.uClampOffset = l.uClampOffset), d.uniforms.uTransform = h.toArray(!0), d.uniforms.uColor = a.utils.premultiplyTintToRgba(t.tint, t.worldAlpha, d.uniforms.uColor, o.premultipliedAlpha), d.uniforms.translationMatrix = t.transform.worldTransform.toArray(!0), d.uniforms.uSampler = e.bindTexture(i), e.setBlendMode(a.utils.correctBlendMode(t.blendMode, o.premultipliedAlpha)), r.vao.draw(this.renderer.gl.TRIANGLES, 6, 0);
          }, e;
        }(a.ObjectRenderer);
      r["default"] = l, a.WebGLRenderer.registerPlugin("tilingSprite", l);
    }, {
      "../../core": 65,
      "../../core/const": 46,
      path: 8
    }],
    143: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = (t("path"), function (t) {
          function e() {
            var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;
            n(this, e);
            var o = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n"));
            return o.alpha = r, o.glShaderKey = "alpha", o;
          }
          return o(e, t), s(e, [{
            key: "alpha",
            get: function get() {
              return this.uniforms.uAlpha;
            },
            set: function set(t) {
              this.uniforms.uAlpha = t;
            }
          }]), e;
        }(u.Filter));
      r["default"] = h;
    }, {
      "../../core": 65,
      path: 8
    }],
    144: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../../core"),
        h = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(u),
        l = t("./BlurXFilter"),
        c = n(l),
        d = t("./BlurYFilter"),
        f = n(d),
        p = function (t) {
          function e(r, n, s, a) {
            i(this, e);
            var u = o(this, t.call(this));
            return u.blurXFilter = new c["default"](r, n, s, a), u.blurYFilter = new f["default"](r, n, s, a), u.padding = 0, u.resolution = s || h.settings.RESOLUTION, u.quality = n || 4, u.blur = r || 8, u;
          }
          return s(e, t), e.prototype.apply = function (t, e, r) {
            var n = t.getRenderTarget(!0);
            this.blurXFilter.apply(t, e, n, !0), this.blurYFilter.apply(t, n, r, !1), t.returnRenderTarget(n);
          }, a(e, [{
            key: "blur",
            get: function get() {
              return this.blurXFilter.blur;
            },
            set: function set(t) {
              this.blurXFilter.blur = this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength));
            }
          }, {
            key: "quality",
            get: function get() {
              return this.blurXFilter.quality;
            },
            set: function set(t) {
              this.blurXFilter.quality = this.blurYFilter.quality = t;
            }
          }, {
            key: "blurX",
            get: function get() {
              return this.blurXFilter.blur;
            },
            set: function set(t) {
              this.blurXFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength));
            }
          }, {
            key: "blurY",
            get: function get() {
              return this.blurYFilter.blur;
            },
            set: function set(t) {
              this.blurYFilter.blur = t, this.padding = 2 * Math.max(Math.abs(this.blurXFilter.strength), Math.abs(this.blurYFilter.strength));
            }
          }, {
            key: "blendMode",
            get: function get() {
              return this.blurYFilter._blendMode;
            },
            set: function set(t) {
              this.blurYFilter._blendMode = t;
            }
          }]), e;
        }(h.Filter);
      r["default"] = p;
    }, {
      "../../core": 65,
      "./BlurXFilter": 145,
      "./BlurYFilter": 146
    }],
    145: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../../core"),
        h = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(u),
        l = t("./generateBlurVertSource"),
        c = n(l),
        d = t("./generateBlurFragSource"),
        f = n(d),
        p = t("./getMaxBlurKernelSize"),
        v = n(p),
        g = function (t) {
          function e(r, n, s, a) {
            i(this, e), a = a || 5;
            var u = (0, c["default"])(a, !0),
              l = (0, f["default"])(a),
              d = o(this, t.call(this, u, l));
            return d.resolution = s || h.settings.RESOLUTION, d._quality = 0, d.quality = n || 4, d.strength = r || 8, d.firstRun = !0, d;
          }
          return s(e, t), e.prototype.apply = function (t, e, r, n) {
            if (this.firstRun) {
              var i = t.renderer.gl,
                o = (0, v["default"])(i);
              this.vertexSrc = (0, c["default"])(o, !0), this.fragmentSrc = (0, f["default"])(o), this.firstRun = !1;
            }
            if (this.uniforms.strength = 1 / r.size.width * (r.size.width / e.size.width), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, r, n);
            else {
              for (var s = t.getRenderTarget(!0), a = e, u = s, h = 0; h < this.passes - 1; h++) {
                t.applyFilter(this, a, u, !0);
                var l = u;
                u = a, a = l;
              }
              t.applyFilter(this, a, r, n), t.returnRenderTarget(s);
            }
          }, a(e, [{
            key: "blur",
            get: function get() {
              return this.strength;
            },
            set: function set(t) {
              this.padding = 2 * Math.abs(t), this.strength = t;
            }
          }, {
            key: "quality",
            get: function get() {
              return this._quality;
            },
            set: function set(t) {
              this._quality = t, this.passes = t;
            }
          }]), e;
        }(h.Filter);
      r["default"] = g;
    }, {
      "../../core": 65,
      "./generateBlurFragSource": 147,
      "./generateBlurVertSource": 148,
      "./getMaxBlurKernelSize": 149
    }],
    146: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("../../core"),
        h = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(u),
        l = t("./generateBlurVertSource"),
        c = n(l),
        d = t("./generateBlurFragSource"),
        f = n(d),
        p = t("./getMaxBlurKernelSize"),
        v = n(p),
        g = function (t) {
          function e(r, n, s, a) {
            i(this, e), a = a || 5;
            var u = (0, c["default"])(a, !1),
              l = (0, f["default"])(a),
              d = o(this, t.call(this, u, l));
            return d.resolution = s || h.settings.RESOLUTION, d._quality = 0, d.quality = n || 4, d.strength = r || 8, d.firstRun = !0, d;
          }
          return s(e, t), e.prototype.apply = function (t, e, r, n) {
            if (this.firstRun) {
              var i = t.renderer.gl,
                o = (0, v["default"])(i);
              this.vertexSrc = (0, c["default"])(o, !1), this.fragmentSrc = (0, f["default"])(o), this.firstRun = !1;
            }
            if (this.uniforms.strength = 1 / r.size.height * (r.size.height / e.size.height), this.uniforms.strength *= this.strength, this.uniforms.strength /= this.passes, 1 === this.passes) t.applyFilter(this, e, r, n);
            else {
              for (var s = t.getRenderTarget(!0), a = e, u = s, h = 0; h < this.passes - 1; h++) {
                t.applyFilter(this, a, u, !0);
                var l = u;
                u = a, a = l;
              }
              t.applyFilter(this, a, r, n), t.returnRenderTarget(s);
            }
          }, a(e, [{
            key: "blur",
            get: function get() {
              return this.strength;
            },
            set: function set(t) {
              this.padding = 2 * Math.abs(t), this.strength = t;
            }
          }, {
            key: "quality",
            get: function get() {
              return this._quality;
            },
            set: function set(t) {
              this._quality = t, this.passes = t;
            }
          }]), e;
        }(h.Filter);
      r["default"] = g;
    }, {
      "../../core": 65,
      "./generateBlurFragSource": 147,
      "./generateBlurVertSource": 148,
      "./getMaxBlurKernelSize": 149
    }],
    147: [function (t, e, r) {
      "use strict";

      function n(t) {
        for (var e = i[t], r = e.length, n = o, s = "", a = "gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;", u = void 0, h = 0; h < t; h++) {
          var l = a.replace("%index%", h);
          u = h, h >= r && (u = t - h - 1), l = l.replace("%value%", e[u]), s += l, s += "\n";
        }
        return n = n.replace("%blur%", s), n = n.replace("%size%", t);
      }
      r.__esModule = !0, r["default"] = n;
      var i = {
          5: [.153388, .221461, .250301],
          7: [.071303, .131514, .189879, .214607],
          9: [.028532, .067234, .124009, .179044, .20236],
          11: [.0093, .028002, .065984, .121703, .175713, .198596],
          13: [.002406, .009255, .027867, .065666, .121117, .174868, .197641],
          15: [489e-6, .002403, .009246, .02784, .065602, .120999, .174697, .197448]
        },
        o = ["varying vec2 vBlurTexCoords[%size%];", "uniform sampler2D uSampler;", "void main(void)", "{", "    gl_FragColor = vec4(0.0);", "    %blur%", "}"].join("\n");
    }, {}],
    148: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        var r = Math.ceil(t / 2),
          n = i,
          o = "",
          s = void 0;
        s = e ? "vBlurTexCoords[%index%] = aTextureCoord + vec2(%sampleIndex% * strength, 0.0);" : "vBlurTexCoords[%index%] = aTextureCoord + vec2(0.0, %sampleIndex% * strength);";
        for (var a = 0; a < t; a++) {
          var u = s.replace("%index%", a);
          u = u.replace("%sampleIndex%", a - (r - 1) + ".0"), o += u, o += "\n";
        }
        return n = n.replace("%blur%", o), n = n.replace("%size%", t);
      }
      r.__esModule = !0, r["default"] = n;
      var i = ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "uniform float strength;", "uniform mat3 projectionMatrix;", "varying vec2 vBlurTexCoords[%size%];", "void main(void)", "{", "gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);", "%blur%", "}"].join("\n");
    }, {}],
    149: [function (t, e, r) {
      "use strict";

      function n(t) {
        for (var e = t.getParameter(t.MAX_VARYING_VECTORS), r = 15; r > e;) r -= 2;
        return r;
      }
      r.__esModule = !0, r["default"] = n;
    }, {}],
    150: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = (t("path"), function (t) {
          function e() {
            n(this, e);
            var r = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n"));
            return r.uniforms.m = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0], r.alpha = 1, r;
          }
          return o(e, t), e.prototype._loadMatrix = function (t) {
            var e = arguments.length > 1 && void 0 !== arguments[1] && arguments[1],
              r = t;
            e && (this._multiply(r, this.uniforms.m, t), r = this._colorMatrix(r)), this.uniforms.m = r;
          }, e.prototype._multiply = function (t, e, r) {
            return t[0] = e[0] * r[0] + e[1] * r[5] + e[2] * r[10] + e[3] * r[15], t[1] = e[0] * r[1] + e[1] * r[6] + e[2] * r[11] + e[3] * r[16], t[2] = e[0] * r[2] + e[1] * r[7] + e[2] * r[12] + e[3] * r[17], t[3] = e[0] * r[3] + e[1] * r[8] + e[2] * r[13] + e[3] * r[18], t[4] = e[0] * r[4] + e[1] * r[9] + e[2] * r[14] + e[3] * r[19] + e[4], t[5] = e[5] * r[0] + e[6] * r[5] + e[7] * r[10] + e[8] * r[15], t[6] = e[5] * r[1] + e[6] * r[6] + e[7] * r[11] + e[8] * r[16], t[7] = e[5] * r[2] + e[6] * r[7] + e[7] * r[12] + e[8] * r[17], t[8] = e[5] * r[3] + e[6] * r[8] + e[7] * r[13] + e[8] * r[18], t[9] = e[5] * r[4] + e[6] * r[9] + e[7] * r[14] + e[8] * r[19] + e[9], t[10] = e[10] * r[0] + e[11] * r[5] + e[12] * r[10] + e[13] * r[15], t[11] = e[10] * r[1] + e[11] * r[6] + e[12] * r[11] + e[13] * r[16], t[12] = e[10] * r[2] + e[11] * r[7] + e[12] * r[12] + e[13] * r[17], t[13] = e[10] * r[3] + e[11] * r[8] + e[12] * r[13] + e[13] * r[18], t[14] = e[10] * r[4] + e[11] * r[9] + e[12] * r[14] + e[13] * r[19] + e[14], t[15] = e[15] * r[0] + e[16] * r[5] + e[17] * r[10] + e[18] * r[15], t[16] = e[15] * r[1] + e[16] * r[6] + e[17] * r[11] + e[18] * r[16], t[17] = e[15] * r[2] + e[16] * r[7] + e[17] * r[12] + e[18] * r[17], t[18] = e[15] * r[3] + e[16] * r[8] + e[17] * r[13] + e[18] * r[18], t[19] = e[15] * r[4] + e[16] * r[9] + e[17] * r[14] + e[18] * r[19] + e[19], t;
          }, e.prototype._colorMatrix = function (t) {
            var e = new Float32Array(t);
            return e[4] /= 255, e[9] /= 255, e[14] /= 255, e[19] /= 255, e;
          }, e.prototype.brightness = function (t, e) {
            var r = [t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, t, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(r, e);
          }, e.prototype.greyscale = function (t, e) {
            var r = [t, t, t, 0, 0, t, t, t, 0, 0, t, t, t, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(r, e);
          }, e.prototype.blackAndWhite = function (t) {
            var e = [.3, .6, .1, 0, 0, .3, .6, .1, 0, 0, .3, .6, .1, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.hue = function (t, e) {
            t = (t || 0) / 180 * Math.PI;
            var r = Math.cos(t),
              n = Math.sin(t),
              i = Math.sqrt,
              o = 1 / 3,
              s = i(o),
              a = r + (1 - r) * o,
              u = o * (1 - r) - s * n,
              h = o * (1 - r) + s * n,
              l = o * (1 - r) + s * n,
              c = r + o * (1 - r),
              d = o * (1 - r) - s * n,
              f = o * (1 - r) - s * n,
              p = o * (1 - r) + s * n,
              v = r + o * (1 - r),
              g = [a, u, h, 0, 0, l, c, d, 0, 0, f, p, v, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(g, e);
          }, e.prototype.contrast = function (t, e) {
            var r = (t || 0) + 1,
              n = -.5 * (r - 1),
              i = [r, 0, 0, 0, n, 0, r, 0, 0, n, 0, 0, r, 0, n, 0, 0, 0, 1, 0];
            this._loadMatrix(i, e);
          }, e.prototype.saturate = function () {
            var t = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0,
              e = arguments[1],
              r = 2 * t / 3 + 1,
              n = -.5 * (r - 1),
              i = [r, n, n, 0, 0, n, r, n, 0, 0, n, n, r, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(i, e);
          }, e.prototype.desaturate = function () {
            this.saturate(-1);
          }, e.prototype.negative = function (t) {
            var e = [-1, 0, 0, 1, 0, 0, -1, 0, 1, 0, 0, 0, -1, 1, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.sepia = function (t) {
            var e = [.393, .7689999, .18899999, 0, 0, .349, .6859999, .16799999, 0, 0, .272, .5339999, .13099999, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.technicolor = function (t) {
            var e = [1.9125277891456083, -.8545344976951645, -.09155508482755585, 0, 11.793603434377337, -.3087833385928097, 1.7658908555458428, -.10601743074722245, 0, -70.35205161461398, -.231103377548616, -.7501899197440212, 1.847597816108189, 0, 30.950940869491138, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.polaroid = function (t) {
            var e = [1.438, -.062, -.062, 0, 0, -.122, 1.378, -.122, 0, 0, -.016, -.016, 1.483, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.toBGR = function (t) {
            var e = [0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.kodachrome = function (t) {
            var e = [1.1285582396593525, -.3967382283601348, -.03992559172921793, 0, 63.72958762196502, -.16404339962244616, 1.0835251566291304, -.05498805115633132, 0, 24.732407896706203, -.16786010706155763, -.5603416277695248, 1.6014850761964943, 0, 35.62982807460946, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.browni = function (t) {
            var e = [.5997023498159715, .34553243048391263, -.2708298674538042, 0, 47.43192855600873, -.037703249837783157, .8609577587992641, .15059552388459913, 0, -36.96841498319127, .24113635128153335, -.07441037908422492, .44972182064877153, 0, -7.562075277591283, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.vintage = function (t) {
            var e = [.6279345635605994, .3202183420819367, -.03965408211312453, 0, 9.651285835294123, .02578397704808868, .6441188644374771, .03259127616149294, 0, 7.462829176470591, .0466055556782719, -.0851232987247891, .5241648018700465, 0, 5.159190588235296, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.colorTone = function (t, e, r, n, i) {
            t = t || .2, e = e || .15, r = r || 16770432, n = n || 3375104;
            var o = (r >> 16 & 255) / 255,
              s = (r >> 8 & 255) / 255,
              a = (255 & r) / 255,
              u = (n >> 16 & 255) / 255,
              h = (n >> 8 & 255) / 255,
              l = (255 & n) / 255,
              c = [.3, .59, .11, 0, 0, o, s, a, t, 0, u, h, l, e, 0, o - u, s - h, a - l, 0, 0];
            this._loadMatrix(c, i);
          }, e.prototype.night = function (t, e) {
            t = t || .1;
            var r = [-2 * t, -t, 0, 0, 0, -t, 0, t, 0, 0, 0, t, 2 * t, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(r, e);
          }, e.prototype.predator = function (t, e) {
            var r = [11.224130630493164 * t, -4.794486999511719 * t, -2.8746118545532227 * t, 0 * t, .40342438220977783 * t, -3.6330697536468506 * t, 9.193157196044922 * t, -2.951810836791992 * t, 0 * t, -1.316135048866272 * t, -3.2184197902679443 * t, -4.2375030517578125 * t, 7.476448059082031 * t, 0 * t, .8044459223747253 * t, 0, 0, 0, 1, 0];
            this._loadMatrix(r, e);
          }, e.prototype.lsd = function (t) {
            var e = [2, -.4, .5, 0, 0, -.5, 2, -.4, 0, 0, -.4, -.5, 3, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(e, t);
          }, e.prototype.reset = function () {
            var t = [1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0];
            this._loadMatrix(t, !1);
          }, s(e, [{
            key: "matrix",
            get: function get() {
              return this.uniforms.m;
            },
            set: function set(t) {
              this.uniforms.m = t;
            }
          }, {
            key: "alpha",
            get: function get() {
              return this.uniforms.uAlpha;
            },
            set: function set(t) {
              this.uniforms.uAlpha = t;
            }
          }]), e;
        }(u.Filter));
      r["default"] = h, h.prototype.grayscale = h.prototype.greyscale;
    }, {
      "../../core": 65,
      path: 8
    }],
    151: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = (t("path"), function (t) {
          function e(r, o) {
            n(this, e);
            var s = new u.Matrix();
            r.renderable = !1;
            var a = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vFilterCoord = ( filterMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vTextureCoord = aTextureCoord;\n}", "varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform vec4 filterArea;\nuniform vec4 filterClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy *= scale / filterArea.xy;\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), filterClamp.xy, filterClamp.zw));\n}\n"));
            return a.maskSprite = r, a.maskMatrix = s, a.uniforms.mapSampler = r._texture, a.uniforms.filterMatrix = s, a.uniforms.scale = {
              x: 1,
              y: 1
            }, null !== o && void 0 !== o || (o = 20), a.scale = new u.Point(o, o), a;
          }
          return o(e, t), e.prototype.apply = function (t, e, r) {
            this.uniforms.filterMatrix = t.calculateSpriteMatrix(this.maskMatrix, this.maskSprite), this.uniforms.scale.x = this.scale.x, this.uniforms.scale.y = this.scale.y, t.applyFilter(this, e, r);
          }, s(e, [{
            key: "map",
            get: function get() {
              return this.uniforms.mapSampler;
            },
            set: function set(t) {
              this.uniforms.mapSampler = t;
            }
          }]), e;
        }(u.Filter));
      r["default"] = h;
    }, {
      "../../core": 65,
      path: 8
    }],
    152: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("../../core"),
        a = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(s),
        u = (t("path"), function (t) {
          function e() {
            return n(this, e), i(this, t.call(this, "\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform vec4 filterArea;\n\nvarying vec2 vTextureCoord;\n\nvec2 mapCoord( vec2 coord )\n{\n    coord *= filterArea.xy;\n    coord += filterArea.zw;\n\n    return coord;\n}\n\nvec2 unmapCoord( vec2 coord )\n{\n    coord -= filterArea.zw;\n    coord /= filterArea.xy;\n\n    return coord;\n}\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n   vTextureCoord = aTextureCoord;\n\n   vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n   texcoords(fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}", 'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform vec4 filterArea;\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n \n --\n \n From:\n https://github.com/mitsuhiko/webgl-meincraft\n \n Copyright (c) 2011 by Armin Ronacher.\n \n Some rights reserved.\n \n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n \n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n \n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n \n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n \n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n    \n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n    \n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n    \n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n    \n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n    \n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec2 fragCoord = vTextureCoord * filterArea.xy;\n\n      vec4 color;\n\n    color = fxaa(uSampler, fragCoord, filterArea.xy, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n'));
          }
          return o(e, t), e;
        }(a.Filter));
      r["default"] = u;
    }, {
      "../../core": 65,
      path: 8
    }],
    153: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./fxaa/FXAAFilter");
      Object.defineProperty(r, "FXAAFilter", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./noise/NoiseFilter");
      Object.defineProperty(r, "NoiseFilter", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./displacement/DisplacementFilter");
      Object.defineProperty(r, "DisplacementFilter", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./blur/BlurFilter");
      Object.defineProperty(r, "BlurFilter", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      });
      var u = t("./blur/BlurXFilter");
      Object.defineProperty(r, "BlurXFilter", {
        enumerable: !0,
        get: function get() {
          return n(u)["default"];
        }
      });
      var h = t("./blur/BlurYFilter");
      Object.defineProperty(r, "BlurYFilter", {
        enumerable: !0,
        get: function get() {
          return n(h)["default"];
        }
      });
      var l = t("./colormatrix/ColorMatrixFilter");
      Object.defineProperty(r, "ColorMatrixFilter", {
        enumerable: !0,
        get: function get() {
          return n(l)["default"];
        }
      });
      var c = t("./alpha/AlphaFilter");
      Object.defineProperty(r, "AlphaFilter", {
        enumerable: !0,
        get: function get() {
          return n(c)["default"];
        }
      });
    }, {
      "./alpha/AlphaFilter": 143,
      "./blur/BlurFilter": 144,
      "./blur/BlurXFilter": 145,
      "./blur/BlurYFilter": 146,
      "./colormatrix/ColorMatrixFilter": 150,
      "./displacement/DisplacementFilter": 151,
      "./fxaa/FXAAFilter": 152,
      "./noise/NoiseFilter": 154
    }],
    154: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = (t("path"), function (t) {
          function e() {
            var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : .5,
              o = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : Math.random();
            n(this, e);
            var s = i(this, t.call(this, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}", "precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n"));
            return s.noise = r, s.seed = o, s;
          }
          return o(e, t), s(e, [{
            key: "noise",
            get: function get() {
              return this.uniforms.uNoise;
            },
            set: function set(t) {
              this.uniforms.uNoise = t;
            }
          }, {
            key: "seed",
            get: function get() {
              return this.uniforms.uSeed;
            },
            set: function set(t) {
              this.uniforms.uSeed = t;
            }
          }]), e;
        }(u.Filter));
      r["default"] = h;
    }, {
      "../../core": 65,
      path: 8
    }],
    155: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = t("../core"),
        s = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(o),
        a = function () {
          function t() {
            n(this, t), this.global = new s.Point(), this.target = null, this.originalEvent = null, this.identifier = null, this.isPrimary = !1, this.button = 0, this.buttons = 0, this.width = 0, this.height = 0, this.tiltX = 0, this.tiltY = 0, this.pointerType = null, this.pressure = 0, this.rotationAngle = 0, this.twist = 0, this.tangentialPressure = 0;
          }
          return t.prototype.getLocalPosition = function (t, e, r) {
            return t.worldTransform.applyInverse(r || this.global, e);
          }, t.prototype.copyEvent = function (t) {
            t.isPrimary && (this.isPrimary = !0), this.button = t.button, this.buttons = Number.isInteger(t.buttons) ? t.buttons : t.which, this.width = t.width, this.height = t.height, this.tiltX = t.tiltX, this.tiltY = t.tiltY, this.pointerType = t.pointerType, this.pressure = t.pressure, this.rotationAngle = t.rotationAngle, this.twist = t.twist || 0, this.tangentialPressure = t.tangentialPressure || 0;
          }, t.prototype.reset = function () {
            this.isPrimary = !1;
          }, i(t, [{
            key: "pointerId",
            get: function get() {
              return this.identifier;
            }
          }]), t;
        }();
      r["default"] = a;
    }, {
      "../core": 65
    }],
    156: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t() {
          n(this, t), this.stopped = !1, this.target = null, this.currentTarget = null, this.type = null, this.data = null;
        }
        return t.prototype.stopPropagation = function () {
          this.stopped = !0;
        }, t.prototype.reset = function () {
          this.stopped = !1, this.currentTarget = null, this.target = null;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    157: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = "function" == typeof Symbol && "symbol" == _typeof(Symbol.iterator) ? function (t) {
          return _typeof(t);
        } : function (t) {
          return t && "function" == typeof Symbol && t.constructor === Symbol && t !== Symbol.prototype ? "symbol" : _typeof(t);
        },
        u = t("../core"),
        h = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(u),
        l = t("./InteractionData"),
        c = n(l),
        d = t("./InteractionEvent"),
        f = n(d),
        p = t("./InteractionTrackingData"),
        v = n(p),
        g = t("eventemitter3"),
        y = n(g),
        m = t("./interactiveTarget"),
        _ = n(m);
      h.utils.mixins.delayMixin(h.DisplayObject.prototype, _["default"]);
      var b = 1,
        x = {
          target: null,
          data: {
            global: null
          }
        },
        T = function (t) {
          function e(r, n) {
            i(this, e);
            var s = o(this, t.call(this));
            return n = n || {}, s.renderer = r, s.autoPreventDefault = void 0 === n.autoPreventDefault || n.autoPreventDefault, s.interactionFrequency = n.interactionFrequency || 10, s.mouse = new c["default"](), s.mouse.identifier = b, s.mouse.global.set(-999999), s.activeInteractionData = {}, s.activeInteractionData[b] = s.mouse, s.interactionDataPool = [], s.eventData = new f["default"](), s.interactionDOMElement = null, s.moveWhenInside = !1, s.eventsAdded = !1, s.mouseOverRenderer = !1, s.supportsTouchEvents = "ontouchstart" in window, s.supportsPointerEvents = !!window.PointerEvent, s.onPointerUp = s.onPointerUp.bind(s), s.processPointerUp = s.processPointerUp.bind(s), s.onPointerCancel = s.onPointerCancel.bind(s), s.processPointerCancel = s.processPointerCancel.bind(s), s.onPointerDown = s.onPointerDown.bind(s), s.processPointerDown = s.processPointerDown.bind(s), s.onPointerMove = s.onPointerMove.bind(s), s.processPointerMove = s.processPointerMove.bind(s), s.onPointerOut = s.onPointerOut.bind(s), s.processPointerOverOut = s.processPointerOverOut.bind(s), s.onPointerOver = s.onPointerOver.bind(s), s.cursorStyles = {
              "default": "inherit",
              pointer: "pointer"
            }, s.currentCursorMode = null, s.cursor = null, s._tempPoint = new h.Point(), s.resolution = 1, s.setTargetElement(s.renderer.view, s.renderer.resolution), s;
          }
          return s(e, t), e.prototype.hitTest = function (t, e) {
            return x.target = null, x.data.global = t, e || (e = this.renderer._lastObjectRendered), this.processInteractive(x, e, null, !0), x.target;
          }, e.prototype.setTargetElement = function (t) {
            var e = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
            this.removeEvents(), this.interactionDOMElement = t, this.resolution = e, this.addEvents();
          }, e.prototype.addEvents = function () {
            this.interactionDOMElement && (h.ticker.shared.add(this.update, this, h.UPDATE_PRIORITY.INTERACTION), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "none", this.interactionDOMElement.style["-ms-touch-action"] = "none") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = "none"), this.supportsPointerEvents ? (window.document.addEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("pointerover", this.onPointerOver, !0), window.addEventListener("pointercancel", this.onPointerCancel, !0), window.addEventListener("pointerup", this.onPointerUp, !0)) : (window.document.addEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.addEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.addEventListener("mouseover", this.onPointerOver, !0), window.addEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.addEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.addEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.addEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.addEventListener("touchmove", this.onPointerMove, !0)), this.eventsAdded = !0);
          }, e.prototype.removeEvents = function () {
            this.interactionDOMElement && (h.ticker.shared.remove(this.update, this), window.navigator.msPointerEnabled ? (this.interactionDOMElement.style["-ms-content-zooming"] = "", this.interactionDOMElement.style["-ms-touch-action"] = "") : this.supportsPointerEvents && (this.interactionDOMElement.style["touch-action"] = ""), this.supportsPointerEvents ? (window.document.removeEventListener("pointermove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("pointerdown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("pointerleave", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("pointerover", this.onPointerOver, !0), window.removeEventListener("pointercancel", this.onPointerCancel, !0), window.removeEventListener("pointerup", this.onPointerUp, !0)) : (window.document.removeEventListener("mousemove", this.onPointerMove, !0), this.interactionDOMElement.removeEventListener("mousedown", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("mouseout", this.onPointerOut, !0), this.interactionDOMElement.removeEventListener("mouseover", this.onPointerOver, !0), window.removeEventListener("mouseup", this.onPointerUp, !0)), this.supportsTouchEvents && (this.interactionDOMElement.removeEventListener("touchstart", this.onPointerDown, !0), this.interactionDOMElement.removeEventListener("touchcancel", this.onPointerCancel, !0), this.interactionDOMElement.removeEventListener("touchend", this.onPointerUp, !0), this.interactionDOMElement.removeEventListener("touchmove", this.onPointerMove, !0)), this.interactionDOMElement = null, this.eventsAdded = !1);
          }, e.prototype.update = function (t) {
            if (this._deltaTime += t, !(this._deltaTime < this.interactionFrequency) && (this._deltaTime = 0, this.interactionDOMElement)) {
              if (this.didMove) return void(this.didMove = !1);
              this.cursor = null;
              for (var e in this.activeInteractionData)
                if (this.activeInteractionData.hasOwnProperty(e)) {
                  var r = this.activeInteractionData[e];
                  if (r.originalEvent && "touch" !== r.pointerType) {
                    var n = this.configureInteractionEventForDOMEvent(this.eventData, r.originalEvent, r);
                    this.processInteractive(n, this.renderer._lastObjectRendered, this.processPointerOverOut, !0);
                  }
                }
              this.setCursorMode(this.cursor);
            }
          }, e.prototype.setCursorMode = function (t) {
            if (t = t || "default", this.currentCursorMode !== t) {
              this.currentCursorMode = t;
              var e = this.cursorStyles[t];
              if (e) switch (void 0 === e ? "undefined" : a(e)) {
                case "string":
                  this.interactionDOMElement.style.cursor = e;
                  break;
                case "function":
                  e(t);
                  break;
                case "object":
                  Object.assign(this.interactionDOMElement.style, e);
              } else "string" != typeof t || Object.prototype.hasOwnProperty.call(this.cursorStyles, t) || (this.interactionDOMElement.style.cursor = t);
            }
          }, e.prototype.dispatchEvent = function (t, e, r) {
            r.stopped || (r.currentTarget = t, r.type = e, t.emit(e, r), t[e] && t[e](r));
          }, e.prototype.mapPositionToPoint = function (t, e, r) {
            var n = void 0;
            n = this.interactionDOMElement.parentElement ? this.interactionDOMElement.getBoundingClientRect() : {
              x: 0,
              y: 0,
              width: 0,
              height: 0
            };
            var i = navigator.isCocoonJS ? this.resolution : 1 / this.resolution;
            t.x = (e - n.left) * (this.interactionDOMElement.width / n.width) * i, t.y = (r - n.top) * (this.interactionDOMElement.height / n.height) * i;
          }, e.prototype.processInteractive = function (t, e, r, n, i) {
            if (!e || !e.visible) return !1;
            var o = t.data.global;
            i = e.interactive || i;
            var s = !1,
              a = i,
              u = !0;
            if (e.hitArea ? (n && (e.worldTransform.applyInverse(o, this._tempPoint), e.hitArea.contains(this._tempPoint.x, this._tempPoint.y) ? s = !0 : (n = !1, u = !1)), a = !1) : e._mask && n && (e._mask.containsPoint(o) || (n = !1, u = !1)), u && e.interactiveChildren && e.children)
              for (var h = e.children, l = h.length - 1; l >= 0; l--) {
                var c = h[l],
                  d = this.processInteractive(t, c, r, n, a);
                if (d) {
                  if (!c.parent) continue;
                  a = !1, d && (t.target && (n = !1), s = !0);
                }
              }
            return i && (n && !t.target && !e.hitArea && e.containsPoint && e.containsPoint(o) && (s = !0), e.interactive && (s && !t.target && (t.target = e), r && r(t, e, !!s))), s;
          }, e.prototype.onPointerDown = function (t) {
            if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
              var e = this.normalizeToPointerData(t);
              this.autoPreventDefault && e[0].isNormalized && t.preventDefault();
              for (var r = e.length, n = 0; n < r; n++) {
                var i = e[n],
                  o = this.getInteractionDataForPointerId(i),
                  s = this.configureInteractionEventForDOMEvent(this.eventData, i, o);
                if (s.data.originalEvent = t, this.processInteractive(s, this.renderer._lastObjectRendered, this.processPointerDown, !0), this.emit("pointerdown", s), "touch" === i.pointerType) this.emit("touchstart", s);
                else if ("mouse" === i.pointerType || "pen" === i.pointerType) {
                  var a = 2 === i.button;
                  this.emit(a ? "rightdown" : "mousedown", this.eventData);
                }
              }
            }
          }, e.prototype.processPointerDown = function (t, e, r) {
            var n = t.data,
              i = t.data.identifier;
            if (r)
              if (e.trackedPointers[i] || (e.trackedPointers[i] = new v["default"](i)), this.dispatchEvent(e, "pointerdown", t), "touch" === n.pointerType) this.dispatchEvent(e, "touchstart", t);
              else if ("mouse" === n.pointerType || "pen" === n.pointerType) {
              var o = 2 === n.button;
              o ? e.trackedPointers[i].rightDown = !0 : e.trackedPointers[i].leftDown = !0, this.dispatchEvent(e, o ? "rightdown" : "mousedown", t);
            }
          }, e.prototype.onPointerComplete = function (t, e, r) {
            for (var n = this.normalizeToPointerData(t), i = n.length, o = t.target !== this.interactionDOMElement ? "outside" : "", s = 0; s < i; s++) {
              var a = n[s],
                u = this.getInteractionDataForPointerId(a),
                h = this.configureInteractionEventForDOMEvent(this.eventData, a, u);
              if (h.data.originalEvent = t, this.processInteractive(h, this.renderer._lastObjectRendered, r, e || !o), this.emit(e ? "pointercancel" : "pointerup" + o, h), "mouse" === a.pointerType || "pen" === a.pointerType) {
                var l = 2 === a.button;
                this.emit(l ? "rightup" + o : "mouseup" + o, h);
              } else "touch" === a.pointerType && (this.emit(e ? "touchcancel" : "touchend" + o, h), this.releaseInteractionDataForPointerId(a.pointerId, u));
            }
          }, e.prototype.onPointerCancel = function (t) {
            this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !0, this.processPointerCancel);
          }, e.prototype.processPointerCancel = function (t, e) {
            var r = t.data,
              n = t.data.identifier;
            void 0 !== e.trackedPointers[n] && (delete e.trackedPointers[n], this.dispatchEvent(e, "pointercancel", t), "touch" === r.pointerType && this.dispatchEvent(e, "touchcancel", t));
          }, e.prototype.onPointerUp = function (t) {
            this.supportsTouchEvents && "touch" === t.pointerType || this.onPointerComplete(t, !1, this.processPointerUp);
          }, e.prototype.processPointerUp = function (t, e, r) {
            var n = t.data,
              i = t.data.identifier,
              o = e.trackedPointers[i],
              s = "touch" === n.pointerType,
              a = "mouse" === n.pointerType || "pen" === n.pointerType,
              u = !1;
            if (a) {
              var h = 2 === n.button,
                l = v["default"].FLAGS,
                c = h ? l.RIGHT_DOWN : l.LEFT_DOWN,
                d = void 0 !== o && o.flags & c;
              r ? (this.dispatchEvent(e, h ? "rightup" : "mouseup", t), d && (this.dispatchEvent(e, h ? "rightclick" : "click", t), u = !0)) : d && this.dispatchEvent(e, h ? "rightupoutside" : "mouseupoutside", t), o && (h ? o.rightDown = !1 : o.leftDown = !1);
            }
            r ? (this.dispatchEvent(e, "pointerup", t), s && this.dispatchEvent(e, "touchend", t), o && (a && !u || this.dispatchEvent(e, "pointertap", t), s && (this.dispatchEvent(e, "tap", t), o.over = !1))) : o && (this.dispatchEvent(e, "pointerupoutside", t), s && this.dispatchEvent(e, "touchendoutside", t)), o && o.none && delete e.trackedPointers[i];
          }, e.prototype.onPointerMove = function (t) {
            if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
              var e = this.normalizeToPointerData(t);
              "mouse" !== e[0].pointerType && "pen" !== e[0].pointerType || (this.didMove = !0, this.cursor = null);
              for (var r = e.length, n = 0; n < r; n++) {
                var i = e[n],
                  o = this.getInteractionDataForPointerId(i),
                  s = this.configureInteractionEventForDOMEvent(this.eventData, i, o);
                s.data.originalEvent = t;
                var a = "touch" !== i.pointerType || this.moveWhenInside;
                this.processInteractive(s, this.renderer._lastObjectRendered, this.processPointerMove, a), this.emit("pointermove", s), "touch" === i.pointerType && this.emit("touchmove", s), "mouse" !== i.pointerType && "pen" !== i.pointerType || this.emit("mousemove", s);
              }
              "mouse" === e[0].pointerType && this.setCursorMode(this.cursor);
            }
          }, e.prototype.processPointerMove = function (t, e, r) {
            var n = t.data,
              i = "touch" === n.pointerType,
              o = "mouse" === n.pointerType || "pen" === n.pointerType;
            o && this.processPointerOverOut(t, e, r), this.moveWhenInside && !r || (this.dispatchEvent(e, "pointermove", t), i && this.dispatchEvent(e, "touchmove", t), o && this.dispatchEvent(e, "mousemove", t));
          }, e.prototype.onPointerOut = function (t) {
            if (!this.supportsTouchEvents || "touch" !== t.pointerType) {
              var e = this.normalizeToPointerData(t),
                r = e[0];
              "mouse" === r.pointerType && (this.mouseOverRenderer = !1, this.setCursorMode(null));
              var n = this.getInteractionDataForPointerId(r),
                i = this.configureInteractionEventForDOMEvent(this.eventData, r, n);
              i.data.originalEvent = r, this.processInteractive(i, this.renderer._lastObjectRendered, this.processPointerOverOut, !1), this.emit("pointerout", i), "mouse" === r.pointerType || "pen" === r.pointerType ? this.emit("mouseout", i) : this.releaseInteractionDataForPointerId(n.identifier);
            }
          }, e.prototype.processPointerOverOut = function (t, e, r) {
            var n = t.data,
              i = t.data.identifier,
              o = "mouse" === n.pointerType || "pen" === n.pointerType,
              s = e.trackedPointers[i];
            r && !s && (s = e.trackedPointers[i] = new v["default"](i)), void 0 !== s && (r && this.mouseOverRenderer ? (s.over || (s.over = !0, this.dispatchEvent(e, "pointerover", t), o && this.dispatchEvent(e, "mouseover", t)), o && null === this.cursor && (this.cursor = e.cursor)) : s.over && (s.over = !1, this.dispatchEvent(e, "pointerout", this.eventData), o && this.dispatchEvent(e, "mouseout", t), s.none && delete e.trackedPointers[i]));
          }, e.prototype.onPointerOver = function (t) {
            var e = this.normalizeToPointerData(t),
              r = e[0],
              n = this.getInteractionDataForPointerId(r),
              i = this.configureInteractionEventForDOMEvent(this.eventData, r, n);
            i.data.originalEvent = r, "mouse" === r.pointerType && (this.mouseOverRenderer = !0), this.emit("pointerover", i), "mouse" !== r.pointerType && "pen" !== r.pointerType || this.emit("mouseover", i);
          }, e.prototype.getInteractionDataForPointerId = function (t) {
            var e = t.pointerId,
              r = void 0;
            return e === b || "mouse" === t.pointerType ? r = this.mouse : this.activeInteractionData[e] ? r = this.activeInteractionData[e] : (r = this.interactionDataPool.pop() || new c["default"](), r.identifier = e, this.activeInteractionData[e] = r), r.copyEvent(t), r;
          }, e.prototype.releaseInteractionDataForPointerId = function (t) {
            var e = this.activeInteractionData[t];
            e && (delete this.activeInteractionData[t], e.reset(), this.interactionDataPool.push(e));
          }, e.prototype.configureInteractionEventForDOMEvent = function (t, e, r) {
            return t.data = r, this.mapPositionToPoint(r.global, e.clientX, e.clientY), navigator.isCocoonJS && "touch" === e.pointerType && (r.global.x = r.global.x / this.resolution, r.global.y = r.global.y / this.resolution), "touch" === e.pointerType && (e.globalX = r.global.x, e.globalY = r.global.y), r.originalEvent = e, t.reset(), t;
          }, e.prototype.normalizeToPointerData = function (t) {
            var e = [];
            if (this.supportsTouchEvents && t instanceof TouchEvent)
              for (var r = 0, n = t.changedTouches.length; r < n; r++) {
                var i = t.changedTouches[r];
                void 0 === i.button && (i.button = t.touches.length ? 1 : 0), void 0 === i.buttons && (i.buttons = t.touches.length ? 1 : 0), void 0 === i.isPrimary && (i.isPrimary = 1 === t.touches.length && "touchstart" === t.type), void 0 === i.width && (i.width = i.radiusX || 1), void 0 === i.height && (i.height = i.radiusY || 1), void 0 === i.tiltX && (i.tiltX = 0), void 0 === i.tiltY && (i.tiltY = 0), void 0 === i.pointerType && (i.pointerType = "touch"), void 0 === i.pointerId && (i.pointerId = i.identifier || 0), void 0 === i.pressure && (i.pressure = i.force || .5), void 0 === i.twist && (i.twist = 0), void 0 === i.tangentialPressure && (i.tangentialPressure = 0), void 0 === i.layerX && (i.layerX = i.offsetX = i.clientX), void 0 === i.layerY && (i.layerY = i.offsetY = i.clientY), i.isNormalized = !0, e.push(i);
              } else !(t instanceof MouseEvent) || this.supportsPointerEvents && t instanceof window.PointerEvent ? e.push(t) : (void 0 === t.isPrimary && (t.isPrimary = !0), void 0 === t.width && (t.width = 1), void 0 === t.height && (t.height = 1), void 0 === t.tiltX && (t.tiltX = 0), void 0 === t.tiltY && (t.tiltY = 0), void 0 === t.pointerType && (t.pointerType = "mouse"), void 0 === t.pointerId && (t.pointerId = b), void 0 === t.pressure && (t.pressure = .5), void 0 === t.twist && (t.twist = 0), void 0 === t.tangentialPressure && (t.tangentialPressure = 0), t.isNormalized = !0, e.push(t));
            return e;
          }, e.prototype.destroy = function () {
            this.removeEvents(), this.removeAllListeners(), this.renderer = null, this.mouse = null, this.eventData = null, this.interactionDOMElement = null, this.onPointerDown = null, this.processPointerDown = null, this.onPointerUp = null, this.processPointerUp = null, this.onPointerCancel = null, this.processPointerCancel = null, this.onPointerMove = null, this.processPointerMove = null, this.onPointerOut = null, this.processPointerOverOut = null, this.onPointerOver = null, this._tempPoint = null;
          }, e;
        }(y["default"]);
      r["default"] = T, h.WebGLRenderer.registerPlugin("interaction", T), h.CanvasRenderer.registerPlugin("interaction", T);
    }, {
      "../core": 65,
      "./InteractionData": 155,
      "./InteractionEvent": 156,
      "./InteractionTrackingData": 158,
      "./interactiveTarget": 160,
      eventemitter3: 3
    }],
    158: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        o = function () {
          function t(e) {
            n(this, t), this._pointerId = e, this._flags = t.FLAGS.NONE;
          }
          return t.prototype._doSet = function (t, e) {
            this._flags = e ? this._flags | t : this._flags & ~t;
          }, i(t, [{
            key: "pointerId",
            get: function get() {
              return this._pointerId;
            }
          }, {
            key: "flags",
            get: function get() {
              return this._flags;
            },
            set: function set(t) {
              this._flags = t;
            }
          }, {
            key: "none",
            get: function get() {
              return this._flags === this.constructor.FLAGS.NONE;
            }
          }, {
            key: "over",
            get: function get() {
              return 0 != (this._flags & this.constructor.FLAGS.OVER);
            },
            set: function set(t) {
              this._doSet(this.constructor.FLAGS.OVER, t);
            }
          }, {
            key: "rightDown",
            get: function get() {
              return 0 != (this._flags & this.constructor.FLAGS.RIGHT_DOWN);
            },
            set: function set(t) {
              this._doSet(this.constructor.FLAGS.RIGHT_DOWN, t);
            }
          }, {
            key: "leftDown",
            get: function get() {
              return 0 != (this._flags & this.constructor.FLAGS.LEFT_DOWN);
            },
            set: function set(t) {
              this._doSet(this.constructor.FLAGS.LEFT_DOWN, t);
            }
          }]), t;
        }();
      r["default"] = o, o.FLAGS = Object.freeze({
        NONE: 0,
        OVER: 1,
        LEFT_DOWN: 2,
        RIGHT_DOWN: 4
      });
    }, {}],
    159: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./InteractionData");
      Object.defineProperty(r, "InteractionData", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./InteractionManager");
      Object.defineProperty(r, "InteractionManager", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./interactiveTarget");
      Object.defineProperty(r, "interactiveTarget", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./InteractionTrackingData");
      Object.defineProperty(r, "InteractionTrackingData", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      });
      var u = t("./InteractionEvent");
      Object.defineProperty(r, "InteractionEvent", {
        enumerable: !0,
        get: function get() {
          return n(u)["default"];
        }
      });
    }, {
      "./InteractionData": 155,
      "./InteractionEvent": 156,
      "./InteractionManager": 157,
      "./InteractionTrackingData": 158,
      "./interactiveTarget": 160
    }],
    160: [function (t, e, r) {
      "use strict";

      r.__esModule = !0, r["default"] = {
        interactive: !1,
        interactiveChildren: !0,
        hitArea: null,
        get buttonMode() {
          return "pointer" === this.cursor;
        },
        set buttonMode(t) {
          t ? this.cursor = "pointer" : "pointer" === this.cursor && (this.cursor = null);
        },
        cursor: null,
        get trackedPointers() {
          return void 0 === this._trackedPointers && (this._trackedPointers = {}), this._trackedPointers;
        },
        _trackedPointers: void 0
      };
    }, {}],
    161: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        t.bitmapFont = a.BitmapText.registerFont(t.data, e);
      }
      r.__esModule = !0, r.parse = n, r["default"] = function () {
        return function (t, e) {
          if (!t.data || t.type !== s.Resource.TYPE.XML) return void e();
          if (0 === t.data.getElementsByTagName("page").length || 0 === t.data.getElementsByTagName("info").length || null === t.data.getElementsByTagName("info")[0].getAttribute("face")) return void e();
          var r = t.isDataUrl ? "" : o.dirname(t.url);
          t.isDataUrl && ("." === r && (r = ""), this.baseUrl && r && "/" === this.baseUrl.charAt(this.baseUrl.length - 1) && (r += "/")), (r = r.replace(this.baseUrl, "")) && "/" !== r.charAt(r.length - 1) && (r += "/");
          for (var i = t.data.getElementsByTagName("page"), a = {}, u = function u(r) {
              a[r.metadata.pageFile] = r.texture, Object.keys(a).length === i.length && (n(t, a), e());
            }, h = 0; h < i.length; ++h) {
            var l = i[h].getAttribute("file"),
              c = r + l,
              d = !1;
            for (var f in this.resources) {
              var p = this.resources[f];
              if (p.url === c) {
                p.metadata.pageFile = l, p.texture ? u(p) : p.onAfterMiddleware.add(u), d = !0;
                break;
              }
            }
            if (!d) {
              var v = {
                crossOrigin: t.crossOrigin,
                loadType: s.Resource.LOAD_TYPE.IMAGE,
                metadata: Object.assign({
                  pageFile: l
                }, t.metadata.imageMetadata),
                parentResource: t
              };
              this.add(c, v, u);
            }
          }
        };
      };
      var i = t("path"),
        o = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(i),
        s = t("resource-loader"),
        a = t("../extras");
    }, {
      "../extras": 141,
      path: 8,
      "resource-loader": 36
    }],
    162: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0, r.shared = r.Resource = r.textureParser = r.getResourcePath = r.spritesheetParser = r.parseBitmapFontData = r.bitmapFontParser = r.Loader = void 0;
      var i = t("./bitmapFontParser");
      Object.defineProperty(r, "bitmapFontParser", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      }), Object.defineProperty(r, "parseBitmapFontData", {
        enumerable: !0,
        get: function get() {
          return i.parse;
        }
      });
      var o = t("./spritesheetParser");
      Object.defineProperty(r, "spritesheetParser", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      }), Object.defineProperty(r, "getResourcePath", {
        enumerable: !0,
        get: function get() {
          return o.getResourcePath;
        }
      });
      var s = t("./textureParser");
      Object.defineProperty(r, "textureParser", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("resource-loader");
      Object.defineProperty(r, "Resource", {
        enumerable: !0,
        get: function get() {
          return a.Resource;
        }
      });
      var u = t("../core/Application"),
        h = n(u),
        l = t("./loader"),
        c = n(l);
      r.Loader = c["default"];
      var d = new c["default"]();
      d.destroy = function () {}, r.shared = d;
      var f = h["default"].prototype;
      f._loader = null, Object.defineProperty(f, "loader", {
        get: function get() {
          if (!this._loader) {
            var t = this._options.sharedLoader;
            this._loader = t ? d : new c["default"]();
          }
          return this._loader;
        }
      }), f._parentDestroy = f.destroy, f.destroy = function (t, e) {
        this._loader && (this._loader.destroy(), this._loader = null), this._parentDestroy(t, e);
      };
    }, {
      "../core/Application": 43,
      "./bitmapFontParser": 161,
      "./loader": 163,
      "./spritesheetParser": 164,
      "./textureParser": 165,
      "resource-loader": 36
    }],
    163: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("resource-loader"),
        u = n(a),
        h = t("resource-loader/lib/middlewares/parsing/blob"),
        l = t("eventemitter3"),
        c = n(l),
        d = t("./textureParser"),
        f = n(d),
        p = t("./spritesheetParser"),
        v = n(p),
        g = t("./bitmapFontParser"),
        y = n(g),
        m = function (t) {
          function e(r, n) {
            i(this, e);
            var s = o(this, t.call(this, r, n));
            c["default"].call(s);
            for (var a = 0; a < e._pixiMiddleware.length; ++a) s.use(e._pixiMiddleware[a]());
            return s.onStart.add(function (t) {
              return s.emit("start", t);
            }), s.onProgress.add(function (t, e) {
              return s.emit("progress", t, e);
            }), s.onError.add(function (t, e, r) {
              return s.emit("error", t, e, r);
            }), s.onLoad.add(function (t, e) {
              return s.emit("load", t, e);
            }), s.onComplete.add(function (t, e) {
              return s.emit("complete", t, e);
            }), s;
          }
          return s(e, t), e.addPixiMiddleware = function (t) {
            e._pixiMiddleware.push(t);
          }, e.prototype.destroy = function () {
            this.removeAllListeners(), this.reset();
          }, e;
        }(u["default"]);
      r["default"] = m;
      for (var _ in c["default"].prototype) m.prototype[_] = c["default"].prototype[_];
      m._pixiMiddleware = [h.blobMiddlewareFactory, f["default"], v["default"], y["default"]];
      var b = u["default"].Resource;
      b.setExtensionXhrType("fnt", b.XHR_RESPONSE_TYPE.DOCUMENT);
    }, {
      "./bitmapFontParser": 161,
      "./spritesheetParser": 164,
      "./textureParser": 165,
      eventemitter3: 3,
      "resource-loader": 36,
      "resource-loader/lib/middlewares/parsing/blob": 37
    }],
    164: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        return t.isDataUrl ? t.data.meta.image : s["default"].resolve(t.url.replace(e, ""), t.data.meta.image);
      }
      r.__esModule = !0, r["default"] = function () {
        return function (t, e) {
          var r = t.name + "_image";
          if (!t.data || t.type !== i.Resource.TYPE.JSON || !t.data.frames || this.resources[r]) return void e();
          var o = {
              crossOrigin: t.crossOrigin,
              metadata: t.metadata.imageMetadata,
              parentResource: t
            },
            s = n(t, this.baseUrl);
          this.add(r, s, o, function (r) {
            if (r.error) return void e(r.error);
            var n = new a.Spritesheet(r.texture.baseTexture, t.data, t.url);
            n.parse(function () {
              t.spritesheet = n, t.textures = n.textures, e();
            });
          });
        };
      }, r.getResourcePath = n;
      var i = t("resource-loader"),
        o = t("url"),
        s = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(o),
        a = t("../core");
    }, {
      "../core": 65,
      "resource-loader": 36,
      url: 38
    }],
    165: [function (t, e, r) {
      "use strict";

      r.__esModule = !0, r["default"] = function () {
        return function (t, e) {
          t.data && t.type === n.Resource.TYPE.IMAGE && (t.texture = o["default"].fromLoader(t.data, t.url, t.name)), e();
        };
      };
      var n = t("resource-loader"),
        i = t("../core/textures/Texture"),
        o = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(i);
    }, {
      "../core/textures/Texture": 115,
      "resource-loader": 36
    }],
    166: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("../core/textures/Texture"),
        l = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(h),
        c = new u.Point(),
        d = new u.Polygon(),
        f = function (t) {
          function e(r, o, s, a, h) {
            n(this, e);
            var c = i(this, t.call(this));
            return c._texture = r || l["default"].EMPTY, c.uvs = s || new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), c.vertices = o || new Float32Array([0, 0, 100, 0, 100, 100, 0, 100]), c.indices = a || new Uint16Array([0, 1, 3, 2]), c.dirty = 0, c.indexDirty = 0, c.vertexDirty = 0, c.autoUpdate = !0, c.blendMode = u.BLEND_MODES.NORMAL, c.canvasPadding = u.settings.MESH_CANVAS_PADDING, c.drawMode = h || e.DRAW_MODES.TRIANGLE_MESH, c.shader = null, c.tintRgb = new Float32Array([1, 1, 1]), c._glDatas = {}, c._uvTransform = new u.TextureMatrix(c._texture), c.uploadUvTransform = !1, c.pluginName = "mesh", c;
          }
          return o(e, t), e.prototype._renderWebGL = function (t) {
            this.refresh(), t.setObjectRenderer(t.plugins[this.pluginName]), t.plugins[this.pluginName].render(this);
          }, e.prototype._renderCanvas = function (t) {
            this.refresh(), t.plugins[this.pluginName].render(this);
          }, e.prototype._onTextureUpdate = function () {
            this._uvTransform.texture = this._texture, this.refresh();
          }, e.prototype.multiplyUvs = function () {
            this.uploadUvTransform || this._uvTransform.multiplyUvs(this.uvs);
          }, e.prototype.refresh = function (t) {
            this.autoUpdate && this.vertexDirty++, this._uvTransform.update(t) && this._refresh();
          }, e.prototype._refresh = function () {}, e.prototype._calculateBounds = function () {
            this._bounds.addVertices(this.transform, this.vertices, 0, this.vertices.length);
          }, e.prototype.containsPoint = function (t) {
            if (!this.getBounds().contains(t.x, t.y)) return !1;
            this.worldTransform.applyInverse(t, c);
            for (var r = this.vertices, n = d.points, i = this.indices, o = this.indices.length, s = this.drawMode === e.DRAW_MODES.TRIANGLES ? 3 : 1, a = 0; a + 2 < o; a += s) {
              var u = 2 * i[a],
                h = 2 * i[a + 1],
                l = 2 * i[a + 2];
              if (n[0] = r[u], n[1] = r[u + 1], n[2] = r[h], n[3] = r[h + 1], n[4] = r[l], n[5] = r[l + 1], d.contains(c.x, c.y)) return !0;
            }
            return !1;
          }, e.prototype.destroy = function (e) {
            for (var r in this._glDatas) {
              var n = this._glDatas[r];
              n.destroy ? n.destroy() : (n.vertexBuffer && (n.vertexBuffer.destroy(), n.vertexBuffer = null), n.indexBuffer && (n.indexBuffer.destroy(), n.indexBuffer = null), n.uvBuffer && (n.uvBuffer.destroy(), n.uvBuffer = null), n.vao && (n.vao.destroy(), n.vao = null));
            }
            this._glDatas = null, t.prototype.destroy.call(this, e);
          }, s(e, [{
            key: "texture",
            get: function get() {
              return this._texture;
            },
            set: function set(t) {
              this._texture !== t && (this._texture = t, t && (t.baseTexture.hasLoaded ? this._onTextureUpdate() : t.once("update", this._onTextureUpdate, this)));
            }
          }, {
            key: "tint",
            get: function get() {
              return u.utils.rgb2hex(this.tintRgb);
            },
            set: function set(t) {
              this.tintRgb = u.utils.hex2rgb(t, this.tintRgb);
            }
          }]), e;
        }(u.Container);
      r["default"] = f, f.DRAW_MODES = {
        TRIANGLE_MESH: 0,
        TRIANGLES: 1
      };
    }, {
      "../core": 65,
      "../core/textures/Texture": 115
    }],
    167: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        u = t("./Plane"),
        h = n(u),
        l = t("../core/sprites/canvas/CanvasTinter"),
        c = n(l),
        d = 10,
        f = function (t) {
          function e(r, n, s, a, u) {
            i(this, e);
            var h = o(this, t.call(this, r, 4, 4));
            return h._origWidth = r.orig.width, h._origHeight = r.orig.height, h._width = h._origWidth, h._height = h._origHeight, h._leftWidth = void 0 !== n ? n : d, h._rightWidth = void 0 !== a ? a : d, h._topHeight = void 0 !== s ? s : d, h._bottomHeight = void 0 !== u ? u : d, h._cachedTint = 16777215, h._tintedTexture = null, h._canvasUvs = null, h.refresh(!0), h;
          }
          return s(e, t), e.prototype.updateHorizontalVertices = function () {
            var t = this.vertices,
              e = this._topHeight + this._bottomHeight,
              r = this._height > e ? 1 : this._height / e;
            t[9] = t[11] = t[13] = t[15] = this._topHeight * r, t[17] = t[19] = t[21] = t[23] = this._height - this._bottomHeight * r, t[25] = t[27] = t[29] = t[31] = this._height;
          }, e.prototype.updateVerticalVertices = function () {
            var t = this.vertices,
              e = this._leftWidth + this._rightWidth,
              r = this._width > e ? 1 : this._width / e;
            t[2] = t[10] = t[18] = t[26] = this._leftWidth * r, t[4] = t[12] = t[20] = t[28] = this._width - this._rightWidth * r, t[6] = t[14] = t[22] = t[30] = this._width;
          }, e.prototype._renderCanvas = function (t) {
            var e = t.context,
              r = this.worldTransform,
              n = t.resolution,
              i = 16777215 !== this.tint,
              o = this._texture;
            i && this._cachedTint !== this.tint && (this._cachedTint = this.tint, this._tintedTexture = c["default"].getTintedTexture(this, this.tint));
            var s = i ? this._tintedTexture : o.baseTexture.source;
            this._canvasUvs || (this._canvasUvs = [0, 0, 0, 0, 0, 0, 0, 0]);
            var a = this.vertices,
              u = this._canvasUvs,
              h = i ? 0 : o.frame.x,
              l = i ? 0 : o.frame.y,
              d = h + o.frame.width,
              f = l + o.frame.height;
            u[0] = h, u[1] = h + this._leftWidth, u[2] = d - this._rightWidth, u[3] = d, u[4] = l, u[5] = l + this._topHeight, u[6] = f - this._bottomHeight, u[7] = f;
            for (var p = 0; p < 8; p++) u[p] *= o.baseTexture.resolution;
            e.globalAlpha = this.worldAlpha, t.setBlendMode(this.blendMode), t.roundPixels ? e.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n | 0, r.ty * n | 0) : e.setTransform(r.a * n, r.b * n, r.c * n, r.d * n, r.tx * n, r.ty * n);
            for (var v = 0; v < 3; v++)
              for (var g = 0; g < 3; g++) {
                var y = 2 * g + 8 * v,
                  m = Math.max(1, u[g + 1] - u[g]),
                  _ = Math.max(1, u[v + 5] - u[v + 4]),
                  b = Math.max(1, a[y + 10] - a[y]),
                  x = Math.max(1, a[y + 11] - a[y + 1]);
                e.drawImage(s, u[g], u[v + 4], m, _, a[y], a[y + 1], b, x);
              }
          }, e.prototype._refresh = function () {
            t.prototype._refresh.call(this);
            var e = this.uvs,
              r = this._texture;
            this._origWidth = r.orig.width, this._origHeight = r.orig.height;
            var n = 1 / this._origWidth,
              i = 1 / this._origHeight;
            e[0] = e[8] = e[16] = e[24] = 0, e[1] = e[3] = e[5] = e[7] = 0, e[6] = e[14] = e[22] = e[30] = 1, e[25] = e[27] = e[29] = e[31] = 1, e[2] = e[10] = e[18] = e[26] = n * this._leftWidth, e[4] = e[12] = e[20] = e[28] = 1 - n * this._rightWidth, e[9] = e[11] = e[13] = e[15] = i * this._topHeight, e[17] = e[19] = e[21] = e[23] = 1 - i * this._bottomHeight, this.updateHorizontalVertices(), this.updateVerticalVertices(), this.dirty++, this.multiplyUvs();
          }, a(e, [{
            key: "width",
            get: function get() {
              return this._width;
            },
            set: function set(t) {
              this._width = t, this._refresh();
            }
          }, {
            key: "height",
            get: function get() {
              return this._height;
            },
            set: function set(t) {
              this._height = t, this._refresh();
            }
          }, {
            key: "leftWidth",
            get: function get() {
              return this._leftWidth;
            },
            set: function set(t) {
              this._leftWidth = t, this._refresh();
            }
          }, {
            key: "rightWidth",
            get: function get() {
              return this._rightWidth;
            },
            set: function set(t) {
              this._rightWidth = t, this._refresh();
            }
          }, {
            key: "topHeight",
            get: function get() {
              return this._topHeight;
            },
            set: function set(t) {
              this._topHeight = t, this._refresh();
            }
          }, {
            key: "bottomHeight",
            get: function get() {
              return this._bottomHeight;
            },
            set: function set(t) {
              this._bottomHeight = t, this._refresh();
            }
          }]), e;
        }(h["default"]);
      r["default"] = f;
    }, {
      "../core/sprites/canvas/CanvasTinter": 104,
      "./Plane": 168
    }],
    168: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("./Mesh"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e(r, o, s) {
            n(this, e);
            var u = i(this, t.call(this, r));
            return u._ready = !0, u.verticesX = o || 10, u.verticesY = s || 10, u.drawMode = a["default"].DRAW_MODES.TRIANGLES, u.refresh(), u;
          }
          return o(e, t), e.prototype._refresh = function () {
            for (var t = this._texture, e = this.verticesX * this.verticesY, r = [], n = [], i = [], o = [], s = this.verticesX - 1, a = this.verticesY - 1, u = t.width / s, h = t.height / a, l = 0; l < e; l++) {
              var c = l % this.verticesX,
                d = l / this.verticesX | 0;
              r.push(c * u, d * h), i.push(c / s, d / a);
            }
            for (var f = s * a, p = 0; p < f; p++) {
              var v = p % s,
                g = p / s | 0,
                y = g * this.verticesX + v,
                m = g * this.verticesX + v + 1,
                _ = (g + 1) * this.verticesX + v,
                b = (g + 1) * this.verticesX + v + 1;
              o.push(y, m, _), o.push(m, b, _);
            }
            this.vertices = new Float32Array(r), this.uvs = new Float32Array(i), this.colors = new Float32Array(n), this.indices = new Uint16Array(o), this.dirty++, this.indexDirty++, this.multiplyUvs();
          }, e.prototype._onTextureUpdate = function () {
            a["default"].prototype._onTextureUpdate.call(this), this._ready && this.refresh();
          }, e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "./Mesh": 166
    }],
    169: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("./Mesh"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e(r, o) {
            n(this, e);
            var s = i(this, t.call(this, r));
            return s.points = o, s.vertices = new Float32Array(4 * o.length), s.uvs = new Float32Array(4 * o.length), s.colors = new Float32Array(2 * o.length), s.indices = new Uint16Array(2 * o.length), s.autoUpdate = !0, s.refresh(), s;
          }
          return o(e, t), e.prototype._refresh = function () {
            var t = this.points;
            if (!(t.length < 1) && this._texture._uvs) {
              this.vertices.length / 4 !== t.length && (this.vertices = new Float32Array(4 * t.length), this.uvs = new Float32Array(4 * t.length), this.colors = new Float32Array(2 * t.length), this.indices = new Uint16Array(2 * t.length));
              var e = this.uvs,
                r = this.indices,
                n = this.colors;
              e[0] = 0, e[1] = 0, e[2] = 0, e[3] = 1, n[0] = 1, n[1] = 1, r[0] = 0, r[1] = 1;
              for (var i = t.length, o = 1; o < i; o++) {
                var s = 4 * o,
                  a = o / (i - 1);
                e[s] = a, e[s + 1] = 0, e[s + 2] = a, e[s + 3] = 1, s = 2 * o, n[s] = 1, n[s + 1] = 1, s = 2 * o, r[s] = s, r[s + 1] = s + 1;
              }
              this.dirty++, this.indexDirty++, this.multiplyUvs(), this.refreshVertices();
            }
          }, e.prototype.refreshVertices = function () {
            var t = this.points;
            if (!(t.length < 1))
              for (var e = t[0], r = void 0, n = 0, i = 0, o = this.vertices, s = t.length, a = 0; a < s; a++) {
                var u = t[a],
                  h = 4 * a;
                r = a < t.length - 1 ? t[a + 1] : u, i = -(r.x - e.x), n = r.y - e.y;
                var l = 10 * (1 - a / (s - 1));
                l > 1 && (l = 1);
                var c = Math.sqrt(n * n + i * i),
                  d = this._texture.height / 2;
                n /= c, i /= c, n *= d, i *= d, o[h] = u.x + n, o[h + 1] = u.y + i, o[h + 2] = u.x - n, o[h + 3] = u.y - i, e = u;
              }
          }, e.prototype.updateTransform = function () {
            this.autoUpdate && this.refreshVertices(), this.containerUpdateTransform();
          }, e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "./Mesh": 166
    }],
    170: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = t("../../core"),
        o = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(i),
        s = t("../Mesh"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function () {
          function t(e) {
            n(this, t), this.renderer = e;
          }
          return t.prototype.render = function (t) {
            var e = this.renderer,
              r = e.context,
              n = t.worldTransform,
              i = e.resolution;
            e.roundPixels ? r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i | 0, n.ty * i | 0) : r.setTransform(n.a * i, n.b * i, n.c * i, n.d * i, n.tx * i, n.ty * i), e.context.globalAlpha = t.worldAlpha, e.setBlendMode(t.blendMode), t.drawMode === a["default"].DRAW_MODES.TRIANGLE_MESH ? this._renderTriangleMesh(t) : this._renderTriangles(t);
          }, t.prototype._renderTriangleMesh = function (t) {
            for (var e = t.vertices.length / 2, r = 0; r < e - 2; r++) {
              var n = 2 * r;
              this._renderDrawTriangle(t, n, n + 2, n + 4);
            }
          }, t.prototype._renderTriangles = function (t) {
            for (var e = t.indices, r = e.length, n = 0; n < r; n += 3) {
              var i = 2 * e[n],
                o = 2 * e[n + 1],
                s = 2 * e[n + 2];
              this._renderDrawTriangle(t, i, o, s);
            }
          }, t.prototype._renderDrawTriangle = function (t, e, r, n) {
            var i = this.renderer.context,
              o = t.uvs,
              s = t.vertices,
              a = t._texture;
            if (a.valid) {
              var u = a.baseTexture,
                h = u.source,
                l = u.width,
                c = u.height,
                d = void 0,
                f = void 0,
                p = void 0,
                v = void 0,
                g = void 0,
                y = void 0;
              if (t.uploadUvTransform) {
                var m = t._uvTransform.mapCoord;
                d = (o[e] * m.a + o[e + 1] * m.c + m.tx) * u.width, f = (o[r] * m.a + o[r + 1] * m.c + m.tx) * u.width, p = (o[n] * m.a + o[n + 1] * m.c + m.tx) * u.width, v = (o[e] * m.b + o[e + 1] * m.d + m.ty) * u.height, g = (o[r] * m.b + o[r + 1] * m.d + m.ty) * u.height, y = (o[n] * m.b + o[n + 1] * m.d + m.ty) * u.height;
              } else d = o[e] * u.width, f = o[r] * u.width, p = o[n] * u.width, v = o[e + 1] * u.height, g = o[r + 1] * u.height, y = o[n + 1] * u.height;
              var _ = s[e],
                b = s[r],
                x = s[n],
                T = s[e + 1],
                w = s[r + 1],
                E = s[n + 1],
                S = t.canvasPadding / this.renderer.resolution;
              if (S > 0) {
                var O = S / Math.abs(t.worldTransform.a),
                  M = S / Math.abs(t.worldTransform.d),
                  P = (_ + b + x) / 3,
                  C = (T + w + E) / 3,
                  R = _ - P,
                  A = T - C,
                  I = Math.sqrt(R * R + A * A);
                _ = P + R / I * (I + O), T = C + A / I * (I + M), R = b - P, A = w - C, I = Math.sqrt(R * R + A * A), b = P + R / I * (I + O), w = C + A / I * (I + M), R = x - P, A = E - C, I = Math.sqrt(R * R + A * A), x = P + R / I * (I + O), E = C + A / I * (I + M);
              }
              i.save(), i.beginPath(), i.moveTo(_, T), i.lineTo(b, w), i.lineTo(x, E), i.closePath(), i.clip();
              var D = d * g + v * p + f * y - g * p - v * f - d * y,
                L = _ * g + v * x + b * y - g * x - v * b - _ * y,
                N = d * b + _ * p + f * x - b * p - _ * f - d * x,
                B = d * g * x + v * b * p + _ * f * y - _ * g * p - v * f * x - d * b * y,
                k = T * g + v * E + w * y - g * E - v * w - T * y,
                F = d * w + T * p + f * E - w * p - T * f - d * E,
                j = d * g * E + v * w * p + T * f * y - T * g * p - v * f * E - d * w * y;
              i.transform(L / D, k / D, N / D, F / D, B / D, j / D), i.drawImage(h, 0, 0, l * u.resolution, c * u.resolution, 0, 0, l, c), i.restore(), this.renderer.invalidateBlendMode();
            }
          }, t.prototype.renderMeshFlat = function (t) {
            var e = this.renderer.context,
              r = t.vertices,
              n = r.length / 2;
            e.beginPath();
            for (var i = 1; i < n - 2; ++i) {
              var o = 2 * i,
                s = r[o],
                a = r[o + 1],
                u = r[o + 2],
                h = r[o + 3],
                l = r[o + 4],
                c = r[o + 5];
              e.moveTo(s, a), e.lineTo(u, h), e.lineTo(l, c);
            }
            e.fillStyle = "#FF0000", e.fill(), e.closePath();
          }, t.prototype.destroy = function () {
            this.renderer = null;
          }, t;
        }();
      r["default"] = u, o.CanvasRenderer.registerPlugin("mesh", u);
    }, {
      "../../core": 65,
      "../Mesh": 166
    }],
    171: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./Mesh");
      Object.defineProperty(r, "Mesh", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./webgl/MeshRenderer");
      Object.defineProperty(r, "MeshRenderer", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./canvas/CanvasMeshRenderer");
      Object.defineProperty(r, "CanvasMeshRenderer", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./Plane");
      Object.defineProperty(r, "Plane", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      });
      var u = t("./NineSlicePlane");
      Object.defineProperty(r, "NineSlicePlane", {
        enumerable: !0,
        get: function get() {
          return n(u)["default"];
        }
      });
      var h = t("./Rope");
      Object.defineProperty(r, "Rope", {
        enumerable: !0,
        get: function get() {
          return n(h)["default"];
        }
      });
    }, {
      "./Mesh": 166,
      "./NineSlicePlane": 167,
      "./Plane": 168,
      "./Rope": 169,
      "./canvas/CanvasMeshRenderer": 170,
      "./webgl/MeshRenderer": 172
    }],
    172: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("pixi-gl-core"),
        l = n(h),
        c = t("../Mesh"),
        d = n(c),
        f = (t("path"), u.Matrix.IDENTITY),
        p = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this, r));
            return n.shader = null, n;
          }
          return s(e, t), e.prototype.onContextChange = function () {
            var t = this.renderer.gl;
            this.shader = new u.Shader(t, "attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n", "varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n");
          }, e.prototype.render = function (t) {
            var e = this.renderer,
              r = e.gl,
              n = t._texture;
            if (n.valid) {
              var i = t._glDatas[e.CONTEXT_UID];
              i || (e.bindVao(null), i = {
                shader: this.shader,
                vertexBuffer: l["default"].GLBuffer.createVertexBuffer(r, t.vertices, r.STREAM_DRAW),
                uvBuffer: l["default"].GLBuffer.createVertexBuffer(r, t.uvs, r.STREAM_DRAW),
                indexBuffer: l["default"].GLBuffer.createIndexBuffer(r, t.indices, r.STATIC_DRAW),
                vao: null,
                dirty: t.dirty,
                indexDirty: t.indexDirty,
                vertexDirty: t.vertexDirty
              }, i.vao = new l["default"].VertexArrayObject(r).addIndex(i.indexBuffer).addAttribute(i.vertexBuffer, i.shader.attributes.aVertexPosition, r.FLOAT, !1, 8, 0).addAttribute(i.uvBuffer, i.shader.attributes.aTextureCoord, r.FLOAT, !1, 8, 0), t._glDatas[e.CONTEXT_UID] = i), e.bindVao(i.vao), t.dirty !== i.dirty && (i.dirty = t.dirty, i.uvBuffer.upload(t.uvs)), t.indexDirty !== i.indexDirty && (i.indexDirty = t.indexDirty, i.indexBuffer.upload(t.indices)), t.vertexDirty !== i.vertexDirty && (i.vertexDirty = t.vertexDirty, i.vertexBuffer.upload(t.vertices)), e.bindShader(i.shader), i.shader.uniforms.uSampler = e.bindTexture(n), e.state.setBlendMode(u.utils.correctBlendMode(t.blendMode, n.baseTexture.premultipliedAlpha)), i.shader.uniforms.uTransform && (t.uploadUvTransform ? i.shader.uniforms.uTransform = t._uvTransform.mapCoord.toArray(!0) : i.shader.uniforms.uTransform = f.toArray(!0)), i.shader.uniforms.translationMatrix = t.worldTransform.toArray(!0), i.shader.uniforms.uColor = u.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, i.shader.uniforms.uColor, n.baseTexture.premultipliedAlpha);
              var o = t.drawMode === d["default"].DRAW_MODES.TRIANGLE_MESH ? r.TRIANGLE_STRIP : r.TRIANGLES;
              i.vao.draw(o, t.indices.length, 0);
            }
          }, e;
        }(u.ObjectRenderer);
      r["default"] = p, u.WebGLRenderer.registerPlugin("mesh", p);
    }, {
      "../../core": 65,
      "../Mesh": 166,
      path: 8,
      "pixi-gl-core": 15
    }],
    173: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = function () {
          function t(t, e) {
            for (var r = 0; r < e.length; r++) {
              var n = e[r];
              n.enumerable = n.enumerable || !1, n.configurable = !0, "value" in n && (n.writable = !0), Object.defineProperty(t, n.key, n);
            }
          }
          return function (e, r, n) {
            return r && t(e.prototype, r), n && t(e, n), e;
          };
        }(),
        a = t("../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("../core/utils"),
        l = function (t) {
          function e() {
            var r = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1500,
              o = arguments[1],
              s = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : 16384,
              a = arguments.length > 3 && void 0 !== arguments[3] && arguments[3];
            n(this, e);
            var h = i(this, t.call(this));
            return s > 16384 && (s = 16384), s > r && (s = r), h._properties = [!1, !0, !1, !1, !1], h._maxSize = r, h._batchSize = s, h._glBuffers = {}, h._bufferUpdateIDs = [], h._updateID = 0, h.interactiveChildren = !1, h.blendMode = u.BLEND_MODES.NORMAL, h.autoResize = a, h.roundPixels = !0, h.baseTexture = null, h.setProperties(o), h._tint = 0, h.tintRgb = new Float32Array(4), h.tint = 16777215, h;
          }
          return o(e, t), e.prototype.setProperties = function (t) {
            t && (this._properties[0] = "vertices" in t || "scale" in t ? !!t.vertices || !!t.scale : this._properties[0], this._properties[1] = "position" in t ? !!t.position : this._properties[1], this._properties[2] = "rotation" in t ? !!t.rotation : this._properties[2], this._properties[3] = "uvs" in t ? !!t.uvs : this._properties[3], this._properties[4] = "tint" in t || "alpha" in t ? !!t.tint || !!t.alpha : this._properties[4]);
          }, e.prototype.updateTransform = function () {
            this.displayObjectUpdateTransform();
          }, e.prototype.renderWebGL = function (t) {
            var e = this;
            this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable && (this.baseTexture || (this.baseTexture = this.children[0]._texture.baseTexture, this.baseTexture.hasLoaded || this.baseTexture.once("update", function () {
              return e.onChildrenChange(0);
            })), t.setObjectRenderer(t.plugins.particle), t.plugins.particle.render(this));
          }, e.prototype.onChildrenChange = function (t) {
            for (var e = Math.floor(t / this._batchSize); this._bufferUpdateIDs.length < e;) this._bufferUpdateIDs.push(0);
            this._bufferUpdateIDs[e] = ++this._updateID;
          }, e.prototype.renderCanvas = function (t) {
            if (this.visible && !(this.worldAlpha <= 0) && this.children.length && this.renderable) {
              var e = t.context,
                r = this.worldTransform,
                n = !0,
                i = 0,
                o = 0,
                s = 0,
                a = 0;
              t.setBlendMode(this.blendMode), e.globalAlpha = this.worldAlpha, this.displayObjectUpdateTransform();
              for (var u = 0; u < this.children.length; ++u) {
                var h = this.children[u];
                if (h.visible) {
                  var l = h._texture.frame;
                  if (e.globalAlpha = this.worldAlpha * h.alpha, h.rotation % (2 * Math.PI) == 0) n && (e.setTransform(r.a, r.b, r.c, r.d, r.tx * t.resolution, r.ty * t.resolution), n = !1), i = h.anchor.x * (-l.width * h.scale.x) + h.position.x + .5, o = h.anchor.y * (-l.height * h.scale.y) + h.position.y + .5, s = l.width * h.scale.x, a = l.height * h.scale.y;
                  else {
                    n || (n = !0), h.displayObjectUpdateTransform();
                    var c = h.worldTransform;
                    t.roundPixels ? e.setTransform(c.a, c.b, c.c, c.d, c.tx * t.resolution | 0, c.ty * t.resolution | 0) : e.setTransform(c.a, c.b, c.c, c.d, c.tx * t.resolution, c.ty * t.resolution), i = h.anchor.x * -l.width + .5, o = h.anchor.y * -l.height + .5, s = l.width, a = l.height;
                  }
                  var d = h._texture.baseTexture.resolution;
                  e.drawImage(h._texture.baseTexture.source, l.x * d, l.y * d, l.width * d, l.height * d, i * t.resolution, o * t.resolution, s * t.resolution, a * t.resolution);
                }
              }
            }
          }, e.prototype.destroy = function (e) {
            if (t.prototype.destroy.call(this, e), this._buffers)
              for (var r = 0; r < this._buffers.length; ++r) this._buffers[r].destroy();
            this._properties = null, this._buffers = null, this._bufferUpdateIDs = null;
          }, s(e, [{
            key: "tint",
            get: function get() {
              return this._tint;
            },
            set: function set(t) {
              this._tint = t, (0, h.hex2rgb)(t, this.tintRgb);
            }
          }]), e;
        }(u.Container);
      r["default"] = l;
    }, {
      "../core": 65,
      "../core/utils": 125
    }],
    174: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./ParticleContainer");
      Object.defineProperty(r, "ParticleContainer", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./webgl/ParticleRenderer");
      Object.defineProperty(r, "ParticleRenderer", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
    }, {
      "./ParticleContainer": 173,
      "./webgl/ParticleRenderer": 176
    }],
    175: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var o = t("pixi-gl-core"),
        s = n(o),
        a = t("../../core/utils/createIndicesForQuads"),
        u = n(a),
        h = function () {
          function t(e, r, n, o) {
            i(this, t), this.gl = e, this.size = o, this.dynamicProperties = [], this.staticProperties = [];
            for (var s = 0; s < r.length; ++s) {
              var a = r[s];
              a = {
                attribute: a.attribute,
                size: a.size,
                uploadFunction: a.uploadFunction,
                unsignedByte: a.unsignedByte,
                offset: a.offset
              }, n[s] ? this.dynamicProperties.push(a) : this.staticProperties.push(a);
            }
            this.staticStride = 0, this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null, this.dynamicStride = 0, this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this._updateID = 0, this.initBuffers();
          }
          return t.prototype.initBuffers = function () {
            var t = this.gl,
              e = 0;
            this.indices = (0, u["default"])(this.size), this.indexBuffer = s["default"].GLBuffer.createIndexBuffer(t, this.indices, t.STATIC_DRAW), this.dynamicStride = 0;
            for (var r = 0; r < this.dynamicProperties.length; ++r) {
              var n = this.dynamicProperties[r];
              n.offset = e, e += n.size, this.dynamicStride += n.size;
            }
            var i = new ArrayBuffer(this.size * this.dynamicStride * 4 * 4);
            this.dynamicData = new Float32Array(i), this.dynamicDataUint32 = new Uint32Array(i), this.dynamicBuffer = s["default"].GLBuffer.createVertexBuffer(t, i, t.STREAM_DRAW);
            var o = 0;
            this.staticStride = 0;
            for (var a = 0; a < this.staticProperties.length; ++a) {
              var h = this.staticProperties[a];
              h.offset = o, o += h.size, this.staticStride += h.size;
            }
            var l = new ArrayBuffer(this.size * this.staticStride * 4 * 4);
            this.staticData = new Float32Array(l), this.staticDataUint32 = new Uint32Array(l), this.staticBuffer = s["default"].GLBuffer.createVertexBuffer(t, l, t.STATIC_DRAW), this.vao = new s["default"].VertexArrayObject(t).addIndex(this.indexBuffer);
            for (var c = 0; c < this.dynamicProperties.length; ++c) {
              var d = this.dynamicProperties[c];
              d.unsignedByte ? this.vao.addAttribute(this.dynamicBuffer, d.attribute, t.UNSIGNED_BYTE, !0, 4 * this.dynamicStride, 4 * d.offset) : this.vao.addAttribute(this.dynamicBuffer, d.attribute, t.FLOAT, !1, 4 * this.dynamicStride, 4 * d.offset);
            }
            for (var f = 0; f < this.staticProperties.length; ++f) {
              var p = this.staticProperties[f];
              p.unsignedByte ? this.vao.addAttribute(this.staticBuffer, p.attribute, t.UNSIGNED_BYTE, !0, 4 * this.staticStride, 4 * p.offset) : this.vao.addAttribute(this.staticBuffer, p.attribute, t.FLOAT, !1, 4 * this.staticStride, 4 * p.offset);
            }
          }, t.prototype.uploadDynamic = function (t, e, r) {
            for (var n = 0; n < this.dynamicProperties.length; n++) {
              var i = this.dynamicProperties[n];
              i.uploadFunction(t, e, r, i.unsignedByte ? this.dynamicDataUint32 : this.dynamicData, this.dynamicStride, i.offset);
            }
            this.dynamicBuffer.upload();
          }, t.prototype.uploadStatic = function (t, e, r) {
            for (var n = 0; n < this.staticProperties.length; n++) {
              var i = this.staticProperties[n];
              i.uploadFunction(t, e, r, i.unsignedByte ? this.staticDataUint32 : this.staticData, this.staticStride, i.offset);
            }
            this.staticBuffer.upload();
          }, t.prototype.destroy = function () {
            this.dynamicProperties = null, this.dynamicBuffer.destroy(), this.dynamicBuffer = null, this.dynamicData = null, this.dynamicDataUint32 = null, this.staticProperties = null, this.staticBuffer.destroy(), this.staticBuffer = null, this.staticData = null, this.staticDataUint32 = null;
          }, t;
        }();
      r["default"] = h;
    }, {
      "../../core/utils/createIndicesForQuads": 123,
      "pixi-gl-core": 15
    }],
    176: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }

      function i(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function o(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function s(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("./ParticleShader"),
        l = n(h),
        c = t("./ParticleBuffer"),
        d = n(c),
        f = t("../../core/utils"),
        p = function (t) {
          function e(r) {
            i(this, e);
            var n = o(this, t.call(this, r));
            return n.shader = null, n.indexBuffer = null, n.properties = null, n.tempMatrix = new u.Matrix(), n.CONTEXT_UID = 0, n;
          }
          return s(e, t), e.prototype.onContextChange = function () {
            var t = this.renderer.gl;
            this.CONTEXT_UID = this.renderer.CONTEXT_UID, this.shader = new l["default"](t), this.properties = [{
              attribute: this.shader.attributes.aVertexPosition,
              size: 2,
              uploadFunction: this.uploadVertices,
              offset: 0
            }, {
              attribute: this.shader.attributes.aPositionCoord,
              size: 2,
              uploadFunction: this.uploadPosition,
              offset: 0
            }, {
              attribute: this.shader.attributes.aRotation,
              size: 1,
              uploadFunction: this.uploadRotation,
              offset: 0
            }, {
              attribute: this.shader.attributes.aTextureCoord,
              size: 2,
              uploadFunction: this.uploadUvs,
              offset: 0
            }, {
              attribute: this.shader.attributes.aColor,
              size: 1,
              unsignedByte: !0,
              uploadFunction: this.uploadTint,
              offset: 0
            }];
          }, e.prototype.start = function () {
            this.renderer.bindShader(this.shader);
          }, e.prototype.render = function (t) {
            var e = t.children,
              r = t._maxSize,
              n = t._batchSize,
              i = this.renderer,
              o = e.length;
            if (0 !== o) {
              o > r && (o = r);
              var s = t._glBuffers[i.CONTEXT_UID];
              s || (s = t._glBuffers[i.CONTEXT_UID] = this.generateBuffers(t));
              var a = e[0]._texture.baseTexture;
              this.renderer.setBlendMode(u.utils.correctBlendMode(t.blendMode, a.premultipliedAlpha));
              var h = i.gl,
                l = t.worldTransform.copy(this.tempMatrix);
              l.prepend(i._activeRenderTarget.projectionMatrix), this.shader.uniforms.projectionMatrix = l.toArray(!0), this.shader.uniforms.uColor = u.utils.premultiplyRgba(t.tintRgb, t.worldAlpha, this.shader.uniforms.uColor, a.premultipliedAlpha), this.shader.uniforms.uSampler = i.bindTexture(a);
              for (var c = !1, d = 0, f = 0; d < o; d += n, f += 1) {
                var p = o - d;
                if (p > n && (p = n), f >= s.length) {
                  if (!t.autoResize) break;
                  s.push(this._generateOneMoreBuffer(t));
                }
                var v = s[f];
                v.uploadDynamic(e, d, p);
                var g = t._bufferUpdateIDs[f] || 0;
                c = c || v._updateID < g, c && (v._updateID = t._updateID, v.uploadStatic(e, d, p)), i.bindVao(v.vao), v.vao.draw(h.TRIANGLES, 6 * p);
              }
            }
          }, e.prototype.generateBuffers = function (t) {
            for (var e = this.renderer.gl, r = [], n = t._maxSize, i = t._batchSize, o = t._properties, s = 0; s < n; s += i) r.push(new d["default"](e, this.properties, o, i));
            return r;
          }, e.prototype._generateOneMoreBuffer = function (t) {
            var e = this.renderer.gl,
              r = t._batchSize,
              n = t._properties;
            return new d["default"](e, this.properties, n, r);
          }, e.prototype.uploadVertices = function (t, e, r, n, i, o) {
            for (var s = 0, a = 0, u = 0, h = 0, l = 0; l < r; ++l) {
              var c = t[e + l],
                d = c._texture,
                f = c.scale.x,
                p = c.scale.y,
                v = d.trim,
                g = d.orig;
              v ? (a = v.x - c.anchor.x * g.width, s = a + v.width, h = v.y - c.anchor.y * g.height, u = h + v.height) : (s = g.width * (1 - c.anchor.x), a = g.width * -c.anchor.x, u = g.height * (1 - c.anchor.y), h = g.height * -c.anchor.y), n[o] = a * f, n[o + 1] = h * p, n[o + i] = s * f, n[o + i + 1] = h * p, n[o + 2 * i] = s * f, n[o + 2 * i + 1] = u * p, n[o + 3 * i] = a * f, n[o + 3 * i + 1] = u * p, o += 4 * i;
            }
          }, e.prototype.uploadPosition = function (t, e, r, n, i, o) {
            for (var s = 0; s < r; s++) {
              var a = t[e + s].position;
              n[o] = a.x, n[o + 1] = a.y, n[o + i] = a.x, n[o + i + 1] = a.y, n[o + 2 * i] = a.x, n[o + 2 * i + 1] = a.y, n[o + 3 * i] = a.x, n[o + 3 * i + 1] = a.y, o += 4 * i;
            }
          }, e.prototype.uploadRotation = function (t, e, r, n, i, o) {
            for (var s = 0; s < r; s++) {
              var a = t[e + s].rotation;
              n[o] = a, n[o + i] = a, n[o + 2 * i] = a, n[o + 3 * i] = a, o += 4 * i;
            }
          }, e.prototype.uploadUvs = function (t, e, r, n, i, o) {
            for (var s = 0; s < r; ++s) {
              var a = t[e + s]._texture._uvs;
              a ? (n[o] = a.x0, n[o + 1] = a.y0, n[o + i] = a.x1, n[o + i + 1] = a.y1, n[o + 2 * i] = a.x2, n[o + 2 * i + 1] = a.y2, n[o + 3 * i] = a.x3, n[o + 3 * i + 1] = a.y3, o += 4 * i) : (n[o] = 0, n[o + 1] = 0, n[o + i] = 0, n[o + i + 1] = 0, n[o + 2 * i] = 0, n[o + 2 * i + 1] = 0, n[o + 3 * i] = 0, n[o + 3 * i + 1] = 0, o += 4 * i);
            }
          }, e.prototype.uploadTint = function (t, e, r, n, i, o) {
            for (var s = 0; s < r; ++s) {
              var a = t[e + s],
                u = a._texture.baseTexture.premultipliedAlpha,
                h = a.alpha,
                l = h < 1 && u ? (0, f.premultiplyTint)(a._tintRGB, h) : a._tintRGB + (255 * h << 24);
              n[o] = l, n[o + i] = l, n[o + 2 * i] = l, n[o + 3 * i] = l, o += 4 * i;
            }
          }, e.prototype.destroy = function () {
            this.renderer.gl && this.renderer.gl.deleteBuffer(this.indexBuffer), t.prototype.destroy.call(this), this.shader.destroy(), this.indices = null, this.tempMatrix = null;
          }, e;
        }(u.ObjectRenderer);
      r["default"] = p, u.WebGLRenderer.registerPlugin("particle", p);
    }, {
      "../../core": 65,
      "../../core/utils": 125,
      "./ParticleBuffer": 175,
      "./ParticleShader": 177
    }],
    177: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }
      r.__esModule = !0;
      var s = t("../../core/Shader"),
        a = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(s),
        u = function (t) {
          function e(r) {
            return n(this, e), i(this, t.call(this, r, ["attribute vec2 aVertexPosition;", "attribute vec2 aTextureCoord;", "attribute vec4 aColor;", "attribute vec2 aPositionCoord;", "attribute float aRotation;", "uniform mat3 projectionMatrix;", "uniform vec4 uColor;", "varying vec2 vTextureCoord;", "varying vec4 vColor;", "void main(void){", "   float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);", "   float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);", "   vec2 v = vec2(x, y);", "   v = v + aPositionCoord;", "   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);", "   vTextureCoord = aTextureCoord;", "   vColor = aColor * uColor;", "}"].join("\n"), ["varying vec2 vTextureCoord;", "varying vec4 vColor;", "uniform sampler2D uSampler;", "void main(void){", "  vec4 color = texture2D(uSampler, vTextureCoord) * vColor;", "  gl_FragColor = color;", "}"].join("\n")));
          }
          return o(e, t), e;
        }(a["default"]);
      r["default"] = u;
    }, {
      "../../core/Shader": 44
    }],
    178: [function (t, e, r) {
      "use strict";

      Math.sign || (Math.sign = function (t) {
        return t = Number(t), 0 === t || isNaN(t) ? t : t > 0 ? 1 : -1;
      });
    }, {}],
    179: [function (t, e, r) {
      "use strict";

      Number.isInteger || (Number.isInteger = function (t) {
        return "number" == typeof t && isFinite(t) && Math.floor(t) === t;
      });
    }, {}],
    180: [function (t, e, r) {
      "use strict";

      var n = t("object-assign"),
        i = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(n);
      Object.assign || (Object.assign = i["default"]);
    }, {
      "object-assign": 6
    }],
    181: [function (t, e, r) {
      "use strict";

      t("./Object.assign"), t("./requestAnimationFrame"), t("./Math.sign"), t("./Number.isInteger"), window.ArrayBuffer || (window.ArrayBuffer = Array), window.Float32Array || (window.Float32Array = Array), window.Uint32Array || (window.Uint32Array = Array), window.Uint16Array || (window.Uint16Array = Array);
    }, {
      "./Math.sign": 178,
      "./Number.isInteger": 179,
      "./Object.assign": 180,
      "./requestAnimationFrame": 182
    }],
    182: [function (t, e, r) {
      (function (t) {
        "use strict";

        if (Date.now && Date.prototype.getTime || (Date.now = function () {
            return new Date().getTime();
          }), !t.performance || !t.performance.now) {
          var e = Date.now();
          t.performance || (t.performance = {}), t.performance.now = function () {
            return Date.now() - e;
          };
        }
        for (var r = Date.now(), n = ["ms", "moz", "webkit", "o"], i = 0; i < n.length && !t.requestAnimationFrame; ++i) {
          var o = n[i];
          t.requestAnimationFrame = t[o + "RequestAnimationFrame"], t.cancelAnimationFrame = t[o + "CancelAnimationFrame"] || t[o + "CancelRequestAnimationFrame"];
        }
        t.requestAnimationFrame || (t.requestAnimationFrame = function (t) {
          if ("function" != typeof t) throw new TypeError(t + "is not a function");
          var e = Date.now(),
            n = 16 + r - e;
          return n < 0 && (n = 0), r = e, setTimeout(function () {
            r = Date.now(), t(performance.now());
          }, n);
        }), t.cancelAnimationFrame || (t.cancelAnimationFrame = function (t) {
          return clearTimeout(t);
        });
      }).call(this, "undefined" != typeof __webpack_require__.g ? __webpack_require__.g : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {}],
    183: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        var r = !1;
        if (t && t._textures && t._textures.length)
          for (var n = 0; n < t._textures.length; n++)
            if (t._textures[n] instanceof d.Texture) {
              var i = t._textures[n].baseTexture; -
              1 === e.indexOf(i) && (e.push(i), r = !0);
            }
        return r;
      }

      function o(t, e) {
        return t instanceof d.BaseTexture && (-1 === e.indexOf(t) && e.push(t), !0);
      }

      function s(t, e) {
        if (t._texture && t._texture instanceof d.Texture) {
          var r = t._texture.baseTexture;
          return -1 === e.indexOf(r) && e.push(r), !0;
        }
        return !1;
      }

      function a(t, e) {
        return e instanceof d.Text && (e.updateText(!0), !0);
      }

      function u(t, e) {
        if (e instanceof d.TextStyle) {
          var r = e.toFontString();
          return d.TextMetrics.measureFont(r), !0;
        }
        return !1;
      }

      function h(t, e) {
        if (t instanceof d.Text) {
          -1 === e.indexOf(t.style) && e.push(t.style), -1 === e.indexOf(t) && e.push(t);
          var r = t._texture.baseTexture;
          return -1 === e.indexOf(r) && e.push(r), !0;
        }
        return !1;
      }

      function l(t, e) {
        return t instanceof d.TextStyle && (-1 === e.indexOf(t) && e.push(t), !0);
      }
      r.__esModule = !0;
      var c = t("../core"),
        d = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(c),
        f = t("./limiters/CountLimiter"),
        p = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(f),
        v = d.ticker.shared;
      d.settings.UPLOADS_PER_FRAME = 4;
      var g = function () {
        function t(e) {
          var r = this;
          n(this, t), this.limiter = new p["default"](d.settings.UPLOADS_PER_FRAME), this.renderer = e, this.uploadHookHelper = null, this.queue = [], this.addHooks = [], this.uploadHooks = [], this.completes = [], this.ticking = !1, this.delayedTick = function () {
            r.queue && r.prepareItems();
          }, this.registerFindHook(h), this.registerFindHook(l), this.registerFindHook(i), this.registerFindHook(o), this.registerFindHook(s), this.registerUploadHook(a), this.registerUploadHook(u);
        }
        return t.prototype.upload = function (t, e) {
          "function" == typeof t && (e = t, t = null), t && this.add(t), this.queue.length ? (e && this.completes.push(e), this.ticking || (this.ticking = !0, v.addOnce(this.tick, this, d.UPDATE_PRIORITY.UTILITY))) : e && e();
        }, t.prototype.tick = function () {
          setTimeout(this.delayedTick, 0);
        }, t.prototype.prepareItems = function () {
          for (this.limiter.beginFrame(); this.queue.length && this.limiter.allowedToUpload();) {
            var t = this.queue[0],
              e = !1;
            if (t && !t._destroyed)
              for (var r = 0, n = this.uploadHooks.length; r < n; r++)
                if (this.uploadHooks[r](this.uploadHookHelper, t)) {
                  this.queue.shift(), e = !0;
                  break;
                }
            e || this.queue.shift();
          }
          if (this.queue.length) v.addOnce(this.tick, this, d.UPDATE_PRIORITY.UTILITY);
          else {
            this.ticking = !1;
            var i = this.completes.slice(0);
            this.completes.length = 0;
            for (var o = 0, s = i.length; o < s; o++) i[o]();
          }
        }, t.prototype.registerFindHook = function (t) {
          return t && this.addHooks.push(t), this;
        }, t.prototype.registerUploadHook = function (t) {
          return t && this.uploadHooks.push(t), this;
        }, t.prototype.add = function (t) {
          for (var e = 0, r = this.addHooks.length; e < r && !this.addHooks[e](t, this.queue); e++);
          if (t instanceof d.Container)
            for (var n = t.children.length - 1; n >= 0; n--) this.add(t.children[n]);
          return this;
        }, t.prototype.destroy = function () {
          this.ticking && v.remove(this.tick, this), this.ticking = !1, this.addHooks = null, this.uploadHooks = null, this.renderer = null, this.completes = null, this.queue = null, this.limiter = null, this.uploadHookHelper = null;
        }, t;
      }();
      r["default"] = g;
    }, {
      "../core": 65,
      "./limiters/CountLimiter": 186
    }],
    184: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function s(t, e) {
        if (e instanceof u.BaseTexture) {
          var r = e.source,
            n = 0 === r.width ? t.canvas.width : Math.min(t.canvas.width, r.width),
            i = 0 === r.height ? t.canvas.height : Math.min(t.canvas.height, r.height);
          return t.ctx.drawImage(r, 0, 0, n, i, 0, 0, t.canvas.width, t.canvas.height), !0;
        }
        return !1;
      }
      r.__esModule = !0;
      var a = t("../../core"),
        u = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(a),
        h = t("../BasePrepare"),
        l = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(h),
        c = 16,
        d = function (t) {
          function e(r) {
            n(this, e);
            var o = i(this, t.call(this, r));
            return o.uploadHookHelper = o, o.canvas = document.createElement("canvas"), o.canvas.width = c, o.canvas.height = c, o.ctx = o.canvas.getContext("2d"), o.registerUploadHook(s), o;
          }
          return o(e, t), e.prototype.destroy = function () {
            t.prototype.destroy.call(this), this.ctx = null, this.canvas = null;
          }, e;
        }(l["default"]);
      r["default"] = d, u.CanvasRenderer.registerPlugin("prepare", d);
    }, {
      "../../core": 65,
      "../BasePrepare": 183
    }],
    185: [function (t, e, r) {
      "use strict";

      function n(t) {
        return t && t.__esModule ? t : {
          "default": t
        };
      }
      r.__esModule = !0;
      var i = t("./webgl/WebGLPrepare");
      Object.defineProperty(r, "webgl", {
        enumerable: !0,
        get: function get() {
          return n(i)["default"];
        }
      });
      var o = t("./canvas/CanvasPrepare");
      Object.defineProperty(r, "canvas", {
        enumerable: !0,
        get: function get() {
          return n(o)["default"];
        }
      });
      var s = t("./BasePrepare");
      Object.defineProperty(r, "BasePrepare", {
        enumerable: !0,
        get: function get() {
          return n(s)["default"];
        }
      });
      var a = t("./limiters/CountLimiter");
      Object.defineProperty(r, "CountLimiter", {
        enumerable: !0,
        get: function get() {
          return n(a)["default"];
        }
      });
      var u = t("./limiters/TimeLimiter");
      Object.defineProperty(r, "TimeLimiter", {
        enumerable: !0,
        get: function get() {
          return n(u)["default"];
        }
      });
    }, {
      "./BasePrepare": 183,
      "./canvas/CanvasPrepare": 184,
      "./limiters/CountLimiter": 186,
      "./limiters/TimeLimiter": 187,
      "./webgl/WebGLPrepare": 188
    }],
    186: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e) {
          n(this, t), this.maxItemsPerFrame = e, this.itemsLeft = 0;
        }
        return t.prototype.beginFrame = function () {
          this.itemsLeft = this.maxItemsPerFrame;
        }, t.prototype.allowedToUpload = function () {
          return this.itemsLeft-- > 0;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    187: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }
      r.__esModule = !0;
      var i = function () {
        function t(e) {
          n(this, t), this.maxMilliseconds = e, this.frameStart = 0;
        }
        return t.prototype.beginFrame = function () {
          this.frameStart = Date.now();
        }, t.prototype.allowedToUpload = function () {
          return Date.now() - this.frameStart < this.maxMilliseconds;
        }, t;
      }();
      r["default"] = i;
    }, {}],
    188: [function (t, e, r) {
      "use strict";

      function n(t, e) {
        if (!(t instanceof e)) throw new TypeError("Cannot call a class as a function");
      }

      function i(t, e) {
        if (!t) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
        return !e || "object" != _typeof(e) && "function" != typeof e ? t : e;
      }

      function o(t, e) {
        if ("function" != typeof e && null !== e) throw new TypeError("Super expression must either be null or a function, not " + _typeof(e));
        t.prototype = Object.create(e && e.prototype, {
          constructor: {
            value: t,
            enumerable: !1,
            writable: !0,
            configurable: !0
          }
        }), e && (Object.setPrototypeOf ? Object.setPrototypeOf(t, e) : t.__proto__ = e);
      }

      function s(t, e) {
        return e instanceof l.BaseTexture && (e._glTextures[t.CONTEXT_UID] || t.textureManager.updateTexture(e), !0);
      }

      function a(t, e) {
        return e instanceof l.Graphics && ((e.dirty || e.clearDirty || !e._webGL[t.plugins.graphics.CONTEXT_UID]) && t.plugins.graphics.updateGraphics(e), !0);
      }

      function u(t, e) {
        return t instanceof l.Graphics && (e.push(t), !0);
      }
      r.__esModule = !0;
      var h = t("../../core"),
        l = function (t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }(h),
        c = t("../BasePrepare"),
        d = function (t) {
          return t && t.__esModule ? t : {
            "default": t
          };
        }(c),
        f = function (t) {
          function e(r) {
            n(this, e);
            var o = i(this, t.call(this, r));
            return o.uploadHookHelper = o.renderer, o.registerFindHook(u), o.registerUploadHook(s), o.registerUploadHook(a), o;
          }
          return o(e, t), e;
        }(d["default"]);
      r["default"] = f, l.WebGLRenderer.registerPlugin("prepare", f);
    }, {
      "../../core": 65,
      "../BasePrepare": 183
    }],
    189: [function (t, e, r) {
      (function (e) {
        "use strict";

        function n(t) {
          if (t && t.__esModule) return t;
          var e = {};
          if (null != t)
            for (var r in t) Object.prototype.hasOwnProperty.call(t, r) && (e[r] = t[r]);
          return e["default"] = t, e;
        }
        r.__esModule = !0, r.loader = r.prepare = r.particles = r.mesh = r.loaders = r.interaction = r.filters = r.extras = r.extract = r.accessibility = void 0;
        var i = t("./polyfill");
        Object.keys(i).forEach(function (t) {
          "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
            enumerable: !0,
            get: function get() {
              return i[t];
            }
          });
        });
        var o = t("./core");
        Object.keys(o).forEach(function (t) {
          "default" !== t && "__esModule" !== t && Object.defineProperty(r, t, {
            enumerable: !0,
            get: function get() {
              return o[t];
            }
          });
        });
        var s = t("./deprecation"),
          a = function (t) {
            return t && t.__esModule ? t : {
              "default": t
            };
          }(s),
          u = t("./accessibility"),
          h = n(u),
          l = t("./extract"),
          c = n(l),
          d = t("./extras"),
          f = n(d),
          p = t("./filters"),
          v = n(p),
          g = t("./interaction"),
          y = n(g),
          m = t("./loaders"),
          _ = n(m),
          b = t("./mesh"),
          x = n(b),
          T = t("./particles"),
          w = n(T),
          E = t("./prepare"),
          S = n(E);
        o.utils.mixins.performMixins();
        var O = _.shared || null;
        r.accessibility = h, r.extract = c, r.extras = f, r.filters = v, r.interaction = y, r.loaders = _, r.mesh = x, r.particles = w, r.prepare = S, r.loader = O, "function" == typeof a["default"] && (0, a["default"])(r), e.PIXI = r;
      }).call(this, "undefined" != typeof __webpack_require__.g ? __webpack_require__.g : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {
      "./accessibility": 42,
      "./core": 65,
      "./deprecation": 131,
      "./extract": 133,
      "./extras": 141,
      "./filters": 153,
      "./interaction": 159,
      "./loaders": 162,
      "./mesh": 171,
      "./particles": 174,
      "./polyfill": 181,
      "./prepare": 185
    }]
  }, {}, [189])(189);
});

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	/* webpack/runtime/global */
/******/ 	(() => {
/******/ 		__webpack_require__.g = (function() {
/******/ 			if (typeof globalThis === 'object') return globalThis;
/******/ 			try {
/******/ 				return this || new Function('return this')();
/******/ 			} catch (e) {
/******/ 				if (typeof window === 'object') return window;
/******/ 			}
/******/ 		})();
/******/ 	})();
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module is referenced by other modules so it can't be inlined
/******/ 	var __webpack_exports__ = __webpack_require__("./src/index.ts");
/******/ 	var __webpack_export_target__ = exports;
/******/ 	for(var __webpack_i__ in __webpack_exports__) __webpack_export_target__[__webpack_i__] = __webpack_exports__[__webpack_i__];
/******/ 	if(__webpack_exports__.__esModule) Object.defineProperty(__webpack_export_target__, "__esModule", { value: true });
/******/ 	
/******/ })()
;